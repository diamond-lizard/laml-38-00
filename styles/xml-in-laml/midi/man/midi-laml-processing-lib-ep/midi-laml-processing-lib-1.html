<html><head><link href="../../../../../css-stylesheets/elucidator/program.css" rel="stylesheet" title="program" type="text/css" /> <title>Source file</title></head><body bgcolor="#ffffff" text="#000000" link="#000000" vlink="#000000"><font size="2"><pre><div class="schemedoc-abstract-comment">;;;; .title       Midi Function Library
;;;; .author      Kurt NÅ¯rmark
;;;; .affiliation Department of Computer Science, Aalborg University, Denmark
;;;; This is a library of common MIDI manipulation functions. 
;;;; It must be loaded together with the &lt;a href= "midi-mirror.html"&gt;MIDI LAML mirror library&lt;/a&gt;.
;;;; .laml-resource                 true
;;;; .css-prestylesheet             compact
;;;; .css-stylesheet                argentina
;;;; .css-stylesheet-copying        true
;;;; .scheme-source-linking         true 
;;;; .source-destination-delta      </div>
<span class="comment">; .schemedoc-dependencies  "man/midi-mirror.manlsp" "man/midi-laml-processing-lib.manlsp"
; schemedoc-dependencies  "man/midi-mirror.manlsp" 
; .source-file-dependencies "midi.scm" </span><br />

<span class="comment">; ---------------------------------------------------------------------------------------------------------------
; Mirror parameter setting</span><br />
(<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#set-xml-accept-only-string-valued-attributes-in" title="Manual: xml-in-laml">set-xml-accept-only-string-valued-attributes-in</a> 'midi #f)

<a name="ensure-all-abstime-in!"></a><span class="comment">; ---------------------------------------------------------------------------------------------------------------
; Issue a fatal error if deltaTime attributes is present in message-list. 
; operation is a parameter passed for error message purposes. </span><br /><a name="ensure-all-abstime-in!"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(ensure-all-abstime-in! operation message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">delta-time-messages</span> 
           (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#traverse-and-collect-all-from-ast" title="Manual: xml-in-laml">traverse-and-collect-all-from-ast</a> 
              message-list
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "NoteOn") (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'deltaTime #f)))
              <a class="schemedoc-name" href="../../../../../lib/man/general.html#id-1" title="Manual: general">id-1</a>)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> delta-time-messages) 0)
        (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "Only absTime mode is supported by" operation))))


<a name="ensure-all-deltatime-in!"></a><span class="comment">; Issue a fatal error if absTime attributes is present in message-list. 
; operation is a parameter passed for error message purposes. </span><br /><a name="ensure-all-deltatime-in!"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(ensure-all-deltatime-in! operation message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">delta-time-messages</span> 
           (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#traverse-and-collect-all-from-ast" title="Manual: xml-in-laml">traverse-and-collect-all-from-ast</a> 
              message-list
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "NoteOn") (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'absTime #f)))
              <a class="schemedoc-name" href="../../../../../lib/man/general.html#id-1" title="Manual: general">id-1</a>)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> delta-time-messages) 0)
        (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "Only deltaTime mode is supported by" operation))))


<a name="fuzzy-drums"></a><span class="comment">; ---------------------------------------------------------------------------------------------------------------
; Assume absTime</span><br />
<a name="fuzzy-drums"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(fuzzy-drums  message-list)</span>
   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#fuzzy-drum-1" title="midi-laml-processing-lib">fuzzy-drum-1</a> 
        message-list 
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> #f))
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> #f (<a class="schemedoc-name" href="../../../../../lib/man/general.html#butlast" title="Manual: general">butlast</a> message-list))))

<a name="fuzzy-drum-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(fuzzy-drum-1 this-mes next-mes prev-mes)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="midi-laml-processing-lib-1.html#drum-message?" title="midi-laml-processing-lib">drum-message?</a> this-mes)
            (<a class="applied-name" href="midi-laml-processing-lib-1.html#fuzzy-drum-message" title="midi-laml-processing-lib">fuzzy-drum-message</a> this-mes next-mes prev-mes))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> this-mes)))

<a name="fuzzy-drum-message"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(fuzzy-drum-message this-mes next-mes prev-mes)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">window-size</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> this-mes next-mes prev-mes)
                        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX247" title="R5RS Scheme form">max</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> next-mes 'absTime)) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> this-mes 'absTime)))
                             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> this-mes 'absTime)) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> prev-mes 'absTime))))
                        0)))
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> 
        ((<a class="applied-name" href="midi-laml-processing-lib-1.html#delete-message?" title="midi-laml-processing-lib">delete-message?</a> this-mes) '())
        ((<a class="applied-name" href="midi-laml-processing-lib-1.html#change-message-velocity?" title="midi-laml-processing-lib">change-message-velocity?</a> this-mes)
           (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> this-mes 'velocity (as-int-string (between 0 127 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> this-mes 'velocity)) (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-velocity" title="midi-laml-processing-lib">delta-velocity</a>))))))
        ((<a class="applied-name" href="midi-laml-processing-lib-1.html#move-message?" title="midi-laml-processing-lib">move-message?</a> this-mes)
           (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> this-mes 'absTime (as-int-string (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> this-mes 'absTime)) (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-move" title="midi-laml-processing-lib">delta-move</a> window-size)))))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> this-mes))))

<a name="drum-message?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(drum-message? mes)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "9" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'channel))
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "10" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'channel))))


<a name="delete-frequency"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">delete-frequency</span> 5)
<a name="move-frequency"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">move-frequency</span> 5)
<a name="velocity-change-frequency"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">velocity-change-frequency</span> 20)
<a name="velocity-max-change"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">velocity-max-change</span> 40)


<a name="delete-message?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(delete-message? mes)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">r</span> (random 100)))
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> r <a class="applied-name" href="midi-laml-processing-lib-1.html#delete-frequency" title="midi-laml-processing-lib">delete-frequency</a>)))

     

<a name="move-r"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">move-r</span> 0)

<a name="move-message?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(move-message? mes)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">r</span> (random 100)))
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> r <a class="applied-name" href="midi-laml-processing-lib-1.html#move-frequency" title="midi-laml-processing-lib">move-frequency</a>)
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#move-r" title="midi-laml-processing-lib">move-r</a> r) #t)
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#move-r" title="midi-laml-processing-lib">move-r</a> 0) #f))))

<a name="delta-move"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(delta-move window-size)</span>
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX246" title="R5RS Scheme form">even?</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#move-r" title="midi-laml-processing-lib">move-r</a>)
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (to-int (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#move-r" title="midi-laml-processing-lib">move-r</a> 100) window-size)))
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (to-int (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#move-r" title="midi-laml-processing-lib">move-r</a> 100) window-size)))))
          


<a name="vel-r"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">vel-r</span> 0)

<a name="change-message-velocity?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(change-message-velocity? mes)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">r</span> (random 100)))
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> r <a class="applied-name" href="midi-laml-processing-lib-1.html#velocity-change-frequency" title="midi-laml-processing-lib">velocity-change-frequency</a>)
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#vel-r" title="midi-laml-processing-lib">vel-r</a> r) #t)
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#vel-r" title="midi-laml-processing-lib">vel-r</a> 0) #f))))

<a name="delta-velocity"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(delta-velocity)</span>
  (to-int 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX246" title="R5RS Scheme form">even?</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#vel-r" title="midi-laml-processing-lib">vel-r</a>)
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#vel-r" title="midi-laml-processing-lib">vel-r</a> 100) <a class="applied-name" href="midi-laml-processing-lib-1.html#velocity-max-change" title="midi-laml-processing-lib">velocity-max-change</a>))
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#vel-r" title="midi-laml-processing-lib">vel-r</a> 100) <a class="applied-name" href="midi-laml-processing-lib-1.html#velocity-max-change" title="midi-laml-processing-lib">velocity-max-change</a>)))))


<span class="comment">; ---------------------------------------------------------------------------------------------------------------</span><br />
<div class="schemedoc-section-comment">;;; .section-id midi-mes-predicates
;;; Midi message predicates.</div>
<a name="NoteOn?"></a><a name="NoteOn?"></a><span><a href="../midi-laml-processing-lib.html#NoteOn?"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(NoteOn? x)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "NoteOn")))

<a name="NoteOnCh?"></a><a name="NoteOnCh?"></a><span><a href="../midi-laml-processing-lib.html#NoteOnCh?"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(NoteOnCh? channels)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>)
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> x)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">ch</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel #f)))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> ch
               (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> ch) channels)
               #f))
        #f)))



<a name="Meta?"></a><a name="Meta?"></a><span><a href="../midi-laml-processing-lib.html#Meta?"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(Meta? x . optional-parameter-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">type-1</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list "*")))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "Meta")
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> type-1 "*")
             #t
             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> type-1 (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'type #f)))))))

<a name="ProgramChange?"></a><a name="ProgramChange?"></a><span><a href="../midi-laml-processing-lib.html#ProgramChange?"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(ProgramChange? x . optional-parameter-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list #t)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x)
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> channel) channel)
                  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "ProgramChange"))
               ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX224" title="R5RS Scheme form">number?</a> channel) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> channel 1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> channel 16))
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "ProgramChange")
                       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel)))))
               ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX374" title="R5RS Scheme form">string?</a> channel) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel) 1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel) 16))
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "ProgramChange")
                       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> channel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel)))))
               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> #f)))))

<a name="SysEx?"></a><a name="SysEx?"></a><span><a href="../midi-laml-processing-lib.html#SysEx?"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(SysEx? x . optional-parameter-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">sys-ex-hex-string</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list #f)))
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x)
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> sys-ex-hex-string) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "SysEx"))
             (sys-ex-hex-string (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "SysEx") (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-text" title="Manual: xml-in-laml">ast-text</a> x) sys-ex-hex-string)))
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> #f))
       #f)))

<a name="ControlChange?"></a><a name="ControlChange?"></a><span><a href="../midi-laml-processing-lib.html#ControlChange?"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(ControlChange? x . optional-parameter-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">control</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list #t))
         (<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 2 optional-parameter-list #t))
         (<span class="local-name-binding">control-nr</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> control) control) #t (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> control)))
         (<span class="local-name-binding">channel-nr</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> channel) channel) #t (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel))))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x)
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> control) control  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> channel) channel)
                  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "ControlChange"))
               ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> control) control  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX224" title="R5RS Scheme form">number?</a> channel-nr))
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "ControlChange") (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel)) channel-nr)))
               ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX224" title="R5RS Scheme form">number?</a> control-nr)  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> channel) channel)
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "ControlChange") (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'control)) control-nr)))
               ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX224" title="R5RS Scheme form">number?</a> control-nr) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX224" title="R5RS Scheme form">number?</a> channel-nr))
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "ControlChange") 
                       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'control)) control-nr)  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel)) channel-nr)))
               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> #f)))))

<a name="PitchBendChange?"></a><a name="PitchBendChange?"></a><span><a href="../midi-laml-processing-lib.html#PitchBendChange?"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(PitchBendChange? x . optional-parameter-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list #f)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> channel
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "PitchBendChange") (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel -1))))   <span class="comment">; -1: forces a number out of ast-attribute which compare with a legal channel always will give a false result.</span><br />        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "PitchBendChange")))))

<a name="drum-NoteOn?"></a><a name="drum-NoteOn?"></a><span><a href="../midi-laml-processing-lib.html#drum-NoteOn?"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(drum-NoteOn? x)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> x) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel) "9") (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel) "10"))))

<a name="midi-null-event-message?"></a><a name="midi-null-event-message?"></a><span><a href="../midi-laml-processing-lib.html#midi-null-event-message?"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(midi-null-event-message? x)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "Meta") 
       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'type) "1")))

<a name="channel-message?"></a><a name="channel-message?"></a><span><a href="../midi-laml-processing-lib.html#channel-message?"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(channel-message? x)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x)
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">ch</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel #f)))
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> ch #t #f))
      #f))

<a name="non-channel-message?"></a><a name="non-channel-message?"></a><span><a href="../midi-laml-processing-lib.html#non-channel-message?"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(non-channel-message? x)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x)
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">ch</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel #f)))
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> ch #f #t))
      #f))


             

<span class="comment">; ---------------------------------------------------------------------------------------------------------------</span><br />
<div class="schemedoc-section-comment">;;; .section-id midi-mes-accessors
;;; Midi message accessor.
;;; Convenient accessor of Midi Asts. Can be used instead of the general purpose accessors of LAML asts. </div>
<a name="midi"></a><a name="midi"></a><span><a href="../midi-laml-processing-lib.html#midi"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(midi attribute-name mes)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">attribute-name-symbol</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> attribute-name)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes)
	(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">attr-val</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes attribute-name-symbol #f)))
	  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> attr-val
		   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> attribute-name-symbol '(deltaTime absTime channel note velocity duration value number pressure strum-length control type)))
	      (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> attr-val)
	      attr-val))
	#f)))
      

<span class="comment">; ---------------------------------------------------------------------------------------------------------------</span><br />
<div class="schemedoc-section-comment">;;; .section-id midi-list-fn-gp
;;; Message List functions - General Purpose.
;;; This section and the following sections contain function that can be applied on lists of midi messages.
;;; The functions in this section are general purpose.
;;; As such, this is the important 'bread and butter' functions of this library.
;;; Most functions come in two flavors. The main function, f, can be applied in this way (f m1 m2 ... mk) on arbitrary many midi messages m1 ... mk.
;;; The other flavor, always named f-1, is applied as (f-1 (list m1 m2 ... mk)).
;;; In many cases there will be a few positional and required parameters before the first message.
;;; Thus, if there are two such required parameters p1 and p2, the calling forms are (f p1 p2 m1 m2 ... mk) and (f-1 p1 p2 (list m1 m2 ... mk)) respectively.
;;; Notice that the f-1 flavor of the functions are not explicitly documented below. If necessary, consult the Scheme source file to see f-1 via the provided links under 'See also'.</div>



<a name="delta-merge"></a><a name="delta-merge"></a><span><a href="../midi-laml-processing-lib.html#delta-merge"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">delta-merge</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">other-message-list</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-merge-two-lists" title="midi-laml-processing-lib">delta-merge-two-lists</a> contents other-message-list))))

<a name="delta-merge-two-lists"></a><a name="delta-merge-two-lists"></a><span><a href="../midi-laml-processing-lib.html#delta-merge-two-lists"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(delta-merge-two-lists message-list-1 message-list-2)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-merge-two-lists-1" title="midi-laml-processing-lib">delta-merge-two-lists-1</a> message-list-1 0 message-list-2 0 '()))

<a name="delta-merge-lists"></a><a name="delta-merge-lists"></a><span><a href="../midi-laml-processing-lib.html#delta-merge-lists"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(delta-merge-lists . list-of-message-lists)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> list-of-message-lists)
      '()
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">first-list</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> list-of-message-lists))
            (<span class="local-name-binding">rest-list-of-message-lists</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> list-of-message-lists)))
        (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-merge-two-lists" title="midi-laml-processing-lib">delta-merge-two-lists</a> first-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX411" title="R5RS Scheme form">apply</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#delta-merge-lists" title="midi-laml-processing-lib">delta-merge-lists</a> rest-list-of-message-lists))))) 

<a name="delta-merge-two-lists-1"></a><span class="comment">; Tail recursive implementation.
; Only one of  subtraction-1 and  subtraction-2 is non-zero (positive) at a given time.</span><br /><a name="delta-merge-two-lists-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(delta-merge-two-lists-1 message-list-1 subtraction-1 message-list-2 subtraction-2 res)</span>
  <span class="comment">; (display-message (length message-list-1) subtraction-1 (length message-list-2) subtraction-2 (length res) (if (not (null? res)) (ast-attribute (car res) 'deltaTime) #f))</span><br />  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list-1)   <span class="comment">; both message lists empty</span><br />              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list-2)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res))
        
         ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list-1)       <span class="comment">; message-list-1 empty. Adjust deltaTime of first element of message-list-2</span><br />                                (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res) 
                                        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">ast</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list-2))
                                               (<span class="local-name-binding">delta-time</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> ast 'deltaTime)))
                                               (<span class="local-name-binding">effective-delta-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> delta-time subtraction-2)))
                                          (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> ast 'deltaTime effective-delta-time) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list-2)))))

        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list-2)       <span class="comment">; message-list-2 empty. Adjust deltaTime of first element of message-list-1</span><br />                                (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res) 
                                        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">ast</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list-1))
                                               (<span class="local-name-binding">delta-time</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> ast 'deltaTime)))
                                               (<span class="local-name-binding">effective-delta-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> delta-time subtraction-1)))
                                          (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> ast 'deltaTime effective-delta-time) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list-1)))))

        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list-1))) (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-merge-two-lists-1" title="midi-laml-processing-lib">delta-merge-two-lists-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list-1) subtraction-1 message-list-2 subtraction-2 res))
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list-2))) (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-merge-two-lists-1" title="midi-laml-processing-lib">delta-merge-two-lists-1</a> message-list-1 subtraction-1 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list-2) subtraction-2 res))

        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a>                         <span class="comment">; do proper merging</span><br />              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">ast-1</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list-1))
                     (<span class="local-name-binding">ast-2</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list-2))
                     (<span class="local-name-binding">delta-time-1</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> ast-1 'deltaTime)))
                     (<span class="local-name-binding">delta-time-2</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> ast-2 'deltaTime)))
                     (<span class="local-name-binding">effective-delta-time-1</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> delta-time-1 subtraction-1))
                     (<span class="local-name-binding">effective-delta-time-2</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> delta-time-2 subtraction-2)))
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> effective-delta-time-1 effective-delta-time-2)
                     (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-merge-two-lists-1" title="midi-laml-processing-lib">delta-merge-two-lists-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list-1) 0 message-list-2 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> subtraction-2 effective-delta-time-1)  
                                              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> ast-1 'deltaTime effective-delta-time-1) res))
                     (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-merge-two-lists-1" title="midi-laml-processing-lib">delta-merge-two-lists-1</a> message-list-1 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> subtraction-1 effective-delta-time-2) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list-2) 0  
                                              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> ast-2 'deltaTime effective-delta-time-2) res))
                 )))))


<a name="abs-merge"></a><a name="abs-merge"></a><span><a href="../midi-laml-processing-lib.html#abs-merge"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">abs-merge</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">other-message-list</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-merge-two-lists" title="midi-laml-processing-lib">abs-merge-two-lists</a> contents other-message-list))))

<a name="abs-merge-two-lists"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(abs-merge-two-lists message-list-1 message-list-2)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-merge-two-lists-1" title="midi-laml-processing-lib">abs-merge-two-lists-1</a> message-list-1 message-list-2 '()))  

<a name="abs-merge-two-lists-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(abs-merge-two-lists-1 message-list-1 message-list-2 res)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list-1)   <span class="comment">; both message lists empty</span><br />              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list-2)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res))
        
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list-1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res) message-list-2))  <span class="comment">; one of the message lists is empty</span><br />        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list-2) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res) message-list-1)) 

        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list-1))) (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-merge-two-lists-1" title="midi-laml-processing-lib">abs-merge-two-lists-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list-1) message-list-2 res))  <span class="comment">; drop non-AST element</span><br />        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list-2))) (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-merge-two-lists-1" title="midi-laml-processing-lib">abs-merge-two-lists-1</a> message-list-1 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list-2) res))  <span class="comment">; ditto</span><br />
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a>                         <span class="comment">; do proper merging - none of the message lists are empty</span><br />              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">ast-1</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list-1))
                     (<span class="local-name-binding">ast-2</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list-2))
                     (<span class="local-name-binding">abs-time-1</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> ast-1 'absTime)))
                     (<span class="local-name-binding">abs-time-2</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> ast-2 'absTime))))
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> abs-time-1 abs-time-2)
                     (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-merge-two-lists-1" title="midi-laml-processing-lib">abs-merge-two-lists-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list-1) message-list-2  
                                              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list-1) res))
                     (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-merge-two-lists-1" title="midi-laml-processing-lib">abs-merge-two-lists-1</a> message-list-1 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list-2)  
                                              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list-2) res))
                 )))))

<a name="abs-time-reverse"></a><a name="abs-time-reverse"></a><span><a href="../midi-laml-processing-lib.html#abs-time-reverse"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">abs-time-reverse</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 0 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-time-reverse-1" title="midi-laml-processing-lib">abs-time-reverse-1</a> contents))))

<a name="abs-time-reverse-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(abs-time-reverse-1 messages)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">rev-messages</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> messages)))
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">m</span> <span class="local-name-binding">mr</span>)
            (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> m 'absTime (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime mr)))
         messages rev-messages)))



<a name="delta-abs-merge"></a><a name="delta-abs-merge"></a><span><a href="../midi-laml-processing-lib.html#delta-abs-merge"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">delta-abs-merge</span> 
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">delta-message-list</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-abs-merge-two-lists" title="midi-laml-processing-lib">delta-abs-merge-two-lists</a> delta-message-list contents))))

<a name="delta-abs-merge-two-lists"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(delta-abs-merge-two-lists delta-message-list abs-message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">first-abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> abs-message-list) 'absTime)))
         (<span class="local-name-binding">delta-to-abs-message-list</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-list-to-abs-time-list" title="midi-laml-processing-lib">delta-time-list-to-abs-time-list</a> delta-message-list first-abs-time)))
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-merge-two-lists" title="midi-laml-processing-lib">abs-merge-two-lists</a> delta-to-abs-message-list abs-message-list)))

<a name="delta-time-list-to-abs-time-list"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(delta-time-list-to-abs-time-list delta-message-list first-abs-time)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> delta-message-list)
      '()
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">first-delta-mes</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> delta-message-list))
             (<span class="local-name-binding">next-abs-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> first-abs-time (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-delta-mes 'deltaTime)))))
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (single-message-ast-delta-to-abs-time first-delta-mes next-abs-time)
              (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-list-to-abs-time-list" title="midi-laml-processing-lib">delta-time-list-to-abs-time-list</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> delta-message-list) next-abs-time)))))


<a name="transform-messages"></a><a name="transform-messages"></a><span><a href="../midi-laml-processing-lib.html#transform-messages"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">transform-messages</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">filter-fn</span> <span class="local-name-binding">transformation-fn</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#transform-messages-1" title="midi-laml-processing-lib">transform-messages-1</a> filter-fn transformation-fn contents ))))


<a name="transform-messages-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(transform-messages-1 filter-fn transformation-fn message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) (filter-fn mes-ast))
        (transformation-fn mes-ast)
        mes-ast))
  message-list))



<a name="filter-messages"></a><a name="filter-messages"></a><span><a href="../midi-laml-processing-lib.html#filter-messages"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">filter-messages</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">pred-fn</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#filter-messages-1" title="midi-laml-processing-lib">filter-messages-1</a> pred-fn contents ))))


<a name="filter-messages-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(filter-messages-1 pred-fn message-list)</span>
 (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) 
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) 
         (pred-fn x)
         #t))
  message-list))

<a name="filter-messages-keep-residual-and-accumulate!"></a><a name="filter-messages-keep-residual-and-accumulate!"></a><span><a href="../midi-laml-processing-lib.html#filter-messages-keep-residual-and-accumulate!"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">filter-messages-keep-residual-and-accumulate!</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 3 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">pred-fn</span> <span class="local-name-binding">abs-target-file-path</span> <span class="local-name-binding">abs-merge-file-path</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#filter-messages-keep-residual-and-accumulate-1!" title="midi-laml-processing-lib">filter-messages-keep-residual-and-accumulate-1!</a> pred-fn abs-target-file-path abs-merge-file-path contents))))

<a name="filter-messages-keep-residual-and-accumulate-1!"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(filter-messages-keep-residual-and-accumulate-1! pred-fn abs-target-file-path abs-merge-file-path message-list)</span>
 (<a class="applied-name" href="midi-laml-processing-lib-1.html#filter-messages-keep-residual-and-accumulate-2" title="midi-laml-processing-lib">filter-messages-keep-residual-and-accumulate-2</a> pred-fn abs-target-file-path abs-merge-file-path message-list '() '()))

<a name="filter-messages-keep-residual-and-accumulate-2"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(filter-messages-keep-residual-and-accumulate-2 pred-fn abs-target-file-path abs-merge-file-path message-list result-list residual-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list)
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">merge-list</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> abs-merge-file-path (file-exists? abs-merge-file-path))
                                 (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-read" title="Manual: general">file-read</a> abs-merge-file-path)
                                 '())))
            (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-write" title="Manual: general">file-write</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> merge-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> compact-midi-laml-ast (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> residual-list))) abs-target-file-path)  <span class="comment">; save reversed residual-list</span><br />            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> result-list)                               <span class="comment">; return list of messages on which the predicate holds</span><br />           )
        )
        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list)) (pred-fn (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))) 
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#filter-messages-keep-residual-and-accumulate-2" title="midi-laml-processing-lib">filter-messages-keep-residual-and-accumulate-2</a> pred-fn abs-target-file-path abs-merge-file-path (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) result-list) residual-list))
        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (pred-fn (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list)))) 
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#filter-messages-keep-residual-and-accumulate-2" title="midi-laml-processing-lib">filter-messages-keep-residual-and-accumulate-2</a> pred-fn abs-target-file-path abs-merge-file-path (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) result-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) residual-list)))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> 
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#filter-messages-keep-residual-and-accumulate-2" title="midi-laml-processing-lib">filter-messages-keep-residual-and-accumulate-2</a> pred-fn abs-target-file-path abs-merge-file-path (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) result-list residual-list))))


<a name="filter-messages-keep-residual-and-reprocess!"></a><a name="filter-messages-keep-residual-and-reprocess!"></a><span><a href="../midi-laml-processing-lib.html#filter-messages-keep-residual-and-reprocess!"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">filter-messages-keep-residual-and-reprocess!</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 3 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">pred-fn</span> <span class="local-name-binding">abs-target-file-path</span> <span class="local-name-binding">abs-merge-file-path</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#filter-messages-keep-residual-and-reprocess-1!" title="midi-laml-processing-lib">filter-messages-keep-residual-and-reprocess-1!</a> pred-fn abs-target-file-path abs-merge-file-path contents))))

<a name="filter-messages-keep-residual-and-reprocess-1!"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(filter-messages-keep-residual-and-reprocess-1! pred-fn abs-target-file-path abs-merge-file-path message-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">merge-list</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> abs-merge-file-path (file-exists? abs-merge-file-path))
                       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> uncompact-midi-laml-entry (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-read" title="Manual: general">file-read</a> abs-merge-file-path))
                      '())))
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#filter-messages-keep-residual-and-reprocess-2" title="midi-laml-processing-lib">filter-messages-keep-residual-and-reprocess-2</a> pred-fn abs-target-file-path (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-merge-two-lists" title="midi-laml-processing-lib">abs-merge-two-lists</a> message-list merge-list) '() '())))

<a name="filter-messages-keep-residual-and-reprocess-2"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(filter-messages-keep-residual-and-reprocess-2 pred-fn abs-target-file-path message-list result-list residual-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list)
            (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-write" title="Manual: general">file-write</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> compact-midi-laml-ast (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> residual-list)) abs-target-file-path)  <span class="comment">; save reversed residual-list</span><br />            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> result-list)                               <span class="comment">; return list of messages on which the predicate holds</span><br />        )
        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list)) (pred-fn (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))) 
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#filter-messages-keep-residual-and-reprocess-2" title="midi-laml-processing-lib">filter-messages-keep-residual-and-reprocess-2</a> pred-fn abs-target-file-path (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) result-list) residual-list))
        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (pred-fn (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list)))) 
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#filter-messages-keep-residual-and-reprocess-2" title="midi-laml-processing-lib">filter-messages-keep-residual-and-reprocess-2</a> pred-fn abs-target-file-path (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) result-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) residual-list)))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> 
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#filter-messages-keep-residual-and-reprocess-2" title="midi-laml-processing-lib">filter-messages-keep-residual-and-reprocess-2</a> pred-fn abs-target-file-path (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) result-list residual-list))))


<a name="transform-attribute"></a><a name="transform-attribute"></a><span><a href="../midi-laml-processing-lib.html#transform-attribute"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">transform-attribute</span>
  (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a>
   3 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ast-predicate</span> <span class="local-name-binding">attribute-name</span> <span class="local-name-binding">transformation-fn</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#transform-attribute-1" title="midi-laml-processing-lib">transform-attribute-1</a> ast-predicate attribute-name transformation-fn contents))))

<a name="transform-attribute-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(transform-attribute-1 ast-predicate attribute-name transformation-fn message-list)</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) 
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (ast-predicate x))
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">mes-ast</span> x)  <span class="comment">; just alias</span><br />                (<span class="local-name-binding">attribute-value</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast attribute-name #f))
               )
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> attribute-value
               (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast attribute-name (as-int-string (transformation-fn (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> attribute-value))))
               mes-ast))
         x))
   message-list))


<a name="scale-attribute-by-factor"></a><a name="scale-attribute-by-factor"></a><span><a href="../midi-laml-processing-lib.html#scale-attribute-by-factor"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">scale-attribute-by-factor</span> 
  (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a>
   3 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ast-predicate</span> <span class="local-name-binding">attribute-name</span> <span class="local-name-binding">factor</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#scale-attribute-by-factor-1" title="midi-laml-processing-lib">scale-attribute-by-factor-1</a> ast-predicate attribute-name factor contents))))

<a name="scale-attribute-by-factor-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(scale-attribute-by-factor-1 ast-predicate attribute-name factor messages)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#transform-attribute-1" title="midi-laml-processing-lib">transform-attribute-1</a> ast-predicate attribute-name (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">value</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> factor value)) messages))   

<a name="randomize-attribute"></a><a name="randomize-attribute"></a><span><a href="../midi-laml-processing-lib.html#randomize-attribute"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">randomize-attribute</span>
  (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 7 0
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">pred</span> <span class="local-name-binding">attribute-name</span> <span class="local-name-binding">channel-list</span> <span class="local-name-binding">lower-number</span> <span class="local-name-binding">upper-number</span> <span class="local-name-binding">min-attribute-value</span> <span class="local-name-binding">max-attribute-value</span>  <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
       (<a class="applied-name" href="midi-laml-processing-lib-1.html#randomize-attribute-1" title="midi-laml-processing-lib">randomize-attribute-1</a> pred attribute-name channel-list lower-number upper-number min-attribute-value max-attribute-value cont))))

<a name="randomize-attribute-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(randomize-attribute-1 pred attribute-name channel-list lower-number upper-number min-attribute-value max-attribute-value message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) (pred mes-ast))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX339" title="R5RS Scheme form">memv</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel) channel-list)) 
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">attr-value</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast attribute-name #f)))
                    (<span class="local-name-binding">random-number</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#random-real-number-between" title="midi-laml-processing-lib">random-real-number-between</a> lower-number upper-number))
                   )  
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> attr-value
                    (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast attribute-name 
                        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> min-attribute-value max-attribute-value)
                            (between min-attribute-value max-attribute-value (to-int (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> random-number attr-value)))
                            (to-int (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> random-number attr-value))))
                    mes-ast))
              mes-ast))
         mes-ast))
  message-list))

<a name="random-real-number-between"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">random-real-number-between</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">seed</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#power" title="Manual: general">power</a> 2 31) 1)))
    (random-seed seed)
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">a</span> <span class="local-name-binding">b</span>)
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">lgt</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> b a))
            (<span class="local-name-binding">r</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX289" title="R5RS Scheme form">exact-&gt;inexact</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> (random seed) seed))) <span class="comment">; between 0 and 1</span><br />            (<span class="local-name-binding">rl</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> r lgt))
            (<span class="local-name-binding">rla</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> a rl)))
       rla))))

<a name="abs-time-sequence?"></a><span class="comment">; Is message-list an absTime sequence.
; Please notice that the choice is made from the first message in the list</span><br /><a name="abs-time-sequence?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(abs-time-sequence? message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list) #f)
        ((<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> message-list))
           (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#has-ast-attribute?" title="Manual: xml-in-laml">has-ast-attribute?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) 'absTime))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-time-sequence?" title="midi-laml-processing-lib">abs-time-sequence?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list)))))

<a name="delta-time-sequence?"></a><span class="comment">; Is message-list an deltaTime sequence.
; Please notice that the choice is made from the first message in the list</span><br /><a name="delta-time-sequence?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(delta-time-sequence? message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list) #f)
        ((<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> message-list))
           (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#has-ast-attribute?" title="Manual: xml-in-laml">has-ast-attribute?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) 'deltaTime))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-sequence?" title="midi-laml-processing-lib">delta-time-sequence?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list)))))

<a name="assert-abs-time"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(assert-abs-time messages)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-time-sequence?" title="midi-laml-processing-lib">abs-time-sequence?</a> messages))
      (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "In this context, you must use absTime sequences.")))

<a name="assert-delta-time"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(assert-delta-time messages)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-sequence?" title="midi-laml-processing-lib">delta-time-sequence?</a> messages))
      (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "In this context, you must use deltaTime sequences.")))


<a name="replicate"></a><a name="replicate"></a><span><a href="../midi-laml-processing-lib.html#replicate"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">replicate</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">n</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#replicate-1" title="midi-laml-processing-lib">replicate-1</a> n cont))))

<a name="replicate-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(replicate-1 n message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> n 0) '())
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> message-list (<a class="applied-name" href="midi-laml-processing-lib-1.html#replicate-1" title="midi-laml-processing-lib">replicate-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> n 1) message-list)))))

<a name="scale-attribute"></a><a name="scale-attribute"></a><span><a href="../midi-laml-processing-lib.html#scale-attribute"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">scale-attribute</span>  
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">attribute-name</span> <span class="local-name-binding">scaling-function</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#scale-attribute-1" title="midi-laml-processing-lib">scale-attribute-1</a> attribute-name scaling-function  contents ))))

<a name="scale-attribute-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(scale-attribute-1 attribute-name f contents)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">attr-name</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> attribute-name))
        (<span class="local-name-binding">noteon-contents</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x)))) contents))
        (<span class="local-name-binding">number-of-noteon-messages</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> noteon-contents))
        (<span class="local-name-binding">number-list</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#consequtive-numbering-by-predicate" title="midi-laml-processing-lib">consequtive-numbering-by-predicate</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> contents 1 0)) <span class="comment">; progressing integer for each NoteOn message. 
; 0 for non-NoteOn messages. </span><br />       )
   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span> <span class="local-name-binding">i</span>) 
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">attr-value</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast attr-name #f)))
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> attr-value
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">attr-val-number</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> attr-value))
                       (<span class="local-name-binding">max-i</span> number-of-noteon-messages) <span class="comment">; a convenient alias</span><br />                       (<span class="local-name-binding">scaled-attr-value</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> attr-val-number (f (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> i max-i))))
                      )
                  (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast
                     (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> attr-name) 
                     (as-int-string scaled-attr-value)))
                mes-ast))
          mes-ast)
    )
    contents
    number-list)))



<a name="scale-attribute-of-channel"></a><a name="scale-attribute-of-channel"></a><span><a href="../midi-laml-processing-lib.html#scale-attribute-of-channel"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">scale-attribute-of-channel</span>  
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 3 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span> <span class="local-name-binding">attribute-name</span> <span class="local-name-binding">scaling-function</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#scale-attribute-of-channel-1" title="midi-laml-processing-lib">scale-attribute-of-channel-1</a> ch attribute-name scaling-function  contents ))))

<a name="scale-attribute-of-channel-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(scale-attribute-of-channel-1 ch attribute-name f contents)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">attr-name</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> attribute-name))
        (<span class="local-name-binding">noteon-contents</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> ch (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel))))) contents))
        (<span class="local-name-binding">number-of-noteon-messages</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> noteon-contents))
        (<span class="local-name-binding">number-list</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#consequtive-numbering-by-predicate" title="midi-laml-processing-lib">consequtive-numbering-by-predicate</a>                                                     <span class="comment">; progressing integer for each NoteOn message. </span><br />                        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> ch (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel)))))                                   
                        contents 1 0))
       )
   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span> <span class="local-name-binding">i</span>) 
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">attr-value</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast attr-name #f)))
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> attr-value (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> ch (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel))))
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">attr-val-number</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> attr-value))
                       (<span class="local-name-binding">max-i</span> number-of-noteon-messages) <span class="comment">; a conveninent alias</span><br />                       (<span class="local-name-binding">scaled-attr-value</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> attr-val-number (f (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> i max-i))))
                      )
                  (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast
                     (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> attr-name) 
                     (as-int-string scaled-attr-value)))
                mes-ast))
          mes-ast)
    )
    contents
    number-list)))

<a name="scale-attribute-by-predicate"></a><a name="scale-attribute-by-predicate"></a><span><a href="../midi-laml-processing-lib.html#scale-attribute-by-predicate"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">scale-attribute-by-predicate</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 4 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch-list</span> <span class="local-name-binding">attribute-name</span> <span class="local-name-binding">scaling-function</span> <span class="local-name-binding">note-value-predicate</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">domaining</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'domaining attributes 'relative-position))) 
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#scale-attribute-by-predicate-1" title="midi-laml-processing-lib">scale-attribute-by-predicate-1</a> ch-list attribute-name scaling-function note-value-predicate (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> domaining) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> <a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> contents))))))

<a name="scale-attribute-by-predicate-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(scale-attribute-by-predicate-1 ch-list attribute-name f note-value-predicate domaining contents)</span>

 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-sequence?" title="midi-laml-processing-lib">delta-time-sequence?</a> contents) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> domaining 'abs-time-domain-scaling))
     (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "abs-time-domain-scaling can only be sued in pure absTime mode"))

 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">attr-name</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> attribute-name))
        (<span class="local-name-binding">noteon-contents</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x)) (note-value-predicate (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'note))))) contents))
        (<span class="local-name-binding">number-of-noteon-messages</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> noteon-contents))
        (<span class="local-name-binding">number-list</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#consequtive-numbering-by-predicate" title="midi-laml-processing-lib">consequtive-numbering-by-predicate</a>
                         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> x) (note-value-predicate (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'note))))
                         contents 1 0)) <span class="comment">; progressing integer for each NoteOn message which satisfy the predicate.
; 0 for non-NoteOn messages etc.</span><br />        (<span class="local-name-binding">t-start</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> domaining 'abs-time-domain-scaling)
                     (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> contents) 'absTime))
                     0)) <span class="comment">; dummy</span><br />        (<span class="local-name-binding">t-end</span>   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> domaining 'abs-time-domain-scaling)
                     (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#last" title="Manual: general">last</a> contents) 'absTime))
                     0))
       )
   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span> <span class="local-name-binding">i</span>) 
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast)) (note-value-predicate (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'note))))  <span class="comment">; implies that i is not zero</span><br />          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">attr-value</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast attr-name #f)))
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> attr-value (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel)) ch-list))
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">attr-val-number</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> attr-value))
                       (<span class="local-name-binding">max-i</span> number-of-noteon-messages) <span class="comment">; a convenient alias</span><br />                       (<span class="local-name-binding">scaled-attr-value</span> 
                           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> domaining 'abs-time-domain-scaling) 
                                   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">t-cur</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime))))
                                     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> attr-val-number (f (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> t-cur t-start) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> t-end t-start))))) 
                                 )
                                 ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> domaining 'relative-position)
                                   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> attr-val-number (f (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> i max-i)))
                                 )
                                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "scale-attribute-by-predicate-1: Unknown domaining" domaining))
                           ))
                      )
                  (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast
                     (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> attr-name) 
                     (as-int-string scaled-attr-value)))
                mes-ast))
          mes-ast)
    )
    contents
    number-list)))


<a name="consequtive-numbering-by-predicate"></a><span class="comment">; Return a consequtive numbering of those elements of lst that satisfy the predicate pred.
; Numbering starts with first-val
; Those elements that do not satisfy pred are given the value missing-value in the resulting list.
; .parameter pred A predicate which must be applicable on all elements of lst
; .parameter lst A list of elements
; .parameter first-val An arbitray integer value. Typically 0 or 1.
; .parameter missing-val An arbitrary value which is given for those elements in lst that do not satisfy pred.
; .returns A list of the same length as lst, of consequtive numbering of those elements of lst that satisfy pred.</span><br /><a name="consequtive-numbering-by-predicate"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(consequtive-numbering-by-predicate pred lst first-val missing-value)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#consequtive-numbering-by-predicate-1" title="midi-laml-processing-lib">consequtive-numbering-by-predicate-1</a> pred lst 1 missing-value '()))

<a name="consequtive-numbering-by-predicate-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(consequtive-numbering-by-predicate-1 pred lst first-val missing-value res)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> lst) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res))
        ((pred (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> lst)) (<a class="applied-name" href="midi-laml-processing-lib-1.html#consequtive-numbering-by-predicate-1" title="midi-laml-processing-lib">consequtive-numbering-by-predicate-1</a> pred (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> lst) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> first-val 1) missing-value (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> first-val res)))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a>             (<a class="applied-name" href="midi-laml-processing-lib-1.html#consequtive-numbering-by-predicate-1" title="midi-laml-processing-lib">consequtive-numbering-by-predicate-1</a> pred (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> lst) first-val missing-value (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> missing-value res)))))

<a name="enforce-attribute-value"></a><a name="enforce-attribute-value"></a><span><a href="../midi-laml-processing-lib.html#enforce-attribute-value"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">enforce-attribute-value</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 3 0 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">form-name</span> <span class="local-name-binding">attribute-name</span> <span class="local-name-binding">attribute-value</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#enforce-attribute-value-1" title="midi-laml-processing-lib">enforce-attribute-value-1</a> form-name attribute-name attribute-value contents))))

<a name="enforce-attribute-value-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(enforce-attribute-value-1 form-name attribute-name attribute-value message-list)</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>)
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> form-name)))
             (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> x (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> attribute-name) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> attribute-value))
             x) 
       )
       message-list)
)







<a name="insert-leading-and-trailing-beats"></a><a name="insert-leading-and-trailing-beats"></a><span><a href="../midi-laml-processing-lib.html#insert-leading-and-trailing-beats"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">insert-leading-and-trailing-beats</span> 
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">ppqn</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'ppqn attributes #f))
          (<span class="local-name-binding">n</span>    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'n attributes #f))
          (<span class="local-name-binding">m</span>    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'm attributes #f)))
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#insert-leading-and-trailing-beats-1" title="midi-laml-processing-lib">insert-leading-and-trailing-beats-1</a> 
        ch 
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> ppqn (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> ppqn) 1920)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> n (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> n) 4)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> m (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> n) 4)
        contents)))))

<a name="insert-leading-and-trailing-beats-1"></a><span class="comment">; ppqn: typically 1920 - when recorded at Tyros.
; n:m: time signature. Typically n = 4 and m = 4. m is not used.</span><br /><a name="insert-leading-and-trailing-beats-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(insert-leading-and-trailing-beats-1 ch ppqn n m messages)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">messages-only-ast</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> <a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> messages))
         (<span class="local-name-binding">end-of-track-message</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#last" title="Manual: general">last</a> messages-only-ast))
         (<span class="local-name-binding">before-end-of-track-messages</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#butlast" title="Manual: general">butlast</a> messages-only-ast)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> end-of-track-message) "Meta") (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> 47 (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'type end-of-track-message))))
        (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "insert-leading-and-trailing-beats-1 ch messages: Last message is not a Meta end of track message."))

    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">first-mes-abs-time</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> before-end-of-track-messages)))
           (<span class="local-name-binding">end-of-track-time</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime end-of-track-message))
           (<span class="local-name-binding">last-bar</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX258" title="R5RS Scheme form">quotient</a> end-of-track-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> ppqn n)))
           (<span class="local-name-binding">trailing-insert-abs-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> last-bar 1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> ppqn n)))
           (<span class="local-name-binding">end-of-track-abs-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> trailing-insert-abs-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> ppqn n 2))))
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a>
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">at</span>)
               (NoteOn 'absTime at 'channel ch 'note "37" 'velocity "127" 'duration "100")
               )
             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> first-mes-abs-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> first-mes-abs-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> 1 ppqn)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> first-mes-abs-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> 2 ppqn)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> first-mes-abs-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> 3 ppqn))))
        (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-displace" title="midi-laml-processing-lib">time-displace</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> 2 n ppqn) before-end-of-track-messages)
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">at</span>)
               (NoteOn 'absTime at 'channel ch 'note "37" 'velocity "127" 'duration "100")
               )
             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> trailing-insert-abs-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> trailing-insert-abs-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> 1 ppqn)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> trailing-insert-abs-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> 2 ppqn)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> trailing-insert-abs-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> 3 ppqn))))
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 
          (Meta 'absTime end-of-track-abs-time 'info "End of track" 'type "47" ""))))))


<a name="thin-out-messages-abs-time"></a><a name="thin-out-messages-abs-time"></a><span><a href="../midi-laml-processing-lib.html#thin-out-messages-abs-time"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">thin-out-messages-abs-time</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel-list</span> <span class="local-name-binding">abs-time-pred</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>) 
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#thin-out-messages-abs-time-1" title="midi-laml-processing-lib">thin-out-messages-abs-time-1</a> channel-list abs-time-pred contents))))

<a name="thin-out-messages-abs-time-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(thin-out-messages-abs-time-1 channel-list abs-time-pred message-list)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#filter-messages-1" title="midi-laml-processing-lib">filter-messages-1</a>
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>)
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">ch</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f))
            (<span class="local-name-binding">delta-time?</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime #f))   <span class="comment">; for error reporting purposes only.</span><br />           )
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> delta-time? (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "thin-out-message-abs-time: Encountered a deltaTime message. Can only be applied in pure absTime mode."))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> ch
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> ch) channel-list)
                (abs-time-pred (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime)))
                #t)
            #t)))
    message-list))


<a name="thin-out-messages-delta-time"></a><a name="thin-out-messages-delta-time"></a><span><a href="../midi-laml-processing-lib.html#thin-out-messages-delta-time"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">thin-out-messages-delta-time</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 3 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel-list</span> <span class="local-name-binding">abs-time-pred</span> <span class="local-name-binding">start-time</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>) 
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#thin-out-messages-delta-time-1" title="midi-laml-processing-lib">thin-out-messages-delta-time-1</a> channel-list abs-time-pred start-time contents))))

<a name="thin-out-messages-delta-time-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(thin-out-messages-delta-time-1 channel-list abs-time-pred start-time message-list)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#thin-out-messages-delta-time-2" title="midi-laml-processing-lib">thin-out-messages-delta-time-2</a> channel-list abs-time-pred start-time 0 message-list '()))

<a name="thin-out-messages-delta-time-2"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(thin-out-messages-delta-time-2 channel-list abs-time-pred previous-abs-time accumulated-deltas  message-list result-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> result-list))
        ((<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">mes-ast</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))
                  (<span class="local-name-binding">ch</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f))
                  (<span class="local-name-binding">abs-time?</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime #f)))
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> abs-time? (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "thin-out-message-delta-time: Encountered an absTime message. Can only be applied in deltaTime mode."))
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">delta-time</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime)))
                    (<span class="local-name-binding">new-abs-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> previous-abs-time delta-time))
                   )
               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> ch 
                        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> ch) channel-list) 
                        (abs-time-pred new-abs-time)
                   )
                   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">delta-modifier-mes-ast</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 'deltaTime (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> delta-time accumulated-deltas))))
                     (<a class="applied-name" href="midi-laml-processing-lib-1.html#thin-out-messages-delta-time-2" title="midi-laml-processing-lib">thin-out-messages-delta-time-2</a> channel-list abs-time-pred new-abs-time 0 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> delta-modifier-mes-ast result-list)))
                   (<a class="applied-name" href="midi-laml-processing-lib-1.html#thin-out-messages-delta-time-2" title="midi-laml-processing-lib">thin-out-messages-delta-time-2</a> channel-list abs-time-pred new-abs-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> accumulated-deltas delta-time) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) result-list)))))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#thin-out-messages-delta-time-2" title="midi-laml-processing-lib">thin-out-messages-delta-time-2</a> channel-list abs-time-pred previous-abs-time accumulated-deltas (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) result-list))))


<a name="keep-beat"></a><a name="keep-beat"></a><span><a href="../midi-laml-processing-lib.html#keep-beat"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(keep-beat n . optional-parameter-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">displacement</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list 0))
        (<span class="local-name-binding">ppqn</span>         (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 2 optional-parameter-list 1920))
       )
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">abs-time</span>)
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX259" title="R5RS Scheme form">remainder</a> 
               (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> abs-time displacement)
               (to-int (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> ppqn (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX281" title="R5RS Scheme form">expt</a> 2 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> 2 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX268" title="R5RS Scheme form">round</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#log2" title="midi-laml-processing-lib">log2</a> n))))))    <span class="comment">; if n is 4, then (- 2 (log2 n)) is 0.
; Thus  (expt 2 (- 2 (log2 n))) is 1.  expt is the usual power function - std scheme.</span><br />            )
            0))))

<a name="log2"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(log2 x)</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> 1 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX272" title="R5RS Scheme form">log</a> 2)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX272" title="R5RS Scheme form">log</a> x)))


<a name="marker-channel"></a><a name="marker-channel"></a><span><a href="../midi-laml-processing-lib.html#marker-channel"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">marker-channel</span> 
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">marker-letter</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> marker-letter) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "Be sure to supply maker-letter as second argument to marker-channel"))  <span class="comment">; backward compatibility error message</span><br />    (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-program-change-1" title="midi-laml-processing-lib">eliminate-program-change-1</a> channel
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-control-change-1" title="midi-laml-processing-lib">eliminate-control-change-1</a> channel #t
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#marker-channel-1" title="midi-laml-processing-lib">marker-channel-1</a> channel marker-letter contents ))))))

<a name="marker-channel-1"></a><span class="comment">; Assume as a precondition that message-list holds at least one message.</span><br /><a name="marker-channel-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(marker-channel-1 channel marker-letter message-list)</span>
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">numbering</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#consequtive-numbering-by-predicate" title="midi-laml-processing-lib">consequtive-numbering-by-predicate</a>
                        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel))))) 
                        message-list 1 0))
        )
     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a>
       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>
        ((<a class="applied-name" href="midi-laml-processing-lib-1.html#treat-marking" title="midi-laml-processing-lib">treat-marking</a> channel marker-letter) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> numbering))
        (Meta 'deltaTime "0"                                 <span class="comment">; initial marker - after first (possible) absTime event</span><br />              'type "6"
              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> marker-letter "-" "0" " " "**"))
       )
       (<a class="schemedoc-name" href="../../../../../lib/man/general.html#map2" title="Manual: general">map2</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#treat-marking" title="midi-laml-processing-lib">treat-marking</a> channel marker-letter)
             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list)
             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> numbering))) 
   )
)

<a name="treat-marking"></a><span class="comment">; marker transformation of mes as number n</span><br /><a name="treat-marking"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(treat-marking channel marker-letter)</span> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes</span> <span class="local-name-binding">n</span>)
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> mes) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'channel))))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'absTime #f))
              (<span class="local-name-binding">delta-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'deltaTime #f)))
          (Meta (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> abs-time 'absTime 'deltaTime) (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> mes)
                'type "6"
                (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> marker-letter "-" (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> n) " " (<a class="applied-name" href="midi-laml-processing-lib-1.html#star-marking-of" title="midi-laml-processing-lib">star-marking-of</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#marker-level-of-note-on" title="midi-laml-processing-lib">marker-level-of-note-on</a> mes)))))
        mes)
    ))


<a name="marker-level-of-note-on"></a><span class="comment">; Mapping from notes (non-octave) to marker levels.
; The black (#/b) keys count as the white key to the left of them (instead of errors).</span><br /><a name="marker-level-of-note-on"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(marker-level-of-note-on noteon-ast)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">note-attr</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> noteon-ast 'note)))
        (<span class="local-name-binding">level-number</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX259" title="R5RS Scheme form">remainder</a> note-attr 12)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> level-number 0) 0)   <span class="comment">; C</span><br />          ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> level-number 1) 0)   <span class="comment">; C#</span><br />          ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> level-number 2) 1)   <span class="comment">; D</span><br />          ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> level-number 3) 1)   <span class="comment">; D#</span><br />          ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> level-number 4) 2)   <span class="comment">; E</span><br />          ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> level-number 5) 3)   <span class="comment">; F</span><br />          ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> level-number 6) 3)   <span class="comment">; F#</span><br />          ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> level-number 7) 4)   <span class="comment">; G</span><br />          ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> level-number 8) 4)   <span class="comment">; G#</span><br />          ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> level-number 9) 5)   <span class="comment">; A</span><br />          ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> level-number 10) 5)  <span class="comment">; A#</span><br />          ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> level-number 11) 6)  <span class="comment">; H</span><br />    )))

<a name="star-marking-of"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(star-marking-of level)</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX375" title="R5RS Scheme form">make-string</a> level #\*))

<a name="marker-silence"></a><a name="marker-silence"></a><span><a href="../midi-laml-processing-lib.html#marker-silence"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">marker-silence</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">silence-ticks</span> <span class="local-name-binding">marker-letter</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#marker-silence-1" title="midi-laml-processing-lib">marker-silence-1</a> silence-ticks marker-letter contents ))))

<a name="marker-silence-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(marker-silence-1 silence-ticks marker-letter messages)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">next-marker-number</span> 0)
       (<span class="local-name-binding">first-mes</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> messages))
       (<span class="local-name-binding">in-between-messages</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#butlast" title="Manual: general">butlast</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> messages)))
       (<span class="local-name-binding">last-mes</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#last" title="Manual: general">last</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> messages)))                  <span class="comment">; expected to be end of track message</span><br />      )

  (<a class="applied-name" href="midi-laml-processing-lib-1.html#assert-abs-time" title="midi-laml-processing-lib">assert-abs-time</a> messages)

  <span class="comment">; It causes weird problems if we insert a marker after the end of track message. Therefore
; last-mes is taken out before map-bites is called.</span><br />  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (Meta 'absTime (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> first-mes)
                              'type "6"
                              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> marker-letter "-" "0" " ")))
          (<a class="schemedoc-name" href="../../../../../lib/man/general.html#map-n-bites" title="Manual: general">map-n-bites</a> <span class="comment">; ealier: (take-message-bite-until-silence silence-ticks)</span><br />                       (<a class="schemedoc-name" href="../../../../../lib/man/general.html#bite-while-element-with-accumulation" title="Manual: general">bite-while-element-with-accumulation</a>
			  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes</span> <span class="local-name-binding">sound-frontier-time</span>)
			    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime mes) sound-frontier-time) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime mes) sound-frontier-time) silence-ticks))))
			  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">sound-frontier-time</span> <span class="local-name-binding">NoteOnMes</span>)
			    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX247" title="R5RS Scheme form">max</a> sound-frontier-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime NoteOnMes) (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'duration NoteOnMes))))
			  0 
			  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> x))))
                       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">midi-messages-bite</span> <span class="local-name-binding">next-marker-number</span>)
			 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">last-mes</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#last" title="Manual: general">last</a> midi-messages-bite)))
			   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> midi-messages-bite 
				   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 
				    (Meta 'absTime (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> last-mes)
					  'type "6"
					  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> marker-letter "-" (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> next-marker-number) " "))))))
                     in-between-messages)
          (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> last-mes))))


<a name="take-message-bite-until-silence"></a><span class="comment">; NOT USED.
; A bite function. Takes a bite until an integer of silence of at least silence-ticks has been identified.
; Relies on pure absTime in the list of messages.</span><br /><a name="take-message-bite-until-silence"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(take-message-bite-until-silence silence-ticks)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">messages</span> . <span class="local-name-binding">rest</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#take-message-bite-until-silence-1" title="midi-laml-processing-lib">take-message-bite-until-silence-1</a> silence-ticks messages #f '())))

<a name="take-message-bite-until-silence-1"></a><span class="comment">; if sound-frontier-time is boolean #f, initiate the biting.</span><br /><a name="take-message-bite-until-silence-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(take-message-bite-until-silence-1 silence-ticks messages sound-frontier-time res-messages)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> messages)
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res-messages)
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">mes</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> messages)))
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> sound-frontier-time) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> sound-frontier-time) (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> mes))                                                    <span class="comment">; get started</span><br />                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#take-message-bite-until-silence-1" title="midi-laml-processing-lib">take-message-bite-until-silence-1</a> silence-ticks (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> messages) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime mes) (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'duration mes))  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes res-messages)))
                ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> sound-frontier-time) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> sound-frontier-time) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> mes)))                                             <span class="comment">; get started</span><br />                   (<a class="applied-name" href="midi-laml-processing-lib-1.html#take-message-bite-until-silence-1" title="midi-laml-processing-lib">take-message-bite-until-silence-1</a> silence-ticks (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> messages) #f (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes res-messages))) 

               ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> mes) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime mes) sound-frontier-time) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime mes) sound-frontier-time) silence-ticks))   <span class="comment">; large enough gap found</span><br />                  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res-messages))

               ((<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> mes) (<a class="applied-name" href="midi-laml-processing-lib-1.html#take-message-bite-until-silence-1" title="midi-laml-processing-lib">take-message-bite-until-silence-1</a> silence-ticks (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> messages)                                                   <span class="comment">; adjust sound-frontier-time </span><br />                                      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX247" title="R5RS Scheme form">max</a> sound-frontier-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime mes) (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'duration mes)))
                                      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes res-messages)))
               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a>                                                                                                                            <span class="comment">; iterate</span><br />                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#take-message-bite-until-silence-1" title="midi-laml-processing-lib">take-message-bite-until-silence-1</a> silence-ticks (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> messages) sound-frontier-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes res-messages)))))))


<a name="markup-chords"></a><a name="markup-chords"></a><span><a href="../midi-laml-processing-lib.html#markup-chords"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">markup-chords</span> 
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">marker-letter</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#markup-chords-1" title="midi-laml-processing-lib">markup-chords-1</a> channel marker-letter contents))))

<a name="markup-chords-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(markup-chords-1 channel marker-letter messages)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">first-mes</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> messages))
       (<span class="local-name-binding">in-between-messages</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#butlast" title="Manual: general">butlast</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> messages)))
       (<span class="local-name-binding">last-mes</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#last" title="Manual: general">last</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> messages)))                  <span class="comment">; expected to be end of track message</span><br />       (<span class="local-name-binding">normalized-note-val</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">noteon-mes</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX259" title="R5RS Scheme form">remainder</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'note noteon-mes) 12)))
      )
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#assert-abs-time" title="midi-laml-processing-lib">assert-abs-time</a> messages)

  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (Meta 'absTime (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> first-mes)
                              'type "6"
                              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> marker-letter "-" "0" " ")))
          (<a class="schemedoc-name" href="../../../../../lib/man/general.html#step-and-map-n-bites" title="Manual: general">step-and-map-n-bites</a> 
                       (<a class="schemedoc-name" href="../../../../../lib/man/general.html#bite-while-element-with-accumulation" title="Manual: general">bite-while-element-with-accumulation</a>
                          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes</span> <span class="local-name-binding">prev-chords</span>)
                           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">chord-candidate-list</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> prev-chords (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (normalized-note-val mes)))))
                            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> chord-candidate-list) 3)
                                #t
                                (<a class="applied-name" href="midi-laml-processing-lib-1.html#chord-match?" title="midi-laml-processing-lib">chord-match?</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#normalize-chord-list" title="midi-laml-processing-lib">normalize-chord-list</a> chord-candidate-list)))))
                          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">chord-candidate-list</span> <span class="local-name-binding">mes</span>)
                             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> chord-candidate-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (normalized-note-val mes))))
                          '() 
                          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'channel x)))))
                       )
                       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">bite</span>)
                          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">chord-list</span>
                                    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">no</span>) (normalized-note-val no))
                                         (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'channel x)))) bite))))
                            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#chord-match?" title="midi-laml-processing-lib">chord-match?</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#normalize-chord-list" title="midi-laml-processing-lib">normalize-chord-list</a> chord-list))
                                (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> bite)
                                -1)))
                       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">bite</span> <span class="local-name-binding">i</span>)
                         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">first-mes</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> bite))
                               (<span class="local-name-binding">last-mes</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#last" title="Manual: general">last</a> bite))
                               (<span class="local-name-binding">normalized-chord-list</span>
                                    (<a class="applied-name" href="midi-laml-processing-lib-1.html#normalize-chord-list" title="midi-laml-processing-lib">normalize-chord-list</a>
                                      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">no</span>) (normalized-note-val no))
                                         (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'channel x)))) bite)))))
                           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> 
                                   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (Meta 'absTime (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> first-mes)
                                               'type "6" 
                                                (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> marker-letter "-" (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> i 2) 1)) 
                                                                "  " "#" (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> channel) ": " 
                                                                "Start of chord: " 
                                                                (<a class="applied-name" href="midi-laml-processing-lib-1.html#chord-name-of-normalized-note-list" title="midi-laml-processing-lib">chord-name-of-normalized-note-list</a> normalized-chord-list))))
                                   bite 
                                   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (Meta 'absTime (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> last-mes)
                                               'type "6" 
                                                (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> marker-letter "-" (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> i 2))
                                                                "  " "#" (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> channel) ": " "End of chord"))))))
                      in-between-messages
          )
          (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> last-mes))))

<a name="map-chords"></a><a name="map-chords"></a><span><a href="../midi-laml-processing-lib.html#map-chords"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">map-chords</span> 
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 3 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">max-time-diff</span> <span class="local-name-binding">f</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#map-chords-1" title="midi-laml-processing-lib">map-chords-1</a> channel max-time-diff f contents))))

<a name="map-chords-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(map-chords-1 channel max-time-diff f messages)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">normalized-note-val</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">noteon-mes</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX259" title="R5RS Scheme form">remainder</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'note noteon-mes) 12)))
       (<span class="local-name-binding">relevant-message?</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'channel x))))) 
      )
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#assert-abs-time" title="midi-laml-processing-lib">assert-abs-time</a> messages)

  (<a class="schemedoc-name" href="../../../../../lib/man/general.html#step-and-map-n-bites" title="Manual: general">step-and-map-n-bites</a> 
     (<a class="schemedoc-name" href="../../../../../lib/man/general.html#bite-while-element-with-accumulation" title="Manual: general">bite-while-element-with-accumulation</a>   <span class="comment">; accumulates time of previous absTime note</span><br />      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes</span> <span class="local-name-binding">prev-time</span>)                <span class="comment">; keep going while notes are dense</span><br />          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> prev-time
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> mes) prev-time) max-time-diff)
                  #t
                  #f)
               #t))
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">time</span> <span class="local-name-binding">mes</span>)
        (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> mes))
      #f
      (<a class="schemedoc-name" href="../../../../../lib/man/general.html#negate" title="Manual: general">negate</a> relevant-message?)
     )
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">bite</span>)
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">chord-list</span>
              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">no</span>) (normalized-note-val no))
                   (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> relevant-message? bite))))
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#chord-match?" title="midi-laml-processing-lib">chord-match?</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#normalize-chord-list" title="midi-laml-processing-lib">normalize-chord-list</a> chord-list))
             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> bite)
             -1)))
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">bite</span> <span class="local-name-binding">n</span>)
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">normalized-chord-list</span>
              (<a class="applied-name" href="midi-laml-processing-lib-1.html#normalize-chord-list" title="midi-laml-processing-lib">normalize-chord-list</a>
               (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">no</span>) (normalized-note-val no))
                    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> relevant-message? bite)))))
         (f bite channel n normalized-chord-list (<a class="applied-name" href="midi-laml-processing-lib-1.html#chord-name-of-normalized-note-list" title="midi-laml-processing-lib">chord-name-of-normalized-note-list</a> normalized-chord-list))))

   messages)))

<a name="map-chords-1-old"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(map-chords-1-old channel f messages)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">normalized-note-val</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">noteon-mes</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX259" title="R5RS Scheme form">remainder</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'note noteon-mes) 12)))
       (<span class="local-name-binding">relevant-message?</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'channel x))))) 
      )
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#assert-abs-time" title="midi-laml-processing-lib">assert-abs-time</a> messages)

  (<a class="schemedoc-name" href="../../../../../lib/man/general.html#step-and-map-n-bites" title="Manual: general">step-and-map-n-bites</a> 
     (<a class="schemedoc-name" href="../../../../../lib/man/general.html#bite-while-element-with-accumulation" title="Manual: general">bite-while-element-with-accumulation</a>
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes</span> <span class="local-name-binding">prev-chords</span>)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">chord-candidate-list</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> prev-chords (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (normalized-note-val mes)))))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> chord-candidate-list) 3)
              #t
              (<a class="applied-name" href="midi-laml-processing-lib-1.html#chord-match?" title="midi-laml-processing-lib">chord-match?</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#normalize-chord-list" title="midi-laml-processing-lib">normalize-chord-list</a> chord-candidate-list)))))
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">chord-candidate-list</span> <span class="local-name-binding">mes</span>)
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> chord-candidate-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (normalized-note-val mes))))
      '()
      (<a class="schemedoc-name" href="../../../../../lib/man/general.html#negate" title="Manual: general">negate</a> relevant-message?)
     )
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">bite</span>)
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">chord-list</span>
              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">no</span>) (normalized-note-val no))
                   (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> relevant-message? bite))))
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#chord-match?" title="midi-laml-processing-lib">chord-match?</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#normalize-chord-list" title="midi-laml-processing-lib">normalize-chord-list</a> chord-list))
             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> bite)
             -1)))
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">bite</span> <span class="local-name-binding">n</span>)
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">normalized-chord-list</span>
              (<a class="applied-name" href="midi-laml-processing-lib-1.html#normalize-chord-list" title="midi-laml-processing-lib">normalize-chord-list</a>
               (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">no</span>) (normalized-note-val no))
                    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> relevant-message? bite)))))
         (f bite channel n normalized-chord-list (<a class="applied-name" href="midi-laml-processing-lib-1.html#chord-name-of-normalized-note-list" title="midi-laml-processing-lib">chord-name-of-normalized-note-list</a> normalized-chord-list))))

   messages)))

<a name="chord-marker"></a><a name="chord-marker"></a><span><a href="../midi-laml-processing-lib.html#chord-marker"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(chord-marker bite channel n chord-formula chord-name)</span> 
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">first-mes</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> bite))
       (<span class="local-name-binding">last-mes</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#last" title="Manual: general">last</a> bite))
       (<span class="local-name-binding">marker-letter</span> "C")
       )
   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> 
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-marker-abs-time" title="midi-laml-processing-lib">midi-marker-abs-time</a> 
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> first-mes) 1)
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a>
            "#" (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> channel) ": " 
            "Start of chord: " chord-name)
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> n 2) 1)
           marker-letter)
          )
    bite 
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-marker-abs-time" title="midi-laml-processing-lib">midi-marker-abs-time</a>
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> last-mes) 1)
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a>
            "#" (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> channel) ": "
            "End of chord")
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> n 2)
           marker-letter)))))
 

<a name="map-sustain-intervals"></a><a name="map-sustain-intervals"></a><span><a href="../midi-laml-processing-lib.html#map-sustain-intervals"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">map-sustain-intervals</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">f</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#map-sustain-intervals-1" title="midi-laml-processing-lib">map-sustain-intervals-1</a> channel f contents))))

<a name="map-sustain-intervals-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(map-sustain-intervals-1 channel f messages)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">cc-val-comparator</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-comparator" title="Manual: general">make-comparator</a> 
                            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">cc1</span> <span class="local-name-binding">cc2</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'value cc1) (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'value cc2)))
                            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">cc1</span> <span class="local-name-binding">cc2</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'value cc1) (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'value cc2)))))
       (<span class="local-name-binding">noice-fn</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#ControlChange?" title="midi-laml-processing-lib">ControlChange?</a> x 64 channel)))))
  (<a class="schemedoc-name" href="../../../../../lib/man/general.html#map-n-bites" title="Manual: general">map-n-bites</a> 
    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#bite-while-monotone" title="Manual: general">bite-while-monotone</a> 
       cc-val-comparator
       noice-fn)
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">messages</span> <span class="local-name-binding">bite-number</span>)    <span class="comment">; earlier, in a simpler version, just f.   It is very helpful for f to get direct acccess to whether the bite is increasing, decreasing or constant.</span><br />             (f messages bite-number 
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="schemedoc-name" href="../../../../../lib/man/general.html#increasing-list-with-noice?" title="Manual: general">increasing-list-with-noice?</a> cc-val-comparator noice-fn messages) 'increasing)
                      ((<a class="schemedoc-name" href="../../../../../lib/man/general.html#decreasing-list-with-noice?" title="Manual: general">decreasing-list-with-noice?</a> cc-val-comparator noice-fn messages) 'decreasing)
                      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> 'constant))))
    messages)))

<a name="map-bars"></a><a name="map-bars"></a><span><a href="../midi-laml-processing-lib.html#map-bars"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">map-bars</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 3 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">f</span> <span class="local-name-binding">ppqn</span> <span class="local-name-binding">time-signature</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#map-bars-1" title="midi-laml-processing-lib">map-bars-1</a> f ppqn time-signature contents))))

<a name="map-bars-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(map-bars-1 f ppqn time-signature messages)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">num</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> time-signature))
        (<span class="local-name-binding">denom</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> time-signature))
        (<span class="local-name-binding">pulses-per-whole-note</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> 4 ppqn))
        (<span class="local-name-binding">ticks-per-bar</span> (to-int (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> pulses-per-whole-note (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX289" title="R5RS Scheme form">exact-&gt;inexact</a> num) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX289" title="R5RS Scheme form">exact-&gt;inexact</a> denom)))))
       )
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> messages)
     '()
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">first-mes</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> messages))
            (<span class="local-name-binding">delta-time?</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-message?" title="midi-laml-processing-lib">delta-time-message?</a> first-mes))
            (<span class="local-name-binding">abs-time?</span>   (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-time-message?" title="midi-laml-processing-lib">abs-time-message?</a> first-mes)))
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> (abs-time?
               (<a class="schemedoc-name" href="../../../../../lib/man/general.html#map-bites" title="Manual: general">map-bites</a> 
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">lst</span> . <span class="local-name-binding">rest</span>)
                    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">start-time-first-mes</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> lst)))
                           (<span class="local-name-binding">bar-number</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX258" title="R5RS Scheme form">quotient</a> start-time-first-mes ticks-per-bar))  <span class="comment">; zero based</span><br />                           (<span class="local-name-binding">bar-start-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> bar-number ticks-per-bar))
                           (<span class="local-name-binding">bar-end-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> bar-start-time ticks-per-bar))
                          )
                      ((<a class="schemedoc-name" href="../../../../../lib/man/general.html#bite-while-element" title="Manual: general">bite-while-element</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime mes) bar-end-time)) 'sentinel "first") lst)))
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">bite</span>)
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">start-time-first-mes</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> bite)))   <span class="comment">; As a service - recalculate these informations in the bite transformation function </span><br />                            (<span class="local-name-binding">bar-number</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX258" title="R5RS Scheme form">quotient</a> start-time-first-mes ticks-per-bar))
                            (<span class="local-name-binding">bar-start-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> bar-number ticks-per-bar))
                            (<span class="local-name-binding">bar-end-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> bar-start-time ticks-per-bar))
                           )
                       (f bite (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> bar-number 1) bar-start-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> bar-end-time 1))))
                  messages)
             )
             (delta-time?   <span class="comment">; Assume that messages (the parameter to map-bars-1) start at absolute time 0   ; NOT CORRECT YET!!!!
; Der sker en tidsforskydning nÅÂr der starter en ny bite. Dette Å¯delÅÊgger gradvist timingen af bars fuldstÅÊndigt!!!!</span><br />               (<a class="schemedoc-name" href="../../../../../lib/man/general.html#map-n-bites" title="Manual: general">map-n-bites</a> 
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">lst</span> <span class="local-name-binding">n</span>)  <span class="comment">; n is one-based</span><br />                    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">bar-start-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> n 1) ticks-per-bar))
                           (<span class="local-name-binding">bar-end-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> bar-start-time ticks-per-bar))
                          )
                      ((<a class="schemedoc-name" href="../../../../../lib/man/general.html#bite-while-element-with-accumulation" title="Manual: general">bite-while-element-with-accumulation</a>
                          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes</span> <span class="local-name-binding">absTime</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> absTime (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'deltaTime mes)) bar-end-time))
                          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">absTime</span> <span class="local-name-binding">mes</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> absTime (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'deltaTime mes)))
                          bar-start-time  <span class="comment">; Dette er ikke et korrekt start punkt for nÅÊste bid...</span><br />                       )
                       lst)))
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">bite</span> <span class="local-name-binding">n</span>)
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">bar-number</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> n 1))
                            (<span class="local-name-binding">bar-start-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> bar-number ticks-per-bar))
                            (<span class="local-name-binding">bar-end-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> bar-start-time ticks-per-bar))
                           )
                       (f bite (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> bar-number 1) bar-start-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> bar-end-time 1))))
                  messages)
             )
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "map-bars-abs-time-1: Time problem. Should not happen")))))))


<a name="n-map"></a><span class="comment">; just playing: map with noice</span><br /><a name="n-map"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(n-map f lst noice?)</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">el</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (noice? el) el (f el))) lst))


<a name="chord-map"></a><span class="comment">; A comprehensive mapping of chord names to a list of notes in the chords.
; The notes in the chord are ordered, and all in the interval 0..11. The list is read when needed the first time,
; and cached for subsequent use.
; May come from a file, such as data/extended-chord-list.lsp.
; Can also be calculated from a C-rooted chord list, via use of the function generate-complete-chord-list.</span><br /><a name="chord-map"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">chord-map</span> #f)

<a name="chord-name-of"></a><span class="comment">; Chord map selectors</span><br /><a name="chord-name-of"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(chord-name-of chord-entry)</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> chord-entry))  
<a name="chord-notes-of"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(chord-notes-of chord-entry)</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> chord-entry))  

<a name="do-ensure-chord-map"></a><span class="comment">; Do cache the chord info list</span><br /><a name="do-ensure-chord-map"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(do-ensure-chord-map)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#chord-map" title="midi-laml-processing-lib">chord-map</a> 
      'do-nothing
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#chord-map" title="midi-laml-processing-lib">chord-map</a>
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#generate-complete-chord-list" title="midi-laml-processing-lib">generate-complete-chord-list</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#basic-chord-list" title="midi-laml-processing-lib">basic-chord-list</a>)   <span class="comment">; earlier:  (file-read (string-append midi-software-dir "data/" "extended-chord-list.lsp"))</span><br />      )))

<a name="normalize-chord-list"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(normalize-chord-list chord-notes)</span>
  (sort-list (<a class="schemedoc-name" href="../../../../../lib/man/general.html#remove-duplicates" title="Manual: general">remove-duplicates</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">note-val</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX259" title="R5RS Scheme form">remainder</a> note-val 12)) chord-notes))
             <a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a>))

<a name="chord-match?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(chord-match? normalized-note-list)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#do-ensure-chord-map" title="midi-laml-processing-lib">do-ensure-chord-map</a>)
  (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a>
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">chord-entry</span>) 
       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> normalized-note-list (<a class="applied-name" href="midi-laml-processing-lib-1.html#chord-notes-of" title="midi-laml-processing-lib">chord-notes-of</a> chord-entry)))
     <a class="applied-name" href="midi-laml-processing-lib-1.html#chord-map" title="midi-laml-processing-lib">chord-map</a>))

<a name="chord-name-of-normalized-note-list"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(chord-name-of-normalized-note-list normalized-note-list)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#do-ensure-chord-map" title="midi-laml-processing-lib">do-ensure-chord-map</a>)
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">search-res</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a>
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">chord-entry</span>) 
                       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> normalized-note-list (<a class="applied-name" href="midi-laml-processing-lib-1.html#chord-notes-of" title="midi-laml-processing-lib">chord-notes-of</a> chord-entry)))
                     <a class="applied-name" href="midi-laml-processing-lib-1.html#chord-map" title="midi-laml-processing-lib">chord-map</a>)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> search-res
        (<a class="applied-name" href="midi-laml-processing-lib-1.html#chord-name-of" title="midi-laml-processing-lib">chord-name-of</a> search-res)
        (<a class="schemedoc-name" href="../../../../../lib/man/general.html#list-to-string" title="Manual: general">list-to-string</a> normalized-note-list ","))))


<a name="basic-chord-list"></a><span class="comment">; A chord formula list for the root of C. A possible input to the function generate-complete-chord-list below.</span><br /><a name="basic-chord-list"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">basic-chord-list</span>
   '(("major" 0 4 7) ("6" 0 4 7 9) ("7" 0 4 7 10) ("M7" 0 4 7 11) ("Aug" 0 4 8) ("maj 9" 0 2 4 7)
     ("minor" 0 3 7) ("min6" 0 3 7 9) ("min7" 0 3 7 10)
     ("dim" 0 3 6) ("dim 6" 0 3 6 9) ("dim 7" 0 3 6 9) ("min 9" 0 2 3 7) ("sus4" 0 5 7) ("sus2" 0 2 7)))

<a name="extended-chord-list"></a><span class="comment">; An more complete - and a much more complex - chord formula list for the root of C. A possible input to the function generate-complete-chord-list below.</span><br /><a name="extended-chord-list"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">extended-chord-list</span>
   '(("major" 0 4 7) ("maj 6" 0 4 7 9) ("maj 7" 0 4 7 11) ("maj 9" 0 2 4 7 11) ("maj 11" 0 2 4 5 7 11) ("maj 13" 0 2 4 7 9 11) ("maj b5" 0 4 6) ("maj 7b5" 0 4 6 11) ("maj 9b5" 0 2 4 6 11) ("maj 11b5" 0 2 4 5 6 11) 
     ("maj 13 b5" 0 2 4 6 9 11) ("Aug" 0 4 8) ("maj 7#5" 0 4 8 11) ("maj 9 #5" 0 2 4 8 11) ("maj 11 #5" 0 2 4 5 8 11) ("maj 13 #5" 0 2 4 8 9 11) ("maj/9" 0 2 4 7) ("maj 6/9" 0 2 4 7 9) ("maj 7/6" 0 4 7 9 11) 
     ("maj 7/11" 0 4 5 7 11) ("maj 11/13" 0 2 4 5 7 9 11) ("maj 7b9" 0 1 4 7 11) ("maj 11b9" 0 1 4 5 7 11) ("maj 7#9" 0 3 4 7 11) ("maj 11 #9" 0 3 4 5 7 11) ("maj 9#11" 0 2 4 6 7 11) ("maj 7b5#9" 0 3 4 6 11) 
     ("minor" 0 3 7) ("min6" 0 3 7 9) ("min7" 0 3 7 10) ("min9" 0 2 3 7 10) ("min 11" 0 2 3 5 7 10) ("min 13" 0 2 3 7 9 10) ("diminished" 0 3 6) ("dim 6" 0 3 6 9) ("dim 7" 0 3 6 9) ("minor Major 7" 0 3 7 11)
     ("min Maj 9" 0 2 3 7 11) ("min Maj 11" 0 2 3 5 7 11) ("min 7 b5 - half dim" 0 3 6 10) ("min9 b5" 0 2 3 6 10) ("min 11b5" 0 2 3 5 6 10) ("min 13 b 5" 0 2 3 6 9 10) ("min 7#5" 0 3 8 10) 
     ("min 9#5" 0 2 3 8 10) ("min 11#5" 0 2 3 5 8 10) ("min/9" 0 2 3 7) ("min 6/9" 0 2 3 7 9) ("min 7/6" 0 3 7 9 10) ("min 7/11" 0 3 5 7 10) ("min 7b 9" 0 1 3 7 10) ("min 7#9" 0 3 3 7 10) ("Dominant 7" 0 4 7 10)
     ("Dom 9" 0 2 4 7 10) ("Dom 11" 0 2 4 5 7 10) ("Dom 13" 0 2 4 7 9 10) ("Dom 7b5" 0 4 6 10) ("Dom 9b5" 0 2 4 6 10) ("Dom 11b5" 0 2 4 5 6 10) ("Dom 7#5" 0 4 8 10) ("Dom 9#5" 0 2 4 8 10) ("Dom 7/6" 0 4 7 9 10)
     ("Dom 7/11" 0 4 5 7 10) ("Dom 7b9" 0 1 4 7 10) ("Dom 7#9" 0 3 4 7 10) ("Suspended 4" 0 5 7) ("Sus 6" 0 5 7 9) ("Sus 7" 0 5 7 11) ("Sus 9" 0 2 5 7 11) ("Sus 7b5" 0 5 6 11) ("Sus 7#5" 0 5 8 11)
     ("Sus/9" 0 2 5 7) ("Sus 6/9" 0 2 5 7 9) ("Maj/4" 0 4 5 7) ("maj 6/4" 0 4 5 7 9) ("maj 7/4" 0 4 5 7 11) ("maj/9/4" 0 2 4 5 7) ("min/4" 0 3 5 7) ("min 6/4" 0 3 5 7 9) ("min 7/4" 0 3 5 7 10) ("dim Sus" 0 5 6)
     ("dim 6 Sus" 0 5 6 9) ("dim 7 Sus" 0 5 6 9) ("aug Sus" 0 5 8) ("Dom 7 Sus" 0 5 7 10) ("Dom 7/4" 0 4 5 7 11) ("Aug/4" 0 4 5 8)))

<a name="generate-complete-chord-list"></a><a name="generate-complete-chord-list"></a><span><a href="../midi-laml-processing-lib.html#generate-complete-chord-list"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(generate-complete-chord-list basic-chord-list . optional-parameter-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">chord-naming-style</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list 'sharp)))
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">displacements</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#number-interval" title="Manual: general">number-interval</a> 0 11))
         (<span class="local-name-binding">roots-sharp</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> "C" "C#" "D" "D#" "E" "F" "F#" "G" "G#" "A" "A#" "B"))
         (<span class="local-name-binding">roots-flat</span>  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> "C" "Db" "D" "Eb" "E" "F" "Gb" "G" "Ab" "A" "Bb" "B"))
         (<span class="local-name-binding">roots</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> chord-naming-style 'sharp) roots-sharp roots-flat))
         (<span class="local-name-binding">transpose-chord-formula</span> 
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">formula</span> <span class="local-name-binding">displacement</span>)
              (<a class="applied-name" href="midi-laml-processing-lib-1.html#normalize-chord-list" title="midi-laml-processing-lib">normalize-chord-list</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">formula-entry</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> formula-entry displacement)) formula))))
       )
    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#flatten" title="Manual: general">flatten</a>
     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">displ</span> <span class="local-name-binding">root</span>)
            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">chord-formula</span>) 
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">chord-name</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#chord-name-of" title="midi-laml-processing-lib">chord-name-of</a> chord-formula))
                      (<span class="local-name-binding">chord-formula</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#chord-notes-of" title="midi-laml-processing-lib">chord-notes-of</a> chord-formula)))
                   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> root " " chord-name)
                         (transpose-chord-formula chord-formula displ))
                )
              ) 
              basic-chord-list
            )
          )
          displacements
          roots
      )))))


<a name="map-paused-sections"></a><a name="map-paused-sections"></a><span><a href="../midi-laml-processing-lib.html#map-paused-sections"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">map-paused-sections</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 3 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">f</span> <span class="local-name-binding">pause-ticks</span> <span class="local-name-binding">relevance-predicate</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#map-paused-sections-1" title="midi-laml-processing-lib">map-paused-sections-1</a> f pause-ticks relevance-predicate contents))))

<a name="map-paused-sections-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(map-paused-sections-1 f pause-ticks relevance-predicate messages)</span>
 (<a class="applied-name" href="midi-laml-processing-lib-1.html#assert-abs-time" title="midi-laml-processing-lib">assert-abs-time</a> messages)

 (<a class="schemedoc-name" href="../../../../../lib/man/general.html#map-n-bites" title="Manual: general">map-n-bites</a> 
   (<a class="schemedoc-name" href="../../../../../lib/man/general.html#bite-while-element-with-accumulation" title="Manual: general">bite-while-element-with-accumulation</a>
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes</span> <span class="local-name-binding">sound-frontier-time</span>)  <span class="comment">; pred</span><br />         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime mes) sound-frontier-time) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime mes) sound-frontier-time) pause-ticks))))
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">sound-frontier-time</span> <span class="local-name-binding">NoteOnMes</span>)  <span class="comment">; accumulator</span><br />         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX247" title="R5RS Scheme form">max</a> sound-frontier-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime NoteOnMes) (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'duration NoteOnMes))))
      0  <span class="comment">; init-val</span><br />      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (relevance-predicate x)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> x)))))  <span class="comment">; noise function</span><br />   )
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">midi-messages-bite</span> <span class="local-name-binding">n</span>)
     (f n midi-messages-bite))
    messages))


<a name="repeat-messages"></a><a name="repeat-messages"></a><span><a href="../midi-laml-processing-lib.html#repeat-messages"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">repeat-messages</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">n</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)  
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#repeat-messages-1" title="midi-laml-processing-lib">repeat-messages-1</a> n contents))))

<a name="repeat-messages-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(repeat-messages-1 n flat-message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> n 0)
      '()
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> flat-message-list (<a class="applied-name" href="midi-laml-processing-lib-1.html#repeat-messages-1" title="midi-laml-processing-lib">repeat-messages-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> n 1) flat-message-list))))


<a name="repeat-messages-enforce-periode-length"></a><a name="repeat-messages-enforce-periode-length"></a><span><a href="../midi-laml-processing-lib.html#repeat-messages-enforce-periode-length"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">repeat-messages-enforce-periode-length</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">n</span> <span class="local-name-binding">min-period-length</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)  
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#repeat-messages-enforce-periode-length-1" title="midi-laml-processing-lib">repeat-messages-enforce-periode-length-1</a> n min-period-length contents))))

<a name="repeat-messages-enforce-periode-length-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(repeat-messages-enforce-periode-length-1 n min-period-length flat-message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> n 0)
      '()
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#enforce-minimum-message-length" title="midi-laml-processing-lib">enforce-minimum-message-length</a> min-period-length flat-message-list)
              (<a class="applied-name" href="midi-laml-processing-lib-1.html#repeat-messages-enforce-periode-length-1" title="midi-laml-processing-lib">repeat-messages-enforce-periode-length-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> n 1) min-period-length flat-message-list))))



<a name="surround-by-delta-time-note-list"></a><a name="surround-by-delta-time-note-list"></a><span><a href="../midi-laml-processing-lib.html#surround-by-delta-time-note-list"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">surround-by-delta-time-note-list</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">delta-time-note-list</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">lgt</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#length-of-delta-time-midi-list" title="midi-laml-processing-lib">length-of-delta-time-midi-list</a> delta-time-note-list)))
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> delta-time-note-list
              (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-displace" title="midi-laml-processing-lib">time-displace</a> lgt contents)
              delta-time-note-list)))))


<a name="pass-through"></a><a name="pass-through"></a><span><a href="../midi-laml-processing-lib.html#pass-through"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">pass-through</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-abstraction" title="Manual: xml-in-laml">xml-in-laml-abstraction</a> 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     contents)))

<a name="map-midi-sections"></a><a name="map-midi-sections"></a><span><a href="../midi-laml-processing-lib.html#map-midi-sections"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">map-midi-sections</span> 
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 3 0 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">prefix-bite</span> <span class="local-name-binding">sublist-pred</span> <span class="local-name-binding">sublist-trans</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#map-midi-sections-1" title="midi-laml-processing-lib">map-midi-sections-1</a> prefix-bite sublist-pred sublist-trans contents))))

<a name="map-midi-sections-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(map-midi-sections-1 prefix-bite sublist-pred sublist-trans message-list)</span>
  (<a class="schemedoc-name" href="../../../../../lib/man/general.html#step-and-map-n-bites" title="Manual: general">step-and-map-n-bites</a> prefix-bite sublist-pred sublist-trans message-list))


<div class="schemedoc-section-comment">;;; .section-id midi-list-fn-time
;;; Message List functions - Time related</div>
<a name="time-stretch"></a><a name="time-stretch"></a><span><a href="../midi-laml-processing-lib.html#time-stretch"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">time-stretch</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a>
  1 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">factor</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-stretch-1" title="midi-laml-processing-lib">time-stretch-1</a> factor cont))))

<a name="time-stretch-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(time-stretch-1 factor message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">delta-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime #f))
              (<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime #f))
              (<span class="local-name-binding">dur</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'duration 0))
             )
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> (delta-time 
                 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast
                                            'deltaTime (as-int-string (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> delta-time) factor))
                                            'duration  (as-int-string (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> dur) factor)) ))
                (abs-time 
                 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast
                                            'absTime (as-int-string (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> abs-time) factor))
                                            'duration  (as-int-string (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> dur) factor)) ))

                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "Can only time stretch in deltaTime and absTime mode")) ))
        mes-ast))
  message-list))

<a name="time-adapt-to"></a><a name="time-adapt-to"></a><span><a href="../midi-laml-processing-lib.html#time-adapt-to"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">time-adapt-to</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a>
  1 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">new-length</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-adapt-to-1" title="midi-laml-processing-lib">time-adapt-to-1</a> new-length cont))))

<a name="time-adapt-to-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(time-adapt-to-1 new-length message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">old-length</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#total-length-of-message-list" title="midi-laml-processing-lib">total-length-of-message-list</a> message-list))
         (<span class="local-name-binding">factor</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> new-length old-length)))
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-stretch-1" title="midi-laml-processing-lib">time-stretch-1</a> factor message-list)))     


<a name="time-displace"></a><a name="time-displace"></a><span><a href="../midi-laml-processing-lib.html#time-displace"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">time-displace</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a>
  1 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">amount</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-displace-1" title="midi-laml-processing-lib">time-displace-1</a> amount cont))))

<a name="time-displace-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(time-displace-1 amount message-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list) '())
       ((<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-time-message?" title="midi-laml-processing-lib">abs-time-message?</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> message-list))
          (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime #f))
                       (<span class="local-name-binding">delta-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime #f))
                      )
                   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> (abs-time 
                          (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast
                                                      'absTime (as-int-string (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> abs-time) amount))))
                         (delta-time
                          mes-ast)                
                         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "time-displace: Problems!"))))
                 mes-ast))
           message-list))
       ((<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-message?" title="midi-laml-processing-lib">delta-time-message?</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> message-list))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">first-mes</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> message-list))
                 (<span class="local-name-binding">first-delta-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'deltaTime #f))
                 (<span class="local-name-binding">rest-messages</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list)))
             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a>
               (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> first-mes 'deltaTime (as-int-string (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> first-delta-time) amount)))
               rest-messages)))
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "time-displace-1: First message must reveal time mode."))))


<a name="time-displace-channels"></a><a name="time-displace-channels"></a><span><a href="../midi-laml-processing-lib.html#time-displace-channels"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">time-displace-channels</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a>
  2 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel-list</span> <span class="local-name-binding">amount</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-displace-channels-1" title="midi-laml-processing-lib">time-displace-channels-1</a> channel-list  amount cont))))

<a name="time-displace-channels-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(time-displace-channels-1 ch-list amount message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> channel
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel-num</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel)))
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> channel-num ch-list)
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime #f)) 
                           (<span class="local-name-binding">delta-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime #f)))
                       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> (abs-time 
                               (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast
                                                           'absTime (as-int-string (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> abs-time) amount))))
                             (delta-time
                               mes-ast)
                             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "time-displace-channels: Problems!"))))
                     mes-ast))
              mes-ast))
        mes-ast))
   message-list))

<a name="time-displace-channels-with-scaling"></a><a name="time-displace-channels-with-scaling"></a><span><a href="../midi-laml-processing-lib.html#time-displace-channels-with-scaling"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">time-displace-channels-with-scaling</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a>
  3 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel-list</span> <span class="local-name-binding">amount</span> <span class="local-name-binding">scaling-fn</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-displace-channels-with-scaling-1" title="midi-laml-processing-lib">time-displace-channels-with-scaling-1</a> channel-list amount scaling-fn cont))))

<a name="time-displace-channels-with-scaling-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(time-displace-channels-with-scaling-1 ch-list amount scaling-fn message-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">number-list</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#consequtive-numbering-by-predicate" title="midi-laml-processing-lib">consequtive-numbering-by-predicate</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#ast-with-channel-pred" title="midi-laml-processing-lib">ast-with-channel-pred</a> ch-list) message-list 1 0)) <span class="comment">; progressing integer for each NoteOn message. </span><br />        (<span class="local-name-binding">number-list-count</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> x 0)) number-list)))
        (<span class="local-name-binding">max-n</span> number-list-count) <span class="comment">; alias</span><br />       )
   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span> <span class="local-name-binding">n</span>) 
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> channel
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel-num</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel)))
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> channel-num ch-list)
                      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime #f)) 
                            (<span class="local-name-binding">delta-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime #f))
                            (<span class="local-name-binding">scaled-amount</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> amount (scaling-fn (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> n max-n))))
                           )
                        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> n 0) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "time-displace-channels-with-scaling-1: Should not happen"))
                        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> (abs-time 
                               (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast
                                                           'absTime (as-int-string (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> abs-time) scaled-amount))))
                              (delta-time
                                (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "time-displace-channels-with-scaling-1: Only supports absTime"))

                              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "time-displace-channels: Problems!"))))
                      mes-ast))
                mes-ast))
          mes-ast))
    message-list
    number-list)))

<a name="ast-with-channel-pred"></a><span class="comment">; Generates a predicate which asserts that x is a message ast belonging to a given channel list.</span><br /><a name="ast-with-channel-pred"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(ast-with-channel-pred ch-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>)
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) 
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">ch</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel #f)))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> ch (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> ch) ch-list))))))




<a name="quantize"></a><a name="quantize"></a><span><a href="../midi-laml-processing-lib.html#quantize"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">quantize</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a>
  3 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">q</span> <span class="local-name-binding">pulses-per-quarter-note</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-time-sequence?" title="midi-laml-processing-lib">abs-time-sequence?</a> cont) (<a class="applied-name" href="midi-laml-processing-lib-1.html#quantize-abs-timing" title="midi-laml-processing-lib">quantize-abs-timing</a> channel q pulses-per-quarter-note cont))
          ((<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-sequence?" title="midi-laml-processing-lib">delta-time-sequence?</a> cont) 
              (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-time-message-list-to-delta-timing" title="midi-laml-processing-lib">abs-time-message-list-to-delta-timing</a> 
                (<a class="applied-name" href="midi-laml-processing-lib-1.html#quantize-abs-timing" title="midi-laml-processing-lib">quantize-abs-timing</a>
                   channel q pulses-per-quarter-note (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-message-list-to-abs-timing" title="midi-laml-processing-lib">delta-time-message-list-to-abs-timing</a> cont 0))
                0)
          )
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "quantize: Problems determining absTime or deltaTime mode of sequence"))))))



<a name="quantize-abs-timing"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(quantize-abs-timing c q pulses-per-quarter-note message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) )   <span class="comment">;  earlier:  (and ... (equal? "NoteOn" (ast-element-name mes-ast)))</span><br />        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel) c))
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime #f)))
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> abs-time)
                    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "Can only quantize in absTime mode"))
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">time-interval</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-interval-of-note" title="midi-laml-processing-lib">time-interval-of-note</a> q pulses-per-quarter-note)))
                  (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 
                                             'absTime (<a class="applied-name" href="midi-laml-processing-lib-1.html#quantize-int" title="midi-laml-processing-lib">quantize-int</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> abs-time) time-interval))))
               mes-ast))
         mes-ast))
  message-list))

<a name="quantize-channels"></a><a name="quantize-channels"></a><span><a href="../midi-laml-processing-lib.html#quantize-channels"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">quantize-channels</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a>
  3 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel-list</span> <span class="local-name-binding">q</span> <span class="local-name-binding">pulses-per-quarter-note</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-time-sequence?" title="midi-laml-processing-lib">abs-time-sequence?</a> cont) (<a class="applied-name" href="midi-laml-processing-lib-1.html#quantize-channels-abs-timing" title="midi-laml-processing-lib">quantize-channels-abs-timing</a> channel-list q pulses-per-quarter-note cont))
          ((<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-sequence?" title="midi-laml-processing-lib">delta-time-sequence?</a> cont) 
              (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-time-message-list-to-delta-timing" title="midi-laml-processing-lib">abs-time-message-list-to-delta-timing</a> 
                (<a class="applied-name" href="midi-laml-processing-lib-1.html#quantize-channels-abs-timing" title="midi-laml-processing-lib">quantize-channels-abs-timing</a>
                   channel-list q pulses-per-quarter-note (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-message-list-to-abs-timing" title="midi-laml-processing-lib">delta-time-message-list-to-abs-timing</a> cont 0))
                0)
          )
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "quantize-channels: Problems determining absTime or deltaTime mode of sequence"))))))

<a name="quantize-channels-abs-timing"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(quantize-channels-abs-timing c-lst q pulses-per-quarter-note message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast))  <span class="comment">;  earlier:  (and ... (equal? "NoteOn" (ast-element-name mes-ast)))</span><br />        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel) c-lst))
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime #f)))
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> abs-time)
                    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "Can only quantize in absTime mode"))
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">time-interval</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-interval-of-note" title="midi-laml-processing-lib">time-interval-of-note</a> q pulses-per-quarter-note)))
                  (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 
                                             'absTime (<a class="applied-name" href="midi-laml-processing-lib-1.html#quantize-int" title="midi-laml-processing-lib">quantize-int</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> abs-time) time-interval))))
               mes-ast))
         mes-ast))
  message-list))

<a name="distribute-even"></a><a name="distribute-even"></a><span><a href="../midi-laml-processing-lib.html#distribute-even"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">distribute-even</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a>
  1 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#distribute-even-1" title="midi-laml-processing-lib">distribute-even-1</a> channel cont))))

<a name="distribute-even-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(distribute-even-1 channel message-list)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#ensure-all-abstime-in!" title="midi-laml-processing-lib">ensure-all-abstime-in!</a> "distribute-even" message-list)
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">relevante-note-on-list</span> 
           (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>)
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel #f)) channel)))
                   message-list))
         (<span class="local-name-binding">number-of-relevant-notes</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> relevante-note-on-list ))
        )
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> number-of-relevant-notes 3)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">abs-time-first</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> relevante-note-on-list) 'absTime #f)))
               (<span class="local-name-binding">abs-time-last</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#last" title="Manual: general">last</a> relevante-note-on-list) 'absTime #f)))
               (<span class="local-name-binding">distance</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> abs-time-last abs-time-first) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> number-of-relevant-notes 1)))
              )
          (<a class="applied-name" href="midi-laml-processing-lib-1.html#distribute-even-2" title="midi-laml-processing-lib">distribute-even-2</a> channel message-list distance 0 abs-time-first) )
        message-list)))

<a name="distribute-even-2"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(distribute-even-2 channel message-list distance i start-time)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list) '())
        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) 'channel #f)) channel))
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) 'absTime  (as-int-string (to-int (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> i distance) start-time))))
                 (<a class="applied-name" href="midi-laml-processing-lib-1.html#distribute-even-2" title="midi-laml-processing-lib">distribute-even-2</a> channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) distance (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> i 1) start-time)))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) (<a class="applied-name" href="midi-laml-processing-lib-1.html#distribute-even-2" title="midi-laml-processing-lib">distribute-even-2</a> channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) distance i start-time)))))




<a name="quantize-int"></a><span class="comment">; Adjust i to the nearest number (factor * n) for some integer n.
; Assume i is possitive</span><br /><a name="quantize-int"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(quantize-int i factor)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">half-factor</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> factor 2))
         (<span class="local-name-binding">rem</span>  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX259" title="R5RS Scheme form">remainder</a> i factor))
         (<span class="local-name-binding">quot</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX258" title="R5RS Scheme form">quotient</a> i factor))
         (<span class="local-name-binding">grid-point</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> quot factor))
        )
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> rem half-factor)
        grid-point
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> grid-point factor))))


<a name="time-interval-of-note"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(time-interval-of-note note-value pulses-per-quarter-note)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> 1 note-value) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> 4 pulses-per-quarter-note))   <span class="comment">; hel node</span><br />        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> 2 note-value) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> 2 pulses-per-quarter-note))   <span class="comment">; halv node</span><br />        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> 4 note-value) pulses-per-quarter-note)         <span class="comment">; fjerdedels node</span><br />        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> 8 note-value) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> pulses-per-quarter-note 2))   <span class="comment">; ottendedels node</span><br />        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> 16 note-value) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> pulses-per-quarter-note 4))
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> 32 note-value) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> pulses-per-quarter-note 8))
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> 64 note-value) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> pulses-per-quarter-note 16))
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> 128 note-value) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> pulses-per-quarter-note 32))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "time-interval-of-note: note-value must be a power of 2 in between 1 and 128"))))



<a name="calculate-note-in-between"></a><span class="comment">; Return a list of one note - the note in between note-ast-1 note-ast-2, or the empty list if note-ast-1 and note-ast-2 are too close</span><br /><a name="calculate-note-in-between"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(calculate-note-in-between note-ast-1 note-ast-2)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">note-val-1</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> note-ast-1 'note)))
        (<span class="local-name-binding">note-val-2</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> note-ast-2 'note)))
        (<span class="local-name-binding">abs-time-1</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> note-ast-1 'absTime #f)))
        (<span class="local-name-binding">abs-time-2</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> note-ast-2 'absTime #f)))
        (<span class="local-name-binding">channel-1</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> note-ast-1 'channel)))
        (<span class="local-name-binding">channel-2</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> note-ast-2 'channel)))
        (<span class="local-name-binding">velocity-1</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> note-ast-1 'velocity)))
        (<span class="local-name-binding">velocity-2</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> note-ast-2 'velocity)))
        (<span class="local-name-binding">duration-1</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> note-ast-1 'duration)))
        (<span class="local-name-binding">duration-2</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> note-ast-2 'duration)))
        )
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> abs-time-1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> abs-time-2) )
        (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "The function interpolate can only be used with asbTime"))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX257" title="R5RS Scheme form">abs</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> note-val-1 note-val-2)) 1)  
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (NoteOn 'absTime (as-int-string (to-int (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> abs-time-1 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> abs-time-2 abs-time-1) 2))))
                    'channel channel-1
                    'note (as-int-string (to-int (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> note-val-1 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> note-val-2 note-val-1) 2))))
                    'velocity velocity-1
                    'duration (as-int-string (to-int (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> duration-1 2)))))
      '())))

<a name="same-time-transform"></a><a name="same-time-transform"></a><span><a href="../midi-laml-processing-lib.html#same-time-transform"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">same-time-transform</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channels</span> <span class="local-name-binding">transformer</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#same-time-transform-1" title="midi-laml-processing-lib">same-time-transform-1</a> channels transformer contents))))

<a name="same-time-transform-1"></a><span class="comment">; Assume as a precondition that message-list is sorted by absTime.</span><br /><a name="same-time-transform-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(same-time-transform-1 channels transformer message-list)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#same-time-transform-2" title="midi-laml-processing-lib">same-time-transform-2</a> channels transformer message-list '() '()))

<a name="same-time-transform-2"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(same-time-transform-2 channels transformer message-list same-time-lst result-lst)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list)
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> same-time-lst result-lst))
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">mes</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> message-list))
             (<span class="local-name-binding">absTime?</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'absTime #f))
             (<span class="local-name-binding">same-mes</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> same-time-lst)) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> same-time-lst) #f))
             (<span class="local-name-binding">same-mes-ch</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> same-mes (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> same-mes 'channel #f) #f))
            )
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> absTime?) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "Same time transformation must occur in pure abs-time mode."))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a>  
                <span class="comment">; adding to same-time-lst</span><br />                ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> same-mes   <span class="comment">; same-time-lst non-empty</span><br />                     (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes)
                     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> same-mes 'absTime) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'absTime))  <span class="comment">; same time                          </span><br />                     same-mes-ch (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> same-mes-ch) channels))
                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#same-time-transform-2" title="midi-laml-processing-lib">same-time-transform-2</a> channels transformer (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes same-time-lst) result-lst))

                <span class="comment">; transforming non-singleton same-time-lst. Start new same-time-lst.</span><br />                ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> same-time-lst) 2))
                   (<a class="applied-name" href="midi-laml-processing-lib-1.html#same-time-transform-2" title="midi-laml-processing-lib">same-time-transform-2</a> channels transformer (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> mes)
                                          (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#maybe-transformer" title="midi-laml-processing-lib">maybe-transformer</a> transformer (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOnCh?" title="midi-laml-processing-lib">NoteOnCh?</a> channels) same-time-lst)) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#negate" title="Manual: general">negate</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOnCh?" title="midi-laml-processing-lib">NoteOnCh?</a> channels)) same-time-lst) result-lst)))

                <span class="comment">; ditto - do not start new same-time-lst.</span><br />                ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> same-time-lst) 2))
                   (<a class="applied-name" href="midi-laml-processing-lib-1.html#same-time-transform-2" title="midi-laml-processing-lib">same-time-transform-2</a> channels transformer (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) '() 
                                         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#maybe-transformer" title="midi-laml-processing-lib">maybe-transformer</a> transformer (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOnCh?" title="midi-laml-processing-lib">NoteOnCh?</a> channels) same-time-lst)) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#negate" title="Manual: general">negate</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOnCh?" title="midi-laml-processing-lib">NoteOnCh?</a> channels)) same-time-lst) result-lst)))

                                ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes) same-mes (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> same-time-lst) 2))                                                                  
                   (<a class="applied-name" href="midi-laml-processing-lib-1.html#same-time-transform-2" title="midi-laml-processing-lib">same-time-transform-2</a> channels transformer (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> mes) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> same-time-lst result-lst)))

                                ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes)) same-mes (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> same-time-lst) 2))                                                                  
                   (<a class="applied-name" href="midi-laml-processing-lib-1.html#same-time-transform-2" title="midi-laml-processing-lib">same-time-transform-2</a> channels transformer (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) '() (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> same-time-lst result-lst)))

                                ((<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes) 
                   (<a class="applied-name" href="midi-laml-processing-lib-1.html#same-time-transform-2" title="midi-laml-processing-lib">same-time-transform-2</a> channels transformer (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> mes) result-lst))

                                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> 
                   (<a class="applied-name" href="midi-laml-processing-lib-1.html#same-time-transform-2" title="midi-laml-processing-lib">same-time-transform-2</a> channels transformer (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) same-time-lst result-lst))))))

<a name="maybe-transformer"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(maybe-transformer transformer lst)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> lst) 2)
      (transformer lst)
      lst))

<a name="cut-at-time"></a><a name="cut-at-time"></a><span><a href="../midi-laml-processing-lib.html#cut-at-time"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">cut-at-time</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a>
  2 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">abs-cut-time</span> <span class="local-name-binding">channel-list</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#cut-at-time-1" title="midi-laml-processing-lib">cut-at-time-1</a> abs-cut-time channel-list cont))))

<a name="cut-at-time-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(cut-at-time-1 abs-cut-time channel-list-0 message-list)</span>
 (<a class="applied-name" href="midi-laml-processing-lib-1.html#ensure-all-abstime-in!" title="midi-laml-processing-lib">ensure-all-abstime-in!</a> "cut-at-time-1"  message-list)
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel-list</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> channel-list-0) channel-list-0) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#number-interval" title="Manual: general">number-interval</a> 1 16) channel-list-0)))
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#cut-at-time-2" title="midi-laml-processing-lib">cut-at-time-2</a> abs-cut-time channel-list message-list '())))

<a name="cut-at-time-2"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(cut-at-time-2 abs-cut-time channel-list message-list res-lst)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list)
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res-lst)
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">m</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))
             (<span class="local-name-binding">m-in-relevant-channel</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#channel-message?" title="midi-laml-processing-lib">channel-message?</a> m) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'channel m) channel-list))))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> m-in-relevant-channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> m)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime m) abs-cut-time))                                                             <span class="comment">; Non-NoteOn that starts after cut time are deleted</span><br />                 (<a class="applied-name" href="midi-laml-processing-lib-1.html#cut-at-time-2" title="midi-laml-processing-lib">cut-at-time-2</a> abs-cut-time channel-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) res-lst))
              ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> m-in-relevant-channel (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> m) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime m) abs-cut-time))                                                                   <span class="comment">; NoteOn messages that starts after cut time are deleted in the same way</span><br />                 (<a class="applied-name" href="midi-laml-processing-lib-1.html#cut-at-time-2" title="midi-laml-processing-lib">cut-at-time-2</a> abs-cut-time channel-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) res-lst))
              ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> m-in-relevant-channel (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> m) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime m) abs-cut-time) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime m) (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'duration m)) abs-cut-time))        <span class="comment">; Note messages that 'cross' the cut-time are given shorter duration </span><br />                 (<a class="applied-name" href="midi-laml-processing-lib-1.html#cut-at-time-2" title="midi-laml-processing-lib">cut-at-time-2</a> abs-cut-time channel-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list)
                               (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> m 'duration (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> abs-cut-time (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime m))) res-lst)))
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#cut-at-time-2" title="midi-laml-processing-lib">cut-at-time-2</a> abs-cut-time channel-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> m res-lst)))                                                          <span class="comment">; Keep all other messages</span><br />         ))))


<div class="schemedoc-section-comment">;;; .section-id midi-list-fn-note
;;; Message List functions - Note related</div>
<a name="octave"></a><a name="octave"></a><span><a href="../midi-laml-processing-lib.html#octave"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">octave</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a>
  2 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span> <span class="local-name-binding">n</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#octave-1" title="midi-laml-processing-lib">octave-1</a> ch n cont))))

<a name="octave-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(octave-1 c n message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOff" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast))))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel) c))
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">old-note</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'note)))
                     (<span class="local-name-binding">new-note</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> old-note (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> 12 n))))
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> new-note 127) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> new-note 0))
                    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "Octave underflow or overflow" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'info) new-note))
                (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 'note new-note))
              mes-ast))
        mes-ast))
  message-list))




<a name="interpolate"></a><a name="interpolate"></a><span><a href="../midi-laml-processing-lib.html#interpolate"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">interpolate</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a>
  1 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#interpolate-1" title="midi-laml-processing-lib">interpolate-1</a> channel cont #f))))

<a name="interpolate-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(interpolate-1 ch message-list prev-ast)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list) prev-ast) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> prev-ast))
        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> prev-ast)) '())

        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))
              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list)))
              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) 'channel #f)) ch))
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> prev-ast)   <span class="comment">; only in beginning</span><br />                (<a class="applied-name" href="midi-laml-processing-lib-1.html#interpolate-1" title="midi-laml-processing-lib">interpolate-1</a> ch (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))  <span class="comment">; now the first prev-ast is in place</span><br />                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">first</span> prev-ast)
                       (<span class="local-name-binding">second</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))
                       (<span class="local-name-binding">note-in-between-list</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#calculate-note-in-between" title="midi-laml-processing-lib">calculate-note-in-between</a> first second))
                      )
                  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> 
                     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> first note-in-between-list)
                     (<a class="applied-name" href="midi-laml-processing-lib-1.html#interpolate-1" title="midi-laml-processing-lib">interpolate-1</a> ch (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) second)
                  ))))

        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list)
                    (<a class="applied-name" href="midi-laml-processing-lib-1.html#interpolate-1" title="midi-laml-processing-lib">interpolate-1</a> ch (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) prev-ast))) ))

<a name="transpose"></a><a name="transpose"></a><span><a href="../midi-laml-processing-lib.html#transpose"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">transpose</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">amount</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#transpose-1" title="midi-laml-processing-lib">transpose-1</a> amount contents))))

<a name="transpose-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(transpose-1 amount message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOff" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast))))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">old-note</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'note)))
               (<span class="local-name-binding">new-note</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> old-note amount)))
          (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 'note new-note))
        mes-ast))
  message-list))


<a name="transpose-channels"></a><a name="transpose-channels"></a><span><a href="../midi-laml-processing-lib.html#transpose-channels"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">transpose-channels</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel-list</span> <span class="local-name-binding">amount</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#transpose-channels-1" title="midi-laml-processing-lib">transpose-channels-1</a> channel-list amount contents))))

<a name="transpose-channels-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(transpose-channels-1 ch-list amount message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOff" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast))))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> channel
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel) ch-list)
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">old-note</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'note)))
                         (<span class="local-name-binding">new-note</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> old-note amount)))
                    (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 'note new-note))
                  mes-ast)
              mes-ast))
        mes-ast))
  message-list))

<a name="map-notes-in-channels"></a><a name="map-notes-in-channels"></a><span><a href="../midi-laml-processing-lib.html#map-notes-in-channels"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">map-notes-in-channels</span> 
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">note-map</span> <span class="local-name-binding">channel-list</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#map-notes-in-channels-1" title="midi-laml-processing-lib">map-notes-in-channels-1</a> note-map channel-list contents))))

<a name="map-notes-in-channels-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(map-notes-in-channels-1 note-map channel-list message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">note-map-numbers</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">map-entry</span>) 
                                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">source</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> map-entry))
                                       (<span class="local-name-binding">dest</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cadr</a> map-entry)))
                                   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (number-of-note-name (<a class="schemedoc-name" href="../../../../../lib/man/general.html#upcase-string" title="Manual: general">upcase-string</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> source))) (number-of-note-name (<a class="schemedoc-name" href="../../../../../lib/man/general.html#upcase-string" title="Manual: general">upcase-string</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> dest))))))
                               note-map)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX123" title="R5RS Scheme form">letrec</a> ((<span class="local-name-binding">note-mapper</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">source-note-value</span>) <span class="comment">; a midi note-value, such as 64. Mapped to the appropriate midi note value, or #f is it is not mapped.</span><br />                            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">map-res</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">entry</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> entry) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX259" title="R5RS Scheme form">remainder</a> source-note-value 12))) note-map-numbers)))
                              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> map-res (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX258" title="R5RS Scheme form">quotient</a> source-note-value 12) 12) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> map-res)) #f)))))
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#map-notes-in-channels-2" title="midi-laml-processing-lib">map-notes-in-channels-2</a> note-mapper channel-list message-list '())
    )
  )
)

<a name="map-notes-in-channels-2"></a><span class="comment">; iterative processing</span><br /><a name="map-notes-in-channels-2"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(map-notes-in-channels-2 note-mapper channel-list message-list res-lst)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res-lst))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">message</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list)))
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> message)
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> message)
                         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> message 'channel)) channel-list)
                             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">target-note-value</span> (note-mapper (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> message 'note)))))
                               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> target-note-value
                                   (<a class="applied-name" href="midi-laml-processing-lib-1.html#map-notes-in-channels-2" title="midi-laml-processing-lib">map-notes-in-channels-2</a> note-mapper channel-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) 
                                         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> message 'note target-note-value) res-lst))  <span class="comment">; map note value!!</span><br />                                   (<a class="applied-name" href="midi-laml-processing-lib-1.html#map-notes-in-channels-2" title="midi-laml-processing-lib">map-notes-in-channels-2</a> note-mapper channel-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list)
                                         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> message 'velocity "1") res-lst))  <span class="comment">; exclude message - muted (cannot use value 0 - WHY???).</span><br />                               )
                             )
                             (<a class="applied-name" href="midi-laml-processing-lib-1.html#map-notes-in-channels-2" title="midi-laml-processing-lib">map-notes-in-channels-2</a> note-mapper channel-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> message res-lst)))  <span class="comment">; unchanged - other channel</span><br />                         (<a class="applied-name" href="midi-laml-processing-lib-1.html#map-notes-in-channels-2" title="midi-laml-processing-lib">map-notes-in-channels-2</a> note-mapper channel-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> message res-lst))) <span class="comment">;  unchanged - non-NoteOn</span><br />                     (<a class="applied-name" href="midi-laml-processing-lib-1.html#map-notes-in-channels-2" title="midi-laml-processing-lib">map-notes-in-channels-2</a> note-mapper channel-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) res-lst) <span class="comment">; drop: non-ast</span><br />                  )
               )
         )
  )
)

<div class="schemedoc-section-comment">;;; .section-id midi-list-fn-vel
;;; Message List functions - Velocity related</div>

<a name="fade-out"></a><a name="fade-out"></a><span><a href="../midi-laml-processing-lib.html#fade-out"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(fade-out . message-list)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#fade-out-1" title="midi-laml-processing-lib">fade-out-1</a> message-list))

<a name="fade-out-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(fade-out-1 message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">lgt</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> message-list)))
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span> <span class="local-name-binding">i</span>) 
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast) "NoteOn")
            (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast
               'velocity (<a class="applied-name" href="midi-laml-processing-lib-1.html#fade-velocity" title="midi-laml-processing-lib">fade-velocity</a> lgt i (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'velocity))))
            mes-ast))
      message-list
      (<a class="schemedoc-name" href="../../../../../lib/man/general.html#number-interval" title="Manual: general">number-interval</a> 1 lgt))))

<a name="fade-out-channels"></a><a name="fade-out-channels"></a><span><a href="../midi-laml-processing-lib.html#fade-out-channels"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(fade-out-channels channel-list . message-list)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#fade-out-channel-1" title="midi-laml-processing-lib">fade-out-channel-1</a> channel-list message-list))

<a name="fade-out-channel-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(fade-out-channel-1 channel-list message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">lgt</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> message-list)))
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span> <span class="local-name-binding">i</span>) 
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> channel
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel-num</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel)))
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> channel-num channel-list)
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast) "NoteOn")
                         (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast
                                                     'velocity (<a class="applied-name" href="midi-laml-processing-lib-1.html#fade-velocity" title="midi-laml-processing-lib">fade-velocity</a> lgt i (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'velocity))))
                         mes-ast)  <span class="comment">; Not NoteOn</span><br />                     mes-ast)) <span class="comment">; Not right channel</span><br />               mes-ast))) <span class="comment">; Not channel message</span><br />      message-list
      (<a class="schemedoc-name" href="../../../../../lib/man/general.html#number-interval" title="Manual: general">number-interval</a> 1 lgt))))

<a name="fade-velocity"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(fade-velocity n i input-velocity)</span>
  (as-int-string (between 0 127 (to-int (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> input-velocity (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> n i)) n)))))

          



<a name="add-to-velocity"></a><a name="add-to-velocity"></a><span><a href="../midi-laml-processing-lib.html#add-to-velocity"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">add-to-velocity</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a>
  2 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">amount</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#add-to-velocity-1" title="midi-laml-processing-lib">add-to-velocity-1</a> channel amount cont))))

<a name="add-to-velocity-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(add-to-velocity-1 channel amount message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast) "NoteOn") (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel)) channel))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">velocity</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'velocity #f)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> (velocity
                 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast
                                            'velocity (as-int-string (between 0 127 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> velocity) amount)))))
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "Cannot find velocity of NoteOn message. Should not happen"))))
        mes-ast))
  message-list))


<div class="schemedoc-section-comment">;;; .section-id midi-list-fn-dur
;;; Message List functions - Duration related</div>
<a name="eliminate-breaks"></a><a name="eliminate-breaks"></a><span><a href="../midi-laml-processing-lib.html#eliminate-breaks"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">eliminate-breaks</span> 
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-breaks-1" title="midi-laml-processing-lib">eliminate-breaks-1</a> channel contents))))

<a name="eliminate-breaks-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(eliminate-breaks-1 channel messages)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">channel-messages</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'channel x)))) messages))
         (<span class="local-name-binding">abs-time-list</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">noteon-ast</span>) (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime noteon-ast)) channel-messages))
         (<span class="local-name-binding">abs-time-diff-list</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#map2" title="Manual: general">map2</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">at1</span> <span class="local-name-binding">at2</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> at1 at2)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> abs-time-list) abs-time-list)))
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#adjust-duration" title="midi-laml-processing-lib">adjust-duration</a> channel messages abs-time-diff-list '())))

<a name="adjust-duration"></a><span class="comment">; Adjust duration of messages in the given channel to the max of the existing duration and the calculated absTime diffes in abs-time-diff-list
; Iterative.</span><br /><a name="adjust-duration"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(adjust-duration channel messages abs-time-diff-list res-messages)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> messages) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res-messages))
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> messages))) (<a class="applied-name" href="midi-laml-processing-lib-1.html#adjust-duration" title="midi-laml-processing-lib">adjust-duration</a> channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> messages) abs-time-diff-list res-messages)) <span class="comment">; just skip</span><br />        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#has-ast-attribute?" title="Manual: xml-in-laml">has-ast-attribute?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> messages) 'channel)) (<a class="applied-name" href="midi-laml-processing-lib-1.html#adjust-duration" title="midi-laml-processing-lib">adjust-duration</a> channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> messages) abs-time-diff-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> messages) res-messages))) <span class="comment">; non-channel mes</span><br />        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> messages)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> messages))) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> abs-time-diff-list)))  <span class="comment">; channel NoteOn message</span><br />                 (<a class="applied-name" href="midi-laml-processing-lib-1.html#adjust-duration" title="midi-laml-processing-lib">adjust-duration</a> channel 
                                  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> messages)
                                  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> abs-time-diff-list)
                                  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> messages) 'duration (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX247" title="R5RS Scheme form">max</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'duration (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> messages)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> abs-time-diff-list)))
                                        res-messages)))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#adjust-duration" title="midi-laml-processing-lib">adjust-duration</a> channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> messages) abs-time-diff-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> messages) res-messages)))))


<a name="legato-in-channel"></a><a name="legato-in-channel"></a><span><a href="../midi-laml-processing-lib.html#legato-in-channel"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">legato-in-channel</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">time-slack-delta</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'time-slack-delta attributes 20)))
           (<span class="local-name-binding">strict</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-boolean" title="Manual: general">as-boolean</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'strict attributes #f)))
           (<span class="local-name-binding">offset</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'offset attributes 0)))
           (<span class="local-name-binding">max-tie-span</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'max-tie-span attributes #f))
          )
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#legato-in-channel-1" title="midi-laml-processing-lib">legato-in-channel-1</a> channel time-slack-delta strict max-tie-span offset contents)))))

<a name="legato-in-channel-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(legato-in-channel-1 channel time-slack-delta strict max-tie-span offset message-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">message-list-1</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> <a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> message-list)))
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-time-sequence?" title="midi-laml-processing-lib">abs-time-sequence?</a> message-list-1)
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#legato-in-channel-abs-time" title="midi-laml-processing-lib">legato-in-channel-abs-time</a> channel time-slack-delta strict max-tie-span offset message-list-1 '() 0 '()))
        ((<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-sequence?" title="midi-laml-processing-lib">delta-time-sequence?</a> message-list-1)
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> max-tie-span (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "legato-in-channel-1: max-timespan cannot be used in delta time mode"))
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#legato-in-channel-delta-time" title="midi-laml-processing-lib">legato-in-channel-delta-time</a> channel time-slack-delta strict offset message-list-1 '() 0 '() 0))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "legato-in-channel-1: Either pure absTime or pure deltaTime mode is expected")))))

<a name="legato-in-channel-delta-time"></a><span class="comment">; t0 is the absolute time (relative to the place of application) of the first NoteOn message that belongs to channel in message-list
; tcur is the current absolute time, as accumulated during traversal. tcur is new in the delta time version.</span><br /><a name="legato-in-channel-delta-time"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(legato-in-channel-delta-time channel time-slack-delta strict offset message-list pending-message-list t0 res-list tcur)</span>
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list)
             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> pending-message-list)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">first-mes</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> message-list))
                       (<span class="local-name-binding">time-first</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> tcur (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'deltaTime)))))
                  (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> pending-message-list) "note = " (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'note first-mes) "time-first = " time-first "t0 = " t0 "tcur = " tcur)
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> 

                        <span class="comment">; getting started: going through messages irrelevant for legato in channel.</span><br />                        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> pending-message-list)
                              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> first-mes))
                                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> first-mes) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'channel)))))))
                          (<a class="applied-name" href="midi-laml-processing-lib-1.html#legato-in-channel-delta-time" title="midi-laml-processing-lib">legato-in-channel-delta-time</a> channel time-slack-delta strict offset (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) '() 0 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> first-mes res-list) 
                                                        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> tcur (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'deltaTime)))))

                        <span class="comment">; locating a Noteon in channel. Serves as the first reference point in pending-message-list.</span><br />                        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> pending-message-list)
                                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> first-mes) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'channel)))))
                          (<a class="applied-name" href="midi-laml-processing-lib-1.html#legato-in-channel-delta-time" title="midi-laml-processing-lib">legato-in-channel-delta-time</a> channel time-slack-delta strict offset (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> first-mes) 
                                                     time-first res-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> tcur (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'deltaTime)))))

                        <span class="comment">; locating messages to pass to pending messages. Either nearby NoteOns in samme channel, or irrelevant messages.</span><br />                        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> pending-message-list))
                              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> first-mes))
                                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> first-mes) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'channel)))))
                                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> first-mes) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'channel))) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> time-first t0) time-slack-delta))))
                         (<a class="applied-name" href="midi-laml-processing-lib-1.html#legato-in-channel-delta-time" title="midi-laml-processing-lib">legato-in-channel-delta-time</a> channel time-slack-delta strict offset (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> first-mes pending-message-list) t0 res-list 
                                                       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> tcur (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'deltaTime)))))

                        <span class="comment">; Locating a more distant NoteOn messages in channel. Now add the pending messages up to first-mes. And continue recursively.</span><br />                        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a>
                         (<a class="applied-name" href="midi-laml-processing-lib-1.html#legato-in-channel-delta-time" title="midi-laml-processing-lib">legato-in-channel-delta-time</a> channel time-slack-delta strict offset (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> first-mes)
                                                     time-first
                                                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">note-to-modify</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#last" title="Manual: general">last</a> pending-message-list))
                                                            (<span class="local-name-binding">note-now-modified</span> 
                                                              (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a>
                                                                note-to-modify 'duration (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> (strict (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX247" title="R5RS Scheme form">max</a> 0 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> offset (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> time-first t0))))
                                                                                               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a>   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX247" title="R5RS Scheme form">max</a> 0 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> offset (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX247" title="R5RS Scheme form">max</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> note-to-modify 'duration))
                                                                                                                             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> time-first t0))))))))
                                                            (<span class="local-name-binding">other-pendings-messages</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#butlast" title="Manual: general">butlast</a> pending-message-list)))
                                                       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> other-pendings-messages (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> note-now-modified)) res-list)) 
                                                      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> tcur (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'deltaTime))))) )))))


<a name="legato-in-channel-abs-time"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(legato-in-channel-abs-time channel time-slack-delta strict max-tie-span offset message-list pending-message-list t0 res-list)</span>
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list)
             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> pending-message-list)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">first-mes</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> message-list))
                       (<span class="local-name-binding">time-first</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'absTime))))
                  (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> pending-message-list) " " (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'note first-mes))
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> 

                        <span class="comment">; getting started: going through messages irrelevant for legato in channel.</span><br />                        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> pending-message-list)
                              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> first-mes))
                                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> first-mes) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'channel)))))))
                          (<a class="applied-name" href="midi-laml-processing-lib-1.html#legato-in-channel-abs-time" title="midi-laml-processing-lib">legato-in-channel-abs-time</a> channel time-slack-delta strict max-tie-span offset (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) '() 0 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> first-mes res-list)))

                        <span class="comment">; locating a Noteon in channel. Serves as first reference point in pending-message-list.</span><br />                        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> pending-message-list)
                                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> first-mes) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'channel)))))
                          (<a class="applied-name" href="midi-laml-processing-lib-1.html#legato-in-channel-abs-time" title="midi-laml-processing-lib">legato-in-channel-abs-time</a> channel time-slack-delta strict max-tie-span offset (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> first-mes) 
                                                     (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'absTime)) res-list))

                        <span class="comment">; locating messages to pass to pending messages. Either close NoteOns in samme channel or irrelevant messages.</span><br />                        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> pending-message-list))
                              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> first-mes))
                                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> first-mes) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'channel)))))
                                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> first-mes) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'channel))) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> time-first t0) time-slack-delta))))
                         (<a class="applied-name" href="midi-laml-processing-lib-1.html#legato-in-channel-abs-time" title="midi-laml-processing-lib">legato-in-channel-abs-time</a> channel time-slack-delta strict max-tie-span offset (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> first-mes pending-message-list) t0 res-list))

                        <span class="comment">; Locating a more distant NoteOn messages in channel. Now add pending messages up to first-mes.</span><br />                        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a>
                         (<a class="applied-name" href="midi-laml-processing-lib-1.html#legato-in-channel-abs-time" title="midi-laml-processing-lib">legato-in-channel-abs-time</a> channel time-slack-delta strict max-tie-span offset (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> first-mes)
                                                     (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'absTime))
                                                     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> 
                                                      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">pending-mes</span>)
                                                             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> pending-mes) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> pending-mes 'channel))))
                                                                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> max-tie-span)
                                                                         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> max-tie-span
                                                                              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'absTime))
										     (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> pending-mes 'absTime)))
										  (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> max-tie-span))))
                                                                     (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> pending-mes 
									    'duration 
                                                                                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> (strict (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX247" title="R5RS Scheme form">max</a> 0 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> offset (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'absTime))
                                                                                                                  (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> pending-mes 'absTime))))))
                                                                                      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a>   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX247" title="R5RS Scheme form">max</a> 0 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> offset (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX247" title="R5RS Scheme form">max</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> pending-mes 'duration))
                                                                                                                    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'absTime))
                                                                                                                       (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> pending-mes 'absTime)))))))))
                                                                 pending-mes)
                                                              pending-mes))
                                                           pending-message-list)
                                                      res-list))))))))


<div class="schemedoc-section-comment">;;; .section-id midi-list-fn-others
;;; Message List functions - Control Related and Misc</div>
<a name="pan-flow"></a><a name="pan-flow"></a><span><a href="../midi-laml-processing-lib.html#pan-flow"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">pan-flow</span> 
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 3 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">pan-from</span> <span class="local-name-binding">pan-to</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#pan-flow-1" title="midi-laml-processing-lib">pan-flow-1</a> channel pan-from pan-to contents))))

<a name="pan-flow-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(pan-flow-1 ch pan-from pan-to message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">pan-diff</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX257" title="R5RS Scheme form">abs</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> pan-to pan-from)))
         (<span class="local-name-binding">number-of-note-ons</span> 
            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> ch (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel -1))))) message-list)))
         (<span class="local-name-binding">pan-step</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> number-of-note-ons 1)
                       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> pan-from pan-to)
                           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> pan-diff (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> number-of-note-ons 1))
                           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> pan-diff (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> number-of-note-ons 1))))
                       #f))
        )
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> pan-step
        (<a class="applied-name" href="midi-laml-processing-lib-1.html#pan-flow-2" title="midi-laml-processing-lib">pan-flow-2</a> ch pan-from pan-to pan-step 0 message-list)
        message-list)))

<a name="pan-flow-2"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(pan-flow-2 ch pan-from pan-to pan-step i message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list) '())
        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">mes-ast</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))
                  (<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel) ch))
                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> 
                   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 
                      (ControlChange 'deltaTime "0" 'channel ch 'control "10" 'value (as-int-string (between 0 127 (to-int (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> pan-from (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> i pan-step))))))
                       mes-ast)
                   (<a class="applied-name" href="midi-laml-processing-lib-1.html#pan-flow-2" title="midi-laml-processing-lib">pan-flow-2</a> ch pan-from pan-to pan-step (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> i 1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list)))
                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes-ast (<a class="applied-name" href="midi-laml-processing-lib-1.html#pan-flow-2" title="midi-laml-processing-lib">pan-flow-2</a> ch pan-from pan-to pan-step i (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list))))))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> 
          (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) (<a class="applied-name" href="midi-laml-processing-lib-1.html#pan-flow-2" title="midi-laml-processing-lib">pan-flow-2</a> ch pan-from pan-to pan-step i (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list))))))

<a name="pan-left-right"></a><a name="pan-left-right"></a><span><a href="../midi-laml-processing-lib.html#pan-left-right"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">pan-left-right</span> 
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">pan-level</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#pan-left-right-1" title="midi-laml-processing-lib">pan-left-right-1</a> channel pan-level contents))))

<a name="pan-left-right-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(pan-left-right-1 ch pan-level message-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX123" title="R5RS Scheme form">letrec</a> (
          (<span class="local-name-binding">arc-pan</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">pan-value</span>)     <span class="comment">; pan-value between 0 and 128. Return an "arccos value"...</span><br />                      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX277" title="R5RS Scheme form">acos</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> pan-value 64) 64))))

          (<span class="local-name-binding">pan-fn</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>)
                    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 64 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> 64 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX274" title="R5RS Scheme form">cos</a> x)))))

          (<span class="local-name-binding">interval-of-reals</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">lower</span> <span class="local-name-binding">upper</span> <span class="local-name-binding">step</span>)
                               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> lower upper)
                                   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> lower (interval-of-reals (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> lower step) upper step))
                                   '())))

          (<span class="local-name-binding">interval-of-n-reals</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">lower</span> <span class="local-name-binding">upper</span> <span class="local-name-binding">n</span>)
                                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">step</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> upper lower) n)))
                                   (interval-of-reals lower upper step))))

          (<span class="local-name-binding">PI</span> 3.14159)
         )
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">number-of-note-ons</span> 
            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> ch (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel -1))))) message-list)))
         (<span class="local-name-binding">ap</span> (arc-pan pan-level))   <span class="comment">; (pan-fn ap) = pan-level</span><br />         (<span class="local-name-binding">pan-value-list</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">r</span>) (pan-fn r)) (interval-of-n-reals ap (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> ap (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> 2 PI)) number-of-note-ons)))   <span class="comment">; a list of values in the interval 0 .. 128</span><br />         (<span class="local-name-binding">pan-message-list</span> 
            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">pan-val</span>) 
                    (ControlChange 'deltaTime "0" 'channel ch 'control "10" 'value (as-int-string (between 0 127 (to-int pan-val)))))
                 pan-value-list))
        )
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#pan-left-right-2" title="midi-laml-processing-lib">pan-left-right-2</a> ch pan-level pan-message-list message-list))))


<a name="pan-left-right-2"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(pan-left-right-2 ch pan-level pan-message-list message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 
                                 (ControlChange 'deltaTime "0" 'channel ch 'control "10" 'value pan-level)))
        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">mes-ast</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))
                  (<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel) ch))
                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> 
                   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 
                      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> pan-message-list)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> pan-message-list) '())
                       mes-ast)
                   (<a class="applied-name" href="midi-laml-processing-lib-1.html#pan-left-right-2" title="midi-laml-processing-lib">pan-left-right-2</a> ch pan-level (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> pan-message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list)))
                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes-ast (<a class="applied-name" href="midi-laml-processing-lib-1.html#pan-left-right-2" title="midi-laml-processing-lib">pan-left-right-2</a> ch pan-level pan-message-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list))))))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> 
          (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) (<a class="applied-name" href="midi-laml-processing-lib-1.html#pan-left-right-2" title="midi-laml-processing-lib">pan-left-right-2</a> ch pan-level pan-message-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list))))))


<a name="channel-volume-flow"></a><a name="channel-volume-flow"></a><span><a href="../midi-laml-processing-lib.html#channel-volume-flow"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">channel-volume-flow</span> 
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 3 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">channel-volume-from</span> <span class="local-name-binding">channel-volume-to</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#channel-volume-flow-1" title="midi-laml-processing-lib">channel-volume-flow-1</a> channel channel-volume-from channel-volume-to contents))))

<a name="channel-volume-flow-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(channel-volume-flow-1 ch channel-volume-from channel-volume-to message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">channel-volume-diff</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX257" title="R5RS Scheme form">abs</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> channel-volume-to channel-volume-from)))
         (<span class="local-name-binding">number-of-note-ons</span> 
            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> ch (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel -1))))) message-list)))
         (<span class="local-name-binding">channel-volume-step</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> number-of-note-ons 1)
                       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> channel-volume-from channel-volume-to)
                           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> channel-volume-diff (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> number-of-note-ons 1))
                           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> channel-volume-diff (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> number-of-note-ons 1))))
                       #f))
        )
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> channel-volume-step
        (<a class="applied-name" href="midi-laml-processing-lib-1.html#channel-volume-flow-2" title="midi-laml-processing-lib">channel-volume-flow-2</a> ch channel-volume-from channel-volume-to channel-volume-step 0 message-list)
        message-list)))

<a name="channel-volume-flow-2"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(channel-volume-flow-2 ch channel-volume-from channel-volume-to channel-volume-step i message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list) '())
        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">mes-ast</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))
                  (<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel) ch))
                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> 
                   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 
                      (ControlChange 'deltaTime "0" 'channel ch 'control "7" 'value (as-int-string (between 0 127 (to-int (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> channel-volume-from (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> i channel-volume-step))))))
                       mes-ast)
                   (<a class="applied-name" href="midi-laml-processing-lib-1.html#channel-volume-flow-2" title="midi-laml-processing-lib">channel-volume-flow-2</a> ch channel-volume-from channel-volume-to channel-volume-step (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> i 1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list)))
                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes-ast (<a class="applied-name" href="midi-laml-processing-lib-1.html#channel-volume-flow-2" title="midi-laml-processing-lib">channel-volume-flow-2</a> ch channel-volume-from channel-volume-to channel-volume-step i (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list))))))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> 
          (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) (<a class="applied-name" href="midi-laml-processing-lib-1.html#channel-volume-flow-2" title="midi-laml-processing-lib">channel-volume-flow-2</a> ch channel-volume-from channel-volume-to channel-volume-step i (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list))))))

<a name="no-sustain"></a><a name="no-sustain"></a><span><a href="../midi-laml-processing-lib.html#no-sustain"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">no-sustain</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#no-sustain-1" title="midi-laml-processing-lib">no-sustain-1</a> channel contents))))

<a name="no-sustain-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(no-sustain-1 ch message-list)</span>
 (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-control-change-1" title="midi-laml-processing-lib">eliminate-control-change-1</a> ch 64 message-list))


<a name="eliminate-control-change"></a><a name="eliminate-control-change"></a><span><a href="../midi-laml-processing-lib.html#eliminate-control-change"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">eliminate-control-change</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">control</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-control-change-1" title="midi-laml-processing-lib">eliminate-control-change-1</a> channel control contents))))

<a name="eliminate-control-change-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(eliminate-control-change-1 ch cntrl message-list)</span>
 (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-midi-null-events" title="midi-laml-processing-lib">eliminate-midi-null-events</a>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast) "ControlChange")
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> cntrl) cntrl) #t (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> cntrl (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'control))))
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> ch) ch) #t (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> ch (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel))))
         )
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime #f))
               (<span class="local-name-binding">delta-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime #f)))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> (abs-time
                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-abs-time" title="midi-laml-processing-lib">midi-null-event-abs-time</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime)))
                 (delta-time
                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-delta-time" title="midi-laml-processing-lib">midi-null-event-delta-time</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime)))
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "eliminate-control-change-1: Not absTime and not deltaTime. Should not happen")))) 
         mes-ast)
     )
   message-list)))


<a name="eliminate-channel-key-pressure"></a><a name="eliminate-channel-key-pressure"></a><span><a href="../midi-laml-processing-lib.html#eliminate-channel-key-pressure"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">eliminate-channel-key-pressure</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-channel-key-pressure-1" title="midi-laml-processing-lib">eliminate-channel-key-pressure-1</a> channel contents))))

<a name="eliminate-channel-key-pressure-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(eliminate-channel-key-pressure-1 ch message-list)</span>
 (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-midi-null-events" title="midi-laml-processing-lib">eliminate-midi-null-events</a>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast) "ChannelKeyPressure")
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> ch) ch) #t (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> ch (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel))))
         )
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime #f))
               (<span class="local-name-binding">delta-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime #f)))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> (abs-time
                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-abs-time" title="midi-laml-processing-lib">midi-null-event-abs-time</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime)))
                 (delta-time
                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-delta-time" title="midi-laml-processing-lib">midi-null-event-delta-time</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime)))
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "eliminate-channel-key-pressure-1: Not absTime and not deltaTime. Should not happen")))) 
         mes-ast)
     )
   message-list)))

<a name="eliminate-program-change"></a><a name="eliminate-program-change"></a><span><a href="../midi-laml-processing-lib.html#eliminate-program-change"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">eliminate-program-change</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-program-change-1" title="midi-laml-processing-lib">eliminate-program-change-1</a> channel contents))))

<a name="eliminate-program-change-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(eliminate-program-change-1 ch message-list)</span>
 (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-midi-null-events" title="midi-laml-processing-lib">eliminate-midi-null-events</a>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast) "ProgramChange")
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> ch) ch) #t (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> ch (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel))))
         )
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime #f))
               (<span class="local-name-binding">delta-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime #f)))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> (abs-time
                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-abs-time" title="midi-laml-processing-lib">midi-null-event-abs-time</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime)))
                 (delta-time
                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-delta-time" title="midi-laml-processing-lib">midi-null-event-delta-time</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime)))
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "eliminate-program-change-1: Not absTime and not deltaTime. Should not happen")))) 
         mes-ast)
     )
   message-list)))


<a name="eliminate-pitch-bend"></a><a name="eliminate-pitch-bend"></a><span><a href="../midi-laml-processing-lib.html#eliminate-pitch-bend"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">eliminate-pitch-bend</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-pitch-bend-1" title="midi-laml-processing-lib">eliminate-pitch-bend-1</a> channel contents))))

<a name="eliminate-pitch-bend-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(eliminate-pitch-bend-1 ch message-list)</span>
 (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-midi-null-events" title="midi-laml-processing-lib">eliminate-midi-null-events</a>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast) "PitchBendChange")
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> ch) ch) #t (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> ch (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel))))
         )
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime #f))
               (<span class="local-name-binding">delta-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime #f)))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> (abs-time
                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-abs-time" title="midi-laml-processing-lib">midi-null-event-abs-time</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime)))
                 (delta-time
                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-delta-time" title="midi-laml-processing-lib">midi-null-event-delta-time</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime)))
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "eliminate-pitch-bend-1: Not absTime and not deltaTime. Should not happen")))) 
         mes-ast)
     )
   message-list)))

<a name="revoice"></a><a name="revoice"></a><span><a href="../midi-laml-processing-lib.html#revoice"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">revoice</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">revoice-map</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">revoice-file</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'revoice-file attributes #f))) 
         (<a class="applied-name" href="midi-laml-processing-lib-1.html#revoice-1" title="midi-laml-processing-lib">revoice-1</a> revoice-map contents revoice-file)))))

<a name="revoice-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(revoice-1 revoice-map contents revoice-file)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">contents-1</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#msb-lsb-to-internal-pc-attributes" title="midi-laml-processing-lib">msb-lsb-to-internal-pc-attributes</a> contents '(#t . 0) '(#t . 0) '() )))

     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> revoice-file
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">file-path</span> (<a class="schemedoc-name" href="../../../../../man/laml.html#in-startup-directory" title="Manual: laml">in-startup-directory</a> revoice-file)))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (file-exists? file-path) (delete-file file-path))
           (<a class="schemedoc-name" href="../../../../../lib/man/file-read.html#write-text-file" title="Manual: file-read">write-text-file</a>
             (<a class="applied-name" href="midi-laml-processing-lib-1.html#extract-revoice-file-info" title="midi-laml-processing-lib">extract-revoice-file-info</a> contents-1)
             file-path)))

     (<a class="applied-name" href="midi-laml-processing-lib-1.html#revoice-2" title="midi-laml-processing-lib">revoice-2</a> revoice-map contents-1)))

<a name="extract-revoice-file-info"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(extract-revoice-file-info contents)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "(" <a class="schemedoc-name" href="../../../../../lib/man/general.html#CR" title="Manual: general">CR</a>
   (<a class="schemedoc-name" href="../../../../../lib/man/general.html#list-to-string" title="Manual: general">list-to-string</a>
    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) x)
            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a>
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ast</span>)
               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#ProgramChange?" title="midi-laml-processing-lib">ProgramChange?</a> ast)
                   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attribute" title="Manual: xml-in-laml">ast-internal-attribute</a> ast 'msb) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attribute" title="Manual: xml-in-laml">ast-internal-attribute</a> ast 'lsb))
                       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">msb</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attribute" title="Manual: xml-in-laml">ast-internal-attribute</a> ast 'msb))
                              (<span class="local-name-binding">lsb</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attribute" title="Manual: xml-in-laml">ast-internal-attribute</a> ast 'lsb))
                              (<span class="local-name-binding">pc</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'number ast)))
                         (<a class="applied-name" href="midi-laml-processing-lib-1.html#single-msb-lsb-pc-info-string" title="midi-laml-processing-lib">single-msb-lsb-pc-info-string</a> msb lsb pc))
                       #f)
                   #f))
             contents)) <a class="schemedoc-name" href="../../../../../lib/man/general.html#CR" title="Manual: general">CR</a>)
   <a class="schemedoc-name" href="../../../../../lib/man/general.html#CR" title="Manual: general">CR</a> ")"))

<a name="single-msb-lsb-pc-info-string"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(single-msb-lsb-pc-info-string msb lsb pc)</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a>
    " (list " " (list " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> msb) " " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> lsb) " " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> pc) " " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#string-it" title="Manual: general">string-it</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (find-voice-info-string msb lsb pc))) ")" <a class="schemedoc-name" href="../../../../../lib/man/general.html#CR" title="Manual: general">CR</a>
       "        (list  )  "
    ")"))

<a name="msb-lsb-to-internal-pc-attributes"></a><span class="comment">; Traverse messages in contents, and put internal attributes on ProgramChange messages that reflect the msb and lsb of preceding ControlChange messages.
; The meaning of previous-msb previous-lsb corresponds to the global variables previous-msb-control-channel-value and
; previous-lsb-control-channel-value in midi.scm
; Decorate program change messages in contents with internal lsb and msb attributes.
; Return a list of ProgramChange ASTs decorated with interal attributes for msb and lsb information (control change info).</span><br /><a name="msb-lsb-to-internal-pc-attributes"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(msb-lsb-to-internal-pc-attributes contents previous-msb previous-lsb out-contents)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> contents) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> out-contents))
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> contents))) (<a class="applied-name" href="midi-laml-processing-lib-1.html#msb-lsb-to-internal-pc-attributes" title="midi-laml-processing-lib">msb-lsb-to-internal-pc-attributes</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> contents) previous-msb previous-lsb out-contents))
        ((<a class="applied-name" href="midi-laml-processing-lib-1.html#ControlChange?" title="midi-laml-processing-lib">ControlChange?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> contents) 0)  <span class="comment">; LSB</span><br />            (<a class="applied-name" href="midi-laml-processing-lib-1.html#msb-lsb-to-internal-pc-attributes" title="midi-laml-processing-lib">msb-lsb-to-internal-pc-attributes</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> contents)
                                               (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> contents)) (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'value (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> contents)))
                                               previous-lsb 
                                               out-contents))   <span class="comment">; remove from midi stream</span><br />        ((<a class="applied-name" href="midi-laml-processing-lib-1.html#ControlChange?" title="midi-laml-processing-lib">ControlChange?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> contents) 32)  <span class="comment">; MSB</span><br />            (<a class="applied-name" href="midi-laml-processing-lib-1.html#msb-lsb-to-internal-pc-attributes" title="midi-laml-processing-lib">msb-lsb-to-internal-pc-attributes</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> contents)
                                               previous-msb
                                               (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> contents)) (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'value (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> contents)))
                                               out-contents))   <span class="comment">; remove from midi stream</span><br />        ((<a class="applied-name" href="midi-laml-processing-lib-1.html#ProgramChange?" title="midi-laml-processing-lib">ProgramChange?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> contents))
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">element</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> contents)) <span class="comment">; alias</span><br />                   (<span class="local-name-binding">channel</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'channel element)))
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> #t  <span class="comment">; (and (not (boolean? (first previous-msb))) (not (boolean? (first previous-lsb)))
;     (= channel (first previous-msb)) (= channel (first previous-lsb)))</span><br />                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">new-element</span>
                          (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#make-ast" title="Manual: xml-in-laml">make-ast</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> element) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a> element) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attributes" title="Manual: xml-in-laml">ast-attributes</a> element) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-kind" title="Manual: xml-in-laml">ast-kind</a> element) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-language" title="Manual: xml-in-laml">ast-language</a> element) 
                                  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'msb (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> previous-msb) 'lsb (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> previous-lsb)))))
                     (<a class="applied-name" href="midi-laml-processing-lib-1.html#msb-lsb-to-internal-pc-attributes" title="midi-laml-processing-lib">msb-lsb-to-internal-pc-attributes</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> contents) '(#t . 0) '(#t . 0) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> new-element out-contents)))
                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#msb-lsb-to-internal-pc-attributes" title="midi-laml-processing-lib">msb-lsb-to-internal-pc-attributes</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> contents) previous-msb previous-lsb (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> element out-contents)))))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#msb-lsb-to-internal-pc-attributes" title="midi-laml-processing-lib">msb-lsb-to-internal-pc-attributes</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> contents) previous-msb previous-lsb (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> contents) out-contents))))) 

<a name="revoice-2"></a><span class="comment">; Carry out the revoicing on the a contents list in which program change messages are decorated with internal msb and lsb attributes.</span><br /><a name="revoice-2"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(revoice-2 revoice-map contents)</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a>
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ast</span>)
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#ProgramChange?" title="midi-laml-processing-lib">ProgramChange?</a> ast)
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attribute" title="Manual: xml-in-laml">ast-internal-attribute</a> ast 'msb) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attribute" title="Manual: xml-in-laml">ast-internal-attribute</a> ast 'lsb))
               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">msb</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attribute" title="Manual: xml-in-laml">ast-internal-attribute</a> ast 'msb))
                      (<span class="local-name-binding">lsb</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attribute" title="Manual: xml-in-laml">ast-internal-attribute</a> ast 'lsb))
                      (<span class="local-name-binding">pc</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'number ast))
                      (<span class="local-name-binding">ch</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'channel ast))
                      (<span class="local-name-binding">res</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#lookup-revoice-map" title="midi-laml-processing-lib">lookup-revoice-map</a> revoice-map msb lsb pc)))
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> res
                     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX411" title="R5RS Scheme form">apply</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#voice" title="midi-laml-processing-lib">voice</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> ch res))
                     (<a class="applied-name" href="midi-laml-processing-lib-1.html#voice" title="midi-laml-processing-lib">voice</a> ch 0 0 pc)   <span class="comment">; Revocing to GM</span><br />                 ))
               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">pc</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'number ast))
                     (<span class="local-name-binding">ch</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'channel ast)))
                (<a class="applied-name" href="midi-laml-processing-lib-1.html#voice" title="midi-laml-processing-lib">voice</a> ch 0 0 pc)))
           ast)
    )
    contents))

<a name="lookup-revoice-map"></a><span class="comment">; A revoice map is a list mapping entries.
; A mapping entry is of the form  ((msb-from lsb-from pc-from) (msb-to lsb-to pc-to)) where all constituents are integers
; Return the list (msb-to lsb-to pc-to) if msb, lsb and pc match (msb-from lsb-from pc-from). If not, return #f.</span><br /><a name="lookup-revoice-map"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(lookup-revoice-map revoice-map msb lsb pc)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">res</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> 
               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">e</span>) 
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">from</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> e)))
                    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> msb (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> from)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lsb (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> from)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> pc (<a class="schemedoc-name" href="../../../../../lib/man/general.html#third" title="Manual: general">third</a> from)))))
               revoice-map)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> res
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cadr</a> res)
        #f)))


<a name="eliminate-voice-messages"></a><a name="eliminate-voice-messages"></a><span><a href="../midi-laml-processing-lib.html#eliminate-voice-messages"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">eliminate-voice-messages</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 0 0 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">info-file</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'info-file attributes #f))) 
       (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-voice-messages-1" title="midi-laml-processing-lib">eliminate-voice-messages-1</a> info-file contents))
 )))

<a name="eliminate-voice-messages-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(eliminate-voice-messages-1 info-file contents)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">contents-1</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#msb-lsb-to-internal-pc-attributes" title="midi-laml-processing-lib">msb-lsb-to-internal-pc-attributes</a> contents '(#t . 0) '(#t . 0) '() )))

     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> info-file
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">file-path</span> (<a class="schemedoc-name" href="../../../../../man/laml.html#in-startup-directory" title="Manual: laml">in-startup-directory</a> info-file)))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (file-exists? file-path) (delete-file file-path))
           (<a class="schemedoc-name" href="../../../../../lib/man/file-read.html#write-text-file" title="Manual: file-read">write-text-file</a>
             (<a class="applied-name" href="midi-laml-processing-lib-1.html#make-voices-info-string" title="midi-laml-processing-lib">make-voices-info-string</a> contents-1)
             file-path)))

     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ast</span>) 
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="midi-laml-processing-lib-1.html#ProgramChange?" title="midi-laml-processing-lib">ProgramChange?</a> ast)
                      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime ast)
                              (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-comment-abs-time" title="midi-laml-processing-lib">midi-comment-abs-time</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime ast) 
                                (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "Was ProgramChange" " "
                                               (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> ast 'channel) " " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attribute" title="Manual: xml-in-laml">ast-internal-attribute</a> ast 'msb "?")) " "
                                               (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attribute" title="Manual: xml-in-laml">ast-internal-attribute</a> ast 'lsb "?")) " " (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> ast 'number))))
                            ((<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'deltaTime ast)
                              (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-comment-delta-time" title="midi-laml-processing-lib">midi-comment-delta-time</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'deltaTime ast) 
                                (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "Was ProgramChange" " "
                                               (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> ast 'channel) " " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attribute" title="Manual: xml-in-laml">ast-internal-attribute</a> ast 'msb "?")) " "
                                               (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attribute" title="Manual: xml-in-laml">ast-internal-attribute</a> ast 'lsb "?")) " " (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> ast 'number))))
                            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "eliminate-voice-messages-1 (A): Should not happen"))))

                  ((<a class="applied-name" href="midi-laml-processing-lib-1.html#SysEx?" title="midi-laml-processing-lib">SysEx?</a> ast "05 7E 7F 09 01 F7")
                      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime ast)
                              (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-comment-abs-time" title="midi-laml-processing-lib">midi-comment-abs-time</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime ast) 
                                (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "Was SysEx" " "
                                               (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-text" title="Manual: xml-in-laml">ast-text</a> ast))))
                            ((<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'deltaTime ast)
                              (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-comment-delta-time" title="midi-laml-processing-lib">midi-comment-delta-time</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'deltaTime ast) 
                                (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "Was SysEx" " "
                                               (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-text" title="Manual: xml-in-laml">ast-text</a> ast))))
                            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "eliminate-voice-messages-1 (B): Should not happen"))))
                           
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> ast)))
          contents-1)
  )
)

<a name="make-voices-info-string"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(make-voices-info-string messages)</span>
  (<a class="schemedoc-name" href="../../../../../lib/man/general.html#list-to-string" title="Manual: general">list-to-string</a>
   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">lst</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX411" title="R5RS Scheme form">apply</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#make-single-voice-info" title="midi-laml-processing-lib">make-single-voice-info</a> lst))
        (sort-list
         (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> <a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX319" title="R5RS Scheme form">pair?</a>
                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a>
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ast</span>)
                    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#ProgramChange?" title="midi-laml-processing-lib">ProgramChange?</a> ast)
                        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attribute" title="Manual: xml-in-laml">ast-internal-attribute</a> ast 'msb) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attribute" title="Manual: xml-in-laml">ast-internal-attribute</a> ast 'lsb))
                            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">ch</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'channel ast))
                                   (<span class="local-name-binding">msb</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attribute" title="Manual: xml-in-laml">ast-internal-attribute</a> ast 'msb))
                                   (<span class="local-name-binding">lsb</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attribute" title="Manual: xml-in-laml">ast-internal-attribute</a> ast 'lsb))
                                   (<span class="local-name-binding">pc</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'number ast)))
                              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> ch msb lsb pc))
                            #f)
                        #f))
                  messages))
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">lst1</span> <span class="local-name-binding">lst2</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> lst1) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> lst2))))) <span class="comment">; sort according to channel</span><br />   <a class="schemedoc-name" href="../../../../../lib/man/general.html#CR" title="Manual: general">CR</a>))


<a name="make-single-voice-info"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(make-single-voice-info ch msb lsb pc)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">voice-name</span> (find-voice-info-string msb lsb pc)))
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a>
    "Channel: " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> ch) <a class="schemedoc-name" href="../../../../../lib/man/general.html#CR" title="Manual: general">CR</a>
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> voice-name voice-name "???") <a class="schemedoc-name" href="../../../../../lib/man/general.html#CR" title="Manual: general">CR</a>
    "MSB LSB PC: " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> msb) " " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> lsb) " " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> pc) " " <a class="schemedoc-name" href="../../../../../lib/man/general.html#CR" title="Manual: general">CR</a>
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#xs-instrument-how-to" title="midi-laml-processing-lib">xs-instrument-how-to</a> msb lsb pc) <a class="schemedoc-name" href="../../../../../lib/man/general.html#CR" title="Manual: general">CR</a>)))

<a name="xs-instrument-how-to"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(xs-instrument-how-to msb lsb pc)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">bank</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> msb 63) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lsb 0))  "PRE1")      <span class="comment">; 128</span><br />                    ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> msb 63) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lsb 1))  "PRE2")                    
                    ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> msb 63) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lsb 2))  "PRE3")                    
                    ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> msb 63) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lsb 3))  "PRE4")                    
                    ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> msb 63) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lsb 4))  "PRE5")                    
                    ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> msb 63) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lsb 5))  "PRE6")                    
                    ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> msb 63) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lsb 6))  "PRE7")                    
                    ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> msb 63) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lsb 7))  "PRE8")                    
                    ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> msb 63) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lsb 8))  "USR1")                    
                    ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> msb 63) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lsb 9))  "USR2")                    
                    ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> msb 63) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lsb 10)) "USR3")
                    ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> msb 0) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lsb 0))   "GM")        <span class="comment">; 128</span><br />                    ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> msb 63) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lsb 32)) "PRE DRUM")  <span class="comment">; 64</span><br />                    ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> msb 63) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lsb 40)) "USR DRUM")  <span class="comment">; 32</span><br />                    ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> msb 127) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lsb 0)) "GM Drum")   <span class="comment">; 1</span><br />                    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> "??")))
        (<span class="local-name-binding">number</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX259" title="R5RS Scheme form">remainder</a> pc 16) 1))
        (<span class="local-name-binding">letter-number</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX258" title="R5RS Scheme form">quotient</a> pc 16)))
   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> bank " " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-char" title="Manual: general">as-char</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 65 letter-number))) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> number))))

<a name="clean-for-motif"></a><a name="clean-for-motif"></a><span><a href="../midi-laml-processing-lib.html#clean-for-motif"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">clean-for-motif</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 0 0 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">info-file</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'info-file attributes #f)))
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#clean-for-motif-1" title="midi-laml-processing-lib">clean-for-motif-1</a> info-file contents)))))

<a name="clean-for-motif-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(clean-for-motif-1 info-file contents)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">contents-1</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-voice-messages-1" title="midi-laml-processing-lib">eliminate-voice-messages-1</a> info-file contents)))
   (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>)
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x)) #f)
             ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#ControlChange?" title="midi-laml-processing-lib">ControlChange?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'control x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 64 84)))) #f)
             ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#SysEx?" title="midi-laml-processing-lib">SysEx?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-text" title="Manual: xml-in-laml">ast-text</a> x) 3 5) "43") (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-text" title="Manual: xml-in-laml">ast-text</a> x) 9 11) "4C")) #f)
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> #t)))
    contents-1)))

<a name="clean-for-sectional-playing"></a><a name="clean-for-sectional-playing"></a><span><a href="../midi-laml-processing-lib.html#clean-for-sectional-playing"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">clean-for-sectional-playing</span> 
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 3 0 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">time-mode</span> <span class="local-name-binding">time-start</span> <span class="local-name-binding">include-voice-messages?</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#clean-for-sectional-playing-1" title="midi-laml-processing-lib">clean-for-sectional-playing-1</a> time-mode time-start include-voice-messages? contents))))

<a name="clean-for-sectional-playing-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(clean-for-sectional-playing-1 time-mode-0 time-start include-voice-messages? messages)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">time-mode</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> time-mode-0))) 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">suffix-starting-with-note-on</span>
          (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-tail-in-list" title="Manual: general">find-tail-in-list</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>)
                               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> mes-ast)))
                             messages))
         (<span class="local-name-binding">prefix-before-starting-note-on</span>
          (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-but-tail-in-list" title="Manual: general">find-but-tail-in-list</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>)
                                   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> mes-ast)))
                                 messages))
         (<span class="local-name-binding">cleaned-prefix</span> <span class="comment">; does not work correctly in deltaTime mode! </span><br />          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> include-voice-messages?
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">voice-messages</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#filter-messages-1" title="midi-laml-processing-lib">filter-messages-1</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>)
                                                          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#ProgramChange?" title="midi-laml-processing-lib">ProgramChange?</a> mes-ast) (<a class="applied-name" href="midi-laml-processing-lib-1.html#ControlChange?" title="midi-laml-processing-lib">ControlChange?</a> mes-ast 0) (<a class="applied-name" href="midi-laml-processing-lib-1.html#ControlChange?" title="midi-laml-processing-lib">ControlChange?</a> mes-ast 32)))
                                                        prefix-before-starting-note-on))
                     )
                (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">voice-mes-ast</span>)
                         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> time-mode 'abs-time)
                             (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> voice-mes-ast 'absTime "0")  <span class="comment">; enforce absTime "0"</span><br />                             (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> voice-mes-ast 'deltaTime "0")))
                       voice-messages))
              '()))
        )
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> suffix-starting-with-note-on)
        cleaned-prefix
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">first-time</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> suffix-starting-with-note-on))))
          (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a>
           cleaned-prefix
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-displace-1" title="midi-laml-processing-lib">time-displace-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> first-time time-start)) 
                            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> time-mode 'abs-time)
                                     (<a class="applied-name" href="midi-laml-processing-lib-1.html#filter-messages" title="midi-laml-processing-lib">filter-messages</a> 
                                      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>)
                                        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#Meta?" title="midi-laml-processing-lib">Meta?</a> mes-ast 81) (<a class="applied-name" href="midi-laml-processing-lib-1.html#ProgramChange?" title="midi-laml-processing-lib">ProgramChange?</a> mes-ast) (<a class="applied-name" href="midi-laml-processing-lib-1.html#ControlChange?" title="midi-laml-processing-lib">ControlChange?</a> mes-ast 0) (<a class="applied-name" href="midi-laml-processing-lib-1.html#ControlChange?" title="midi-laml-processing-lib">ControlChange?</a> mes-ast 32) (<a class="applied-name" href="midi-laml-processing-lib-1.html#PitchBendChange?" title="midi-laml-processing-lib">PitchBendChange?</a> mes-ast))))
                                      suffix-starting-with-note-on))
                                  ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> time-mode 'delta-time)
                                     (<a class="applied-name" href="midi-laml-processing-lib-1.html#transform-messages" title="midi-laml-processing-lib">transform-messages</a> 
                                      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>)
                                        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#Meta?" title="midi-laml-processing-lib">Meta?</a> mes-ast 81) (<a class="applied-name" href="midi-laml-processing-lib-1.html#ProgramChange?" title="midi-laml-processing-lib">ProgramChange?</a> mes-ast) (<a class="applied-name" href="midi-laml-processing-lib-1.html#ControlChange?" title="midi-laml-processing-lib">ControlChange?</a> mes-ast 0) (<a class="applied-name" href="midi-laml-processing-lib-1.html#ControlChange?" title="midi-laml-processing-lib">ControlChange?</a> mes-ast 32) (<a class="applied-name" href="midi-laml-processing-lib-1.html#PitchBendChange?" title="midi-laml-processing-lib">PitchBendChange?</a> mes-ast)))
                                      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-delta-time" title="midi-laml-processing-lib">midi-null-event-delta-time</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime))))
                                      suffix-starting-with-note-on))
                                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "clean-for-sectional-playing-1: Should not happen."))))))))))

<a name="tempo-scale"></a><a name="tempo-scale"></a><span><a href="../midi-laml-processing-lib.html#tempo-scale"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">tempo-scale</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">base-tempo</span> <span class="local-name-binding">scale-fn</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">duration</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#total-length-of-message-list" title="midi-laml-processing-lib">total-length-of-message-list</a> contents))
            (<span class="local-name-binding">n</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'n attributes (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX258" title="R5RS Scheme form">quotient</a> duration 960)))
            (<span class="local-name-binding">last-tempo</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'last-tempo attributes #f)))
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#tempo-scale-1" title="midi-laml-processing-lib">tempo-scale-1</a> n base-tempo scale-fn last-tempo contents)))))

<a name="tempo-scale-1"></a><span class="comment">; The signature of tempo-scale-1 has been changed a little on December 16, 2010 (eliminated duration parameter - recalculated in tempo-scale-1)</span><br /><a name="tempo-scale-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(tempo-scale-1 n base-tempo scale-fn last-tempo contents)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#assert-abs-time" title="midi-laml-processing-lib">assert-abs-time</a> contents)
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">duration</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#total-length-of-message-list" title="midi-laml-processing-lib">total-length-of-message-list</a> contents))  <span class="comment">; recalculated of convenience, need not be passed as parameter</span><br />       )
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-abs-merge-two-lists" title="midi-laml-processing-lib">delta-abs-merge-two-lists</a> 
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> last-tempo
         (<a class="applied-name" href="midi-laml-processing-lib-1.html#make-tempo-change-list" title="midi-laml-processing-lib">make-tempo-change-list</a> n duration base-tempo scale-fn (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> last-tempo))
         (<a class="applied-name" href="midi-laml-processing-lib-1.html#make-tempo-change-list" title="midi-laml-processing-lib">make-tempo-change-list</a> n duration base-tempo scale-fn))
     contents)))

<a name="volume-scale"></a><a name="volume-scale"></a><span><a href="../midi-laml-processing-lib.html#volume-scale"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">volume-scale</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 3 0 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span> <span class="local-name-binding">start-volume</span> <span class="local-name-binding">scale-fn</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">duration</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#total-length-of-message-list" title="midi-laml-processing-lib">total-length-of-message-list</a> contents))
            (<span class="local-name-binding">n</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'n attributes (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX258" title="R5RS Scheme form">quotient</a> duration 960)))
            (<span class="local-name-binding">end-volume</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'end-volume attributes #f)))
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#volume-scale-1" title="midi-laml-processing-lib">volume-scale-1</a> ch n duration start-volume scale-fn end-volume contents)))))

<a name="volume-scale-1"></a><span class="comment">; (define (volume-scale-1 ch n duration start-volume scale-fn end-volume contents)
;   (list 
;     (if end-volume
;         (make-volume-change-list ch n duration start-volume scale-fn (as-number end-volume))
;         (make-volume-change-list ch n duration start-volume scale-fn))
;     contents)
; )</span><br />
<a name="volume-scale-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(volume-scale-1 ch n duration start-volume scale-fn end-volume contents)</span>
  (get-rid-of-delta-times
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-abs-merge-two-lists" title="midi-laml-processing-lib">delta-abs-merge-two-lists</a> 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> end-volume
        (<a class="applied-name" href="midi-laml-processing-lib-1.html#make-volume-change-list" title="midi-laml-processing-lib">make-volume-change-list</a> ch n duration start-volume scale-fn (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> end-volume))
        (<a class="applied-name" href="midi-laml-processing-lib-1.html#make-volume-change-list" title="midi-laml-processing-lib">make-volume-change-list</a> ch n duration start-volume scale-fn))
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-copy" title="Manual: xml-in-laml">ast-copy</a> contents)   <span class="comment">; conservative: copy perhaps not necessary?</span><br />   )
   0)
)

<a name="volume-scale-multi-channel"></a><a name="volume-scale-multi-channel"></a><span><a href="../midi-laml-processing-lib.html#volume-scale-multi-channel"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">volume-scale-multi-channel</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">volume-scale-list</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">duration</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#total-length-of-message-list" title="midi-laml-processing-lib">total-length-of-message-list</a> contents))
            (<span class="local-name-binding">n</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX258" title="R5RS Scheme form">quotient</a> duration 960)))
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#volume-scale-multi-channel-1" title="midi-laml-processing-lib">volume-scale-multi-channel-1</a> n duration volume-scale-list contents)))))

<a name="volume-scale-multi-channel-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(volume-scale-multi-channel-1 n duration volume-scale-list contents)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> volume-scale-list)
      contents
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">vol-scale-entry</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> volume-scale-list))
             (<span class="local-name-binding">ch</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> vol-scale-entry))
             (<span class="local-name-binding">start-vol</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> vol-scale-entry))
             (<span class="local-name-binding">scaling-fn</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#third" title="Manual: general">third</a> vol-scale-entry))
             (<span class="local-name-binding">end-vol</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> vol-scale-entry) 4) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#fourth" title="Manual: general">fourth</a> vol-scale-entry) #f)))
        (<a class="applied-name" href="midi-laml-processing-lib-1.html#volume-scale-multi-channel-1" title="midi-laml-processing-lib">volume-scale-multi-channel-1</a> n duration (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> volume-scale-list) (<a class="applied-name" href="midi-laml-processing-lib-1.html#volume-scale-1" title="midi-laml-processing-lib">volume-scale-1</a> ch n duration start-vol scaling-fn end-vol contents)))))

<a name="insert-lyric"></a><a name="insert-lyric"></a><span><a href="../midi-laml-processing-lib.html#insert-lyric"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">insert-lyric</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">lyric-syllable-list</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#insert-lyric-1" title="midi-laml-processing-lib">insert-lyric-1</a> lyric-syllable-list contents))))


<a name="insert-lyric-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(insert-lyric-1 lyric-syllable-list messages)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#insert-lyric-2" title="midi-laml-processing-lib">insert-lyric-2</a> lyric-syllable-list messages '())
)

<a name="insert-lyric-2"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(insert-lyric-2 lyric-syllable-list messages res-messages)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> messages) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res-messages))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">mes</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> messages)))
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes))
                         (<a class="applied-name" href="midi-laml-processing-lib-1.html#insert-lyric-2" title="midi-laml-processing-lib">insert-lyric-2</a> lyric-syllable-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> messages) res-messages))

                      ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#Meta?" title="midi-laml-processing-lib">Meta?</a> mes 5)  <span class="comment">; empty lyric meta message</span><br />                            (<a class="schemedoc-name" href="../../../../../lib/man/general.html#empty-string?" title="Manual: general">empty-string?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-text" title="Manual: xml-in-laml">ast-text</a> mes))
                            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> lyric-syllable-list)))
                         (<a class="applied-name" href="midi-laml-processing-lib-1.html#insert-lyric-2" title="midi-laml-processing-lib">insert-lyric-2</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> lyric-syllable-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> messages)
                                         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (Meta 'deltaTime (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'deltaTime mes) 'type 5
                                                     (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> lyric-syllable-list))) res-messages)))

                      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> 
                         (<a class="applied-name" href="midi-laml-processing-lib-1.html#insert-lyric-2" title="midi-laml-processing-lib">insert-lyric-2</a> lyric-syllable-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> messages) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes res-messages))))))))


<div class="schemedoc-section-comment">;;; .section-id smf-functions
;;; Standard Midi File functions.
;;; Functions which should be applied on a StandardMidiFile form.</div>
<a name="smf-to-ppqn"></a><a name="smf-to-ppqn"></a><span><a href="../midi-laml-processing-lib.html#smf-to-ppqn"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(smf-to-ppqn target-ppqn context-mode smf-ast)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">header</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtree" title="Manual: xml-in-laml">ast-subtree</a> smf-ast "MidiHeader"))
         (<span class="local-name-binding">source-ppqn</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> header 'pulsesPerQuarterNote)))
         (<span class="local-name-binding">format</span>      (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> header 'format)))
         (<span class="local-name-binding">mode</span>        (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> header 'mode))
         (<span class="local-name-binding">ct</span>          (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> header 'counterTransposition))
         (<span class="local-name-binding">no-of-tracks</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> header 'numberOfTracks)))
         (<span class="local-name-binding">track-list</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "MidiTrack"))) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a> smf-ast)))
        )
    (StandardMidiFile (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> context-mode 'nested) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'internal:run-action-procedure "false") (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>))
      (MidiHeader 'format format 'numberOfTracks no-of-tracks 'pulsesPerQuarterNote target-ppqn 'mode mode 'counterTransposition ct)
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">track-ast</span>)
         (MidiTrack
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-stretch-1" title="midi-laml-processing-lib">time-stretch-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> target-ppqn source-ppqn) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a> track-ast)))
       ) 
       track-list))))

<a name="smf-to-format-0"></a><a name="smf-to-format-0"></a><span><a href="../midi-laml-processing-lib.html#smf-to-format-0"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(smf-to-format-0 context-mode smf-ast . optional-parameters)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">ppqn-distance-to-end-of-track</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameters 8))
         (<span class="local-name-binding">header</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtree" title="Manual: xml-in-laml">ast-subtree</a> smf-ast "MidiHeader"))
         (<span class="local-name-binding">ppqn</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> header 'pulsesPerQuarterNote)))
         (<span class="local-name-binding">format</span>      (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> header 'format)))
         (<span class="local-name-binding">mode</span>        (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> header 'mode))
         (<span class="local-name-binding">ct</span>          (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> header 'counterTransposition))
         (<span class="local-name-binding">no-of-tracks</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> header 'numberOfTracks))) <span class="comment">; not used</span><br />         (<span class="local-name-binding">track-list</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) "MidiTrack"))) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a> smf-ast)))
         (<span class="local-name-binding">no-end-of-track</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">message-list</span>) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="applied-name" href="midi-laml-processing-lib-1.html#Meta?" title="midi-laml-processing-lib">Meta?</a> x 47)))) message-list)))
        )

   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> format 0)
       smf-ast  <span class="comment">; the identity function</span><br />       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> mode "absTime")
               (StandardMidiFile (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> context-mode 'nested) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'internal:run-action-procedure "false") (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>))
                (MidiHeader 'format 0 'numberOfTracks 1 'pulsesPerQuarterNote ppqn 'mode "absTime" 'counterTransposition ct)
                (MidiTrack
                 (<a class="schemedoc-name" href="../../../../../lib/man/general.html#accumulate-right" title="Manual: general">accumulate-right</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#abs-merge-two-lists" title="midi-laml-processing-lib">abs-merge-two-lists</a> '() (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#compose" title="Manual: general">compose</a> no-end-of-track <a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a>) track-list))
                 (Meta 'deltaTime (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> ppqn-distance-to-end-of-track ppqn) 'type "47" ""))))
             ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> mode "deltaTime")
               (StandardMidiFile (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> context-mode 'nested) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'internal:run-action-procedure "false") (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>))
                (MidiHeader 'format 0 'numberOfTracks 1 'pulsesPerQuarterNote ppqn 'mode "deltaTime" 'counterTransposition ct)
                (MidiTrack
                 (<a class="schemedoc-name" href="../../../../../lib/man/general.html#accumulate-right" title="Manual: general">accumulate-right</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#delta-merge-two-lists" title="midi-laml-processing-lib">delta-merge-two-lists</a> '() (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#compose" title="Manual: general">compose</a> no-end-of-track <a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a>) track-list))
                 (Meta 'deltaTime (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> ppqn-distance-to-end-of-track ppqn) 'type "47" ""))))))))

<a name="recording-to-motif"></a><a name="recording-to-motif"></a><span><a href="../midi-laml-processing-lib.html#recording-to-motif"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(recording-to-motif smf-ast)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#smf-to-format-0" title="midi-laml-processing-lib">smf-to-format-0</a> 'top-level (<a class="applied-name" href="midi-laml-processing-lib-1.html#smf-to-ppqn" title="midi-laml-processing-lib">smf-to-ppqn</a> 480 'nested smf-ast)))

<a name="recording-to-motif-nested"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(recording-to-motif-nested smf-ast)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#smf-to-format-0" title="midi-laml-processing-lib">smf-to-format-0</a> 'nested (<a class="applied-name" href="midi-laml-processing-lib-1.html#smf-to-ppqn" title="midi-laml-processing-lib">smf-to-ppqn</a> 480 'nested smf-ast)))

<a name="as-step-recording-on-motif-nested-fixed-timing"></a><span class="comment">; An function used internally by the step-recording facility.
; It transforms the smf ast to mofif format (a single track, 480 ppqn).
; Quantification q is either 32, 16, 4, 2, or 1 corresponding to 1/q't note.
; Assume deltaTiming.
; NOT USED</span><br /><a name="as-step-recording-on-motif-nested-fixed-timing"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(as-step-recording-on-motif-nested-fixed-timing smf-ast quantification-str)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">quantification</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> quantification-str)))
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">ticks</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> quantification 1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> 4 480))
                     ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> quantification 2) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> 2 480))
                     ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> quantification 4) 480)
                     ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> quantification 8) 240)
                     ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> quantification 16) 120)
                     ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> quantification 32) 60)
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "as-step-recording-on-motif-nested: Unknown quantification:" quantification)))))
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#apply-to-tracks-nested" title="midi-laml-processing-lib">apply-to-tracks-nested</a> 
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> <span class="local-name-binding">mes-lst</span>
         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ast</span>)
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> ast)
                    (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> ast 'deltaTime ticks 'duration ticks)
                    ast)
              )
              mes-lst))  <span class="comment">; earlier: (filter-messages NoteOn? mes-lst)</span><br />      ()
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#recording-to-motif-nested" title="midi-laml-processing-lib">recording-to-motif-nested</a> smf-ast)))))

<a name="as-step-recording-on-motif-nested-variable-timing"></a><span class="comment">; An function used internally by the step-recording facility.
; Assume step recording takes place in channel 1.
; The function transforms the smf ast to mofif format (a single track, 480 ppqn) and it quantizes the notes to 1/16th, 1/8th, 1/4th, 1/2th, or 1/1th notes (durations 120, 240, 480, 960, 1920 resp)
; after having applied legato
; Pauses are restricted to 1/4, 1/2 or 1/1.
; Recording happens at 100 BPM = 100 quarter notes / 60 sek = 100*480 ticks / 60 s = 800 ticks pr. sec with PPQN = 480.
; Assume deltaTiming in this function.</span><br /><a name="as-step-recording-on-motif-nested-variable-timing"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(as-step-recording-on-motif-nested-variable-timing smf-ast)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#apply-to-tracks-nested" title="midi-laml-processing-lib">apply-to-tracks-nested</a> 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> <span class="local-name-binding">mes-lst</span>
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#quantize-timing-in-a-step-recording" title="midi-laml-processing-lib">quantize-timing-in-a-step-recording</a>
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ast</span>)
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> ast)
                 (<a class="applied-name" href="midi-laml-processing-lib-1.html#quantize-duration-of-note-step-recording" title="midi-laml-processing-lib">quantize-duration-of-note-step-recording</a> ast)
                 ast)
             )
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#legato-in-channel-1" title="midi-laml-processing-lib">legato-in-channel-1</a> 1 10 #t #f 0 mes-lst))))  <span class="comment">; (legato-in-channel-1 1 10 #t #f 0 mes-lst)</span><br />   ()
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#recording-to-motif-nested" title="midi-laml-processing-lib">recording-to-motif-nested</a> smf-ast)))  

<a name="quantize-duration-of-note-step-recording"></a><span class="comment">; Force duration to either 120, 240, 480, 960 or 1920 ticks.
; The forced duration comes from the recorded duration.</span><br /><a name="quantize-duration-of-note-step-recording"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(quantize-duration-of-note-step-recording note-ast)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">recorded-duration</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'duration note-ast))
         (<span class="local-name-binding">forced-duration</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> recorded-duration 300) 120)     <span class="comment">; 1/16th at 480 PPQN</span><br />                                ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> recorded-duration 600) 240)     <span class="comment">; 1/8th at 480 PPQN</span><br />                                ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> recorded-duration 1200) 480)    <span class="comment">; 1/4th at 480 PPQN</span><br />                                ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> recorded-duration 2400) 960)    <span class="comment">; 1/2th at 480 PPQN</span><br />                                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a>                        1920))) <span class="comment">; 1/1th at 480 PPQN</span><br />        )
    (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> note-ast 'duration forced-duration)))

<a name="quantize-timing-in-a-step-recording"></a><span class="comment">; Set the deltaTime based on the duration of the previous note.
; No pauses are introduced.</span><br /><a name="quantize-timing-in-a-step-recording"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(quantize-timing-in-a-step-recording event-ast-lst)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#quantize-timing-step-recording-1" title="midi-laml-processing-lib">quantize-timing-step-recording-1</a> event-ast-lst #f '())
)

<a name="quantize-timing-step-recording-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(quantize-timing-step-recording-1 event-ast-lst prev-duration res-lst)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> event-ast-lst)
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res-lst)
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">mes</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> event-ast-lst)))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> mes) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> prev-duration))
                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#quantize-timing-step-recording-1" title="midi-laml-processing-lib">quantize-timing-step-recording-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> event-ast-lst) (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'duration mes) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes 'deltaTime 480) res-lst)))
              ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> mes) prev-duration)
                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#quantize-timing-step-recording-1" title="midi-laml-processing-lib">quantize-timing-step-recording-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> event-ast-lst) (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'duration mes) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes 'deltaTime prev-duration) res-lst)))
              ((<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes)
                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#quantize-timing-step-recording-1" title="midi-laml-processing-lib">quantize-timing-step-recording-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> event-ast-lst) prev-duration (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes res-lst)))
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> 
                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#quantize-timing-step-recording-1" title="midi-laml-processing-lib">quantize-timing-step-recording-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> event-ast-lst) prev-duration res-lst))))))


<a name="rtm"></a><a name="rtm"></a><span><a href="../midi-laml-processing-lib.html#rtm"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(rtm smf-ast)</span>
 (<a class="applied-name" href="midi-laml-processing-lib-1.html#apply-to-tracks-top-level" title="midi-laml-processing-lib">apply-to-tracks-top-level</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-channel-key-pressure" title="midi-laml-processing-lib">eliminate-channel-key-pressure</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> #t)
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#apply-to-tracks-nested" title="midi-laml-processing-lib">apply-to-tracks-nested</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#marker-silence" title="midi-laml-processing-lib">marker-silence</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 2000)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#recording-to-motif-nested" title="midi-laml-processing-lib">recording-to-motif-nested</a> smf-ast))))

<a name="recording-to-tyros"></a><a name="recording-to-tyros"></a><span><a href="../midi-laml-processing-lib.html#recording-to-tyros"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(recording-to-tyros smf-ast)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#smf-to-format-0" title="midi-laml-processing-lib">smf-to-format-0</a> 'top-level (<a class="applied-name" href="midi-laml-processing-lib-1.html#smf-to-ppqn" title="midi-laml-processing-lib">smf-to-ppqn</a> 1920 'nested smf-ast)))

<a name="apply-to-tracks-nested"></a><a name="apply-to-tracks-nested"></a><span><a href="../midi-laml-processing-lib.html#apply-to-tracks-nested"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(apply-to-tracks-nested f f-parameter-list ast)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#apply-to-tracks" title="midi-laml-processing-lib">apply-to-tracks</a> f f-parameter-list ast 'nested)
)

<a name="apply-to-tracks-top-level"></a><a name="apply-to-tracks-top-level"></a><span><a href="../midi-laml-processing-lib.html#apply-to-tracks-top-level"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(apply-to-tracks-top-level f f-parameter-list ast)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#apply-to-tracks" title="midi-laml-processing-lib">apply-to-tracks</a> f f-parameter-list ast 'top-level)
)

<a name="apply-to-tracks"></a><span class="comment">; In this function, mode is either top-level or nested (a symbol).</span><br /><a name="apply-to-tracks"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(apply-to-tracks f f-parameter-list ast context-mode)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> 
         <span class="comment">; ast is format 0 StandardMidiFile</span><br />         ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "StandardMidiFile" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> ast)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "0" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtree" title="Manual: xml-in-laml">ast-subtree</a> ast "MidiHeader") 'format)))
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">track-ast</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtree" title="Manual: xml-in-laml">ast-subtree</a> ast "MidiTrack" 1))
                   (<span class="local-name-binding">header-ast</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtree" title="Manual: xml-in-laml">ast-subtree</a> ast "MidiHeader"))
                   (<span class="local-name-binding">track-messages</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a> track-ast)))
              (StandardMidiFile (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> context-mode 'nested) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'internal:run-action-procedure "false") (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>)) 
               header-ast
               (MidiTrack
                (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX411" title="R5RS Scheme form">apply</a> f (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> f-parameter-list track-messages))))))

         <span class="comment">; ast is format 1 StandardMidiFile</span><br />         ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "StandardMidiFile" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> ast)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "1" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtree" title="Manual: xml-in-laml">ast-subtree</a> ast "MidiHeader") 'format)))
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">header-ast</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtree" title="Manual: xml-in-laml">ast-subtree</a> ast "MidiHeader"))
                   (<span class="local-name-binding">track-ast-list</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#find-asts" title="Manual: xml-in-laml">find-asts</a> ast "MidiTrack"))
                  )
              (StandardMidiFile (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> context-mode 'nested) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'internal:run-action-procedure "false") (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>))
               header-ast
               (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">track-ast</span>)
                      (MidiTrack
                        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX411" title="R5RS Scheme form">apply</a> f (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> f-parameter-list (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a> track-ast)))))
                    track-ast-list))))

         <span class="comment">; ast is MidiTrack</span><br />         ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "MidiTrack" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> ast))
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">track-messages</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a> ast)))
               (MidiTrack
                (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX411" title="R5RS Scheme form">apply</a> f (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> f-parameter-list track-messages)))))

 
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "Must be called on a StandardMidiFile or MidiTrack ast"))))
   

<div class="schemedoc-section-comment">;;; .section-id scaling-function-generation
;;; Generation of Scaling Functions.
;;; Scaling functions are used for smooth scaling of attributes such as deltaTime, duration, and velocity.
;;; A scaling function has the simple signature [0,1] -&gt; Real.
;;; The functions in this section generate such scaling functions.
;;; The next section contains concrete scaling functions.
;;; The most useful - and the most versatile - generator is make-scale-function-by-xy-points.</div>
<a name="make-scale-fn-pol-one-pol"></a><a name="make-scale-fn-pol-one-pol"></a><span><a href="../midi-laml-processing-lib.html#make-scale-fn-pol-one-pol"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(make-scale-fn-pol-one-pol shape-start shape-end c d)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX123" title="R5RS Scheme form">letrec</a> ((<span class="local-name-binding">f-up</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 1 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> c (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> x d) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> x (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> 1 d))))))
           (<span class="local-name-binding">f-down</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX247" title="R5RS Scheme form">max</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> 1 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> c (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> x d) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> x (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> 1 d)))) 0)))
           (<span class="local-name-binding">f-flat</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) 1))
          )
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> x 0) (error "the input is not supposed to be negative"))
              ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> x d) ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> shape-start 'up) f-up)
                              ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> shape-start 'flat) f-flat)
                              ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> shape-start 'down) f-down)
                              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "shape-start must be one of the symbols up, flat, or down"))) x))
              ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> x (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> 1 d)) 1)
              ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> x 1) ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> shape-end 'up) f-up)
                              ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> shape-end 'flat) f-flat)
                              ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> shape-end 'down) f-down)
                              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "shape-end must be one of the symbols up, flat, or down"))) x))
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (error "the input is not supposed to larger than one"))))))

<a name="make-scale-fn-pol-one-pol-general"></a><a name="make-scale-fn-pol-one-pol-general"></a><span><a href="../midi-laml-processing-lib.html#make-scale-fn-pol-one-pol-general"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(make-scale-fn-pol-one-pol-general shape-start shape-end cs ds ce de)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX123" title="R5RS Scheme form">letrec</a> ((<span class="local-name-binding">f-up-s</span>   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 1 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> cs (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> x ds) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> x (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> 1 ds))))))
           (<span class="local-name-binding">f-down-s</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX247" title="R5RS Scheme form">max</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> 1 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> cs (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> x ds) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> x (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> 1 ds)))) 0)))
           (<span class="local-name-binding">f-up-e</span>   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 1 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> ce (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> x de) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> x (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> 1 de))))))
           (<span class="local-name-binding">f-down-e</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX247" title="R5RS Scheme form">max</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> 1 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> ce (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> x de) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> x (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> 1 de)))) 0)))
           (<span class="local-name-binding">f-flat</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) 1))
          )
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> x 0) (error "the input is not supposed to be negative"))
              ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> x ds) ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> shape-start 'up) f-up-s)
                               ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> shape-start 'flat) f-flat)
                               ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> shape-start 'down) f-down-s)
                               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "shape-start must be one of the symbols up, flat, or down"))) x))
              ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> x (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> 1 de)) 1)
              ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> x 1) ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> shape-end 'up) f-up-e)
                               ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> shape-end 'flat) f-flat)
                               ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> shape-end 'down) f-down-e)
                               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "shape-end must be one of the symbols up, flat, or down"))) x))
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (error "the input is not supposed to larger than one"))))))


<a name="make-scale-function-by-xy-points"></a><a name="make-scale-function-by-xy-points"></a><span><a href="../midi-laml-processing-lib.html#make-scale-function-by-xy-points"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(make-scale-function-by-xy-points xy-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX123" title="R5RS Scheme form">letrec</a> ((<span class="local-name-binding">x-of</span> <a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a>)
           (<span class="local-name-binding">y-of</span> <a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a>)
          )
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">sorted-xy-list</span> (sort-list
                            xy-list
                            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">p1</span> <span class="local-name-binding">p2</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> (x-of p1) (x-of p2))))))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>)   <span class="comment">; x in [0,1]</span><br />      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">first-pair-0</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">pair</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (x-of pair) x)) sorted-xy-list))
             (<span class="local-name-binding">first-pair</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> first-pair-0) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> first-pair-0))
                             (<a class="schemedoc-name" href="../../../../../lib/man/general.html#last" title="Manual: general">last</a> sorted-xy-list)
                             first-pair-0))
             (<span class="local-name-binding">second-pair</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#element-before" title="Manual: general">element-before</a> first-pair sorted-xy-list <a class="schemedoc-name" href="../../../../../lib/man/general.html#id-1" title="Manual: general">id-1</a> <a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a>))
             (<span class="local-name-binding">x1</span> (x-of first-pair))
             (<span class="local-name-binding">y1</span> (y-of first-pair))
             (<span class="local-name-binding">x2</span> (x-of second-pair))
             (<span class="local-name-binding">y2</span> (y-of second-pair)))
       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> y1 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> y2 y1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> x2 x1)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> x x1))))))))


<a name="multiply-scaling-function"></a><a name="multiply-scaling-function"></a><span><a href="../midi-laml-processing-lib.html#multiply-scaling-function"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(multiply-scaling-function factor sf)</span> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>)
     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> factor (sf x))))

<a name="add-two-scaling-functions"></a><a name="add-two-scaling-functions"></a><span><a href="../midi-laml-processing-lib.html#add-two-scaling-functions"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(add-two-scaling-functions sf1 sf2)</span> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>)
     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (sf1 x) (sf2 x) )))

<a name="subtract-two-scaling-functions"></a><a name="subtract-two-scaling-functions"></a><span><a href="../midi-laml-processing-lib.html#subtract-two-scaling-functions"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(subtract-two-scaling-functions sf1 sf2)</span> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>)
     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (sf1 x) (sf2 x) )))

<a name="multiply-two-scaling-functions"></a><a name="multiply-two-scaling-functions"></a><span><a href="../midi-laml-processing-lib.html#multiply-two-scaling-functions"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(multiply-two-scaling-functions sf1 sf2)</span> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>)
     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (sf1 x) (sf2 x) )))

<a name="from-percent-points"></a><a name="from-percent-points"></a><span><a href="../midi-laml-processing-lib.html#from-percent-points"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(from-percent-points point-lst)</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">point</span>)
         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> point) 100)
               (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> point) 100)))
       point-lst))

<a name="from-permille-points"></a><a name="from-permille-points"></a><span><a href="../midi-laml-processing-lib.html#from-permille-points"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(from-permille-points point-lst)</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">point</span>)
         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> point) 1000)
               (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> point) 1000)))
       point-lst))


<a name="pi"></a><div class="schemedoc-section-comment">;;; .section-id scaling-functions
;;; Examples of Scaling Functions.
;;; This section contains concrete scaling functions, as generated by the functions in the previous section.
;;; These scaling functions may serve as inspiration when new scaling functions are needed. 
;;; As already mentioned above, a scaling function has the simple signature [0,1] -&gt; Real.
;;; We link to SVG illustrations of the graphs of the scaling functions.
;;; When a new scaling function is developed it can be tried out in &lt;a href = "scaling-functions/try.laml"&gt; man/scaling-functions/try.laml &lt;/a&gt;
;;; and visualized in &lt;a href="scaling-functions/try.svg"&gt; man/scaling-functions/try.svg &lt;/a&gt;.
;;; Consult the Scheme source to access the source form of the scaling function.</div>
<a name="pi"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">pi</span> 3.141592654)

<a name="sf1"></a><a name="sf1"></a><span><a href="../midi-laml-processing-lib.html#sf1"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">sf1</span>
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#multiply-scaling-function" title="midi-laml-processing-lib">multiply-scaling-function</a> 2.5
          (<a class="applied-name" href="midi-laml-processing-lib-1.html#make-scale-function-by-xy-points" title="midi-laml-processing-lib">make-scale-function-by-xy-points</a>
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#from-permille-points" title="midi-laml-processing-lib">from-permille-points</a> '((0 -150) (350 -110) (700 0) (760 50) (800 70) (850 60) (900 30) (1000 0)))
          )))

<a name="sf2"></a><a name="sf2"></a><span><a href="../midi-laml-processing-lib.html#sf2"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">sf2</span>
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#multiply-scaling-function" title="midi-laml-processing-lib">multiply-scaling-function</a> 1.0
          (<a class="applied-name" href="midi-laml-processing-lib-1.html#make-scale-function-by-xy-points" title="midi-laml-processing-lib">make-scale-function-by-xy-points</a>
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#from-permille-points" title="midi-laml-processing-lib">from-permille-points</a> '((0 -250) (500 -150) (750 -75) (800 -50) (900 -10) (1000 0)))
          )))

<a name="sf3"></a><a name="sf3"></a><span><a href="../midi-laml-processing-lib.html#sf3"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">sf3</span>
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#multiply-scaling-function" title="midi-laml-processing-lib">multiply-scaling-function</a> 1.8
          (<a class="applied-name" href="midi-laml-processing-lib-1.html#make-scale-function-by-xy-points" title="midi-laml-processing-lib">make-scale-function-by-xy-points</a>
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#from-permille-points" title="midi-laml-processing-lib">from-permille-points</a> '((0 0) (33 -50) (66 50)   (100 0) (133 -50) (166 50)  
                                   (200 0) (233 -50) (266 50)   (300 0) (333 -50) (366 50)  
                                   (400 0) (433 -40) (466 40)   (500 0) (533 -40) (566 40)  
                                   (600 0) (633 -30) (666 30)   (700 0) (733 -30) (766 30)  
                                   (800 0) (833 -25) (866 25)   (900 0) (933 -25) (966 25)   (1000 0)  ))
          )))

<a name="sf4"></a><a name="sf4"></a><span><a href="../midi-laml-processing-lib.html#sf4"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">sf4</span>
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#make-scale-fn-pol-one-pol" title="midi-laml-processing-lib">make-scale-fn-pol-one-pol</a> 'down 'down 4.5 0.35))


<a name="sf5"></a><a name="sf5"></a><span><a href="../midi-laml-processing-lib.html#sf5"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">sf5</span>
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#make-scale-fn-pol-one-pol" title="midi-laml-processing-lib">make-scale-fn-pol-one-pol</a> 'up 'down 5.5 0.25))


<a name="sf6"></a><a name="sf6"></a><span><a href="../midi-laml-processing-lib.html#sf6"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">sf6</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#multiply-two-scaling-functions" title="midi-laml-processing-lib">multiply-two-scaling-functions</a> 
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#make-scale-function-by-xy-points" title="midi-laml-processing-lib">make-scale-function-by-xy-points</a>
         (<a class="applied-name" href="midi-laml-processing-lib-1.html#from-percent-points" title="midi-laml-processing-lib">from-percent-points</a> '((0 100) (100 0))))
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX273" title="R5RS Scheme form">sin</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> x 15 <a class="applied-name" href="midi-laml-processing-lib-1.html#pi" title="midi-laml-processing-lib">pi</a>)))
     ))



        

<span class="comment">; ---------------------------------------------------------------------------------------------------------------</span><br /><div class="schemedoc-section-comment">;;; .section-id midi-region-functions
;;; Midi region functions.
;;; This section contains function that establish regions around a list of midi messages.</div>
<a name="midi-context"></a><a name="midi-context"></a><span><a href="../midi-laml-processing-lib.html#midi-context"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX187" title="R5RS Scheme form">define-syntax</a> <span class="signature">midi-context</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX164" title="R5RS Scheme form">syntax-rules</a> ()
     ((midi-context <a class="schemedoc-name" href="../../../../../lib/xml-in-laml/mirrors/man/xhtml10-transitional-mirror.html#select" title="Manual: xhtml10-transitional-mirror">select</a> midi-message ...)
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX417" title="R5RS Scheme form">call-with-current-continuation</a>
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">select</span>)
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> midi-message ...))))))

<a name="midi-region-do"></a><a name="midi-region-do"></a><span><a href="../midi-laml-processing-lib.html#midi-region-do"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">midi-region-do</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">contextual-continuation</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">ast-contents</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> <a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> contents))
            (<span class="local-name-binding">first-mes</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> ast-contents)) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> ast-contents) #f))
            (<span class="local-name-binding">abs-time</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> first-mes (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> first-mes 'absTime #f) #f)))
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> abs-time  
           (contextual-continuation (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-displace" title="midi-laml-processing-lib">time-displace</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> abs-time)) contents))
           (contextual-continuation contents))))))

<a name="midi-region"></a><a name="midi-region"></a><span><a href="../midi-laml-processing-lib.html#midi-region"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">midi-region</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-abstraction" title="Manual: xml-in-laml">xml-in-laml-abstraction</a>
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">drop</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-boolean" title="Manual: general">as-boolean</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'drop attributes #f)))
            (<span class="local-name-binding">name</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'name attributes "")) 
            (<span class="local-name-binding">sep</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#empty-string?" title="Manual: general">empty-string?</a> name) "" ":"))
            (<span class="local-name-binding">midi-comment-start</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-comment" title="midi-laml-processing-lib">midi-comment</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "Midi region start" sep)  name ))
            (<span class="local-name-binding">midi-comment-end</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-comment" title="midi-laml-processing-lib">midi-comment</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "Midi region end" sep) name ))
           )
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> drop)
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> midi-comment-start contents midi-comment-end)
           '())))))

<span class="comment">; ---------------------------------------------------------------------------------------------------------------</span><br /><div class="schemedoc-section-comment">;;; .section-id sing-midi-abstractions
;;; Single midi message abstractions.
;;; Abstractions that generate a single, or a few midi messages.</div>
<a name="midi-null-event-text"></a><a name="midi-null-event-text"></a><span><a href="../midi-laml-processing-lib.html#midi-null-event-text"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">midi-null-event-text</span> "Midi null-event")

<a name="midi-null-event"></a><a name="midi-null-event"></a><span><a href="../midi-laml-processing-lib.html#midi-null-event"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(midi-null-event delta-time . optional-parameter-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">info-text</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list <a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-text" title="midi-laml-processing-lib">midi-null-event-text</a>)))
  (Meta 'deltaTime delta-time 'type "1" info-text)))

<a name="midi-null-event-delta-time"></a><a name="midi-null-event-delta-time"></a><span><a href="../midi-laml-processing-lib.html#midi-null-event-delta-time"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">midi-null-event-delta-time</span> <a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event" title="midi-laml-processing-lib">midi-null-event</a>)

<a name="midi-null-event-abs-time"></a><a name="midi-null-event-abs-time"></a><span><a href="../midi-laml-processing-lib.html#midi-null-event-abs-time"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(midi-null-event-abs-time abs-time . optional-parameter-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">info-text</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list <a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-text" title="midi-laml-processing-lib">midi-null-event-text</a>)))
  (Meta 'absTime abs-time 'type "1" info-text)))

<a name="midi-comment"></a><a name="midi-comment"></a><span><a href="../midi-laml-processing-lib.html#midi-comment"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">midi-comment</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-abstraction" title="Manual: xml-in-laml">xml-in-laml-abstraction</a>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">contents</span> <span class="local-name-binding">attr</span>)
    (Meta 'deltaTime "0" 'type 1 contents))))

<a name="midi-comment-abs-time"></a><a name="midi-comment-abs-time"></a><span><a href="../midi-laml-processing-lib.html#midi-comment-abs-time"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">midi-comment-abs-time</span> 
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">abs-time</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attr</span>)
    (Meta 'absTime abs-time 'type 1 contents))))

<a name="midi-comment-delta-time"></a><a name="midi-comment-delta-time"></a><span><a href="../midi-laml-processing-lib.html#midi-comment-delta-time"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">midi-comment-delta-time</span> 
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">delta-time</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attr</span>)
    (Meta 'deltaTime delta-time 'type 1 contents))))

<a name="midi-marker"></a><a name="midi-marker"></a><span><a href="../midi-laml-processing-lib.html#midi-marker"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(midi-marker marker-txt . optional-parameter-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">marker-number</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list 0))
       (<span class="local-name-binding">marker-letter</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 2 optional-parameter-list "M"))
      )
  (Meta 'deltaTime "0" 'type "6" (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> marker-letter "-" (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> marker-number) " " marker-txt))))

<a name="midi-marker-abs-time"></a><a name="midi-marker-abs-time"></a><span><a href="../midi-laml-processing-lib.html#midi-marker-abs-time"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(midi-marker-abs-time abs-time marker-txt . optional-parameter-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">marker-number</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list 0))
       (<span class="local-name-binding">marker-letter</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 2 optional-parameter-list "M"))
      )
  (Meta 'absTime (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> abs-time) 'type "6" (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> marker-letter "-" (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> marker-number) " " marker-txt))))


<a name="pan"></a><a name="pan"></a><span><a href="../midi-laml-processing-lib.html#pan"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(pan c value)</span>
 (ControlChange 'deltaTime "0" 'channel c 'control "10" 'value value))

<a name="volume"></a><a name="volume"></a><span><a href="../midi-laml-processing-lib.html#volume"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(volume c value)</span>
 (ControlChange 'deltaTime "0" 'channel c 'control "7" 'value value))

<a name="reverb"></a><a name="reverb"></a><span><a href="../midi-laml-processing-lib.html#reverb"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(reverb c value)</span>
 (ControlChange 'deltaTime "0" 'channel c 'control "91" 'value value))

<a name="chorus"></a><a name="chorus"></a><span><a href="../midi-laml-processing-lib.html#chorus"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(chorus c value)</span>
 (ControlChange 'deltaTime "0" 'channel c 'control "93" 'value value))


<a name="dsp-variation-on"></a><span class="comment">; Works in certain test, but probably not in general. Too simple and specific perhaps.
; Experimental and doubtful.</span><br /><a name="dsp-variation-on"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(dsp-variation-on)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>
   (SysEx 'deltaTime "0"  "08 43 10 4C 03 00 02 5B F7")
   (SysEx 'deltaTime "0"  "08 43 10 4C 03 00 03 05 F7")))

<a name="dsp-variation-off"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(dsp-variation-off)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>
   (SysEx 'deltaTime "0"  "08 43 10 4C 03 00 02 28 F7")
   (SysEx 'deltaTime "0"  "08 43 10 4C 03 00 03 04 F7")))

<span class="comment">; Voice Convenience.
; (voice c msb lsb program-number)</span><br />
<a name="voice"></a><a name="voice"></a><span><a href="../midi-laml-processing-lib.html#voice"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(voice channel msb lsb program-number)</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 
    (ControlChange 'deltaTime "0" 'channel channel 'control "0" 'value msb)
    (ControlChange 'deltaTime "0" 'channel channel 'control "32" 'value lsb)
    (ProgramChange 'deltaTime "0" 'channel channel 'number program-number)
  )
)

<a name="voice-with-mix"></a><a name="voice-with-mix"></a><span><a href="../midi-laml-processing-lib.html#voice-with-mix"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(voice-with-mix channel msb lsb program-number v p r c)</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 
    (ControlChange 'deltaTime "0" 'channel channel 'control "0" 'value msb)
    (ControlChange 'deltaTime "0" 'channel channel 'control "32" 'value lsb)
    (ProgramChange 'deltaTime "0" 'channel channel 'number program-number)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#volume" title="midi-laml-processing-lib">volume</a> channel v)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#pan" title="midi-laml-processing-lib">pan</a> channel p)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#reverb" title="midi-laml-processing-lib">reverb</a> channel r)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#chorus" title="midi-laml-processing-lib">chorus</a> channel c)
  )
)


<a name="gm-voice"></a><a name="gm-voice"></a><span><a href="../midi-laml-processing-lib.html#gm-voice"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(gm-voice channel program)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX224" title="R5RS Scheme form">number?</a> program)
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#voice" title="midi-laml-processing-lib">voice</a> channel 0 0 program))
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX374" title="R5RS Scheme form">string?</a> program)
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">gm-data-list</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-read" title="Manual: general">file-read</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> midi-software-dir "data/general-midi-voices.dat")))
                  (<span class="local-name-binding">res</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">entry</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#downcase-string" title="Manual: general">downcase-string</a> program)
                                                             (<a class="schemedoc-name" href="../../../../../lib/man/general.html#downcase-string" title="Manual: general">downcase-string</a> (get-gm-voice-name entry))))
                                     gm-data-list)))
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> res
                 (<a class="applied-name" href="midi-laml-processing-lib-1.html#voice" title="midi-laml-processing-lib">voice</a> channel 0 0 (get-gm-voice-pc res))
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">res</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">entry</span>) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#substring?" title="Manual: general">substring?</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#downcase-string" title="Manual: general">downcase-string</a> (get-gm-voice-name entry))
                                                                      (<a class="schemedoc-name" href="../../../../../lib/man/general.html#downcase-string" title="Manual: general">downcase-string</a> program)))
                                          gm-data-list)))
                   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> res
                       (<a class="applied-name" href="midi-laml-processing-lib-1.html#voice" title="midi-laml-processing-lib">voice</a> channel 0 0 (get-gm-voice-pc res))
                       (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "gm-voice: Cannot make sense of program: " program))))))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "gm-voice: The second parameter must be a pc-number of a voice name (a string)"))))

<a name="voices-from-file"></a><a name="voices-from-file"></a><span><a href="../midi-laml-processing-lib.html#voices-from-file"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(voices-from-file . optional-parameter-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">voice-file</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list (<a class="schemedoc-name" href="../../../../../man/laml.html#source-filename-without-extension" title="Manual: laml">source-filename-without-extension</a>)))  <span class="comment">; (string-append (startup-directory) (source-filename-without-extension))</span><br />         (<span class="local-name-binding">init-path</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-name-initial-path" title="Manual: general">file-name-initial-path</a> voice-file))
         (<span class="local-name-binding">voice-file-with-extension</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-name-proper" title="Manual: general">file-name-proper</a> voice-file) "." "voices"))
         (<span class="local-name-binding">file-path</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#empty-string?" title="Manual: general">empty-string?</a> init-path) (<a class="schemedoc-name" href="../../../../../man/laml.html#startup-directory" title="Manual: laml">startup-directory</a>) init-path) voice-file-with-extension)) 
         (<span class="local-name-binding">get-msb</span> <a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a>) (<span class="local-name-binding">get-lsb</span> <a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a>) (<span class="local-name-binding">get-pc</span> <a class="schemedoc-name" href="../../../../../lib/man/general.html#third" title="Manual: general">third</a>) (<span class="local-name-binding">get-vol</span> <a class="schemedoc-name" href="../../../../../lib/man/general.html#fifth" title="Manual: general">fifth</a>) (<span class="local-name-binding">get-pan</span> <a class="schemedoc-name" href="../../../../../lib/man/general.html#sixth" title="Manual: general">sixth</a>) (<span class="local-name-binding">get-reverb</span> <a class="schemedoc-name" href="../../../../../lib/man/general.html#seventh" title="Manual: general">seventh</a>) (<span class="local-name-binding">get-chorus</span> <a class="schemedoc-name" href="../../../../../lib/man/general.html#eighth" title="Manual: general">eighth</a>)  <span class="comment">; local accessors - only used here, so waste to make them global.</span><br />        ) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (file-exists? file-path)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">voice-structure</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-read" title="Manual: general">file-read</a> file-path)))
           (<a class="schemedoc-name" href="../../../../../lib/man/general.html#flatten" title="Manual: general">flatten</a> 
            (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) x)
                    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#map2" title="Manual: general">map2</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">e</span> <span class="local-name-binding">ch</span>)
                            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> e 'nil))
                                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> e) 4) 
                                       (<a class="applied-name" href="midi-laml-processing-lib-1.html#voice" title="midi-laml-processing-lib">voice</a> ch (get-msb e) (get-lsb e) (get-pc e))
                                       (<a class="applied-name" href="midi-laml-processing-lib-1.html#voice-with-mix" title="midi-laml-processing-lib">voice-with-mix</a> ch (get-msb e) (get-lsb e) (get-pc e) (get-vol e) (get-pan e) (get-reverb e) (get-chorus e)))
                                #f))
                          (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> voice-structure) <span class="comment">; first element is dummy</span><br />                          (<a class="schemedoc-name" href="../../../../../lib/man/general.html#number-interval" title="Manual: general">number-interval</a> 1 16) <span class="comment">; possible channel numbers</span><br />                          ))))
        (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "voices-from-file: Non-exisisting voice file path: " file-path))))


<a name="tempo"></a><a name="tempo"></a><span><a href="../midi-laml-processing-lib.html#tempo"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(tempo bpm)</span>
  (Meta 'deltaTime "0" 'type "81" (tempo= bpm)))

<a name="pitch-bend-range"></a><a name="pitch-bend-range"></a><span><a href="../midi-laml-processing-lib.html#pitch-bend-range"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(pitch-bend-range channel range  . optional-parameter-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">cents</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list 0)))
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>
   <span class="comment">; Tell that the following data entry messages encoded Pitch Bend</span><br />   (ControlChange 'deltaTime "0" 'channel channel 'control "101" 'value "0")
   (ControlChange 'deltaTime "0" 'channel channel 'control "100" 'value "0")  

   <span class="comment">; Sets the pitch bend semi-tone and fine tune adjustments</span><br />   (ControlChange 'deltaTime "0" 'channel channel 'control "6" 'value range)
   (ControlChange 'deltaTime "0" 'channel channel 'control "38" 'value cents)
  )))


<a name="chord-meta"></a><a name="chord-meta"></a><span><a href="../midi-laml-processing-lib.html#chord-meta"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(chord-meta root . optional-parameter-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">chord-type</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list "M")))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">chord-type-number</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#index-in-list-by-predicate" title="Manual: general">index-in-list-by-predicate</a> chord-types chord-type (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">chord-types-row</span> <span class="local-name-binding">ct</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> chord-types-row) ct))))
           (<span class="local-name-binding">root-number</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#calculate-root-number" title="midi-laml-processing-lib">calculate-root-number</a> root))
           (<span class="local-name-binding">chord-type-number-two-ciffer-hex-string</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#binary-to-hex-string" title="Manual: general">binary-to-hex-string</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#int10-to-binary" title="Manual: general">int10-to-binary</a> chord-type-number 1)))
           (<span class="local-name-binding">chord-root-number-two-ciffer-hex-string</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#binary-to-hex-string" title="Manual: general">binary-to-hex-string</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#int10-to-binary" title="Manual: general">int10-to-binary</a> root-number 1)))  <span class="comment">; produces a hex string, such as "A3"</span><br />          )
      (Meta 'deltaTime "0" 'type "127" 
          (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "43 7B 01" " "
                         chord-root-number-two-ciffer-hex-string " " chord-type-number-two-ciffer-hex-string " "
                         chord-root-number-two-ciffer-hex-string " " chord-type-number-two-ciffer-hex-string)))))

<a name="calculate-root-number"></a><span class="comment">; Root is a string of one or two characters, such as "C#"
; Return a number between 0 and 255 (really between 0 and 127)</span><br /><a name="calculate-root-number"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(calculate-root-number root0)</span>   <span class="comment">; tyros data list page 59, cr</span><br />  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">root</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#upcase-string" title="Manual: general">upcase-string</a> root0))
         (<span class="local-name-binding">real-root</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> root 0))
         (<span class="local-name-binding">root-variation</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> root) 1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> root 1) #f))
         (<span class="local-name-binding">part1-hex-ciffer</span> 
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> root-variation) 3)       <span class="comment">; natural</span><br />                  ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> root-variation #\#) 4)    <span class="comment">; sharp</span><br />                  ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> root-variation #\b) 2)    <span class="comment">; b           - not really supported</span><br />                  ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> root-variation #\B) 2)    <span class="comment">; b           - not really supported</span><br />                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "chord-meta -&gt; calculate-root-number. Unknown root variation. Use only the empty or &#39;#&#39;" root))))
         (<span class="local-name-binding">part2-hex-ciffer</span> 
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> #\C real-root) 1)
                  ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> #\D real-root) 2)
                  ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> #\E real-root) 3)
                  ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> #\F real-root) 4)
                  ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> #\G real-root) 5)
                  ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> #\A real-root) 6)
                  ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> #\B real-root) 7)
                  ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> #\H real-root) 7)
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "chord-meta -&gt; calculate-root-number. Unknown root. Use only C D E F G A H B (or H for B)")))))
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> 16 part1-hex-ciffer) part2-hex-ciffer)))

<a name="lyrics"></a><a name="lyrics"></a><span><a href="../midi-laml-processing-lib.html#lyrics"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(lyrics txt)</span>
  (Meta 'deltaTime "0" 'type "5" txt))


<span class="comment">; ---------------------------------------------------------------------------------------------------------------
; Chord playing.</span><br />
<a name="play-chord"></a><a name="play-chord"></a><span><a href="../midi-laml-processing-lib.html#play-chord"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(play-chord root chord-type start-octave number-of-octaves time-delta duration . optional-parameter-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">ch</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list 1))
       (<span class="local-name-binding">vel</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 2 optional-parameter-list 80)))
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">absolute-repeated-root-chord-formula</span> (chord-note-list root chord-type start-octave number-of-octaves))
         (<span class="local-name-binding">time-delta-list</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-list" title="Manual: general">make-list</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> absolute-repeated-root-chord-formula) time-delta))
        )
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a>
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">nn</span> <span class="local-name-binding">dt</span>)
         (NoteOn 'deltaTime dt 'channel ch 'note (between 0 127 nn) 'velocity vel 'duration duration))
      absolute-repeated-root-chord-formula
      time-delta-list)
  )))

<a name="noteon-sequence-ending-at"></a><span class="comment">; Return a list of NoteOn messages ending at the note value note (an integer).
; A list of deltaTime NoteOn messages are created; Thus, the chord sequence will be relative to the message occurring before the sequence.
; Root is a name (string): C, C#, D, D#, E, F, F#, G, G#, A, A#, B.
; Chord-type is a chord type name, as appearing in the list chord-types.
; There will be  time-delta  between notes in the played chord (meassured in basic type units, 1920 pr. quarter note on tyros).
; Each played note will last  duration  time units
; Optional parameters allows for control of channel and velocity.
; .form (noteon-sequence-ending-at note lgt root chord-type time-delta duration [channel velocity])
; .misc lgt must be at least 2 (not a problem in practical life due to lengths of chords).</span><br /><a name="noteon-sequence-ending-at"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(noteon-sequence-ending-at note lgt root chord-type time-delta duration . optional-parameter-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">ch</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list 1))
       (<span class="local-name-binding">vel</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 2 optional-parameter-list 80)))
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">chord-lst</span> (chord-note-list-ending-at note lgt root chord-type)))
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> chord-lst
         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a>
           <span class="comment">; first NoteOn is moved back in time</span><br />           (NoteOn 'deltaTime (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> time-delta (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> chord-lst) 1))) 'channel ch 'note (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> chord-lst) 'velocity vel 'duration duration)

           <span class="comment">; The rest are relative to the first</span><br />           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">note-val</span>) 
                (NoteOn 'deltaTime time-delta 'channel ch 'note note-val 'velocity vel 'duration duration)
              )
            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> chord-lst))
         )
         '()))))


<a name="strum-one-note"></a><span class="comment">; Add strum (a sequence of chord adapted notes) to note-ast.
; If the chord does not match note-on-ast, return (a list of) note-on-ast. Else return a longer chord adapted list ending with note-on-ast.
; note-on-ast should be with absTime.
; The parameters lgt, root, chord-type, delta-time, duration, channel and velocity is as for noteon-sequence-ending-at.</span><br /><a name="strum-one-note"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(strum-one-note note-on-ast lgt root chord-type time-delta duration . optional-parameter-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">ch</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> note-on-ast 'channel)))
         (<span class="local-name-binding">vel</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 2 optional-parameter-list (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> note-on-ast 'velocity)))
         (<span class="local-name-binding">note</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> note-on-ast 'note)))
         (<span class="local-name-binding">seq</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#noteon-sequence-ending-at" title="midi-laml-processing-lib">noteon-sequence-ending-at</a> note lgt root chord-type time-delta duration ch vel)))
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> seq)) 
         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> note-on-ast) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#butlast" title="Manual: general">butlast</a> seq))   <span class="comment">; note-on-ast must have absTime. Strum is relative to it, therefore note-on-ast should come first</span><br />         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> note-on-ast))))

<a name="strum-1"></a><a name="strum-1"></a><span><a href="../midi-laml-processing-lib.html#strum-1"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">strum-1</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 3 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">lgt</span> <span class="local-name-binding">root</span> <span class="local-name-binding">chord-type</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>)
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast)))
                (<a class="applied-name" href="midi-laml-processing-lib-1.html#strum-one-note" title="midi-laml-processing-lib">strum-one-note</a> mes-ast lgt root chord-type 300 300)
                mes-ast))
          contents))))

<a name="strum-2"></a><a name="strum-2"></a><span><a href="../midi-laml-processing-lib.html#strum-2"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">strum-2</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-abstraction" title="Manual: xml-in-laml">xml-in-laml-abstraction</a> 
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>)
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast)))
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">lgt</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'strum-length 4)))
                       (<span class="local-name-binding">chord</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'chord #f)))
                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> chord
                      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">root-chordtype</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-chord-to-root-and-type" title="midi-laml-processing-lib">split-chord-to-root-and-type</a> chord))
                             (<span class="local-name-binding">root</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> root-chordtype))
                             (<span class="local-name-binding">chord-type</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> root-chordtype)))
                        (<a class="applied-name" href="midi-laml-processing-lib-1.html#strum-one-note" title="midi-laml-processing-lib">strum-one-note</a> mes-ast lgt root chord-type 300 300))
                      mes-ast))
                mes-ast))
          contents))))


<a name="strum-3"></a><a name="strum-3"></a><span><a href="../midi-laml-processing-lib.html#strum-3"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">strum-3</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>)
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#strum-3-internal" title="midi-laml-processing-lib">strum-3-internal</a> ch contents #f #f 10))))

<a name="strum-3-internal"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(strum-3-internal ch contents root chord-type strum-length)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> contents) '())
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">mes-ast</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> contents)))
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes-ast)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> ch (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel))))
                          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">lgt-new</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'strum-length strum-length)))
                                 (<span class="local-name-binding">chord-new</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'chord #f)))
                            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> chord-new
                                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">root-chordtype</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-chord-to-root-and-type" title="midi-laml-processing-lib">split-chord-to-root-and-type</a> chord-new))
                                       (<span class="local-name-binding">root-new</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> root-chordtype))
                                       (<span class="local-name-binding">chord-type-new</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> root-chordtype)))
                                    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#strum-one-note" title="midi-laml-processing-lib">strum-one-note</a> mes-ast lgt-new root-new chord-type-new 300 300) 
                                            (<a class="applied-name" href="midi-laml-processing-lib-1.html#strum-3-internal" title="midi-laml-processing-lib">strum-3-internal</a> ch (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> contents) root-new chord-type-new lgt-new)))
                                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> root chord-type)
                                    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#strum-one-note" title="midi-laml-processing-lib">strum-one-note</a> mes-ast lgt-new root chord-type 300 300) 
                                             (<a class="applied-name" href="midi-laml-processing-lib-1.html#strum-3-internal" title="midi-laml-processing-lib">strum-3-internal</a> ch (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> contents) root chord-type strum-length))
                                    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes-ast (<a class="applied-name" href="midi-laml-processing-lib-1.html#strum-3-internal" title="midi-laml-processing-lib">strum-3-internal</a> ch (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> contents) root chord-type strum-length))))))

                       ((meta-chord-ast? mes-ast)
                          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">root-and-chordtype</span> (meta-chord-root-and-chordtype mes-ast))
                                 (<span class="local-name-binding">root-new</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> root-and-chordtype))  <span class="comment">; a string, maybe with b instead of #</span><br />                                 (<span class="local-name-binding">chord-type-new</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> root-and-chordtype)))  <span class="comment">; a string</span><br />                            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes-ast (<a class="applied-name" href="midi-laml-processing-lib-1.html#strum-3-internal" title="midi-laml-processing-lib">strum-3-internal</a> ch (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> contents) root-new chord-type-new strum-length))))

                       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes-ast (<a class="applied-name" href="midi-laml-processing-lib-1.html#strum-3-internal" title="midi-laml-processing-lib">strum-3-internal</a> ch (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> contents) root chord-type strum-length))))))))


<a name="split-chord-to-root-and-type"></a><span class="comment">; Split chord to cons of two strings: chord root and chord-type.
; Typical input "C#M7". Output ( "C#" . "M7").</span><br /><a name="split-chord-to-root-and-type"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-chord-to-root-and-type chord)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">lgt</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> chord)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lgt 1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> chord 0 1) "M"))
          ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> lgt 2) 
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> chord 1) #\#)
                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> chord 0 2) "M")
                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> chord 0 1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> chord 1 lgt))))
          ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> lgt 2) 
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> chord 1) #\#)
                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> chord 0 2) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> chord 2 lgt))
                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> chord 0 1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> chord 1 lgt)))))))


<a name="make-pitch-bend-change-list"></a><a name="make-pitch-bend-change-list"></a><span><a href="../midi-laml-processing-lib.html#make-pitch-bend-change-list"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(make-pitch-bend-change-list ch n duration scale-fn . optional-parameters)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">first-delta-time</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameters (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> duration n))))
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX123" title="R5RS Scheme form">letrec</a> ((<span class="local-name-binding">make-function-domain-values</span> <span class="comment">; produces length equidistant values between 0 and 1. actual is used for accumulation, and should initially be 0.</span><br />             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">length</span> <span class="local-name-binding">increment</span> <span class="local-name-binding">actual</span>)
               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> length 0)
                   '()
                   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> actual (make-function-domain-values (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> length 1) increment (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> actual increment))))))
            )
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">pitch-value-fn</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#compose" title="Manual: general">compose</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">r</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> r 8192) 8192)) scale-fn)) <span class="comment">;     [0,1] -&gt; pitch value</span><br />           (<span class="local-name-binding">delta-dur</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> duration n))
           (<span class="local-name-binding">function-unit-domain-values</span> (make-function-domain-values n (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> 1 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> n 1)) 0))
          )
       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">value</span> (between 0 16383 (pitch-value-fn (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> function-unit-domain-values)))))
                (PitchBendChange 'deltaTime (as-int-string first-delta-time) 'channel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> ch)
                              'value (as-int-string value)))
             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a>
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">unit-domain-value</span>)
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">value</span> (between 0 16383 (pitch-value-fn unit-domain-value))))
                  (PitchBendChange 'deltaTime (as-int-string delta-dur) 'channel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> ch) 'value (as-int-string value))))
              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> function-unit-domain-values)))))))

<a name="make-tempo-change-list"></a><a name="make-tempo-change-list"></a><span><a href="../midi-laml-processing-lib.html#make-tempo-change-list"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(make-tempo-change-list n0 duration base-tempo scale-fn . optional-parameter-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">n</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> n0 1))
        (<span class="local-name-binding">last-tempo</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list #f)))
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX123" title="R5RS Scheme form">letrec</a> ((<span class="local-name-binding">make-function-domain-values</span> <span class="comment">; produces length+1 equidistant values between 0 and 1. actual is used for accumulation, and should initially be 0.</span><br />            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">length</span> <span class="local-name-binding">increment</span> <span class="local-name-binding">actual</span>)
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> length 0)
                  '()
                  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> actual (make-function-domain-values (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> length 1) increment (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> actual increment))))))
          )
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> last-tempo  <span class="comment">; insert a forced tempo event as the last in the list of deltaTimed meta events</span><br />        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">function-unit-domain-values</span> (make-function-domain-values (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> n 1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> 1 n) 0))
              (<span class="local-name-binding">delta-dur</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> duration n0))
             )
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a>
             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a>
               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">unit-domain-value</span>)
                 (Meta 'deltaTime (as-int-string delta-dur) 'type "81" (tempo= (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> base-tempo (scale-fn unit-domain-value))))
                 )
               (<a class="schemedoc-name" href="../../../../../lib/man/general.html#butlast" title="Manual: general">butlast</a> function-unit-domain-values))  <span class="comment">; notice butlast</span><br />             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>  <span class="comment">; the last forced tempo Meta event</span><br />                (Meta 'deltaTime (as-int-string delta-dur) 'type "81" (tempo= last-tempo)))))

        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">function-unit-domain-values</span> (make-function-domain-values (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> n 1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> 1 n) 0))
              (<span class="local-name-binding">delta-dur</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> duration n0))
              )
          (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a>
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">unit-domain-value</span>)
             (Meta 'deltaTime (as-int-string delta-dur) 'type "81" (tempo= (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> base-tempo (scale-fn unit-domain-value))))
             )
           function-unit-domain-values))
    ))))

<a name="make-volume-change-list"></a><a name="make-volume-change-list"></a><span><a href="../midi-laml-processing-lib.html#make-volume-change-list"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(make-volume-change-list ch n0 duration start-volume scale-fn . optional-parameter-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">n</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> n0 1))
         (<span class="local-name-binding">end-volume</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list #f)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX123" title="R5RS Scheme form">letrec</a> ((<span class="local-name-binding">make-function-domain-values</span> <span class="comment">; produces length equidistant values between 0 and 1. actual is used for accumulation, and should initially be 0.</span><br />              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">length</span> <span class="local-name-binding">increment</span> <span class="local-name-binding">actual</span>)
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> length 0)
                    '()
                    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> actual (make-function-domain-values (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> length 1) increment (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> actual increment))))))
             )
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> end-volume <span class="comment">; insert a forced end-volume as the last in the list of deltaTimed meta events</span><br />          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">function-unit-domain-values</span> (make-function-domain-values (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> n 1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> 1 n) 0))
                (<span class="local-name-binding">delta-dur</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> duration n0))
               )
            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a>
             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a>
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">unit-domain-value</span>)
                (ControlChange 'deltaTime (as-int-string delta-dur) 'channel ch 'control "7" 
                               'value (as-int-string (between 0 127 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> start-volume (scale-fn unit-domain-value)))))
                )
              (<a class="schemedoc-name" href="../../../../../lib/man/general.html#butlast" title="Manual: general">butlast</a> function-unit-domain-values)) <span class="comment">; notice butlast</span><br />             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>                 <span class="comment">; the last forced volumne control event</span><br />              (ControlChange 'deltaTime (as-int-string delta-dur) 'channel ch 'control "7" 
                             'value (as-int-string (between 0 127 end-volume))))))

          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">function-unit-domain-values</span> (make-function-domain-values (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> n 1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> 1 n) 0))
                (<span class="local-name-binding">delta-dur</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> duration n0))
                )
            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a>
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">unit-domain-value</span>)
               (ControlChange 'deltaTime (as-int-string delta-dur) 'channel ch 'control "7"
                               'value (as-int-string (between 0 127 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> start-volume (scale-fn unit-domain-value)))))
               )
             function-unit-domain-values))
          ))))
  

<span class="comment">; ---------------------------------------------------------------------------------------------------------------</span><br /><div class="schemedoc-section-comment">;;; .section-id channel-repl-join-sel
;;; Channel replication, (copying), rechanneling, joining, and selection.</div>
<a name="replicate-channel"></a><a name="replicate-channel"></a><span><a href="../midi-laml-processing-lib.html#replicate-channel"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">replicate-channel</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch-from</span> <span class="local-name-binding">ch-to</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#replicate-channel-1" title="midi-laml-processing-lib">replicate-channel-1</a> ch-from ch-to cont))))

<a name="replicate-channel-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(replicate-channel-1 ch-from ch-to message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> channel
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> ch-from (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel))
                  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 
                     mes-ast
                     (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 'channel ch-to)
                  )
                  mes-ast)
              mes-ast))
         mes-ast))
  message-list))

<a name="replicate-by-predicate"></a><a name="replicate-by-predicate"></a><span><a href="../midi-laml-processing-lib.html#replicate-by-predicate"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">replicate-by-predicate</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">predicate</span> <span class="local-name-binding">ch-to</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#replicate-by-predicate-1" title="midi-laml-processing-lib">replicate-by-predicate-1</a> predicate ch-to cont))))

<a name="replicate-by-predicate-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(replicate-by-predicate-1 predicate ch-to message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> channel (predicate mes-ast))
              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>   <span class="comment">; the replication</span><br />                mes-ast
                (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 'channel ch-to)
              )
              mes-ast))
         mes-ast
     ))
  message-list))

<a name="replicate-by-predicate-and-transformation"></a><a name="replicate-by-predicate-and-transformation"></a><span><a href="../midi-laml-processing-lib.html#replicate-by-predicate-and-transformation"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">replicate-by-predicate-and-transformation</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">predicate</span> <span class="local-name-binding">transf</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#replicate-by-predicate-and-transformation-1" title="midi-laml-processing-lib">replicate-by-predicate-and-transformation-1</a> predicate transf cont))))

<a name="replicate-by-predicate-and-transformation-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(replicate-by-predicate-and-transformation-1 predicate transf message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> channel (predicate mes-ast))
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">the-transformation</span> (transf mes-ast)))
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> the-transformation) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> mes-ast (transf mes-ast)))
                       ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> the-transformation) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes-ast the-transformation))
                       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "replicate-by-predicate-1: The transformation must return an AST, or a list of ASTs"))))
              mes-ast))
         mes-ast
     ))
  message-list))





<a name="join-channels"></a><a name="join-channels"></a><span><a href="../midi-laml-processing-lib.html#join-channels"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">join-channels</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch-list</span> <span class="local-name-binding">ch-to</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#join-channels-1" title="midi-laml-processing-lib">join-channels-1</a> ch-list ch-to cont))))

<a name="join-channels-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(join-channels-1 ch-list ch-to message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> channel
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel) ch-list)
                  (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 'channel ch-to)
                  mes-ast)
              mes-ast))
         mes-ast))
  message-list))


<a name="select-channel"></a><a name="select-channel"></a><span><a href="../midi-laml-processing-lib.html#select-channel"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">select-channel</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-midi-null-events" title="midi-laml-processing-lib">eliminate-midi-null-events</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#select-channel-1" title="midi-laml-processing-lib">select-channel-1</a> ch cont)))))

<a name="select-channel-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(select-channel-1 c message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> channel
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> c (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel)))
                  mes-ast
                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event" title="midi-laml-processing-lib">midi-null-event</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime 0)))
              mes-ast))
         mes-ast))
  message-list))

<a name="delete-channel"></a><a name="delete-channel"></a><span><a href="../midi-laml-processing-lib.html#delete-channel"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">delete-channel</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#delete-channel-1" title="midi-laml-processing-lib">delete-channel-1</a> ch cont))))

<a name="delete-channel-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(delete-channel-1 c message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> channel
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> c (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel)))
                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event" title="midi-laml-processing-lib">midi-null-event</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime 0))
                  mes-ast)
              mes-ast))
         mes-ast))
  message-list))

<a name="delete-channel-abs-time"></a><a name="delete-channel-abs-time"></a><span><a href="../midi-laml-processing-lib.html#delete-channel-abs-time"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">delete-channel-abs-time</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#delete-channel-abs-time-1" title="midi-laml-processing-lib">delete-channel-abs-time-1</a> ch cont))))

<a name="delete-channel-abs-time-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(delete-channel-abs-time-1 ch message-list)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#delete-channel-abs-time-2" title="midi-laml-processing-lib">delete-channel-abs-time-2</a> ch message-list '()))

<a name="delete-channel-abs-time-2"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(delete-channel-abs-time-2 ch message-list res)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list)
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res)
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">mes-ast</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list)))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> ch (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel))))
            (<a class="applied-name" href="midi-laml-processing-lib-1.html#delete-channel-abs-time-2" title="midi-laml-processing-lib">delete-channel-abs-time-2</a> ch (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) res)
            (<a class="applied-name" href="midi-laml-processing-lib-1.html#delete-channel-abs-time-2" title="midi-laml-processing-lib">delete-channel-abs-time-2</a> ch (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes-ast res))))))

<a name="select-channels"></a><a name="select-channels"></a><span><a href="../midi-laml-processing-lib.html#select-channels"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">select-channels</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch-list</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> ch-list) ch-list)  <span class="comment">; channel-list is #t</span><br />       cont
       (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-midi-null-events" title="midi-laml-processing-lib">eliminate-midi-null-events</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#select-channels-1" title="midi-laml-processing-lib">select-channels-1</a> ch-list cont 0))))))

<span class="comment">; (define (select-channels-1 c-list message-list)
;  (map
;   (lambda (mes-ast)
;     (if (ast? mes-ast) 
;         (let ((channel (ast-attribute mes-ast 'channel #f)))
;           (if channel
;               (if (member (as-number (ast-attribute mes-ast 'channel)) c-list)
;                   mes-ast 
;                   (midi-null-event (ast-attribute mes-ast 'deltaTime 0)))
;               #t))
;         mes-ast))
;   message-list))</span><br />
<a name="select-channels-1"></a><span class="comment">; between-time is accumulated time between deltaTime events. Only used for deltaTime mode. Rather complicated. 
; Future: Split deltaTime and absTime version</span><br /><a name="select-channels-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(select-channels-1 c-list message-list between-time)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list)  '())
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">mes-ast</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> message-list)))
                (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast) 
                    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
                      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> channel
                          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> c-list) c-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel)) c-list))
                              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-message?" title="midi-laml-processing-lib">delta-time-message?</a> mes-ast)
                                        (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 'deltaTime (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> mes-ast) between-time))
                                        mes-ast)
                                    (<a class="applied-name" href="midi-laml-processing-lib-1.html#select-channels-1" title="midi-laml-processing-lib">select-channels-1</a> c-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) 0))
                              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-message?" title="midi-laml-processing-lib">delta-time-message?</a> mes-ast)
                                  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event" title="midi-laml-processing-lib">midi-null-event</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> mes-ast) between-time))   <span class="comment">; remove event from unwanted channel - keep delta time in null event</span><br />                                        (<a class="applied-name" href="midi-laml-processing-lib-1.html#select-channels-1" title="midi-laml-processing-lib">select-channels-1</a> c-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) 0))    
                                  (<a class="applied-name" href="midi-laml-processing-lib-1.html#select-channels-1" title="midi-laml-processing-lib">select-channels-1</a> c-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> between-time (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> mes-ast)))    <span class="comment">; remove event from unwanted channel</span><br />                              )
                          )
                          (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a>   <span class="comment">; system and meta messages </span><br />                             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-message?" title="midi-laml-processing-lib">delta-time-message?</a> mes-ast)
                                 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 'deltaTime (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> mes-ast) between-time))
                                 mes-ast)
                             (<a class="applied-name" href="midi-laml-processing-lib-1.html#select-channels-1" title="midi-laml-processing-lib">select-channels-1</a> c-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) 0))
                      )
                    )
                    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes-ast (<a class="applied-name" href="midi-laml-processing-lib-1.html#select-channels-1" title="midi-laml-processing-lib">select-channels-1</a> c-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) between-time)))))))

<a name="time-of-message"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(time-of-message mes-ast)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime #f))
        (<span class="local-name-binding">delta-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime #f)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a>  (abs-time (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> abs-time))
           (delta-time (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> delta-time))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "time-of-message: Message AST without deltaTime or absTime attribute")))))

<a name="delta-time-message?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(delta-time-message? mes-ast)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
      (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-boolean" title="Manual: general">as-boolean</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'deltaTime #f))
      #f))

<a name="abs-time-message?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(abs-time-message? mes-ast)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
      (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-boolean" title="Manual: general">as-boolean</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime #f))
      #f))

<a name="rechannel"></a><a name="rechannel"></a><span><a href="../midi-laml-processing-lib.html#rechannel"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">rechannel</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch-map</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#rechannel-1" title="midi-laml-processing-lib">rechannel-1</a> ch-map cont))))

<a name="rechannel-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(rechannel-1 ch-map message-list)</span>
 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes-ast</span>) 
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'channel #f)))
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> channel
              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX343" title="R5RS Scheme form">assoc</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel) ch-map)
                  (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 'channel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX343" title="R5RS Scheme form">assoc</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> channel) ch-map)))
                  mes-ast)
              mes-ast))
         mes-ast))
  message-list))


<a name="eliminate-midi-null-events"></a><a name="eliminate-midi-null-events"></a><span><a href="../midi-laml-processing-lib.html#eliminate-midi-null-events"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">eliminate-midi-null-events</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-abstraction" title="Manual: xml-in-laml">xml-in-laml-abstraction</a> 
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-midi-null-events-1" title="midi-laml-processing-lib">eliminate-midi-null-events-1</a> cont 0 0))))

<a name="eliminate-midi-null-events-1"></a><span class="comment">; acc-delta is accumulated delta-time until a non-null event
; abs-time is the current absolute time.</span><br /><a name="eliminate-midi-null-events-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(eliminate-midi-null-events-1 message-list abs-time acc-delta)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-events-1" title="midi-laml-processing-lib">eliminate-events-1</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-message?" title="midi-laml-processing-lib">midi-null-event-message?</a> message-list abs-time acc-delta))

<a name="eliminate-events"></a><a name="eliminate-events"></a><span><a href="../midi-laml-processing-lib.html#eliminate-events"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">eliminate-events</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">predicate</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-events-1" title="midi-laml-processing-lib">eliminate-events-1</a> predicate cont 1 0))))

<a name="eliminate-events-1"></a><span class="comment">; acc-delta is accumulated delta-time until a non-null event
; abs-time is the current absolute time.</span><br /><a name="eliminate-events-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(eliminate-events-1 predicate message-list abs-time acc-delta)</span>
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list)  '())
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">mes-ast</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> message-list)))
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-time-message?" title="midi-laml-processing-lib">abs-time-message?</a> mes-ast) (predicate mes-ast))       <span class="comment">; just drop message</span><br />                              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">delta-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> mes-ast) abs-time)))
                                (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-events-1" title="midi-laml-processing-lib">eliminate-events-1</a> predicate (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> mes-ast) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> delta-time acc-delta))))
                           ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-time-message?" title="midi-laml-processing-lib">abs-time-message?</a> mes-ast) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (predicate mes-ast)))
                              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes-ast (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-events-1" title="midi-laml-processing-lib">eliminate-events-1</a> predicate (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> mes-ast) 0)))
                           ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-message?" title="midi-laml-processing-lib">delta-time-message?</a> mes-ast) (predicate mes-ast))
                              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">delta-time</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> mes-ast)))
                               (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-events-1" title="midi-laml-processing-lib">eliminate-events-1</a> predicate (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> abs-time delta-time) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> delta-time acc-delta))))
                           ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-message?" title="midi-laml-processing-lib">delta-time-message?</a> mes-ast) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (predicate mes-ast)))
                              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">delta-time</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> mes-ast)))
                                (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 'deltaTime (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> acc-delta delta-time))
                                      (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-events-1" title="midi-laml-processing-lib">eliminate-events-1</a> predicate (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> abs-time delta-time) 0))))
                           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "eliminate-events-1: Should not happen.")))

                     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes-ast (<a class="applied-name" href="midi-laml-processing-lib-1.html#eliminate-events-1" title="midi-laml-processing-lib">eliminate-events-1</a> predicate (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) abs-time acc-delta)))))))

<a name="split-channel-by-predicate"></a><a name="split-channel-by-predicate"></a><span><a href="../midi-laml-processing-lib.html#split-channel-by-predicate"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">split-channel-by-predicate</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 4 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">predicate</span> <span class="local-name-binding">channel-true</span> <span class="local-name-binding">channel-false</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-channel-by-predicate-1" title="midi-laml-processing-lib">split-channel-by-predicate-1</a> channel predicate channel-true channel-false cont))))

<a name="split-channel-by-predicate-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-channel-by-predicate-1 channel predicate channel-true channel-false message-list)</span>
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-channel-by-predicate-2" title="midi-laml-processing-lib">split-channel-by-predicate-2</a> channel predicate channel-true channel-false message-list '())
)

<a name="split-channel-by-predicate-2"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-channel-by-predicate-2 channel predicate channel-true channel-false message-list res-list)</span>
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list)  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res-list))
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">mes-ast</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> message-list)))
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> mes-ast) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'channel mes-ast)))
                         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (predicate mes-ast)
                             (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-channel-by-predicate-2" title="midi-laml-processing-lib">split-channel-by-predicate-2</a> channel predicate channel-true channel-false (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) 
                                  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 'channel channel-true) res-list))
                             (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-channel-by-predicate-2" title="midi-laml-processing-lib">split-channel-by-predicate-2</a> channel predicate channel-true channel-false (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) 
                                  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 'channel channel-false) res-list)))
                         (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-channel-by-predicate-2" title="midi-laml-processing-lib">split-channel-by-predicate-2</a> channel predicate channel-true channel-false (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) 
                                  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a>  mes-ast res-list)))
                     (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-channel-by-predicate-2" title="midi-laml-processing-lib">split-channel-by-predicate-2</a> channel predicate channel-true channel-false (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) res-list))))))

<a name="split-channel-by-contextual-predicate"></a><a name="split-channel-by-contextual-predicate"></a><span><a href="../midi-laml-processing-lib.html#split-channel-by-contextual-predicate"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">split-channel-by-contextual-predicate</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 4 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span> <span class="local-name-binding">predicate</span> <span class="local-name-binding">channel-true</span> <span class="local-name-binding">channel-false</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">behind-context</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'behind-context attr 240)))
         (<span class="local-name-binding">ahead-context</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'ahead-context attr 240))))
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-channel-by-contextual-predicate-1" title="midi-laml-processing-lib">split-channel-by-contextual-predicate-1</a> channel predicate channel-true channel-false behind-context ahead-context cont)))))

<a name="split-channel-by-contextual-predicate-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-channel-by-contextual-predicate-1 channel predicate channel-true channel-false behind-context ahead-context message-list)</span>
   (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-channel-by-contextual-predicate-2" title="midi-laml-processing-lib">split-channel-by-contextual-predicate-2</a> channel predicate channel-true channel-false behind-context ahead-context message-list '() '())
)

<a name="split-channel-by-contextual-predicate-2"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-channel-by-contextual-predicate-2 channel predicate channel-true channel-false behind-context ahead-context message-list past-list res-list)</span>
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list)  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res-list))
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">mes-ast</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> message-list)))
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> mes-ast)
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> mes-ast) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> channel (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'channel mes-ast)))
                         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">tm</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes-ast 'absTime)))
                                (<span class="local-name-binding">past-list</span>  (<a class="schemedoc-name" href="../../../../../lib/man/general.html#list-prefix-while" title="Manual: general">list-prefix-while</a> past-list (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">n</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime n) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> tm behind-context)))))
                                (<span class="local-name-binding">ahead-list</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#list-prefix-while" title="Manual: general">list-prefix-while</a> message-list (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">n</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime n) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> tm ahead-context))))))
                           (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> past-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> ahead-list))
                           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (predicate mes-ast (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOnCh?" title="midi-laml-processing-lib">NoteOnCh?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> channel)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> past-list) ahead-list)))
                               (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-channel-by-contextual-predicate-2" title="midi-laml-processing-lib">split-channel-by-contextual-predicate-2</a> channel predicate channel-true channel-false behind-context ahead-context (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) 
                                                                        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes-ast past-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 'channel channel-true) res-list))
                               (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-channel-by-contextual-predicate-2" title="midi-laml-processing-lib">split-channel-by-contextual-predicate-2</a> channel predicate channel-true channel-false behind-context ahead-context (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) 
                                                                        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes-ast past-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> mes-ast 'channel channel-false) res-list))))
                         (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-channel-by-contextual-predicate-2" title="midi-laml-processing-lib">split-channel-by-contextual-predicate-2</a> channel predicate channel-true channel-false behind-context ahead-context (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) 
                                  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes-ast past-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a>  mes-ast res-list)))
                     (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-channel-by-contextual-predicate-2" title="midi-laml-processing-lib">split-channel-by-contextual-predicate-2</a> channel predicate channel-true channel-false behind-context ahead-context 
                                                              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) past-list res-list))))))


<div class="schemedoc-section-comment">;;; .section-id bar-transformations
;;; Midi transformations on given bars.</div>
<a name="substitute-section-by-bar"></a><a name="substitute-section-by-bar"></a><span><a href="../midi-laml-processing-lib.html#substitute-section-by-bar"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">substitute-section-by-bar</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channels</span> <span class="local-name-binding">section-list</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#substitute-section-by-bar-1" title="midi-laml-processing-lib">substitute-section-by-bar-1</a> channels section-list cont)))) 

<a name="substitute-section-by-bar-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(substitute-section-by-bar-1 channels section-list message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">sorted-section-list</span>
          (sort-list
             section-list
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">s1</span> <span class="local-name-binding">s2</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> s1) (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> s2)))))
       )
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">section</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> sorted-section-list))
           (<span class="local-name-binding">start-end-repl</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#by-bar-advancement-substitution" title="midi-laml-processing-lib">by-bar-advancement-substitution</a> section))
          )
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-substitution" title="midi-laml-processing-lib">multi-substitution</a> channels message-list
                         (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> start-end-repl) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> start-end-repl) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#third" title="Manual: general">third</a> start-end-repl) sorted-section-list <a class="applied-name" href="midi-laml-processing-lib-1.html#by-bar-advancement-substitution" title="midi-laml-processing-lib">by-bar-advancement-substitution</a> #f))))

<a name="by-bar-advancement-substitution"></a><span class="comment">; returns a list of start-point, end-point, and effective replacement-list of section - of replication and bar version.
; holds detailed knowledge of the structure of a section</span><br /><a name="by-bar-advancement-substitution"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(by-bar-advancement-substitution section)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">units-per-bar</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> global-ppqn (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> global-signature)))
         (<span class="local-name-binding">bar</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> section))
         (<span class="local-name-binding">repl-start-point</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> bar units-per-bar))
         (<span class="local-name-binding">number-of-bars</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-length-of" title="midi-laml-processing-lib">bar-length-of</a> section))
         (<span class="local-name-binding">repl-length</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> number-of-bars units-per-bar))
         (<span class="local-name-binding">repl-end-point</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> repl-start-point repl-length))
         (<span class="local-name-binding">replacement-lst</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#replicate-if-necessary" title="midi-laml-processing-lib">replicate-if-necessary</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#replacement-list-of" title="midi-laml-processing-lib">replacement-list-of</a> section) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> number-of-bars units-per-bar)))
        )
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> repl-start-point repl-end-point replacement-lst)))
  

<a name="multi-substitution"></a><span class="comment">; Invariant: repl-start-point, repl-end-point and replacement-lst correspond to first element of section-insertion-list.
; repl-start-point and repl-end-point is measured in (abs)time units.
; section-advancement-fn is a function that returns a list of start time, end time, and effective replacment (stretched or replicated or...)
; of a given entry of the replacement-list.</span><br /><a name="multi-substitution"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(multi-substitution channels ml repl-start-point repl-end-point replacement-lst section-insertion-list section-advancement-fn replacing?)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> ml) '())

        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> replacing?) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml)))) 
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml) (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-substitution" title="midi-laml-processing-lib">multi-substitution</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point replacement-lst section-insertion-list section-advancement-fn replacing?)))

        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> replacing?) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml)))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">mes</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml))
                  (<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'absTime))))
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> abs-time repl-start-point) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> abs-time repl-end-point))  <span class="comment">; insert replacement-list and enter relacing mode</span><br />                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a>
                   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a>
                    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'channel)) channels)
                        (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-abs-time" title="midi-laml-processing-lib">midi-null-event-abs-time</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'absTime))
                        mes)
                    replacement-lst   <span class="comment">; delta time events</span><br />                   )
                   (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-substitution" title="midi-laml-processing-lib">multi-substitution</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point replacement-lst section-insertion-list section-advancement-fn #t))
                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-substitution" title="midi-laml-processing-lib">multi-substitution</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point replacement-lst section-insertion-list section-advancement-fn replacing?)))))

        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> replacing? (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml))))   <span class="comment">; replacing mode - replacement-lst has already been inserted or waiting for it to happen</span><br />           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml) (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-substitution" title="midi-laml-processing-lib">multi-substitution</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point replacement-lst section-insertion-list section-advancement-fn replacing?)))

        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> replacing? (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml)))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">mes</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml))
                  (<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'absTime))))
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> abs-time repl-end-point)
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'channel)) channels) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes) "NoteOn"))
                     (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-substitution" title="midi-laml-processing-lib">multi-substitution</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point replacement-lst section-insertion-list section-advancement-fn replacing?)   <span class="comment">; removing event</span><br />                     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-substitution" title="midi-laml-processing-lib">multi-substitution</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point replacement-lst section-insertion-list section-advancement-fn replacing?)))

                 <span class="comment">; outside replacing interval - advance replacement-lst</span><br />                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> section-insertion-list)))  
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">next-section</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> section-insertion-list))
                            (<span class="local-name-binding">start-end-repl</span> (section-advancement-fn next-section))
                           )
                       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-substitution" title="midi-laml-processing-lib">multi-substitution</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) 
                                 (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> start-end-repl) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> start-end-repl) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#third" title="Manual: general">third</a> start-end-repl)
                                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> section-insertion-list) section-advancement-fn #f))) 
                     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-substitution" title="midi-laml-processing-lib">multi-substitution</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point replacement-lst '() section-advancement-fn #f))))))

        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "multi-substitution: Should not happen"))))



<a name="replicate-if-necessary"></a><span class="comment">; -----------------------------------------------------------------------------</span><br /><a name="replicate-if-necessary"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(replicate-if-necessary delta-message-list source-length)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">mes-lst-lgt</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#length-of-delta-time-midi-list" title="midi-laml-processing-lib">length-of-delta-time-midi-list</a> delta-message-list)))
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#replicate-if-necessary-1" title="midi-laml-processing-lib">replicate-if-necessary-1</a> delta-message-list source-length mes-lst-lgt)))

<a name="replicate-if-necessary-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(replicate-if-necessary-1 delta-message-list source-length mes-lst-lgt)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> mes-lst-lgt source-length)
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> delta-message-list (<a class="applied-name" href="midi-laml-processing-lib-1.html#replicate-if-necessary-1" title="midi-laml-processing-lib">replicate-if-necessary-1</a> delta-message-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> source-length mes-lst-lgt) mes-lst-lgt))
      '()))

<a name="length-of-delta-time-midi-list"></a><span class="comment">; -----------------------------------------------------------------------------</span><br />
<a name="length-of-delta-time-midi-list"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(length-of-delta-time-midi-list message-list)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#length-of-delta-time-midi-list-1" title="midi-laml-processing-lib">length-of-delta-time-midi-list-1</a> message-list 0))

<a name="length-of-delta-time-midi-list-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(length-of-delta-time-midi-list-1 message-list res)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list) res)
        ((<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#length-of-delta-time-midi-list-1" title="midi-laml-processing-lib">length-of-delta-time-midi-list-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> res (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) 'deltaTime)))))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#length-of-delta-time-midi-list-1" title="midi-laml-processing-lib">length-of-delta-time-midi-list-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) res))))
  

<a name="thin-out-section-by-bar"></a><a name="thin-out-section-by-bar"></a><span><a href="../midi-laml-processing-lib.html#thin-out-section-by-bar"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">thin-out-section-by-bar</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channels</span> <span class="local-name-binding">section-list</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#thin-out-section-by-bar-1" title="midi-laml-processing-lib">thin-out-section-by-bar-1</a> channels section-list cont)))) 

<a name="thin-out-section-by-bar-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(thin-out-section-by-bar-1 channels section-list message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">units-per-bar</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> global-ppqn (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> global-signature)))
        (<span class="local-name-binding">sorted-section-list</span>
          (sort-list
             section-list
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">s1</span> <span class="local-name-binding">s2</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> s1) (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> s2)))))
       )
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">section</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> sorted-section-list))
           (<span class="local-name-binding">bar</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> section))
           (<span class="local-name-binding">repl-start-point</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> bar units-per-bar))
           (<span class="local-name-binding">number-of-bars</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-length-of" title="midi-laml-processing-lib">bar-length-of</a> section))
           (<span class="local-name-binding">repl-length</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> number-of-bars units-per-bar))
           (<span class="local-name-binding">repl-end-point</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> repl-start-point repl-length))
           (<span class="local-name-binding">keep-pred</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#keep-predicate-of" title="midi-laml-processing-lib">keep-predicate-of</a> section))
          )
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-thin-out" title="midi-laml-processing-lib">multi-thin-out</a> channels message-list repl-start-point repl-end-point keep-pred  sorted-section-list units-per-bar #f))))

<a name="multi-thin-out"></a><span class="comment">; Invariant: repl-start-point, repl-end-point and keep-pred correspond to first element of section-list</span><br /><a name="multi-thin-out"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(multi-thin-out channels ml repl-start-point repl-end-point keep-pred section-list upb thinning-out?)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> ml) '())
        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> thinning-out?) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml)))) 
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml) (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-thin-out" title="midi-laml-processing-lib">multi-thin-out</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point keep-pred section-list upb thinning-out?)))
        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> thinning-out?) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml)))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">mes</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml))
                  (<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'absTime)))
                  (<span class="local-name-binding">delta-time?</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'deltaTime #f))     <span class="comment">; for error reporting purposes only.</span><br />                 )
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> delta-time? 
                 (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "thin-out-section-by-bar: Encountered a deltaTime message. Can only be applied in pure absTime mode."))
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> abs-time repl-start-point) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> abs-time repl-end-point))  <span class="comment">; entering thin-out zone</span><br />                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">ch</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'channel #f))
                      )                
                   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> ch   <span class="comment">; channel message</span><br />                       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> ch) channels) <span class="comment">; channel in the channel list channels</span><br />                           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (keep-pred abs-time)   <span class="comment">; retain this mes</span><br />                               (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-thin-out" title="midi-laml-processing-lib">multi-thin-out</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point keep-pred section-list upb #t))
                               (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-thin-out" title="midi-laml-processing-lib">multi-thin-out</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point keep-pred section-list upb #t))
                       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-thin-out" title="midi-laml-processing-lib">multi-thin-out</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point keep-pred section-list upb #t)))))
                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-thin-out" title="midi-laml-processing-lib">multi-thin-out</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point keep-pred section-list upb thinning-out?)))))

        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> thinning-out? (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml))))
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml) (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-thin-out" title="midi-laml-processing-lib">multi-thin-out</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point keep-pred section-list upb thinning-out?)))

        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> thinning-out? (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml)))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">mes</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml))
                  (<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'absTime))))
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> abs-time repl-end-point)
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'channel)) channels) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes) "NoteOn"))
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (keep-pred abs-time) <span class="comment">; retain this mes</span><br />                         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-thin-out" title="midi-laml-processing-lib">multi-thin-out</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point keep-pred section-list upb #t))
                         (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-thin-out" title="midi-laml-processing-lib">multi-thin-out</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point keep-pred section-list upb #t))
                     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-thin-out" title="midi-laml-processing-lib">multi-thin-out</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point keep-pred section-list upb thinning-out?)))

                 <span class="comment">; now again outside thin-out zone</span><br />                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> section-list)))  
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">next-section</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> section-list))
                            (<span class="local-name-binding">next-bar</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> next-section))
                            (<span class="local-name-binding">next-repl-start-point</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> next-bar upb))
                            (<span class="local-name-binding">next-number-of-bars</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-length-of" title="midi-laml-processing-lib">bar-length-of</a> next-section))
                            (<span class="local-name-binding">next-repl-length</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> next-number-of-bars upb))
                            (<span class="local-name-binding">next-repl-end-point</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> next-repl-start-point next-repl-length))
                            (<span class="local-name-binding">next-keep-pred</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#keep-predicate-of" title="midi-laml-processing-lib">keep-predicate-of</a> next-section)))
                       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-thin-out" title="midi-laml-processing-lib">multi-thin-out</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) next-repl-start-point next-repl-end-point next-keep-pred (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> section-list) upb #f))) 
                     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-thin-out" title="midi-laml-processing-lib">multi-thin-out</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point keep-pred '() upb #f))))))

        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "multi-thin-out: Should not happen"))))


<a name="scale-velocity-of-sections-by-bar"></a><a name="scale-velocity-of-sections-by-bar"></a><span><a href="../midi-laml-processing-lib.html#scale-velocity-of-sections-by-bar"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">scale-velocity-of-sections-by-bar</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channels</span> <span class="local-name-binding">section-list</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">min-vel</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'min-velocity attr "0")))
         (<span class="local-name-binding">max-vel</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'max-velocity attr "127")))) 
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#scale-velocity-of-sections-by-bar-1" title="midi-laml-processing-lib">scale-velocity-of-sections-by-bar-1</a> channels section-list min-vel max-vel cont)))))

<a name="scale-velocity-of-sections-by-bar-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(scale-velocity-of-sections-by-bar-1 channels section-list min-vel max-vel message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">sorted-section-list</span>
          (sort-list
             section-list
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">s1</span> <span class="local-name-binding">s2</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> s1) (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> s2)))))
       )
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">section</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> sorted-section-list))
           (<span class="local-name-binding">start-end-sf</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#by-bar-advancement-velocity-scaling" title="midi-laml-processing-lib">by-bar-advancement-velocity-scaling</a> section))
          )
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-scale-velocity" title="midi-laml-processing-lib">multi-scale-velocity</a> channels message-list min-vel max-vel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> start-end-sf) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> start-end-sf) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#third" title="Manual: general">third</a> start-end-sf)
                            sorted-section-list <a class="applied-name" href="midi-laml-processing-lib-1.html#by-bar-advancement-velocity-scaling" title="midi-laml-processing-lib">by-bar-advancement-velocity-scaling</a> #f 0 0))))

<a name="by-bar-advancement-velocity-scaling"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(by-bar-advancement-velocity-scaling section)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">units-per-bar</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> global-ppqn (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> global-signature)))
         (<span class="local-name-binding">bar</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> section))
         (<span class="local-name-binding">repl-start-point</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> bar units-per-bar))
         (<span class="local-name-binding">number-of-bars</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-length-of" title="midi-laml-processing-lib">bar-length-of</a> section))
         (<span class="local-name-binding">repl-length</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> number-of-bars units-per-bar))
         (<span class="local-name-binding">repl-end-point</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> repl-start-point repl-length))
         (<span class="local-name-binding">scaling-fu</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#scaling-function-of" title="midi-laml-processing-lib">scaling-function-of</a> section))
        )
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> repl-start-point repl-end-point scaling-fu)))

<a name="multi-scale-velocity"></a><span class="comment">; Invariant: repl-start-point, repl-end-point and scaling-fu correspond to first element of section-list
; nss is the number of scaling steps, and i is the actual scaling step (progressing from 1 to nss). </span><br /><a name="multi-scale-velocity"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(multi-scale-velocity channels ml min-vel max-vel repl-start-point repl-end-point scaling-fu section-list by-bar-advancement-velocity-scaling scaling? nss i)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> ml) '())
        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> scaling?) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml))))
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml) (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-scale-velocity" title="midi-laml-processing-lib">multi-scale-velocity</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) min-vel max-vel repl-start-point
                                                repl-end-point scaling-fu section-list by-bar-advancement-velocity-scaling scaling? nss i)))
        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> scaling?) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml)))
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX461" title="R5RS Scheme form">display</a> "X")
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">mes</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml))
                  (<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'absTime)))
                  (<span class="local-name-binding">delta-time?</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'deltaTime #f)) <span class="comment">; for error reporting purposes only.</span><br />                 )
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> delta-time? 
                 (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "scale-velocity-of-sections-by-bar: Encountered a deltaTime message."))          
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> abs-time repl-start-point) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> abs-time repl-end-point))  <span class="comment">; entering scaling zone</span><br />                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">ch</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'channel #f))
                      )
                   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> ch   <span class="comment">; channel message</span><br />                       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">scaling-steps</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#find-number-of-scaling-steps-in" title="midi-laml-processing-lib">find-number-of-scaling-steps-in</a> ml channels repl-end-point)))
                         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> ch) channels) <span class="comment">; channel in the channel list channels</span><br />                             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#scale-message" title="midi-laml-processing-lib">scale-message</a> mes scaling-fu scaling-steps 1 min-vel max-vel)
                                   (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-scale-velocity" title="midi-laml-processing-lib">multi-scale-velocity</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) min-vel max-vel repl-start-point
                                                         repl-end-point scaling-fu section-list by-bar-advancement-velocity-scaling #t scaling-steps 2))
                             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-scale-velocity" title="midi-laml-processing-lib">multi-scale-velocity</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) min-vel max-vel repl-start-point
                                                             repl-end-point scaling-fu section-list by-bar-advancement-velocity-scaling #t scaling-steps 1)) 
                           ))
                       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">scaling-steps</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#find-number-of-scaling-steps-in" title="midi-laml-processing-lib">find-number-of-scaling-steps-in</a> ml channels repl-end-point)))
                         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-scale-velocity" title="midi-laml-processing-lib">multi-scale-velocity</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) min-vel max-vel repl-start-point
                                                           repl-end-point scaling-fu section-list by-bar-advancement-velocity-scaling #t scaling-steps 1)))))
                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-scale-velocity" title="midi-laml-processing-lib">multi-scale-velocity</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) min-vel max-vel repl-start-point repl-end-point
                                                 scaling-fu section-list by-bar-advancement-velocity-scaling scaling? nss i)))))

        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> scaling? (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml))))
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml) (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-scale-velocity" title="midi-laml-processing-lib">multi-scale-velocity</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) min-vel max-vel repl-start-point repl-end-point
                                                scaling-fu section-list by-bar-advancement-velocity-scaling scaling? nss i)))

        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> scaling? (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml)))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">mes</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml))
                  (<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'absTime))))
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> abs-time repl-end-point)
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a>
                    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> "W" nss i)
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'channel)) channels) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> mes) "NoteOn"))
                     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#scale-message" title="midi-laml-processing-lib">scale-message</a> mes scaling-fu nss i min-vel max-vel)
                           (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-scale-velocity" title="midi-laml-processing-lib">multi-scale-velocity</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) min-vel max-vel repl-start-point
                                                 repl-end-point scaling-fu section-list by-bar-advancement-velocity-scaling #t nss (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> i 1)))
                     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-scale-velocity" title="midi-laml-processing-lib">multi-scale-velocity</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) min-vel max-vel repl-start-point repl-end-point
                                                     scaling-fu section-list by-bar-advancement-velocity-scaling scaling? nss i))))

                 <span class="comment">; now again outside thin-out zone</span><br />                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a>
                    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX461" title="R5RS Scheme form">display</a> "V")

                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> section-list)))  
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">next-section</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> section-list))
                            (<span class="local-name-binding">start-end-sf</span> (by-bar-advancement-velocity-scaling next-section))
                           )
                       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-scale-velocity" title="midi-laml-processing-lib">multi-scale-velocity</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) min-vel max-vel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> start-end-sf) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> start-end-sf) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#third" title="Manual: general">third</a> start-end-sf)
                                                       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> section-list) by-bar-advancement-velocity-scaling #f 0 0))) 
                     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-scale-velocity" title="midi-laml-processing-lib">multi-scale-velocity</a> channels (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) min-vel max-vel repl-start-point repl-end-point
                                                     scaling-fu '() by-bar-advancement-velocity-scaling #f 0 0)))))))

        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "multi-scale-velocity: Should not happen"))))

<a name="find-number-of-scaling-steps-in"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(find-number-of-scaling-steps-in message-list channels time-limit)</span>
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#find-number-of-scaling-steps-in-1" title="midi-laml-processing-lib">find-number-of-scaling-steps-in-1</a> message-list channels time-limit 0))

<a name="find-number-of-scaling-steps-in-1"></a><span class="comment">; Find the number of NoteOn messages in channels before time-limit</span><br /><a name="find-number-of-scaling-steps-in-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(find-number-of-scaling-steps-in-1 message-list channels time-limit count)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-list) count)
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list))) 
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#find-number-of-scaling-steps-in-1" title="midi-laml-processing-lib">find-number-of-scaling-steps-in-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) channels time-limit count))
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) 'absTime)) time-limit) count)
        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list)) "NoteOn")
              (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) 'channel #f) 
              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-list) 'channel)) channels))
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#find-number-of-scaling-steps-in-1" title="midi-laml-processing-lib">find-number-of-scaling-steps-in-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) channels time-limit (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> count 1)))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> 
           (<a class="applied-name" href="midi-laml-processing-lib-1.html#find-number-of-scaling-steps-in-1" title="midi-laml-processing-lib">find-number-of-scaling-steps-in-1</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-list) channels time-limit count))))


<a name="scale-message"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(scale-message noteon-ast scaling-fu scaling-steps i min-vel max-vel)</span>
  (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> i scaling-steps)
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">old-velocity</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> noteon-ast 'velocity)))
         (<span class="local-name-binding">new-velocity</span> (between min-vel max-vel
                               (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> min-vel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> old-velocity min-vel) (scaling-fu (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> i scaling-steps)))))))
    (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#copy-ast-mutate-attributes" title="Manual: xml-in-laml">copy-ast-mutate-attributes</a> noteon-ast 'velocity (as-int-string new-velocity))))



<a name="envelope-sections-by-bar"></a><a name="envelope-sections-by-bar"></a><span><a href="../midi-laml-processing-lib.html#envelope-sections-by-bar"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">envelope-sections-by-bar</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 1 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">section-list</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#envelope-sections-by-bar-1" title="midi-laml-processing-lib">envelope-sections-by-bar-1</a> section-list cont)))) 

<a name="envelope-sections-by-bar-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(envelope-sections-by-bar-1 section-list message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">units-per-bar</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> global-ppqn (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> global-signature)))
        (<span class="local-name-binding">sorted-section-list</span>
          (sort-list
             section-list
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">s1</span> <span class="local-name-binding">s2</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> s1) (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> s2)))))
       )
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">section</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> sorted-section-list))
           (<span class="local-name-binding">bar</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> section))
           (<span class="local-name-binding">repl-start-point</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> bar units-per-bar))
           (<span class="local-name-binding">number-of-bars</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-length-of" title="midi-laml-processing-lib">bar-length-of</a> section))
           (<span class="local-name-binding">repl-length</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> number-of-bars units-per-bar))
           (<span class="local-name-binding">repl-end-point</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> repl-start-point repl-length))
           (<span class="local-name-binding">pre-envelope-list</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#pre-envelope-of" title="midi-laml-processing-lib">pre-envelope-of</a> section))
           (<span class="local-name-binding">post-envelope-list</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#post-envelope-of" title="midi-laml-processing-lib">post-envelope-of</a> section))
           (<span class="local-name-binding">post-envelope-list-length</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#total-length-of-message-list" title="midi-laml-processing-lib">total-length-of-message-list</a> post-envelope-list))
          )
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-enveloping" title="midi-laml-processing-lib">multi-enveloping</a> message-list repl-start-point repl-end-point pre-envelope-list post-envelope-list post-envelope-list-length
                        sorted-section-list units-per-bar #f #f))))

<a name="multi-enveloping"></a><span class="comment">; Invariant: repl-start-point, repl-end-point and replacement-lst correspond to first element of section-insertion-list</span><br /><a name="multi-enveloping"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(multi-enveloping ml repl-start-point repl-end-point pre-envelope-list post-envelope-list
                          post-envelope-length  section-envelope-list upb enveloping? post-env-inserted?)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> ml) '())
        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> enveloping?) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml)))) 
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml) 
                 (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-enveloping" title="midi-laml-processing-lib">multi-enveloping</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point pre-envelope-list post-envelope-list
                                   post-envelope-length  section-envelope-list upb enveloping? post-env-inserted? )))

        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> enveloping?) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml)))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">mes</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml))
                  (<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'absTime))))
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> abs-time repl-start-point) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> abs-time repl-end-point))  <span class="comment">; insert the pre-envelope here</span><br />                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> 
                    pre-envelope-list
                    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a>
                      mes
                      (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-enveloping" title="midi-laml-processing-lib">multi-enveloping</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point pre-envelope-list post-envelope-list
                                        post-envelope-length  section-envelope-list upb #t #f)))
                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-enveloping" title="midi-laml-processing-lib">multi-enveloping</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point pre-envelope-list post-envelope-list
                                             post-envelope-length  section-envelope-list upb enveloping? post-env-inserted?)))))

        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> enveloping? (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml))))
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml) (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-enveloping" title="midi-laml-processing-lib">multi-enveloping</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point pre-envelope-list
                                            post-envelope-list post-envelope-length  section-envelope-list upb enveloping? 
                                            post-env-inserted?)))

        ((<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> enveloping? (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml)))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">mes</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ml))
                  (<span class="local-name-binding">abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> mes 'absTime))))
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> abs-time repl-end-point)
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> abs-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> repl-end-point post-envelope-length)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> post-env-inserted?))
                     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> 
                        post-envelope-list
                        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a>
                         mes
                         (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-enveloping" title="midi-laml-processing-lib">multi-enveloping</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point pre-envelope-list post-envelope-list
                                           post-envelope-length  section-envelope-list upb #t #t)))
                     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-enveloping" title="midi-laml-processing-lib">multi-enveloping</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point pre-envelope-list 
                                                 post-envelope-list post-envelope-length  section-envelope-list upb enveloping? 
                                                 post-env-inserted?)) )

                 <span class="comment">; outside enveloping interval</span><br />                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> section-envelope-list)))  
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">next-section</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> section-envelope-list))
                            (<span class="local-name-binding">next-bar</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> next-section))
                            (<span class="local-name-binding">next-repl-start-point</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> next-bar upb))
                            (<span class="local-name-binding">next-number-of-bars</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-length-of" title="midi-laml-processing-lib">bar-length-of</a> next-section))
                            (<span class="local-name-binding">next-repl-length</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> next-number-of-bars upb))
                            (<span class="local-name-binding">next-repl-end-point</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> next-repl-start-point next-repl-length))
                            (<span class="local-name-binding">pre-envelope-list</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#pre-envelope-of" title="midi-laml-processing-lib">pre-envelope-of</a> next-section))
                            (<span class="local-name-binding">post-envelope-list</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#post-envelope-of" title="midi-laml-processing-lib">post-envelope-of</a> next-section))
                            (<span class="local-name-binding">post-envelope-list-length</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#total-length-of-message-list" title="midi-laml-processing-lib">total-length-of-message-list</a> post-envelope-list))
                           )
                       (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes 
                             (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-enveloping" title="midi-laml-processing-lib">multi-enveloping</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) next-repl-start-point next-repl-end-point pre-envelope-list post-envelope-list
                                              post-envelope-length (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> section-envelope-list) upb #f #f))) 
                     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> mes (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-enveloping" title="midi-laml-processing-lib">multi-enveloping</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ml) repl-start-point repl-end-point pre-envelope-list 
                                                 post-envelope-list post-envelope-length  '() upb #f #f))))))

        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "multi-enveloping: Should not happen"))))
  

<a name="bar-number-of"></a><span class="comment">; Selectors of section descriptions - kind of overloaded.</span><br /><a name="bar-number-of"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">bar-number-of</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 1 "bar-number-of"))
<a name="bar-length-of"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">bar-length-of</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 2 "bar-length-of"))
<a name="start-time-of"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">start-time-of</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 1 "start-time-of"))
<a name="end-time-of"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">end-time-of</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 2 "end-time-of"))
<a name="replacement-list-of"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">replacement-list-of</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 3 "replacement-list-of"))
<a name="keep-predicate-of"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">keep-predicate-of</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 3 "keep-predicate-of"))
<a name="scaling-function-of"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">scaling-function-of</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 3 "scaling-function-of"))
<a name="pre-envelope-of"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">pre-envelope-of</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 3 "pre-envelope-of"))
<a name="post-envelope-of"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">post-envelope-of</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 4 "post-envelope-of"))


<span class="comment">; ---------------------------------------------------------------------------------------------------------------</span><br />
<div class="schemedoc-section-comment">;;; .section-id 
;;; Midi transformations on sections.
;;; The functions in this section are similar to the functions in the previous sections.
;;; The main difference is that the functions in this section work on sections, identified 
;;; by absolute time ticks, not bar numbers. The function time-of-marker allows for identification 
;;; of sections by markers.</div>
<a name="substitute-section-by-time"></a><a name="substitute-section-by-time"></a><span><a href="../midi-laml-processing-lib.html#substitute-section-by-time"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">substitute-section-by-time</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channels</span> <span class="local-name-binding">section-list</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#substitute-section-by-time-1" title="midi-laml-processing-lib">substitute-section-by-time-1</a> channels section-list cont)))) 

<a name="contextual-message-list"></a><span class="comment">; Used by substitute-section-by-time-1 to access the message-list on which the substitution is being performed</span><br /><a name="contextual-message-list"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">contextual-message-list</span> '())

<a name="substitute-section-by-time-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(substitute-section-by-time-1 channels section-list message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#contextual-message-list" title="midi-laml-processing-lib">contextual-message-list</a> message-list)
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">units-per-bar</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> global-ppqn (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> global-signature)))
        (<span class="local-name-binding">sorted-section-list</span>
          (sort-list
             section-list
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">s1</span> <span class="local-name-binding">s2</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> s1) (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> s2)))))
       )
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">section</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> sorted-section-list))
           (<span class="local-name-binding">start-end-repl</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#by-time-advancement-substitution" title="midi-laml-processing-lib">by-time-advancement-substitution</a> section))
          )
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-substitution" title="midi-laml-processing-lib">multi-substitution</a> channels message-list
                         (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> start-end-repl) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> start-end-repl) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#third" title="Manual: general">third</a> start-end-repl)
                         sorted-section-list <a class="applied-name" href="midi-laml-processing-lib-1.html#by-time-advancement-substitution" title="midi-laml-processing-lib">by-time-advancement-substitution</a> #f))))

<a name="by-time-advancement-substitution"></a><span class="comment">; Returns a list of start-point, end-point, and effective replacement-list of section - of stretching and given time version.
; holds detailed knowledge of the structure of a section</span><br /><a name="by-time-advancement-substitution"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(by-time-advancement-substitution section)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">repl-start-point</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#start-time-of" title="midi-laml-processing-lib">start-time-of</a> section))
         (<span class="local-name-binding">repl-end-point</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#end-time-of" title="midi-laml-processing-lib">end-time-of</a> section))
         (<span class="local-name-binding">replacement-lst</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#stretch-if-necessary" title="midi-laml-processing-lib">stretch-if-necessary</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#replacement-list-of" title="midi-laml-processing-lib">replacement-list-of</a> section) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> repl-end-point repl-start-point)))
        )
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> repl-start-point repl-end-point replacement-lst)))

<a name="stretch-if-necessary"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(stretch-if-necessary delta-message-list to-length)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">mes-lst-lgt</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#length-of-delta-time-midi-list" title="midi-laml-processing-lib">length-of-delta-time-midi-list</a> delta-message-list))
         (<span class="local-name-binding">stretch-factor</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> to-length mes-lst-lgt)))
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-stretch-1" title="midi-laml-processing-lib">time-stretch-1</a> stretch-factor delta-message-list)))


<a name="scale-velocity-of-sections-by-time"></a><a name="scale-velocity-of-sections-by-time"></a><span><a href="../midi-laml-processing-lib.html#scale-velocity-of-sections-by-time"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">scale-velocity-of-sections-by-time</span>
 (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#xml-in-laml-positional-abstraction" title="Manual: xml-in-laml">xml-in-laml-positional-abstraction</a> 2 0
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channels</span> <span class="local-name-binding">section-list</span> <span class="local-name-binding">cont</span> <span class="local-name-binding">attr</span>)
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">min-vel</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'min-velocity attr "0")))
         (<span class="local-name-binding">max-vel</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#defaulted-get-prop" title="Manual: general">defaulted-get-prop</a> 'max-velocity attr "127"))))
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#scale-velocity-of-sections-by-time-1" title="midi-laml-processing-lib">scale-velocity-of-sections-by-time-1</a> channels section-list min-vel max-vel cont)))))

<a name="scale-velocity-of-sections-by-time-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(scale-velocity-of-sections-by-time-1 channels section-list min-vel max-vel message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#contextual-message-list" title="midi-laml-processing-lib">contextual-message-list</a> message-list)
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">sorted-section-list</span>
          (sort-list
             section-list
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">s1</span> <span class="local-name-binding">s2</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> s1) (<a class="applied-name" href="midi-laml-processing-lib-1.html#bar-number-of" title="midi-laml-processing-lib">bar-number-of</a> s2)))))
       )
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">section</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> sorted-section-list))
           (<span class="local-name-binding">start-end-sf</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#by-time-advancement-velocity-scaling" title="midi-laml-processing-lib">by-time-advancement-velocity-scaling</a> section))
          )
      (<a class="applied-name" href="midi-laml-processing-lib-1.html#multi-scale-velocity" title="midi-laml-processing-lib">multi-scale-velocity</a> channels message-list min-vel max-vel (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> start-end-sf) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> start-end-sf) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#third" title="Manual: general">third</a> start-end-sf)
                            sorted-section-list <a class="applied-name" href="midi-laml-processing-lib-1.html#by-time-advancement-velocity-scaling" title="midi-laml-processing-lib">by-time-advancement-velocity-scaling</a> #f 0 0))))

<a name="by-time-advancement-velocity-scaling"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(by-time-advancement-velocity-scaling section)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">repl-start-point</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#start-time-of" title="midi-laml-processing-lib">start-time-of</a> section))
         (<span class="local-name-binding">repl-end-point</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#end-time-of" title="midi-laml-processing-lib">end-time-of</a> section))
         (<span class="local-name-binding">scaling-fu</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#scaling-function-of" title="midi-laml-processing-lib">scaling-function-of</a> section))
        )
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> repl-start-point repl-end-point scaling-fu)))


<a name="time-of-marker"></a><a name="time-of-marker"></a><span><a href="../midi-laml-processing-lib.html#time-of-marker"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(time-of-marker marker-name . optional-parameter-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">message-lst</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list <a class="applied-name" href="midi-laml-processing-lib-1.html#contextual-message-list" title="midi-laml-processing-lib">contextual-message-list</a>)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">marker-lgt</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> marker-name))
           (<span class="local-name-binding">res-mes</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> 
                     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">mes</span>) 
                       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#Meta?" title="midi-laml-processing-lib">Meta?</a> mes 6)
                            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">meta-txt</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-text" title="Manual: xml-in-laml">ast-text</a> mes)))
                              (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> meta-txt) marker-lgt)
                                   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> meta-txt 0 marker-lgt) marker-name)))))
                     message-lst)))
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> res-mes
          (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> res-mes 'absTime)
          (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "Cannot find marker" marker-name (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> message-lst))))))


<div class="schemedoc-section-comment">;;; .section-id guitar-beats
;;; Generation of note phrases.
;;; The functions in this section generate - or help generate - list of notes.
;;; The most sophisticated is the function beat, which - typically, but not necessarily - generates guitar beats.
;;; The instrument definition is outside the context of the beat function.
;;; The generated beats are affected by a large number of parameters.
;;; The function duration-to-next is a function which makes it possible to express the duration contextually.
;;; LAML technically, duration-to-next, is an attribute-returning delayed procedural content item function.</div>
<a name="regular-beats"></a><a name="regular-beats"></a><span><a href="../midi-laml-processing-lib.html#regular-beats"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(regular-beats n ch note-value distance)</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a>
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">n</span>) (NoteOn 'deltaTime distance 'channel ch 'note note-value 'velocity 127 'duration 100))
    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#number-interval" title="Manual: general">number-interval</a> 1 n)))

<a name="beat"></a><a name="beat"></a><span><a href="../midi-laml-processing-lib.html#beat"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(beat direction stretch base-velocity total-length velocity-scaling-fn delta-time-scaling-fn . optional-parameter-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">transposition</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list 0))
       (<span class="local-name-binding">ch</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 2 optional-parameter-list 1))
       (<span class="local-name-binding">base-duration</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 3 optional-parameter-list 960))
       (<span class="local-name-binding">time-note-list</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 4 optional-parameter-list '((240 C2) (240 E2) (240 G2) (240 B2) (240 C3) (240 E3))))
      )
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#transpose-channels" title="midi-laml-processing-lib">transpose-channels</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> ch) transposition
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">directional-time-note-list</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> direction 'down) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> time-note-list) time-note-list))
           (<span class="local-name-binding">notes</span>
            (<a class="applied-name" href="midi-laml-processing-lib-1.html#scale-attribute-1" title="midi-laml-processing-lib">scale-attribute-1</a> 'deltaTime delta-time-scaling-fn
             (<a class="applied-name" href="midi-laml-processing-lib-1.html#scale-attribute-1" title="midi-laml-processing-lib">scale-attribute-1</a> 'velocity velocity-scaling-fn
              (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-stretch" title="midi-laml-processing-lib">time-stretch</a> stretch
               (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a>
                 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">t</span> 0)   <span class="comment">; First - forced zero deltaTime</span><br />                        (<span class="local-name-binding">nv</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> directional-time-note-list)))
                        (<span class="local-name-binding">n-velocity</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#third-else" title="midi-laml-processing-lib">third-else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> directional-time-note-list) base-velocity))
                        (<span class="local-name-binding">nn</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> nv '-) #f) ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX224" title="R5RS Scheme form">number?</a> nv) nv) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (note-name-to-note-number nv))))
                       )
                   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> nn #f)
                       (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-delta-time" title="midi-laml-processing-lib">midi-null-event-delta-time</a> t "Dropped note")
                       (NoteOn 'deltaTime t 'channel ch 'note nn 'velocity n-velocity (<a class="applied-name" href="midi-laml-processing-lib-1.html#duration-to-next" title="midi-laml-processing-lib">duration-to-next</a> base-duration))))
                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a>                     <span class="comment">; Rest</span><br />                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">t-nv</span>)
                    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">t</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> t-nv))
                           (<span class="local-name-binding">nv</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> t-nv))
                           (<span class="local-name-binding">n-velocity</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#third-else" title="midi-laml-processing-lib">third-else</a> t-nv base-velocity))
                           (<span class="local-name-binding">nn</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> nv '-) #f) ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX224" title="R5RS Scheme form">number?</a> nv) nv) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (note-name-to-note-number nv))))
                          )
                      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> nn #f)
                          (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-delta-time" title="midi-laml-processing-lib">midi-null-event-delta-time</a> t "Dropped note")
                          (NoteOn 'deltaTime t 'channel ch 'note nn 'velocity n-velocity (<a class="applied-name" href="midi-laml-processing-lib-1.html#duration-to-next" title="midi-laml-processing-lib">duration-to-next</a> base-duration)))))
                  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> directional-time-note-list)))
              ))))
            (<span class="local-name-binding">note-lgt</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#accumulate-right" title="Manual: general">accumulate-right</a> <a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 0 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ast</span>) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> ast 'deltaTime))) notes)))
           )
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> note-lgt total-length) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "Stretched NoteOn sequence of length" note-lgt "does not fit in an interval of length" total-length))
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>
        (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-comment" title="midi-laml-processing-lib">midi-comment</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> direction 'down) "Downwards:" "Upwards:"))
        notes
        (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-delta-time" title="midi-laml-processing-lib">midi-null-event-delta-time</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> total-length note-lgt) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "Filling to total-length " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> total-length)))
        (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-comment" title="midi-laml-processing-lib">midi-comment</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> direction 'down) "End downwards." "End upwards."))
      )))))

<a name="third-else"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(third-else lst default)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> lst) 3) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#third" title="Manual: general">third</a> lst) default))


<a name="add-together-delta-times-until"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(add-together-delta-times-until ast-list stop-ast)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> ast-list) 0)
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ast-list))) (<a class="applied-name" href="midi-laml-processing-lib-1.html#add-together-delta-times-until" title="midi-laml-processing-lib">add-together-delta-times-until</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ast-list) stop-ast))
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ast-list) stop-ast) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> stop-ast 'deltaTime)) ) <span class="comment">; thus including deltaTime of stop-ast. Maybe not correct?</span><br />        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> ast-list) 'deltaTime)) (<a class="applied-name" href="midi-laml-processing-lib-1.html#add-together-delta-times-until" title="midi-laml-processing-lib">add-together-delta-times-until</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> ast-list) stop-ast)))))

<a name="duration-to-next"></a><a name="duration-to-next"></a><span><a href="../midi-laml-processing-lib.html#duration-to-next"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(duration-to-next default-duration)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">root-ast</span> <span class="local-name-binding">note-ast</span>)
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">track</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#find-first-ast" title="Manual: xml-in-laml">find-first-ast</a> root-ast "MidiTrack"))
         (<span class="local-name-binding">events-in-track</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a> track))
         (<span class="local-name-binding">note-value</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> note-ast 'note -1))
         (<span class="local-name-binding">channel</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> note-ast 'channel -1))
         (<span class="local-name-binding">events-from-note-ast</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-tail-in-list" title="Manual: general">find-tail-in-list</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">el</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> el note-ast)) events-in-track))     <span class="comment">; events after note-ast</span><br />         (<span class="local-name-binding">events-after-note-ast</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> events-from-note-ast)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> events-from-note-ast) '())) <span class="comment">; tail of</span><br />         (<span class="local-name-binding">next-similar-note-ast</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> 
                                  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">n-ast</span>)
                                    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#NoteOn?" title="midi-laml-processing-lib">NoteOn?</a> n-ast) 
                                         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> note-value (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> n-ast 'note))
                                         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> channel (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> n-ast 'channel))
                                    ))
                                  events-after-note-ast))
         (<span class="local-name-binding">dur</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> next-similar-note-ast (<a class="applied-name" href="midi-laml-processing-lib-1.html#add-together-delta-times-until" title="midi-laml-processing-lib">add-together-delta-times-until</a> events-after-note-ast next-similar-note-ast) default-duration))  
        )
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'duration (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX247" title="R5RS Scheme form">max</a> 0 dur)))))

<span class="comment">; ----------------------------------------------------------------------------------------------------------------------------------------------------
; Mega voice maps</span><br />
<span class="comment">; The functions in this section are used to encapsulate the details of a mega voice map.
; A mega voice map is a list of mega voice entries.
; A mega voice entry is a list of 
;   (mega-voice-section-name min-note max-note min-velocity max-melocity)
; A mega voice function, defined relative to a mega voice map, maps
;    note-name' section-name velocity'
; to
;    note-number velocity
; where note-name' is an extended note name, section-name is a name of mega voice section, and velocity' is a normal velocity in the interval [1 .. 127].
; note-name' examples:
;   C2   mapped by note-name-to-note-number
;   c2   mapped such that c0 is the minimum note in its section. 
; The given velocity is mapped to the interval which is characteristic of the mega voice section.</span><br />
<a name="generate-mega-voice-function"></a><a name="generate-mega-voice-function"></a><span><a href="../midi-laml-processing-lib.html#generate-mega-voice-function"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(generate-mega-voice-function mega-voice-map)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">note-name</span> <span class="local-name-binding">section-name</span> <span class="local-name-binding">velocity</span>)
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">note-name-str</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> note-name))
           (<span class="local-name-binding">relative-note-name?</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> note-name-str 0)) <a class="applied-name" href="midi-laml-processing-lib-1.html#lower-case-interval" title="midi-laml-processing-lib">lower-case-interval</a>))
           (<span class="local-name-binding">min-note-mvm</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#min-note-of-mega-voice-map" title="midi-laml-processing-lib">min-note-of-mega-voice-map</a> section-name mega-voice-map)) 
           (<span class="local-name-binding">max-note-mvm</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#max-note-of-mega-voice-map" title="midi-laml-processing-lib">max-note-of-mega-voice-map</a> section-name mega-voice-map)) 
           (<span class="local-name-binding">min-vel-mvm</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#min-velocity-of-mega-voice-map" title="midi-laml-processing-lib">min-velocity-of-mega-voice-map</a> section-name mega-voice-map)) 
           (<span class="local-name-binding">max-vel-vmv</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#max-velocity-of-mega-voice-map" title="midi-laml-processing-lib">max-velocity-of-mega-voice-map</a> section-name mega-voice-map))
          )
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> relative-note-name?
             (<a class="applied-name" href="midi-laml-processing-lib-1.html#mv-relative-to-absolute-note-number" title="midi-laml-processing-lib">mv-relative-to-absolute-note-number</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (note-name-to-note-number note-name) 24) min-note-mvm max-note-mvm) 
             (between min-note-mvm max-note-mvm (note-name-to-note-number note-name)))
         (<a class="applied-name" href="midi-laml-processing-lib-1.html#mv-scale-velocity" title="midi-laml-processing-lib">mv-scale-velocity</a> velocity min-vel-mvm max-vel-vmv)))))

<a name="lower-case-interval"></a><span class="comment">; The interval of the lower case letters</span><br /><a name="lower-case-interval"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">lower-case-interval</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#number-interval" title="Manual: general">number-interval</a> 97 122))

<a name="min-note-of-mega-voice-map"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(min-note-of-mega-voice-map section-name mega-voice-map)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">section</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">sec</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> section-name) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> sec)))) mega-voice-map)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> section (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> section) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "min-note-of-mega-voice-map: Unknown section" section-name))))

<a name="max-note-of-mega-voice-map"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(max-note-of-mega-voice-map section-name mega-voice-map)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">section</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">sec</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> section-name) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> sec)))) mega-voice-map)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> section (<a class="schemedoc-name" href="../../../../../lib/man/general.html#third" title="Manual: general">third</a> section) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "max-note-of-mega-voice-map: Unknown section" section-name))))

<a name="min-velocity-of-mega-voice-map"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(min-velocity-of-mega-voice-map section-name mega-voice-map)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">section</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">sec</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> section-name) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> sec)))) mega-voice-map)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> section (<a class="schemedoc-name" href="../../../../../lib/man/general.html#fourth" title="Manual: general">fourth</a> section) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "min-velocity-of-mega-voice-map: Unknown section" section-name))))

<a name="max-velocity-of-mega-voice-map"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(max-velocity-of-mega-voice-map section-name mega-voice-map)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">section</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">sec</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> section-name) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> sec)))) mega-voice-map)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> section (<a class="schemedoc-name" href="../../../../../lib/man/general.html#fifth" title="Manual: general">fifth</a> section) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "max-velocity-of-mega-voice-map: Unknown section" section-name))))

<a name="mv-scale-velocity"></a><span class="comment">; Scale velocity and displace it in the interval from min-vel to max-vel.</span><br /><a name="mv-scale-velocity"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(mv-scale-velocity velocity min-vel max-vel)</span>
  (to-int (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> min-vel (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> max-vel min-vel) 127) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> velocity 1)))))

<a name="mv-relative-to-absolute-note-number"></a><span class="comment">; Displace rel-note-number to the interval from min-note to max-note.</span><br /><a name="mv-relative-to-absolute-note-number"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(mv-relative-to-absolute-note-number rel-note-number min-note max-note)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">result</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> rel-note-number min-note)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> result max-note)
        result
        max-note)))

<a name="steel-guitar-megavoice-map"></a><a name="steel-guitar-megavoice-map"></a><span><a href="../midi-laml-processing-lib.html#steel-guitar-megavoice-map"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">steel-guitar-megavoice-map</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'harmonics 0 95 121 127) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'slide 0 95 106 120) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'hammer 0 95 91 105) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'mute 0 95 76 90) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'dead 0 95 61 75) 
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'open-hard 0 95 41 60) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'open-medium 0 95 21 40) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'open-soft 0 95 1 20)
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'strum-noice 96 119 1 127) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'fret-noice 120 127 1 127)))

<span class="comment">; ----------------------------------------------------------------------------------------------------------------------------------------------------</span><br />
<div class="schemedoc-section-comment">;;; .section-id style-splitting
;;; Style Splitting. The functions in this section split a style file in its midi path.
;;; In this context, a style file is a Yamaha Keyboard style file which control the automatic accompaniment.
;;; The first functions are older versions. The refined functions are more advanced.
;;; The refined functions are able to extract meta information about the midi contents of the pieces.
;;; Some levels of bulk processing is provided.</div>
<a name="split-and-process-style"></a><a name="split-and-process-style"></a><span><a href="../midi-laml-processing-lib.html#split-and-process-style"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-and-process-style style-file-path output-dir-path mode channel-selection)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">target-dir</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-name-proper" title="Manual: general">file-name-proper</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-name-proper" title="Manual: general">file-name-proper</a> style-file-path)))
         (<span class="local-name-binding">midi-ast</span> (midi-file-to-laml-ast style-file-path mode 0 #f #f))
         (<span class="local-name-binding">midi-header</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtree" title="Manual: xml-in-laml">ast-subtree</a> midi-ast "MidiHeader"))
         (<span class="local-name-binding">track-ast</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtree" title="Manual: xml-in-laml">ast-subtree</a> midi-ast "MidiTrack"))  <span class="comment">; format 0 - thus a single track</span><br />         (<span class="local-name-binding">track-events</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a> track-ast))         <span class="comment">; all midi events in this track </span><br />
         (<span class="local-name-binding">track-meta-divisions</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> meta-division-event? track-events))   <span class="comment">; a list of type 6 meta events</span><br />         (<span class="local-name-binding">track-meta-division-names</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-text" title="Manual: xml-in-laml">ast-text</a> track-meta-divisions))     <span class="comment">; a list of division names, taken from type 6 meta events</span><br />
         (<span class="local-name-binding">init-stuff</span> (midi-event-ast-subsequence track-events #t (<a class="schemedoc-name" href="../../../../../lib/man/general.html#third" title="Manual: general">third</a> track-meta-division-names)))   <span class="comment">; initial stuff - to be in all sections.</span><br />
         (<span class="local-name-binding">section-list</span> 
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a>
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">from</span> <span class="local-name-binding">to</span>)
              (midi-event-ast-subsequence track-events from to))
            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cddr</a> track-meta-division-names)
            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cdddr</a> track-meta-division-names) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> #t))))

         (<span class="local-name-binding">section-name-list</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> no-spaces-in-string (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cddr</a> track-meta-division-names)))
         (<span class="local-name-binding">end-of-track-event</span> (Meta 'deltaTime "0" 'type "47" "")))

    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#ensure-directory-existence!" title="Manual: general">ensure-directory-existence!</a> output-dir-path target-dir)  

    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX413" title="R5RS Scheme form">for-each</a> 
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">section</span> <span class="local-name-binding">section-name</span>)
       (<a class="schemedoc-name" href="../../../../../lib/man/file-read.html#write-text-file" title="Manual: file-read">write-text-file</a>
        (standard-midi-file-ast-to-bin
         (StandardMidiFile 'internal:run-action-procedure "false"
                           midi-header
                           (MidiTrack 
                            init-stuff
                            (<a class="applied-name" href="midi-laml-processing-lib-1.html#select-channels" title="midi-laml-processing-lib">select-channels</a> channel-selection section)
                            end-of-track-event)))
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> output-dir-path target-dir "/" section-name "." "mid")   
        )
       )
     section-list section-name-list)))

<a name="split-and-process-all-styles"></a><a name="split-and-process-all-styles"></a><span><a href="../midi-laml-processing-lib.html#split-and-process-all-styles"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-and-process-all-styles input-dir-path output-dir-path mode channel-selection)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">file-list</span> (directory-list input-dir-path))
        (<span class="local-name-binding">style-file-list</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">fn</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-name-extension" title="Manual: general">file-name-extension</a> fn) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> "sty" "pst" "psc" "sst" "prs" "bcs"))) file-list)))
   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX413" title="R5RS Scheme form">for-each</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">style-file</span>)
               (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> style-file)
               (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-and-process-style" title="midi-laml-processing-lib">split-and-process-style</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> input-dir-path style-file) output-dir-path mode channel-selection)
               (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> "")
             )
             style-file-list)))


<a name="split-and-process-style-one-channel-refined"></a><a name="split-and-process-style-one-channel-refined"></a><span><a href="../midi-laml-processing-lib.html#split-and-process-style-one-channel-refined"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-and-process-style-one-channel-refined style-file-path output-dir-path mode channel)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">midi-ast</span> (midi-file-to-laml-ast style-file-path mode 0 #f #f)))  <span class="comment">; last #f: produce midi format 0 AST</span><br />   (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-and-process-style-one-channel-given-ast-refined" title="midi-laml-processing-lib">split-and-process-style-one-channel-given-ast-refined</a> #f style-file-path midi-ast output-dir-path mode channel)))


<a name="split-and-process-style-one-channel-given-ast-refined"></a><span class="comment">; Doing the real work, given the ast.
; If meta-file-path is not #f, store meta information in this path.
; Factored out of efficiency reasons when repeating the splitting many times for the same style.</span><br /><a name="split-and-process-style-one-channel-given-ast-refined"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-and-process-style-one-channel-given-ast-refined meta-file-path style-file-path midi-ast output-dir-path mode channel)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> mode 'deltaTime))
      (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "split-and-process-style-one-channel-given-ast-refined: mode must be deltaTime" mode))
  
  <span class="comment">; Create last directory in output-dir-path if necessary</span><br />  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (directory-exists? output-dir-path))
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">parent-output-dir</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#parent-directory" title="Manual: general">parent-directory</a> output-dir-path))
            (<span class="local-name-binding">last-dir</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#directory-leave-name" title="Manual: general">directory-leave-name</a> output-dir-path))
           )
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> parent-output-dir) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> last-dir))
            (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "You should not work in the root directory"))
        (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> "Creating" last-dir "in" parent-output-dir)
        (<a class="schemedoc-name" href="../../../../../lib/man/general.html#ensure-directory-existence!" title="Manual: general">ensure-directory-existence!</a> parent-output-dir last-dir)))


  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">style-name-0</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-name-proper" title="Manual: general">file-name-proper</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-name-proper" title="Manual: general">file-name-proper</a> style-file-path)))
         (<span class="local-name-binding">style-name</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#transliterate" title="Manual: general">transliterate</a> style-name-0 #\space "-"))
         (<span class="local-name-binding">midi-header</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtree" title="Manual: xml-in-laml">ast-subtree</a> midi-ast "MidiHeader"))
         (<span class="local-name-binding">track-ast</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtree" title="Manual: xml-in-laml">ast-subtree</a> midi-ast "MidiTrack"))  <span class="comment">; format 0 - thus a single track</span><br />         (<span class="local-name-binding">track-events</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a> track-ast))         <span class="comment">; all midi events in this track </span><br />
         (<span class="local-name-binding">track-meta-divisions</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> meta-division-event? track-events))   <span class="comment">; a list of type 6 meta events</span><br />         (<span class="local-name-binding">track-meta-division-names</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-text" title="Manual: xml-in-laml">ast-text</a> track-meta-divisions))     <span class="comment">; a list of division names, taken from type 6 meta events</span><br />
         (<span class="local-name-binding">init-stuff</span> (midi-event-ast-subsequence track-events #t (<a class="schemedoc-name" href="../../../../../lib/man/general.html#third" title="Manual: general">third</a> track-meta-division-names)))   <span class="comment">; initial stuff - to be in all sections.</span><br />
         (<span class="local-name-binding">section-list</span> 
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a>
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">from</span> <span class="local-name-binding">to</span>)
              (midi-event-ast-subsequence track-events from to))
            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cddr</a> track-meta-division-names)
            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cdddr</a> track-meta-division-names) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> #t))))

         (<span class="local-name-binding">section-name-list</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> no-spaces-in-string (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cddr</a> track-meta-division-names)))
         (<span class="local-name-binding">end-of-track-event</span> (Meta 'deltaTime "0" 'type "47" "")))

    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#ensure-directory-existence!" title="Manual: general">ensure-directory-existence!</a> output-dir-path style-name)  
    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#ensure-directory-existence!" title="Manual: general">ensure-directory-existence!</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> output-dir-path style-name "/") (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> channel))   

    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX413" title="R5RS Scheme form">for-each</a> 
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">section</span> <span class="local-name-binding">section-name</span>)
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">init-events-for-selected-channel</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#select-channel" title="midi-laml-processing-lib">select-channel</a> channel init-stuff))
             (<span class="local-name-binding">body-events-for-selected-channel</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#select-channel" title="midi-laml-processing-lib">select-channel</a> channel section))
             (<span class="local-name-binding">target-file-path</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> output-dir-path style-name "/" (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> channel) "/" section-name "." "mid"))
            )
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x)))) body-events-for-selected-channel)))
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">meta-info</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#make-meta-info-about-style-part" title="midi-laml-processing-lib">make-meta-info-about-style-part</a> 
                                 style-name-0 section-name channel style-file-path target-file-path
                                 midi-header init-events-for-selected-channel body-events-for-selected-channel)))
               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> meta-file-path (<a class="applied-name" href="midi-laml-processing-lib-1.html#add-meta-info-to-meta-base" title="midi-laml-processing-lib">add-meta-info-to-meta-base</a> meta-file-path meta-info))
               (<a class="schemedoc-name" href="../../../../../lib/man/file-read.html#write-text-file" title="Manual: file-read">write-text-file</a> <span class="comment">; There are relevant NoteOn events in the selected channels</span><br />                (standard-midi-file-ast-to-bin
                 (StandardMidiFile 'internal:run-action-procedure "false"
                                   midi-header
                                   (MidiTrack 
                                    init-events-for-selected-channel
                                    body-events-for-selected-channel
                                    end-of-track-event)))
                target-file-path
                ))
              'do-nothing)))
     section-list section-name-list)))

<a name="split-and-process-style-refined"></a><a name="split-and-process-style-refined"></a><span><a href="../midi-laml-processing-lib.html#split-and-process-style-refined"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-and-process-style-refined meta-file-path style-file-path output-dir-path mode)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#global-meta-info-list" title="midi-laml-processing-lib">global-meta-info-list</a> '())
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-and-process-style-refined-1" title="midi-laml-processing-lib">split-and-process-style-refined-1</a> meta-file-path style-file-path output-dir-path mode))

<a name="split-and-process-style-refined-1"></a><span class="comment">; just without resetting global-meta-info-list</span><br /><a name="split-and-process-style-refined-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-and-process-style-refined-1 meta-file-path style-file-path output-dir-path mode)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">midi-ast</span> (midi-file-to-laml-ast style-file-path mode 0 #f #f)))  <span class="comment">; last #f: produce midi format 0 AST</span><br />    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX413" title="R5RS Scheme form">for-each</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">channel</span>)  
                (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-and-process-style-one-channel-given-ast-refined" title="midi-laml-processing-lib">split-and-process-style-one-channel-given-ast-refined</a> meta-file-path style-file-path midi-ast output-dir-path mode channel))
              (<a class="schemedoc-name" href="../../../../../lib/man/general.html#number-interval" title="Manual: general">number-interval</a> 1 16))))


<a name="split-and-process-all-styles-refined"></a><a name="split-and-process-all-styles-refined"></a><span><a href="../midi-laml-processing-lib.html#split-and-process-all-styles-refined"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-and-process-all-styles-refined meta-file-path input-dir-path output-dir-path mode)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#global-meta-info-list" title="midi-laml-processing-lib">global-meta-info-list</a> '())
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-and-process-all-styles-refined-1" title="midi-laml-processing-lib">split-and-process-all-styles-refined-1</a> meta-file-path input-dir-path output-dir-path mode))  

<a name="split-and-process-all-styles-refined-1"></a><span class="comment">; just without resetting global-meta-info-list</span><br /><a name="split-and-process-all-styles-refined-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-and-process-all-styles-refined-1 meta-file-path input-dir-path output-dir-path mode)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">file-list</span> (directory-list input-dir-path))
        (<span class="local-name-binding">style-file-list</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">fn</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#downcase-string" title="Manual: general">downcase-string</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-name-extension" title="Manual: general">file-name-extension</a> fn)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> "sty" "pst" "psc" "sst" "prs" "bcs"))) file-list)))
   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX413" title="R5RS Scheme form">for-each</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">style-file</span>)
               (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> style-file)
               (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-and-process-style-refined-1" title="midi-laml-processing-lib">split-and-process-style-refined-1</a> meta-file-path (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> input-dir-path style-file) output-dir-path mode)
               (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> "")
             )
             style-file-list)))

<a name="split-and-process-all-style-directory-refined"></a><a name="split-and-process-all-style-directory-refined"></a><span><a href="../midi-laml-processing-lib.html#split-and-process-all-style-directory-refined"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-and-process-all-style-directory-refined meta-file-path input-dir-path output-dir-path mode)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#global-meta-info-list" title="midi-laml-processing-lib">global-meta-info-list</a> '())
  (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-and-process-all-style-directory-refined-1" title="midi-laml-processing-lib">split-and-process-all-style-directory-refined-1</a> meta-file-path input-dir-path output-dir-path mode)
)

<a name="split-and-process-all-style-directory-refined-1"></a><span class="comment">; just without resetting global-meta-info-list</span><br /><a name="split-and-process-all-style-directory-refined-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-and-process-all-style-directory-refined-1 meta-file-path input-dir-path output-dir-path mode)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">directory-list</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> directory-exists? (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">subdir</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> input-dir-path subdir "/"))
                                                       (directory-list input-dir-path))))  <span class="comment">; only directories, full paths - after filtering</span><br />        (<span class="local-name-binding">leave-output-dir</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#directory-leave-name" title="Manual: general">directory-leave-name</a> output-dir-path))
        (<span class="local-name-binding">output-parent-dir</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#parent-directory" title="Manual: general">parent-directory</a> output-dir-path))
       )
   (<a class="schemedoc-name" href="../../../../../lib/man/general.html#ensure-directory-existence!" title="Manual: general">ensure-directory-existence!</a> output-parent-dir leave-output-dir)
   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX413" title="R5RS Scheme form">for-each</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">dir</span>)
               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">leave-dir</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#directory-leave-name" title="Manual: general">directory-leave-name</a> dir)))
                 (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> "***" dir)
                 (<a class="schemedoc-name" href="../../../../../lib/man/general.html#ensure-directory-existence!" title="Manual: general">ensure-directory-existence!</a> output-dir-path leave-dir)
                 (<a class="applied-name" href="midi-laml-processing-lib-1.html#split-and-process-all-styles-refined-1" title="midi-laml-processing-lib">split-and-process-all-styles-refined-1</a> meta-file-path dir (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> output-dir-path leave-dir "/") mode)
                 (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> ""))
             )
             directory-list)

  (<a class="applied-name" href="midi-laml-processing-lib-1.html#save-meta-info-on-file" title="midi-laml-processing-lib">save-meta-info-on-file</a> meta-file-path <a class="applied-name" href="midi-laml-processing-lib-1.html#global-meta-info-list" title="midi-laml-processing-lib">global-meta-info-list</a>)
 )
)


<span class="comment">; (define (fix-it) 
;   (let* ((mel (file-read "c:/users/kurt/Media/Tyros/Styles/style-meta-info.lsp"))
;          (nl (number-interval 1 (length mel))))
;     (file-write
;         (map (lambda (e n)
;                (cons n e))
;              mel nl)
;         "c:/users/kurt/Media/Tyros/Styles/style-meta-info-1.lsp")))</span><br />
<span class="comment">; ---------------------------------------------------------------------------------------------------------------
; Meta data of style pieces.</span><br />
<a name="make-meta-info-about-style-part"></a><span class="comment">; Return a list of meta information of a given channel or a given section of a style file.
; channel is an integer</span><br /><a name="make-meta-info-about-style-part"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(make-meta-info-about-style-part  style-name section-name channel style-file-path target-file-path
               midi-header init-events-for-selected-channel body-events-for-selected-channel)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">nil-if-false</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> x)) 'nil x)))  <span class="comment">; #f -&gt; nil</span><br /> 
         (<span class="local-name-binding">ppqn</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> midi-header 'pulsesPerQuarterNote)))
         (<span class="local-name-binding">meta-time-signature-ast</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "Meta" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'type #f) "88")))
                                                 init-events-for-selected-channel))
         (<span class="local-name-binding">time-signature</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> meta-time-signature-ast (time-signature-of-meta-type-88-ast meta-time-signature-ast) #f))
         (<span class="local-name-binding">instrument-tuple</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#find-instrument-info-of" title="midi-laml-processing-lib">find-instrument-info-of</a> channel init-events-for-selected-channel))
         (<span class="local-name-binding">instrument-name</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> instrument-tuple (find-tyros-voice (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> instrument-tuple) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> instrument-tuple) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#third" title="Manual: general">third</a> instrument-tuple)) #f))
         (<span class="local-name-binding">number-of-notes</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x)))) body-events-for-selected-channel)))
         (<span class="local-name-binding">number-of-different-notes</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#count-number-of-different-notes" title="midi-laml-processing-lib">count-number-of-different-notes</a> body-events-for-selected-channel))
         (<span class="local-name-binding">program-control-changes</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#program-control-change-info" title="midi-laml-processing-lib">program-control-change-info</a> init-events-for-selected-channel body-events-for-selected-channel))
         (<span class="local-name-binding">length-of-body</span>   <span class="comment">; in pulses</span><br />             (<a class="schemedoc-name" href="../../../../../lib/man/general.html#accumulate-right" title="Manual: general">accumulate-right</a> <a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 0
                               (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ast</span>) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> ast 'deltaTime)))
                                    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a>  <span class="comment">; do not count first deltaTime</span><br />                                      (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x)) body-events-for-selected-channel)))))

        <span class="comment">; (bar-beat-clock    ; a list of 3 numbers
;   (if (and ppqn time-signature last-abs-time) (bar-beat-clock length-of-body ppqn (first time-signature) (second time-signature)) #f)) </span><br />
        )

  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>
    (nil-if-false time-signature)
    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX266" title="R5RS Scheme form">ceiling</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> length-of-body ppqn))         <span class="comment">; approximate number of quater notes. Rounded up.</span><br />    number-of-notes
    (nil-if-false instrument-tuple)
    (nil-if-false instrument-name)
    (nil-if-false section-name)
    channel
    ppqn             <span class="comment">; in pulses</span><br />    length-of-body   <span class="comment">; in pulses</span><br />    (nil-if-false style-name)
    (nil-if-false (<a class="applied-name" href="midi-laml-processing-lib-1.html#truncate-this-string" title="midi-laml-processing-lib">truncate-this-string</a> "c:/users/kurt/Media/Tyros/Styles/midi/" style-file-path))    <span class="comment">; path to style file - the ultimate source of this inforamation</span><br />    (nil-if-false (<a class="applied-name" href="midi-laml-processing-lib-1.html#truncate-this-string" title="midi-laml-processing-lib">truncate-this-string</a> "c:/users/kurt/Media/Tyros/Styles/midi/MIDI-PIECES/All-pieces/" target-file-path))   <span class="comment">; path the midi file - the midi file with the essential result of this meta information</span><br />    number-of-different-notes
    program-control-changes
  )
 )
)

<a name="count-number-of-different-notes"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(count-number-of-different-notes midi-even-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">occ-count</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX400" title="R5RS Scheme form">make-vector</a> 128 0)))   <span class="comment">; 128 elements, initial value 0
; register number of occurrences in vector</span><br />    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX413" title="R5RS Scheme form">for-each</a> 
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>)
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x)))
             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">note</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'note))))
               (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX405" title="R5RS Scheme form">vector-set!</a> occ-count note (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 1 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX404" title="R5RS Scheme form">vector-ref</a> occ-count note)))))  <span class="comment">; increment</span><br />       )
       midi-even-list)
    
    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#accumulate-right" title="Manual: general">accumulate-right</a> <a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 0 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">note</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX404" title="R5RS Scheme form">vector-ref</a> occ-count note) 0) 1 0)) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#number-interval" title="Manual: general">number-interval</a> 0 127)))))

<a name="program-control-change-info"></a><span class="comment">; Return a list of the number of Program change events, Expression controller events, and PitchBend controller events.
; A list of three integer numbers.</span><br /><a name="program-control-change-info"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(program-control-change-info init-event-list body-event-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">all-events</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a>  init-event-list body-event-list))

         (<span class="local-name-binding">program-events</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "ProgramChange" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x)))) all-events))
         (<span class="local-name-binding">control-change-expression-events</span>
                         (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "ControlChange" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x)) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> 11 (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'control))))) all-events))
         (<span class="local-name-binding">pitch-bend-change-events</span>
                         (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "PitchBendChange" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x)))) all-events))
        )
   (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> program-events)
         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> control-change-expression-events)
         (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> pitch-bend-change-events))))
    


<a name="find-instrument-info-of"></a><span class="comment">; Find the msb, lsb, prog-number for a selected channel in a list of midi event ASTs that
; contains the releveant ControlChange and ProgramChange informations.
; Returns a list of three integers, of #f.</span><br /><a name="find-instrument-info-of"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(find-instrument-info-of channel midi-events-for-selected-channel)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">msb-ast</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) 
                                                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "ControlChange" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x))
                                                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel)) channel)
                                                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'control #f) "0")))
                               midi-events-for-selected-channel))
         (<span class="local-name-binding">msb</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> msb-ast (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> msb-ast 'value #f) #f))
         (<span class="local-name-binding">lsb-ast</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) 
                                                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "ControlChange" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x))
                                                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel)) channel)
                                                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'control #f) "32")))
                               midi-events-for-selected-channel))
         (<span class="local-name-binding">lsb</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> lsb-ast (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> lsb-ast 'value #f) #f))
         (<span class="local-name-binding">prog-number-ast</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) 
                                                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "ProgramChange" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x))
                                                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> x 'channel)) channel)))
                               midi-events-for-selected-channel))
         (<span class="local-name-binding">prog-number</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> prog-number-ast (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> prog-number-ast 'number #f) #f)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> msb lsb prog-number)
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> msb) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> lsb) (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> prog-number))
        #f) ))

<a name="global-meta-info-list"></a><span class="comment">; The list where we - internally - accumulates meta info about midi pieces.</span><br /><a name="global-meta-info-list"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">global-meta-info-list</span> '())

<a name="add-meta-info-to-meta-base"></a><span class="comment">; Add meta-info (a list) to the contents of meta-file-path (a full path to a file with a list).</span><br /><a name="add-meta-info-to-meta-base"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(add-meta-info-to-meta-base meta-file-path meta-info)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#global-meta-info-list" title="midi-laml-processing-lib">global-meta-info-list</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> meta-info <a class="applied-name" href="midi-laml-processing-lib-1.html#global-meta-info-list" title="midi-laml-processing-lib">global-meta-info-list</a>))

  <span class="comment">; For each 1000 new elements in global-meta-info-list, save it on meta-file-path.</span><br />  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> 0 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX259" title="R5RS Scheme form">remainder</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#global-meta-info-list" title="midi-laml-processing-lib">global-meta-info-list</a>) 1000))
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a>
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX461" title="R5RS Scheme form">display</a> "Saving meta info about midi-pieces... ")
        (<a class="applied-name" href="midi-laml-processing-lib-1.html#save-meta-info-on-file" title="midi-laml-processing-lib">save-meta-info-on-file</a> meta-file-path <a class="applied-name" href="midi-laml-processing-lib-1.html#global-meta-info-list" title="midi-laml-processing-lib">global-meta-info-list</a>)
        (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> "  DONE")))
)

<a name="save-meta-info-on-file"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(save-meta-info-on-file meta-file-path meta-info-list)</span>

  <span class="comment">; Create file in existing directory if necessary</span><br />  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (file-exists? meta-file-path))
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">fnpe</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-name-proper-and-extension" title="Manual: general">file-name-proper-and-extension</a> meta-file-path))
            (<span class="local-name-binding">fnip</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-name-initial-path" title="Manual: general">file-name-initial-path</a> meta-file-path)))
        (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> "Creating meta piece file" fnpe "in" fnip)
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (directory-exists? fnip)
            (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-write" title="Manual: general">file-write</a> '() meta-file-path)
            (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "Trying to make meta midi piece file in non-existing directory" fnip)))) 
  (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-write" title="Manual: general">file-write</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> meta-info-list) meta-file-path)
)

<a name="adapt-meta-info-file-to-relative-file-paths"></a><span class="comment">; -----------------------------------------------------------------------------  
; Utility procedures</span><br />
<a name="adapt-meta-info-file-to-relative-file-paths"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(adapt-meta-info-file-to-relative-file-paths meta-info-path)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">meta-lst</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-read" title="Manual: general">file-read</a> meta-info-path)))
    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-write" title="Manual: general">file-write</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#adapt-meta-entry-to-relative-file-paths" title="midi-laml-processing-lib">adapt-meta-entry-to-relative-file-paths</a> meta-lst) meta-info-path)))

<a name="adapt-meta-entry-to-relative-file-paths"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(adapt-meta-entry-to-relative-file-paths me)</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX337" title="R5RS Scheme form">list-ref</a> me 0) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX337" title="R5RS Scheme form">list-ref</a> me 1) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX337" title="R5RS Scheme form">list-ref</a> me 2) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX337" title="R5RS Scheme form">list-ref</a> me 3) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX337" title="R5RS Scheme form">list-ref</a> me 4) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX337" title="R5RS Scheme form">list-ref</a> me 5) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX337" title="R5RS Scheme form">list-ref</a> me 6) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX337" title="R5RS Scheme form">list-ref</a> me 7) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX337" title="R5RS Scheme form">list-ref</a> me 8) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX337" title="R5RS Scheme form">list-ref</a> me 9)  
        (<a class="applied-name" href="midi-laml-processing-lib-1.html#truncate-this-string" title="midi-laml-processing-lib">truncate-this-string</a> "c:/users/kurt/Media/Tyros/Styles/midi/" (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX337" title="R5RS Scheme form">list-ref</a> me 10))
        (<a class="applied-name" href="midi-laml-processing-lib-1.html#truncate-this-string" title="midi-laml-processing-lib">truncate-this-string</a> "c:/users/kurt/Media/Tyros/Styles/midi/MIDI-PIECES/All-pieces/" (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX337" title="R5RS Scheme form">list-ref</a> me 11))
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX337" title="R5RS Scheme form">list-ref</a> me 12) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX337" title="R5RS Scheme form">list-ref</a> me 13)))    <a name="truncate-this-string"></a><span class="comment">; when applied to remembered pieces: Add  (list-ref me 14)</span><br />
<a name="truncate-this-string"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(truncate-this-string str in-str)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">str-lgt</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> str)))
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> in-str 0 str-lgt) str )
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> in-str str-lgt (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> in-str))
      (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "truncate-this-string: problems" str in-str))))

<span class="comment">; End utility procedures
; -----------------------------------------------------------------------------  </span><br />

<a name="abs-time-message-list-to-delta-timing"></a><span class="comment">; ---------------------------------------------------------------------------------------------------------------
; Abs time to delta time conversion and vice versa.
; Does only affect the deltaTime and absTime attributes. 
; All other attributes are left unchanged.</span><br />
<a name="abs-time-message-list-to-delta-timing"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(abs-time-message-list-to-delta-timing message-ast-list previous-abs-time)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-ast-list) '())
        ((<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-ast-list))
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">message-ast</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-ast-list))
                   (<span class="local-name-binding">this-abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> message-ast 'absTime)))
                   (<span class="local-name-binding">new-delta-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> this-abs-time previous-abs-time))
                   )
              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#sm-abs-to-delta-time" title="midi-laml-processing-lib">sm-abs-to-delta-time</a> message-ast new-delta-time)
                    (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-time-message-list-to-delta-timing" title="midi-laml-processing-lib">abs-time-message-list-to-delta-timing</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-ast-list) this-abs-time))))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-ast-list) (<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-time-message-list-to-delta-timing" title="midi-laml-processing-lib">abs-time-message-list-to-delta-timing</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-ast-list) previous-abs-time)))))

<a name="sm-abs-to-delta-time"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(sm-abs-to-delta-time ast delta-time)</span>
  (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#make-ast" title="Manual: xml-in-laml">make-ast</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> ast) 
            (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a> ast) 
            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'deltaTime 
                           (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> delta-time))
                    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#but-props" title="Manual: general">but-props</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attributes" title="Manual: xml-in-laml">ast-attributes</a> ast) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'absTime)))
            (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-kind" title="Manual: xml-in-laml">ast-kind</a> ast)
            (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-language" title="Manual: xml-in-laml">ast-language</a> ast)
            (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attributes" title="Manual: xml-in-laml">ast-internal-attributes</a> ast)))



<a name="delta-time-message-list-to-abs-timing"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(delta-time-message-list-to-abs-timing message-ast-list start-time)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> message-ast-list) '())
        ((<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-ast-list))
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">message-ast</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-ast-list))
                  (<span class="local-name-binding">delta-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> message-ast 'deltaTime))
                  (<span class="local-name-binding">new-abs-time</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> start-time (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> delta-time)))
                  )
             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#sm-delta-to-abs-time" title="midi-laml-processing-lib">sm-delta-to-abs-time</a> message-ast new-abs-time)
                   (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-message-list-to-abs-timing" title="midi-laml-processing-lib">delta-time-message-list-to-abs-timing</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-ast-list) new-abs-time))))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> message-ast-list) (<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-message-list-to-abs-timing" title="midi-laml-processing-lib">delta-time-message-list-to-abs-timing</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> message-ast-list) start-time)))))

<a name="sm-delta-to-abs-time"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(sm-delta-to-abs-time ast abs-time)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">existing-info</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> ast 'info "")))
  (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#make-ast" title="Manual: xml-in-laml">make-ast</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> ast) 
            (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a> ast) 
            (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>
                       'absTime (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> abs-time) 
                    )
                    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#but-props" title="Manual: general">but-props</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attributes" title="Manual: xml-in-laml">ast-attributes</a> ast) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'deltaTime 'info)))
            (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-kind" title="Manual: xml-in-laml">ast-kind</a> ast)
            (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-language" title="Manual: xml-in-laml">ast-language</a> ast)
            (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attributes" title="Manual: xml-in-laml">ast-internal-attributes</a> ast))))

<span class="comment">; ---------------------------------------------------------------------------------------------------------------</span><br /><div class="schemedoc-section-comment">;;; Arpeggio splitting.</div>
<a name="split-arpeggio-recording"></a><a name="split-arpeggio-recording"></a><span><a href="../midi-laml-processing-lib.html#split-arpeggio-recording"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-arpeggio-recording source-file-path start-number target-dir-list . optional-parameter-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">expected-length</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list #f))
         (<span class="local-name-binding">given-number-interval</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 2 optional-parameter-list #f))
         (<span class="local-name-binding">target-dir</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> target-dir-list))
         (<span class="local-name-binding">trimmed-target-dir</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> target-dir-list))
         (<span class="local-name-binding">meta-target-dir</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#third" title="Manual: general">third</a> target-dir-list))
         (<span class="local-name-binding">midi-ast</span> (midi-file-to-laml-ast source-file-path 'absTime 0 #f))
         (<span class="local-name-binding">midi-header</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtree" title="Manual: xml-in-laml">ast-subtree</a> midi-ast "MidiHeader"))
         (<span class="local-name-binding">track</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtree" title="Manual: xml-in-laml">ast-subtree</a> midi-ast "MidiTrack"))
         (<span class="local-name-binding">messages</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a> track))
         (<span class="local-name-binding">sections</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#sublist-by-predicate" title="Manual: general">sublist-by-predicate</a> messages (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ast</span> <span class="local-name-binding">prev-ast</span> <span class="local-name-binding">n</span>) (<a class="applied-name" href="midi-laml-processing-lib-1.html#ControlChange?" title="midi-laml-processing-lib">ControlChange?</a> ast 0))))
         (<span class="local-name-binding">sections-1</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> sections))
         (<span class="local-name-binding">sections-2</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">section</span>) 
                             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">first-mes</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> section))
                                    (<span class="local-name-binding">first-abs-time</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime first-mes)))
                               (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-displace" title="midi-laml-processing-lib">time-displace</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> first-abs-time) section)))
                          sections-1))
         (<span class="local-name-binding">count</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> sections-1))
        )
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> expected-length (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> expected-length count)))
        (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "Expected length: " expected-length "  Actual length: " count))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> given-number-interval (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> expected-length (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> given-number-interval))))
        (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "The explicitly given list has length" (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> given-number-interval) ". The expected length is" expected-length))


    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX413" title="R5RS Scheme form">for-each</a> 
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">section</span> <span class="local-name-binding">number</span>)
          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">arp-meta-data</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#get-arpeggio-meta-info" title="midi-laml-processing-lib">get-arpeggio-meta-info</a> number))

                 (<span class="local-name-binding">a-length</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#arp-length" title="midi-laml-processing-lib">arp-length</a> arp-meta-data))
                 (<span class="local-name-binding">a-time-sig-str</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#arp-time-sig" title="midi-laml-processing-lib">arp-time-sig</a> arp-meta-data))
                 (<span class="local-name-binding">a-time-sig-lst</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#parse-arp-time-signature" title="midi-laml-processing-lib">parse-arp-time-signature</a> a-time-sig-str))     <span class="comment">; to such as the list (4  4)</span><br />                 (<span class="local-name-binding">nom</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> a-time-sig-lst))
                 (<span class="local-name-binding">denom</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> a-time-sig-lst))                 

                 (<span class="local-name-binding">target-file</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> target-dir (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> number) "." "mid"))
                 (<span class="local-name-binding">trimmed-target-file</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> trimmed-target-dir (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> number) "." "mid"))
                 (<span class="local-name-binding">total-length</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#total-length-of-message-list" title="midi-laml-processing-lib">total-length-of-message-list</a> section))
                 (<span class="local-name-binding">cc-and-pc-section</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#list-part" title="Manual: general">list-part</a> 1 3 section))
                 (<span class="local-name-binding">rest-section</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> section))))
                 (<span class="local-name-binding">first-abs-time</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> rest-section))
                                     (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> rest-section))
                                     #f))
                 (<span class="local-name-binding">time-displaced-rest-section</span> 
                    (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-displace-1" title="midi-laml-processing-lib">time-displace-1</a>  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> first-abs-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> 480 first-abs-time) 480)
                                      rest-section  
                                      ))
                 (<span class="local-name-binding">trimmed-time-displaced-rest-section</span>
                    (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">event-ast</span>)
                              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime event-ast) 
                                 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 480 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> a-length nom (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> denom 4) 480) ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> denom 8) 240) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "unsupported time sig")))))))
                            time-displaced-rest-section)) 
                )
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (file-exists? target-file) (delete-file target-file)) 
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (file-exists? trimmed-target-file) (delete-file trimmed-target-file)) 
            (<a class="applied-name" href="midi-laml-processing-lib-1.html#analyze-arpeggio-for-recording-control!" title="midi-laml-processing-lib">analyze-arpeggio-for-recording-control!</a> number time-displaced-rest-section arp-meta-data)
            (<a class="applied-name" href="midi-laml-processing-lib-1.html#analyze-arpeggio-and-write-results!" title="midi-laml-processing-lib">analyze-arpeggio-and-write-results!</a> meta-target-dir number cc-and-pc-section trimmed-time-displaced-rest-section time-displaced-rest-section arp-meta-data)

            (<a class="schemedoc-name" href="../../../../../lib/man/file-read.html#write-text-file" title="Manual: file-read">write-text-file</a>                                     
                (standard-midi-file-ast-to-bin
                  (StandardMidiFile 'internal:run-action-procedure "false"
                                    midi-header
                                    (MidiTrack 
                                       (Meta 'absTime "0" 'type "81" (tempo= (<a class="applied-name" href="midi-laml-processing-lib-1.html#arp-tempo" title="midi-laml-processing-lib">arp-tempo</a> arp-meta-data)))
                                       (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-comment-abs-time" title="midi-laml-processing-lib">midi-comment-abs-time</a> 0 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "Motif XS Arpeggio number " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> number)))
                                       cc-and-pc-section
                                       time-displaced-rest-section
                                       (Meta 'absTime (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> total-length 960) 'type "47" "")
                                    )))
                target-file)

            (<a class="schemedoc-name" href="../../../../../lib/man/file-read.html#write-text-file" title="Manual: file-read">write-text-file</a>                                     <span class="comment">; Writes the trimmed section                                 </span><br />                (standard-midi-file-ast-to-bin
                  (StandardMidiFile 'internal:run-action-procedure "false"
                                    midi-header
                                    (MidiTrack 
                                       (Meta 'absTime "0" 'type "81" (tempo= (<a class="applied-name" href="midi-laml-processing-lib-1.html#arp-tempo" title="midi-laml-processing-lib">arp-tempo</a> arp-meta-data)))
                                       (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-comment-abs-time" title="midi-laml-processing-lib">midi-comment-abs-time</a> 0 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "Motif XS Arpeggio number " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> number)))
                                       cc-and-pc-section
                                       trimmed-time-displaced-rest-section    
                                       (Meta 'absTime 
                                             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 480 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> a-length nom (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> denom 4) 480) ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> denom 8) 240) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "unsupported time sig")))))
                                             'type "47" "")
                                    )))
                trimmed-target-file)
            )
       )
       sections-2
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> given-number-interval given-number-interval (<a class="schemedoc-name" href="../../../../../lib/man/general.html#number-interval" title="Manual: general">number-interval</a> start-number (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> start-number count -1))))
  )
)

<a name="split-arpeggio-recording-via-pc-recording"></a><a name="split-arpeggio-recording-via-pc-recording"></a><span><a href="../midi-laml-processing-lib.html#split-arpeggio-recording-via-pc-recording"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(split-arpeggio-recording-via-pc-recording source-file-path start-number target-dir-list . optional-parameter-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">expected-length</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1 optional-parameter-list #f))
         (<span class="local-name-binding">given-number-interval</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 2 optional-parameter-list #f))
         (<span class="local-name-binding">target-dir</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> target-dir-list))
         (<span class="local-name-binding">trimmed-target-dir</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> target-dir-list))
         (<span class="local-name-binding">meta-target-dir</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#third" title="Manual: general">third</a> target-dir-list))
         (<span class="local-name-binding">midi-ast</span> (midi-file-to-laml-ast source-file-path 'absTime 0 #f))
         (<span class="local-name-binding">midi-header</span> (MidiHeader 'format "0" 'numberOfTracks "1" 'pulsesPerQuarterNote "480" 'mode "absTime" 'counterTransposition "0"))
         (<span class="local-name-binding">track</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtree" title="Manual: xml-in-laml">ast-subtree</a> midi-ast "MidiTrack" 2))  <span class="comment">; track 2 because the recording happens to be a format 1 midi file.</span><br />         (<span class="local-name-binding">messages</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a> track))
         (<span class="local-name-binding">sections</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#sublist-by-predicate" title="Manual: general">sublist-by-predicate</a> messages (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ast</span> <span class="local-name-binding">prev-ast</span> <span class="local-name-binding">n</span>) (<a class="applied-name" href="midi-laml-processing-lib-1.html#ControlChange?" title="midi-laml-processing-lib">ControlChange?</a> ast 0))))
         (<span class="local-name-binding">sections-1</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> sections))  <span class="comment">; drop the first one</span><br />         (<span class="local-name-binding">sections-2</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">section</span>) 
                             (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">first-mes</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> section))
                                    (<span class="local-name-binding">first-abs-time</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime first-mes)))
                               (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-displace" title="midi-laml-processing-lib">time-displace</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> first-abs-time) section)))
                          sections-1))
         (<span class="local-name-binding">count</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> sections-1))
        )
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> expected-length (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> expected-length count)))
        (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "Expected length: " expected-length "  Actual length: " count))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> given-number-interval (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> expected-length (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> given-number-interval))))
        (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "The explicitly given list has length" (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> given-number-interval) ". The expected length is" expected-length))

    (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX413" title="R5RS Scheme form">for-each</a> 
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">section</span> <span class="local-name-binding">number</span>)  <span class="comment">; section is assumed to start with to ControlChange messages and one ProgramChange message.</span><br />          (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">arp-meta-data</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#get-arpeggio-meta-info" title="midi-laml-processing-lib">get-arpeggio-meta-info</a> number))
                 (<span class="local-name-binding">target-file</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> target-dir (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> number) "." "mid"))
                 (<span class="local-name-binding">total-length</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#total-length-of-message-list" title="midi-laml-processing-lib">total-length-of-message-list</a> section))
                 (<span class="local-name-binding">stretched-section</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-stretch-1" title="midi-laml-processing-lib">time-stretch-1</a> 0.5 section)) <span class="comment">; go from ppqn 960 to 480</span><br />                 (<span class="local-name-binding">cc-and-pc-section</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#list-part" title="Manual: general">list-part</a> 1 3 stretched-section))
                 (<span class="local-name-binding">rest-section</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> stretched-section))))
                 (<span class="local-name-binding">first-abs-time</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> rest-section))
                                     (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> rest-section))
                                     #f))
                )
            (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (file-exists? target-file) (delete-file target-file)) 
            (<a class="applied-name" href="midi-laml-processing-lib-1.html#analyze-arpeggio-for-recording-control!" title="midi-laml-processing-lib">analyze-arpeggio-for-recording-control!</a> number rest-section arp-meta-data)
            (<a class="schemedoc-name" href="../../../../../lib/man/file-read.html#write-text-file" title="Manual: file-read">write-text-file</a> <span class="comment">; There are relevant NoteOn events in the selected channels</span><br />                (standard-midi-file-ast-to-bin
                  (StandardMidiFile 'internal:run-action-procedure "false"
                                    midi-header
                                    (MidiTrack 
                                       (Meta 'absTime "0" 'type "81" (tempo= (<a class="applied-name" href="midi-laml-processing-lib-1.html#arp-tempo" title="midi-laml-processing-lib">arp-tempo</a> arp-meta-data)))
                                       (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-comment-abs-time" title="midi-laml-processing-lib">midi-comment-abs-time</a> 0 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "Motif XS Arpeggio number " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> number)))
                                       cc-and-pc-section
                                       (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-displace-1" title="midi-laml-processing-lib">time-displace-1</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> first-abs-time (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> 480 first-abs-time) 480)
                                         rest-section  
                                       )
                                       (Meta 'absTime (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> total-length 960) 'type "47" "")
                                    )))
                target-file)
            )
       )
       sections-2
       (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> given-number-interval given-number-interval (<a class="schemedoc-name" href="../../../../../lib/man/general.html#number-interval" title="Manual: general">number-interval</a> start-number (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> start-number count -1)))
    )
  )
)

<a name="analyze-arpeggio-for-recording-control!"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(analyze-arpeggio-for-recording-control! arp-number midi-event-list arp-meta-data)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">midi-event-list-1</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> <a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> midi-event-list))
         (<span class="local-name-binding">a-length</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#arp-length" title="midi-laml-processing-lib">arp-length</a> arp-meta-data))
         (<span class="local-name-binding">a-time-sig-str</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#arp-time-sig" title="midi-laml-processing-lib">arp-time-sig</a> arp-meta-data))
         (<span class="local-name-binding">a-time-sig-lst</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#parse-arp-time-signature" title="midi-laml-processing-lib">parse-arp-time-signature</a> a-time-sig-str)) <span class="comment">; to such as (4  4)</span><br />         (<span class="local-name-binding">nom</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> a-time-sig-lst))
         (<span class="local-name-binding">denom</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> a-time-sig-lst))
         (<span class="local-name-binding">last-abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#last" title="Manual: general">last</a> midi-event-list-1) 'absTime))
         (<span class="local-name-binding">ppqn</span> 480)
        )
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> denom 4)
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">required-length</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> nom ppqn a-length))
                 (<span class="local-name-binding">actual-length</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> last-abs-time) 480)))
             (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a>
              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a>
               (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> arp-number) ": "
               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> required-length actual-length) "!!" "  ")
               "Required length: " a-time-sig-str " " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> required-length ) ".  "  "Actual length: " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> actual-length)))))
         ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> denom 8)
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">required-length</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> nom (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX254" title="R5RS Scheme form">/</a> ppqn 2) a-length))
                 (<span class="local-name-binding">actual-length</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> last-abs-time) 480)))
             (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a>
              (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a>
               (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> arp-number) ": "
               (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> required-length actual-length) "!!" "  ")
               "Required length: " "(" a-time-sig-str ")" " " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> required-length ) ".  "  "Actual length: " (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> actual-length)))))
         (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> "Non-fit")))))


<a name="analyze-arpeggio-and-write-results!"></a><span class="comment">; Format of arp analysis meta data:
; (long-enough msb-lsb-pc-voice-info-list number-of-notes number-of-different-notes pc-exprcc-pitchbend-list)</span><br />
<a name="analyze-arpeggio-and-write-results!"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(analyze-arpeggio-and-write-results! target-dir arp-number cc-pc-events trimmed-midi-event-list untrimmed-midi-event-list arp-meta-data)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> (
         (<span class="local-name-binding">nil-if-false</span> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX305" title="R5RS Scheme form">boolean?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> x)) 'nil 't)))
         (<span class="local-name-binding">midi-event-list-1</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> <a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> trimmed-midi-event-list))
         (<span class="local-name-binding">a-length</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#arp-length" title="midi-laml-processing-lib">arp-length</a> arp-meta-data))

         (<span class="local-name-binding">a-time-sig-str</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#arp-time-sig" title="midi-laml-processing-lib">arp-time-sig</a> arp-meta-data))
         (<span class="local-name-binding">a-time-sig-lst</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#parse-arp-time-signature" title="midi-laml-processing-lib">parse-arp-time-signature</a> a-time-sig-str)) <span class="comment">; to such as (4  4)</span><br />         (<span class="local-name-binding">nom</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> a-time-sig-lst))
         (<span class="local-name-binding">denom</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#second" title="Manual: general">second</a> a-time-sig-lst))

         (<span class="local-name-binding">last-abs-time</span> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attribute" title="Manual: xml-in-laml">ast-attribute</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#last" title="Manual: general">last</a> untrimmed-midi-event-list) 'absTime))
         (<span class="local-name-binding">ppqn</span> 480)

         (<span class="local-name-binding">required-length</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> nom ppqn a-length))
         (<span class="local-name-binding">actual-length</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> last-abs-time) 480))

         (<span class="local-name-binding">msb-lsb-pc</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#find-instrument-info-of" title="midi-laml-processing-lib">find-instrument-info-of</a> 1 cc-pc-events))  <span class="comment">; first parameter: channel: all arps are recorded to channel 1.</span><br />         (<span class="local-name-binding">number-of-notes</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> "NoteOn" (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x)))) midi-event-list-1)))
         (<span class="local-name-binding">number-of-different-notes</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#count-number-of-different-notes" title="midi-laml-processing-lib">count-number-of-different-notes</a> midi-event-list-1))
         (<span class="local-name-binding">program-control-changes</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#program-control-change-info" title="midi-laml-processing-lib">program-control-change-info</a> cc-pc-events midi-event-list-1))
        )
   (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">result</span>
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>
                 (nil-if-false (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> required-length actual-length))
                 msb-lsb-pc
                 number-of-notes
                 number-of-different-notes
                 program-control-changes
           )
         )
         (<span class="local-name-binding">target-file</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> target-dir (<a class="schemedoc-name" href="../../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> arp-number) "." "dat"))
        )
     (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (file-exists? target-file) (delete-file target-file))
     (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-write" title="Manual: general">file-write</a> result target-file)
   )
 )
)

<a name="parse-arp-time-signature"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-arp-time-signature time-sig-str)</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="schemedoc-name" href="../../../../../lib/man/general.html#as-number" title="Manual: general">as-number</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#split-string-by-predicate" title="Manual: general">split-string-by-predicate</a> time-sig-str (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span>) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> ch #\/)))))

<a name="cached-arpeggio-list"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">cached-arpeggio-list</span> #f)

<a name="get-arpeggio-meta-info"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(get-arpeggio-meta-info arp-number)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#cached-arpeggio-list" title="midi-laml-processing-lib">cached-arpeggio-list</a> 
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX337" title="R5RS Scheme form">list-ref</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#cached-arpeggio-list" title="midi-laml-processing-lib">cached-arpeggio-list</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> arp-number 1))
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">arp-info-list</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-read" title="Manual: general">file-read</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> midi-software-dir "data/Motif-xs-arps.dat"))))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#cached-arpeggio-list" title="midi-laml-processing-lib">cached-arpeggio-list</a> arp-info-list)
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX337" title="R5RS Scheme form">list-ref</a> arp-info-list (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> arp-number 1)))))

<a name="arp-main-cat"></a><span class="comment">; Arp selectors</span><br />
<a name="arp-main-cat"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">arp-main-cat</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 1 "arp-main-cat"))
<a name="arp-sub-cat"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">arp-sub-cat</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 2 "arp-sub-cat"))
<a name="arp-number"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">arp-number</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 3 "arp-number"))
<a name="arp-role"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">arp-role</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 4 "arp-role"))
<a name="arp-name"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">arp-name</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 5 "arp-name"))
<a name="arp-generation"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">arp-generation</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 6 "arp-generation"))
<a name="arp-time-sig"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">arp-time-sig</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 7 "arp-time-sig"))
<a name="arp-length"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">arp-length</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 8 "arp-lenght"))
<a name="arp-tempo"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">arp-tempo</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 9 "arp-tempo"))
<a name="arp-accent?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">arp-accent?</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 10 "arp-accent?"))
<a name="arp-random-sfx?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">arp-random-sfx?</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 11 "arp-random-sfx?"))
<a name="arp-voice"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">arp-voice</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 12 "arp-voice"))
<a name="arp-voice-specific"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">arp-voice-specific</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#make-selector-function" title="Manual: general">make-selector-function</a> 13 "arp-voice-specific"))


<span class="comment">; ---------------------------------------------------------------------------------------------------------------</span><br /><div class="schemedoc-section-comment">;;; .section-id aux-functions
;;; Auxiliary functions.
;;; Miscellaneous function that are not naturally contained in the categories from above.</div>

<a name="pitch-bend-scale"></a><a name="pitch-bend-scale"></a><span><a href="../midi-laml-processing-lib.html#pitch-bend-scale"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(pitch-bend-scale factor)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">mid-value</span> 8192))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">value</span>)
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a>  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX250" title="R5RS Scheme form">*</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> value mid-value) factor) mid-value))))

<a name="copy-midi-ast-list"></a><span class="comment">; Copy a list of midi ASTs.
; Useful if the same list of Midi ASTs are used several places in a song.
; The out list structure, the AST list structure and the attribute property list structures are copied.
; Strings are not copied.
; Not necessary any more (as of May 15, 2008).</span><br /><a name="copy-midi-ast-list"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(copy-midi-ast-list ast-lst)</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#copy-midi-ast" title="midi-laml-processing-lib">copy-midi-ast</a> ast-lst))

<a name="copy-midi-ast"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(copy-midi-ast x)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> x)
      (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#make-ast" title="Manual: xml-in-laml">make-ast</a>
            (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-element-name" title="Manual: xml-in-laml">ast-element-name</a> x) 
            (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-subtrees" title="Manual: xml-in-laml">ast-subtrees</a> x) 
            (<a class="applied-name" href="midi-laml-processing-lib-1.html#copy-midi-property-list" title="midi-laml-processing-lib">copy-midi-property-list</a> (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-attributes" title="Manual: xml-in-laml">ast-attributes</a> x))
            (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-kind" title="Manual: xml-in-laml">ast-kind</a> x)
            (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-language" title="Manual: xml-in-laml">ast-language</a> x)
            (<a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast-internal-attributes" title="Manual: xml-in-laml">ast-internal-attributes</a> x))
      x))

<a name="copy-midi-property-list"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(copy-midi-property-list plst)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> plst)
      '()
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> plst) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cadr</a> plst) (<a class="applied-name" href="midi-laml-processing-lib-1.html#copy-midi-property-list" title="midi-laml-processing-lib">copy-midi-property-list</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cddr</a> plst))))))

<a name="total-length-of-message-list"></a><a name="total-length-of-message-list"></a><span><a href="../midi-laml-processing-lib.html#total-length-of-message-list"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(total-length-of-message-list message-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">message-list-asts-only</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> <a class="schemedoc-name" href="../../../../../lib/xml-in-laml/man/xml-in-laml.html#ast?" title="Manual: xml-in-laml">ast?</a> message-list)))
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="midi-laml-processing-lib-1.html#abs-time-sequence?" title="midi-laml-processing-lib">abs-time-sequence?</a> message-list) 
           (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">first-message</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#first" title="Manual: general">first</a> message-list-asts-only))
                  (<span class="local-name-binding">last-message</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#last" title="Manual: general">last</a> message-list-asts-only)))
             (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> last-message) (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> first-message))))
        ((<a class="applied-name" href="midi-laml-processing-lib-1.html#delta-time-sequence?" title="midi-laml-processing-lib">delta-time-sequence?</a> message-list)
           (<a class="schemedoc-name" href="../../../../../lib/man/general.html#accumulate-right" title="Manual: general">accumulate-right</a> <a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 0 (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ast</span>) (<a class="applied-name" href="midi-laml-processing-lib-1.html#time-of-message" title="midi-laml-processing-lib">time-of-message</a> ast)) message-list-asts-only)))
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "total-length-of-message-list: Cannot determine time mode of message-list. Is the message-list maybe empty?")))))

<a name="enforce-minimum-message-length"></a><a name="enforce-minimum-message-length"></a><span><a href="../midi-laml-processing-lib.html#enforce-minimum-message-length"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(enforce-minimum-message-length min-length message-list)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">lgt</span> (<a class="applied-name" href="midi-laml-processing-lib-1.html#total-length-of-message-list" title="midi-laml-processing-lib">total-length-of-message-list</a> message-list)))
    (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> lgt min-length)
        (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> 
           message-list 
           (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-null-event-delta-time" title="midi-laml-processing-lib">midi-null-event-delta-time</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> min-length lgt) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "Enforcing of minium length"))))
        message-list)))

<span class="comment">; ---------------------------------------------------------------------------------------------------------------
; Image file names</span><br />
<a name="icon"></a><a name="icon"></a><span><a href="../midi-laml-processing-lib.html#icon"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(icon name)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> name "penguin") "S713")
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> name "butterfly") "S690")
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> name "candle") "S719")
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> name "banana") "S696")
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> name "orange") "S697")
        ((<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> name "lighting") "S718")
        (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> "S713")))  

<span class="comment">; ---------------------------------------------------------------------------------------------------------------</span><br />
<a name="note-complement"></a><a name="note-complement"></a><span><a href="../midi-laml-processing-lib.html#note-complement"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(note-complement note-str-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">note-list</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#string-to-list" title="Manual: general">string-to-list</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#transliterate" title="Manual: general">transliterate</a> note-str-list #\space "") (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> #\,)))
        (<span class="local-name-binding">complement-note-list</span>
          (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">nn</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> nn note-list) #f nn)) note-name-list)))
   (<a class="schemedoc-name" href="../../../../../lib/man/general.html#list-to-string" title="Manual: general">list-to-string</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) x) complement-note-list) ",")))

<a name="chord-complement"></a><a name="chord-complement"></a><span><a href="../midi-laml-processing-lib.html#chord-complement"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(chord-complement chord-str-list)</span>
 (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">chord-list</span> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#string-to-list" title="Manual: general">string-to-list</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#transliterate" title="Manual: general">transliterate</a> chord-str-list #\space "") (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> #\,)))
        (<span class="local-name-binding">complement-chord-list</span>
          (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">cn</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> cn chord-list) #f cn)) chord-name-list)))
   (<a class="schemedoc-name" href="../../../../../lib/man/general.html#list-to-string" title="Manual: general">list-to-string</a> (<a class="schemedoc-name" href="../../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) x) complement-chord-list) ",")))


<span class="comment">; ---------------------------------------------------------------------------------------------------------------
; Drum map - categorization of drum note values.</span><br />
<a name="drum-map-vector"></a><span class="comment">; Drum map vector, starting at index 13</span><br /><a name="drum-map-vector"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">drum-map-vector</span>
  #(latin-percussion latin-percussion others others others others others                                                        <span class="comment">; 13 -19</span><br />    others others others others others snare-drum snare-drum snare-drum snare-drum snare-drum                                   <span class="comment">; 20 - 29</span><br />    latin-high-pitch snare-drum others bass-drum snare-drum bass-drum bass-drum snare-drum snare-drum others                    <span class="comment">; 30 - 39</span><br />    snare-drum tom hi-hat tom hi-hat tom hi-hat tom tom crash-cymbal                                                            <span class="comment">; 40 - 49</span><br />    tom ride-cymbal cymbal ride-cymbal others cymbal others crash-cymbal others ride-cymbal                                     <span class="comment">; 50 - 59</span><br />    latin-percussion latin-percussion latin-percussion latin-percussion latin-percussion                                  <span class="comment">; 60 - 64</span><br />    latin-percussion latin-percussion latin-high-pitch latin-high-pitch latin-high-pitch                                  <span class="comment">; 66 - 69</span><br />    latin-high-pitch latin-high-pitch latin-high-pitch latin-high-pitch latin-high-pitch                                  <span class="comment">; 70 - 74</span><br />    latin-high-pitch latin-high-pitch latin-high-pitch latin-high-pitch latin-high-pitch                                  <span class="comment">; 75 - 79</span><br />    others others latin-high-pitch others others                                                                          <span class="comment">; 80 - 84</span><br />    others others others undefined undefined others others                                                                <span class="comment">; 85 - 91</span><br />   )
)

<a name="drum-category-of-note-value"></a><a name="drum-category-of-note-value"></a><span><a href="../midi-laml-processing-lib.html#drum-category-of-note-value"><img src="../../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(drum-category-of-note-value note-value)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> note-value 13) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> note-value 91))
      (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX404" title="R5RS Scheme form">vector-ref</a> <a class="applied-name" href="midi-laml-processing-lib-1.html#drum-map-vector" title="midi-laml-processing-lib">drum-map-vector</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> note-value 13))
      'undefined)) 

<span class="comment">; ---------------------------------------------------------------------------------------------------------------</span><br />
<a name="get-fixed-part-from-to-abstime"></a><span class="comment">; A function used internally by a MIDL template, as used by MIDI LAML Emacs list support - for playing including the fixed part.</span><br /><a name="get-fixed-part-from-to-abstime"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(get-fixed-part-from-to-abstime the-fixed-part-full-path first-abs-time last-abs-time)</span>
  (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">fixed-part-ast-list</span> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> uncompact-midi-laml-entry (<a class="schemedoc-name" href="../../../../../lib/man/general.html#file-read" title="Manual: general">file-read</a> the-fixed-part-full-path))))
    (<a class="applied-name" href="midi-laml-processing-lib-1.html#filter-messages-1" title="midi-laml-processing-lib">filter-messages-1</a> 
      (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">m</span>) (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime m) first-abs-time) (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi" title="midi-laml-processing-lib">midi</a> 'absTime m) last-abs-time)))
      fixed-part-ast-list)
  )
)

<a name="end-sectional-playing"></a><span class="comment">; Returns the ending part of Emacs MIDI LAML sectional playing. Used in some of the MIDI LAML templates.</span><br /><a name="end-sectional-playing"></a><span></span>(<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(end-sectional-playing delta-time)</span>
  (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a>
     (<a class="applied-name" href="midi-laml-processing-lib-1.html#midi-comment-delta-time" title="midi-laml-processing-lib">midi-comment-delta-time</a> delta-time "Ending part starts here")

     <span class="comment">; Reset sustain in all channels</span><br />     (<a class="scheme-procedure-name" href="../../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span>) 
             (ControlChange 'deltaTime "0" 'channel ch 'control "64" 'value "0"))
          (<a class="schemedoc-name" href="../../../../../lib/man/general.html#number-interval" title="Manual: general">number-interval</a> 1 16))
   
     <span class="comment">; End of track message</span><br />     (Meta 'deltaTime "10" 'type "47" "")
  ) 
)



</pre></font><div>&nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p></div></body></html>
<html><head><link href="stylesheets/documentation.css" rel="stylesheet" title="documentation" type="text/css" /> <title>documentation</title></head><body bgcolor="#ffecd9" text="#000000" link="#000000" vlink="#000000"><a name="START"></a><h1><font color="#0000ff">XML mirrors in Scheme: XML in LAML</font></h1><h3><span>Kurt N&#248;rmark   &copy;</span> &nbsp; &nbsp; normark@cs.aau.dk <br /> Department of Computer Science, Aalborg University</h3><p></p><div class="elucidator-abstract"><b>Abstract.</b> <p>This is the chapter in which you learn how to make a mirror of an XML language, which is formally defined via a Document Type Definition (DTD).</p> <p>The LAML DTD parser and the XML-in-LAML mirror generation stuff is made available in the LAML distribution from version 19.00.</p> <p><a href="../../../examples/xml-in-laml-transformation/index.html" target="xml-trans">Some of the other XML transformation examples</a>,  not addressed in this tutorial, are also available.</p></div><div>&nbsp; <p></p></div><div class="elucidator-section"><a name="intro"></a><div><a href="documentation.html#START"><img src="./images/small-up.gif" title="" alt="" border="0" /></a> <img src="./images/small-prev-blind.gif" title="" alt="" border="0" /> <a href="documentation.html#dtd-sec"><img src="./images/small-next.gif" title="The DTD" alt="" border="0" /></a></div><div><b><font size="5"><span>1 &nbsp; &nbsp; Introduction</span></font></b></div><div class="body-normal"><p>The starting point of this part of the tutorial is a standard XML Document Type Definition - also known as a DTD. We will see how to parse it using the LAML DTD parser. After that we will generate a fully validating Scheme mirror of the DTD, and we will see how to make use of the XML language in Scheme and LAML.</p></div><div style="margin-left:10px;"><font size="2"><span>1.1 &nbsp; &nbsp; <a href="documentation.html#overview" target="documentation-frame"><font color="#000000">Overview</font></a></span></font> <br /></div></div><div>&nbsp; <p></p></div><div class="elucidator-entry"><a name="overview"></a><div class="elucidator-entry-head"><a href="documentation.html#intro"><img src="./images/small-up.gif" title="Introduction" alt="" border="0" /></a> <img src="./images/small-prev-blind.gif" title="" alt="" border="0" /> <img src="./images/small-next-blind.gif" title="" alt="" border="0" />  <br /> <b><font size="4"><span>1.1 &nbsp; &nbsp; Overview</span></font></b></div><div class="body-normal"><p>The example we will study is written in a very simple XML language for description of a bike. This is not a very interesting examples. In fact, we have a number of examples around which would more interesting, see for instance the DTDs of the <a href="../../../examples/xml-in-laml-transformation/index.html">transformation examples</a>.</p> <p>We define the grammar (DTD) of the language in <a class="documentation-reference" href="documentation.html#dtd" target="documentation-frame" title="The DTD">2.1</a>, parse it in <a class="documentation-reference" href="documentation.html#dtd-parsing" target="documentation-frame" title="Parsing the DTD">2.2</a>, and we make a mirror of it in Scheme (see <a class="documentation-reference" href="documentation.html#mirror-making" target="documentation-frame" title="Making the mirror">3.1</a> ). The major efforts is here to define a validation predicate for one of the elements in the language, see validation.</p> <p>In <a class="documentation-reference" href="documentation.html#mirror-trans" target="documentation-frame" title="Transformation of the mirror AST">4.1</a> we illustrate how to make a simple transformation of a bike document to XHTML</p> <p>Finally, in <a class="documentation-reference" href="documentation.html#mirror-use" target="documentation-frame" title="Using the mirror">5.1</a> we study a couple of bike documents and their transformations to XHTML.</p> <p>All the examples source files are available in the <a href="../../../examples/tutorial/xml-in-laml/index.html" target="examples">tutorial/xml-in-laml</a> directory of the LAML examples.</p></div></div><div class="elucidator-section"><a name="dtd-sec"></a><div><a href="documentation.html#START"><img src="./images/small-up.gif" title="" alt="" border="0" /></a> <a href="documentation.html#intro"><img src="./images/small-prev.gif" title="Introduction" alt="" border="0" /></a> <a href="documentation.html#mirror-sec"><img src="./images/small-next.gif" title="Mirror synthesis" alt="" border="0" /></a></div><div><b><font size="5"><span>2 &nbsp; &nbsp; The DTD</span></font></b></div><div class="body-normal"><p>We start by defining and parsing the DTD</p></div><div style="margin-left:10px;"><font size="2"><span>2.1 &nbsp; &nbsp; <a href="documentation.html#dtd" target="documentation-frame"><font color="#000000">The DTD</font></a></span></font> <br /> <font size="2"><span>2.2 &nbsp; &nbsp; <a href="documentation.html#dtd-parsing" target="documentation-frame"><font color="#000000">Parsing the DTD</font></a></span></font> <br /></div></div><div>&nbsp; <p></p></div><div class="elucidator-entry"><a name="dtd"></a><div class="elucidator-entry-head"><a href="documentation.html#dtd-sec"><img src="./images/small-up.gif" title="The DTD" alt="" border="0" /></a> <img src="./images/small-prev-blind.gif" title="" alt="" border="0" /> <a href="documentation.html#dtd-parsing"><img src="./images/small-next.gif" title="Parsing the DTD" alt="" border="0" /></a>  <br /> <b><font size="4"><span>2.1 &nbsp; &nbsp; The DTD</span></font></b></div><div class="body-normal"><p>The bikes document type definition (DTD) is the first to be constructed. Indeed, it is very simple; We have written it for purposes and for this tutorial. It is not used in other contexts. The DTD is here:</p> <div style="margin-left:5px;"><table border="0"><tbody><tr><td width="*" valign="bottom" bgcolor="#caf0b3"><pre><font size="2">&lt;!ENTITY % Number &quot;CDATA&quot;&gt;
    &lt;!-- one or more digits --&gt;

&lt;!ENTITY % Boolean &quot;(true | false)&quot;&gt;
    &lt;!--  spaces --&gt;



&lt;!ELEMENT bikes (bike)*&gt;
&lt;!ATTLIST bikes
&gt;

&lt;!ELEMENT bike (frame, wheel+, brake*, lock*)&gt;
&lt;!ATTLIST bike
  kind   (mountain-bike, racer-bike, tourist-bike, other)  &quot;tourist-bike&quot;
&gt;

&lt;!ELEMENT frame EMPTY&gt;

&lt;!ATTLIST frame
  frame-number CDATA #REQUIRED
&gt;

&lt;!ELEMENT wheel EMPTY&gt;

&lt;!ATTLIST wheel
  size        %Number; #REQUIRED
  tube-kind   CDATA    #IMPLIED
&gt;

&lt;!ELEMENT brake EMPTY&gt;

&lt;!ATTLIST brake
  kind    CDATA   #IMPLIED
  brand   CDATA   #IMPLIED
&gt;

&lt;!ELEMENT lock EMPTY&gt;

&lt;!ATTLIST lock
  brand   CDATA   #IMPLIED
  insurance-approved  %Boolean; #REQUIRED
&gt;

</font></pre></td></tr></tbody></table></div> <p>If you wish, you can bring the DTD up in the right frame of this elucidator by clicking  <a href="../../../examples/tutorial/xml-in-laml/dtds/bikes/bikes-dtd.html" target="program-frame">here</a> .</p> <p>Let us briefly explain what the DTD means. - The first two clauses are entities. Basically, you can think of them as textual macros named &#39;Number&#39; and &#39;Boolean&#39;. DTDs are weak with respect to pre-defined types. Therefore it is common to introduce some ad hoc types in the way we have done it in <kbd>bikes.dtd</kbd>. Entities should, in addition, be used whenever you need to use the same fragment of text more than once.</p> <p>Next we encounter the elements and the attributes. The elements define a conventional context free grammar. We see that <kbd>bikes</kbd> consist of zero, one, or more <kbd>bike</kbd> clauses. In turn, a single bike clause is an aggregation of a <kbd>frame</kbd>, one or more <kbd>wheels</kbd>, zero or more <kbd>brakes</kbd>, and zero or more <kbd>locks</kbd>. Both <kbd>frame</kbd>, <kbd>wheel</kbd>, <kbd>brake</kbd>, and <kbd>lock</kbd> are terminal concepts. In DTD parlance, they are EMPTY elements. All of them have a number of attributes, however.</p></div></div><div class="elucidator-entry"><a name="dtd-parsing"></a><div class="elucidator-entry-head"><a href="documentation.html#dtd-sec"><img src="./images/small-up.gif" title="The DTD" alt="" border="0" /></a> <a href="documentation.html#dtd"><img src="./images/small-prev.gif" title="The DTD" alt="" border="0" /></a> <img src="./images/small-next-blind.gif" title="" alt="" border="0" />  <br /> <b><font size="4"><span>2.2 &nbsp; &nbsp; Parsing the DTD</span></font></b></div><div class="body-normal"><p>It must be stressed that the LAML DTD parser is an ad hoc parser, which does not recognize all aspects of a DTD. However, it is good enough to handle all the XHTML DTDs (strict, transitional, frameset), the SVG DTD, as well as the DTD we have made in the scope of the LAML project. Early versions of the parser (which are not part of the LAML distributions) have also been used to parse the HTML4.01 DTD (which is a non-XML DTD).</p> <p>In order to use the information in the DTD it is necessary to parse it. I.e., the natural structure of the DTD needs to be revealed and represented in some kind of hierarchical structure.</p> <p>The central parsing command is <a class="manual-reference" href="../../../tools/dtd-parser/man/dtd-parser.html#parse-dtd" target="program-frame" title="Manual: dtd-parser">parse-dtd</a>. This procedure can be called from a Scheme prompt if the &#39;appropriate software&#39; is loaded. We find it easier to make a little <em>script</em> that first loads the software and next calls <a class="manual-reference" href="../../../tools/dtd-parser/man/dtd-parser.html#parse-dtd" target="program-frame" title="Manual: dtd-parser">parse-dtd</a>. The parsing script is <a class="program-file-reference-strong" href="parsing-script-1-LARGE.html" target="program-frame" title="Link to program file: parsing-script">parsing-script</a>. After loading <a class="manual-file-reference-strong" href="../../../man/laml.html" target="program-frame" title="Link to SchmeDoc manual: laml">laml</a> and the DTD parser from the <kbd>tools/dtd-parser</kbd> directory of the LAML distribution, the <a class="manual-reference" href="../../../tools/dtd-parser/man/dtd-parser.html#parse-dtd" target="program-frame" title="Manual: dtd-parser">parse-dtd</a> function is called with the proper name of the dtd file as input.</p> <p>As the result, the DTD parser writes a file <kbd>bikes.lsp</kbd> - <a class="program-file-reference-strong" href="parsed-bikes-dtd-raw-1-LARGE.html" target="program-frame" title="Link to program file: parsed-bikes-dtd-raw">parsed-bikes-dtd-raw</a> - which contains the parsed DTD data structure. No kind of pretty printing is performed, so at the first glance the result may be difficult to grasp. To make it a little easier to understand we provide a somewhat pretty printed version of <kbd>bikes.lsp</kbd>  in <a class="program-file-reference-strong" href="parsed-bikes-dtd-1-LARGE.html" target="program-frame" title="Link to program file: parsed-bikes-dtd">parsed-bikes-dtd</a> (made, in part, by using the LAML Scheme pretty printer <a class="manual-reference" href="../../../man/laml.html#scheme-pp" target="program-frame" title="Manual: laml">scheme-pp</a> on the file). One of the main things to notice is the contents models in the element clauses. This is element number five in each of the <kbd>element</kbd> forms. The element content model is a symbol (empty or any) or a list structure prefixed by either element-content or mixed-content). The symbol or list is a natural and straightforward Lisp representation of the content model, as defined in <a href="http://www.w3.org/TR/REC-xml#elemdecls" target="XML">section 3.2</a> or the XML1.0 Recommendation. As examples, the parsed representation of the <kbd>bikes</kbd> and <kbd>bike</kbd> elements are</p> <ul><pre>(element-content (seq zero-or-more (name one &quot;bike&quot;)))</pre> <pre>
 (element-content
  (seq
   one
   (name one &quot;frame&quot;)
   (name one-or-more &quot;wheel&quot;)
   (name zero-or-more &quot;brake&quot;)
   (name zero-or-more &quot;lock&quot;)))</pre></ul> <p>respectively.</p> <p>You should read section 1 of <a class="manual-file-reference-weak" href="../../../tools/dtd-parser/man/dtd-parser.html" target="program-frame" title="Link to SchmeDoc manual: dtd-parser">dtd-parser</a> for additional details about the format of the parsed DTD file.</p></div></div><div class="elucidator-section"><a name="mirror-sec"></a><div><a href="documentation.html#START"><img src="./images/small-up.gif" title="" alt="" border="0" /></a> <a href="documentation.html#dtd-sec"><img src="./images/small-prev.gif" title="The DTD" alt="" border="0" /></a> <a href="documentation.html#mirror-trans-sect"><img src="./images/small-next.gif" title="Transformation of the mirror AST" alt="" border="0" /></a></div><div><b><font size="5"><span>3 &nbsp; &nbsp; Mirror synthesis</span></font></b></div><div class="body-normal"><p>In this section we will describe how to make the mirror of the  <kbd>bikes</kbd>  language in Scheme.</p></div><div style="margin-left:10px;"><font size="2"><span>3.1 &nbsp; &nbsp; <a href="documentation.html#mirror-making" target="documentation-frame"><font color="#000000">Making the mirror</font></a></span></font> <br /> <font size="2"><span>3.2 &nbsp; &nbsp; <a href="documentation.html#mirror-making-sec" target="documentation-frame"><font color="#000000">The resulting mirror</font></a></span></font> <br /></div></div><div>&nbsp; <p></p></div><div class="elucidator-entry"><a name="mirror-making"></a><div class="elucidator-entry-head"><a href="documentation.html#mirror-sec"><img src="./images/small-up.gif" title="Mirror synthesis" alt="" border="0" /></a> <img src="./images/small-prev-blind.gif" title="" alt="" border="0" /> <a href="documentation.html#mirror-making-sec"><img src="./images/small-next.gif" title="The resulting mirror" alt="" border="0" /></a>  <br /> <b><font size="4"><span>3.1 &nbsp; &nbsp; Making the mirror</span></font></b></div><div class="body-normal"><p>Given the parsed DTD from above it is easy to synthesize a fully validating mirror of XML language in Scheme. Stated in simple terms, we go for a one-to-one mapping between elements of the DTD and functions in Scheme. Thus, for each element in the XML language there will be a <em>mirror function</em> in Scheme.</p> <p>As we did for parsing, we also make a simple script which activates the mirror synthesizer. This is <a class="program-file-reference-strong" href="mirroring-script-1-LARGE.html" target="program-frame" title="Link to program file: mirroring-script">mirroring-script</a>.</p> <p>We explain it briefly. After initial loading of <a class="manual-file-reference-weak" href="../../../man/laml.html" target="program-frame" title="Link to SchmeDoc manual: laml">laml</a> and <a class="manual-file-reference-strong" href="../../../tools/xml-in-laml/man/xml-in-laml.html" target="program-frame" title="Link to SchmeDoc manual: tools-xml-in-laml">tools-xml-in-laml</a> we set the tools parameters in the section of the script called <a class="program-reference-strong" href="mirroring-script-1-LARGE.html#tool-parameters" target="program-frame" title="mirroring-script">tool-parameters</a> . All these parameters are described in <a class="manual-file-reference-weak" href="../../../man/laml.html#SECTION1" target="program-frame" title="Link to SchmeDoc manual: laml">Section 1 of laml.scm</a>. We give the name of the mirror (<a class="program-reference-weak" href="mirroring-script-1-LARGE.html#mirror-name" target="program-frame" title="mirroring-script">mirror-name</a>), a full path to the parsed dtd (<a class="program-reference-weak" href="mirroring-script-1-LARGE.html#parsed-dtd-path" target="program-frame" title="mirroring-script">parsed-dtd-path</a>), and the full path of the mirror target directory ( <a class="program-reference-weak" href="mirroring-script-1-LARGE.html#mirror-target-dir" target="program-frame" title="mirroring-script">mirror-target-dir</a> ).</p> <p>The main mirror generation procedure is <a class="manual-reference" href="../../../tools/xml-in-laml/man/xml-in-laml.html#generate-mirror" target="program-frame" title="Manual: xml-in-laml">generate-mirror</a> from <a class="manual-file-reference-weak" href="../../../tools/xml-in-laml/man/xml-in-laml.html" target="program-frame" title="Link to SchmeDoc manual: tools-xml-in-laml">tools-xml-in-laml</a>. Please click on the name to learn about its formal parameters. See also the activation of <a class="manual-reference" href="../../../tools/xml-in-laml/man/xml-in-laml.html#generate-mirror" target="program-frame" title="Manual: xml-in-laml">generate-mirror</a> and the actual parameters in the section of the script called <a class="program-reference-strong" href="mirroring-script-1-LARGE.html#tool-activation" target="program-frame" title="mirroring-script">tool-activation</a>.</p> <p>The  <em>action element</em>   <kbd>bikes</kbd>  is the root element in a  <kbd>bikes</kbd>  document. See section  <a class="documentation-reference" href="documentation.html#mirror-use" target="documentation-frame" title="Using the mirror">5.1</a>  for an example of such a document. The consequence of announcing the  <kbd>bikes</kbd>  element as an action element is that a procedures  <kbd>bikes!</kbd>  will be called with the purpose of initiating some kind of transformation of the bike ast - see section  <a class="documentation-reference" href="documentation.html#mirror-trans-sect" target="documentation-frame" title="Transformation of the mirror AST">4</a> .</p> <p>Notice also the default language properties, described in section 2 of <a class="manual-file-reference-strong" href="../../../tools/xml-in-laml/man/xml-in-laml.html#Section 2 of tools/xml-in-laml.scm" target="program-frame" title="Link to SchmeDoc manual: tools-xml-in-laml">tools-xml-in-laml</a>. In case the default default values do not fit your needs, you can change the defaults before <a class="manual-reference" href="../../../tools/xml-in-laml/man/xml-in-laml.html#generate-mirror" target="program-frame" title="Manual: xml-in-laml">generate-mirror</a> is called. Please read <a class="manual-file-reference-strong" href="../../../tools/xml-in-laml/man/xml-in-laml.html#SECTION2" target="program-frame" title="Link to SchmeDoc manual: tools-xml-in-laml">Section 2 of tools/xml-in-laml.scm</a>. The values of the variables are strings, which are inserted in the synthesized mirror library. This aspect of the mirror synthesis is a little primitive, and we may be able to improve it in a future version.</p></div></div><div class="elucidator-entry"><a name="mirror-making-sec"></a><div class="elucidator-entry-head"><a href="documentation.html#mirror-sec"><img src="./images/small-up.gif" title="Mirror synthesis" alt="" border="0" /></a> <a href="documentation.html#mirror-making"><img src="./images/small-prev.gif" title="Making the mirror" alt="" border="0" /></a> <img src="./images/small-next-blind.gif" title="" alt="" border="0" />  <br /> <b><font size="4"><span>3.2 &nbsp; &nbsp; The resulting mirror</span></font></b></div><div class="body-normal"><p>In earlier versions of LAML the DTD author should be prepared to write som of the XML validation predicates manually. From version 20, this is all fully automated.</p> <p>It is now time to take a look at the generated mirror. As many other auto-generated programs it is not really intended to be read. More important, you should never edit it!</p> <p>Take a look at the mirror in <a class="program-file-reference-strong" href="bikes-mirror-1-LARGE.html" target="program-frame" title="Link to program file: bikes-mirror">bikes-mirror</a>. There are two sections:</p> <ol><li>The validation procedures starting with <a class="program-reference-weak" href="bikes-mirror-1-LARGE.html#bikes-bike-management-laml-validate!" target="program-frame" title="bikes-mirror">bikes-bike-management-laml-validate!</a>. The vectors inside some of the the validation procedures represent the automatically generated final state automata, as provided and supported by the library <a class="manual-file-reference-strong" href="../../../lib/man/final-state-automaton.html" target="program-frame" title="Link to SchmeDoc manual: finite-state">Finite State Automaton library</a>.</li> <li>The mirror functions starting with  <a class="program-reference-weak" href="bikes-mirror-1-LARGE.html#bikes" target="program-frame" title="bikes-mirror">bikes</a>.</li></ol> <p>For convenience we usually make a LAML style function for easy loading of software which belongs to a given XML-in-LAML language. These styles are located in <kbd>styles/xml-in-laml/</kbd> in the LAML distribution. The <kbd>bikes.scm</kbd> LAML style can be seen in <a class="program-file-reference-strong" href="bikes-style-1-LARGE.html" target="program-frame" title="Link to program file: bikes-style">bikes-style</a>. Notice that the definition of the action procedure of bike, called <a class="program-reference-weak" href="bikes-style-1-LARGE.html#bikes!" target="program-frame" title="bikes-style">bikes!</a> is defined here. It <b>must</b> be defined <em>before</em> the generated mirror functions are loaded. In this file we also program the appropriate transformations of a bikes AST. This is the theme of section <a class="documentation-reference" href="documentation.html#mirror-trans-sect" target="documentation-frame" title="Transformation of the mirror AST">4</a>.</p> <p>At this point in time it will be possible to play with <kbd>bikes</kbd> documents in Scheme/LAML syntax. If you are curious, you can already now jump to section <a class="documentation-reference" href="documentation.html#mirror-use-sec" target="documentation-frame" title="Mirror usage">5</a>.</p></div></div><div class="elucidator-section"><a name="mirror-trans-sect"></a><div><a href="documentation.html#START"><img src="./images/small-up.gif" title="" alt="" border="0" /></a> <a href="documentation.html#mirror-sec"><img src="./images/small-prev.gif" title="Mirror synthesis" alt="" border="0" /></a> <a href="documentation.html#mirror-use-sec"><img src="./images/small-next.gif" title="Mirror usage" alt="" border="0" /></a></div><div><b><font size="5"><span>4 &nbsp; &nbsp; Transformation of the mirror AST</span></font></b></div><div class="body-normal"><p>In this section we will study a simple transformation of a bikes AST.</p></div><div style="margin-left:10px;"><font size="2"><span>4.1 &nbsp; &nbsp; <a href="documentation.html#mirror-trans" target="documentation-frame"><font color="#000000">Transformation of the mirror AST</font></a></span></font> <br /></div></div><div>&nbsp; <p></p></div><div class="elucidator-entry"><a name="mirror-trans"></a><div class="elucidator-entry-head"><a href="documentation.html#mirror-trans-sect"><img src="./images/small-up.gif" title="Transformation of the mirror AST" alt="" border="0" /></a> <img src="./images/small-prev-blind.gif" title="" alt="" border="0" /> <img src="./images/small-next-blind.gif" title="" alt="" border="0" />  <br /> <b><font size="4"><span>4.1 &nbsp; &nbsp; Transformation of the mirror AST</span></font></b></div><div class="body-normal"><p>At this point we are able to construct a bike AST. In order to make it useful, we must somehow transform the AST - typically to an HTML page. We will here see a very simple example of a transformation which illustrates some useful LAML function for these purposes.</p> <p>The <a class="program-file-reference-strong" href="bikes-1-1-LARGE.html" target="program-frame" title="Link to program file: bikes-1">bikes-1</a> document gives rise to an abstract syntax tree. Normally, we do not look at the internal list representation of such a tree. It may, however, be instructive to see what it looks like, see <a class="program-file-reference-strong" href="bikes-1-ast-1-LARGE.html" target="program-frame" title="Link to program file: bikes-1-ast">bikes-1-ast</a>. The boolean #t constants are white space markers, and really of no relevance for the bikes language. (You may get rid of the white space markers once and for all via definition of <a class="manual-reference" href="../../../tools/xml-in-laml/man/xml-in-laml.html#default-xml-represent-white-space" target="program-frame" title="Manual: xml-in-laml">default-xml-represent-white-space</a> ).</p> <p>The <a class="manual-file-reference-weak" href="../../../lib/xml-in-laml/man/xml-in-laml.html" target="program-frame" title="Link to SchmeDoc manual: xml-in-laml">xml-in-laml</a> library, which is shared between all the XML-in-LAML languages, defines functions for constructing and accessing abstract syntax trees (see <a class="manual-file-reference-weak" href="../../../lib/xml-in-laml/man/xml-in-laml.html#ast-cons-sel" target="program-frame" title="Link to SchmeDoc manual: xml-in-laml">section 4</a>).</p> <p>We program the transformation functions in the bikes style file <a class="program-file-reference-strong" href="bikes-style-1-LARGE.html" target="program-frame" title="Link to program file: bikes-style">bikes-style</a> which - for support of this tutorial - is located in the <kbd>styles/xml-in-laml/tutorials-and-demos/</kbd> directory of the LAML distribution. The transformation is initiated in the action procedure of the bikes element called <a class="program-reference-strong" href="bikes-style-1-LARGE.html#bikes!" target="program-frame" title="bikes-style">bikes!</a>. This procedure writes a HTML file via use of the <a class="manual-reference" href="../../../man/laml.html#write-html" target="program-frame" title="Manual: laml">write-html</a> procedure from <a class="manual-file-reference-strong" href="../../../man/laml.html" target="program-frame" title="Link to SchmeDoc manual: laml">laml</a>. In the procedure <a class="program-reference-strong" href="bikes-style-1-LARGE.html#bikes!" target="program-frame" title="bikes-style">bikes!</a> we traverse the <kbd>bikes</kbd> AST in order to locate the <kbd>bike</kbd> subclauses (<span><a href="bikes-style-1-LARGE.html#bikes!-@a" target="program-frame"><img src="./images/source-mark-red.gif" title="A link to a program source marker in bikes!" alt="" border="0" /></a><a name="mirror-trans-@a"></a></span>). The <a class="manual-reference" href="../../../lib/xml-in-laml/man/xml-in-laml.html#traverse-and-collect-all-from-ast" target="program-frame" title="Manual: xml-in-laml">traverse-and-collect-all-from-ast</a> function applies the <a class="program-reference-weak" href="bikes-style-1-LARGE.html#bike-table" target="program-frame" title="bikes-style">bike-table</a> function on each <kbd>bike</kbd> clause. The resulting HTML document can be seen <a href="../../../examples/tutorial/xml-in-laml/documents/bikes/bikes-1.html" target="html-doc">here</a>. At the HTML level the bikes style uses XHTML 1.0 transitional, and the HTML file is written in pretty printed mode. You can take a look at the HTML source via the &#39;view source&#39; in your browser.</p> <p>The function <a class="program-reference-strong" href="bikes-style-1-LARGE.html#bike-table" target="program-frame" title="bikes-style">bike-table</a> accesses some of the constituents of a <kbd>bike</kbd> clause, and in in turn some of their attributes. The function returns a list of <a class="manual-reference" href="../../../lib/xml-in-laml/mirrors/man/xhtml10-transitional-mirror.html#tr" target="program-frame" title="Manual: xhtml10-transitional-mirror">tr</a> elements, which in <a class="program-reference-strong" href="bikes-style-1-LARGE.html#bikes!" target="program-frame" title="bikes-style">bikes!</a> conveniently can be passed to a modified (<span><a href="bikes-style-1-LARGE.html#bikes!-@b" target="program-frame"><img src="./images/source-mark-green.gif" title="A link to a program source marker in bikes!" alt="" border="0" /></a><a name="mirror-trans-@b"></a></span>) XHTML table mirror function.</p> <p>Notice that <a class="program-file-reference-strong" href="bikes-style-1-LARGE.html" target="program-frame" title="Link to program file: bikes-style">bikes-style</a> loads the XHTML transitional mirror, <a class="program-reference-strong" href="bikes-style-1-LARGE.html#xhtml-loading" target="program-frame" title="bikes-style">xhtml-loading</a>, such that the resulting transformation returns an XHTML document. In case of XHTML validation problem, you will get warnings.</p></div></div><div class="elucidator-section"><a name="mirror-use-sec"></a><div><a href="documentation.html#START"><img src="./images/small-up.gif" title="" alt="" border="0" /></a> <a href="documentation.html#mirror-trans-sect"><img src="./images/small-prev.gif" title="Transformation of the mirror AST" alt="" border="0" /></a> <a href="documentation.html#summary"><img src="./images/small-next.gif" title="Summary" alt="" border="0" /></a></div><div><b><font size="5"><span>5 &nbsp; &nbsp; Mirror usage</span></font></b></div><div class="body-normal"><p>In this section we will look at an example usage of the generated mirror functions.</p></div><div style="margin-left:10px;"><font size="2"><span>5.1 &nbsp; &nbsp; <a href="documentation.html#mirror-use" target="documentation-frame"><font color="#000000">Using the mirror</font></a></span></font> <br /></div></div><div>&nbsp; <p></p></div><div class="elucidator-entry"><a name="mirror-use"></a><div class="elucidator-entry-head"><a href="documentation.html#mirror-use-sec"><img src="./images/small-up.gif" title="Mirror usage" alt="" border="0" /></a> <img src="./images/small-prev-blind.gif" title="" alt="" border="0" /> <img src="./images/small-next-blind.gif" title="" alt="" border="0" />  <br /> <b><font size="4"><span>5.1 &nbsp; &nbsp; Using the mirror</span></font></b></div><div class="body-normal"><p>Let us look at a couple of bikes documents, see <a class="program-file-reference-strong" href="bikes-1-1-LARGE.html" target="program-frame" title="Link to program file: bikes-1">bikes-1</a> and <a class="program-file-reference-strong" href="bikes-2-1-LARGE.html" target="program-frame" title="Link to program file: bikes-2">bikes-2</a>. In both we first load <kbd>laml.scm</kbd> and then the bikes style, which we discussed in section <a class="documentation-reference" href="documentation.html#mirror-making-sec" target="documentation-frame" title="The resulting mirror">3.2</a> and <a class="documentation-reference" href="documentation.html#mirror-trans-sect" target="documentation-frame" title="Transformation of the mirror AST">4</a>.</p> <p>In <a class="program-file-reference-strong" href="bikes-1-1-LARGE.html" target="program-frame" title="Link to program file: bikes-1">bikes-1</a> we see a bikes clause with two bike clauses. The document is valid relative to the DTD. The generated HTML document is <a href="../../../examples/tutorial/xml-in-laml/documents/bikes/bikes-1.html" target="html-doc">here</a>.</p> <p>In <a class="program-file-reference-strong" href="bikes-2-1-LARGE.html" target="program-frame" title="Link to program file: bikes-2">bikes-2</a> we also see a bikes clause with two bike clauses. This document is <b>invalid,</b> however. When we process it we get several validation errors, relative to the bikes DTD. The error report looks like:</p> <font size="2"><pre>
LAML Emacs Processing
Welcome to MzScheme version 101, Copyright (c) 1995-99 PLT (Matthew Flatt)
XML Warning: The XML attribute  tube-kind-attribute  is not valid in the wheel element.
XML Warning: Encountered a misplaced frame in a bike construct: 
    &amp;lt;frame frame-number=&quot;IQ7W36-56&quot;/&amp;gt; SPACE &amp;lt;wheel size=&quot;25&quot; tube-kind-attribute=&quot;standard&quot;/&amp;gt; SPACE &amp;lt;wheel size=&quot;25&quot; tube-kind=&quot;standa...
XML Warning: Encountered a misplaced lock in a bike construct: 
    &amp;lt;lock brand=&quot;basta&quot; insurance-approved=&quot;true&quot;/&amp;gt; SPACE &amp;lt;frame frame-number=&quot;IQ98T33-00&quot;/&amp;gt; SPACE &amp;lt;wheel size=&quot;22&quot; tube-kind=&quot;standar...</pre></font> <p>Therefore we cannot (and should not) transform it to an HTML document.</p></div></div><div class="elucidator-section"><a name="summary"></a><div><a href="documentation.html#START"><img src="./images/small-up.gif" title="" alt="" border="0" /></a> <a href="documentation.html#mirror-use-sec"><img src="./images/small-prev.gif" title="Mirror usage" alt="" border="0" /></a> <img src="./images/small-next-blind.gif" title="" alt="" border="0" /></div><div><b><font size="5"><span>6 &nbsp; &nbsp; Summary</span></font></b></div><div class="body-normal"><p>To summarize, the major work is two-fold. First an XML DTD has to be written. Second, the transformation of a document in the new XML language to HTML has to be programmed - in Scheme. The DTD parsing and mirror synthesis (including full XML validation) is done automatically. </p> <p>You are invited to study <a href="../../../examples/xml-in-laml-transformation/index.html" target="xml-trans">some of the other XML transformation examples</a> together with the accompanying paper called <a href="http://www.cs.auc.dk/~normark/laml/papers/xml-transformations.pdf" target="paper"><em>XML Transformations in Scheme with LAML - a Minimalistic Approach</em></a>.</p></div><div style="margin-left:10px;"></div></div><div>&nbsp; <p></p></div><div>&nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p></div></body></html>
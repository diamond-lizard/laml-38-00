<html><head><title>Source file</title></head><body bgcolor = "#ffffff" text = "#000000" link = "#000000" vlink = "#000000"  ><font size = "2"  ><pre><span class = "comment"  >;The LAML library and programs written by Kurt Normark, Aalborg University, Denmark.
; Copyright (C) 1999  Kurt Normark.
;
; This program is free software; you can redistribute it and/or modify
; it under the terms of the GNU General Public License as published by
; the Free Software Foundation; either version 2 of the License, or
; (at your option) any later version.
;
; This program is distributed in the hope that it will be useful,
; but WITHOUT ANY WARRANTY; without even the implied warranty of
; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
; GNU General Public License for more details.
;
; You should have received a copy of the GNU General Public License
; along with this program; if not, write to the Free Software
; Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<span class = "comment"  >;;;;This library provides a number of functions that reads a string from a text file,
;;;; and functions which write a string to a text file.
;;;; In particular the library supports very useful functions that read selected parts of a text file to strings.&lt;p&gt;
;;;; The main functions are: read-text-file and write-text-file.
;;;; The selective reading functions are read-text-file-between-marks and read-text-file-including-marks.
;;;; .title Reference Manual of the Text File Reading and Writing Library</span>
<span class = "comment"  >;-----------------------------------------------------------------------------</span>
<a name="read-text-file"></a><span class = "comment"  >;;;Reading stuff. </span>

<a name="read-text-file"></a><span> <span><a href="cross-reference-index-r.html#read-text-file" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from read-text-file to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(read-text-file file-name)</font></b>
  <span class = "comment"  >;;Return the textual contents of file-name, as a string</span>
 (<a href="../../../../r4rs/r4rs_6.htm#IDX107" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let*</b></a> ((ip (<a href="../../../../r4rs/r4rs_8.htm#IDX595" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">open-input-file</font></a> file-name))
        (res (<a href="file-read.html#read-text-file-from-input-port" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-text-file-from-input-port</font></a> ip)))
     (<a href="../../../../r4rs/r4rs_8.htm#IDX597" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">close-input-port</font></a> ip)
     res))

<a name="file-chunck"></a><span> <span><a href="cross-reference-index-f.html#file-chunck" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from file-chunck to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >file-chunck</font></b> 1000)

<a name="read-text-file-from-input-port"></a><span> <span><a href="cross-reference-index-r.html#read-text-file-from-input-port" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from read-text-file-from-input-port to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(read-text-file-from-input-port input-port)</font></b>
  <span class = "comment"  >;;Return the textual contents of input-port, as a string</span>
 (<a href="../../../../r4rs/r4rs_6.htm#IDX107" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let*</b></a> ((res (<a href="file-read.html#read-text-file-portion" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-text-file-portion</font></a> input-port <a href="file-read.html#file-chunck" title="file-read" style="{text-decoration: none;}"><font color="#000080">file-chunck</font></a>)))
  (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX177" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">not</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX616" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eof-object?</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX606" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">peek-char</font></a> input-port)))
      (<a href="../../../../r4rs/r4rs_8.htm#IDX510" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-append</font></a> res (<a href="file-read.html#read-text-file-from-input-port" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-text-file-from-input-port</font></a> input-port))
      res)))

<a name="read-text-file-portion"></a><span> <span><a href="cross-reference-index-r.html#read-text-file-portion" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from read-text-file-portion to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(read-text-file-portion input-port portion)</font></b>
  <span class = "comment"  >;read up to portion characters from input-port</span>
 (<a href="../../../../r4rs/r4rs_6.htm#SEC35" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let</b></a> ((str (<a href="../../../../r4rs/r4rs_8.htm#IDX483" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">make-string</font></a> portion #\space)))
  (<a href="file-read.html#read-into-string" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-into-string</font></a> input-port str 0 portion)))

<a name="read-into-string"></a><span> <span><a href="cross-reference-index-r.html#read-into-string" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from read-into-string to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(read-into-string input-port str position max)</font></b>
  <span class = "comment"  >;read up to max characters into str in a tail recursive fashion.
  ; return the string</span>
 (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX351" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">=</font></a> position <a href="../../../../r4rs/r4rs_8.htm#IDX363" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">max</font></a>)
     str
     (<a href="../../../../r4rs/r4rs_6.htm#SEC35" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let</b></a> ((ch (<a href="../../../../r4rs/r4rs_8.htm#IDX603" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">read-char</font></a> input-port)))
       (<a href="../../../../r4rs/r4rs_6.htm#SEC34" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>cond</b></a> ((<a href="../../../../r4rs/r4rs_8.htm#IDX616" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eof-object?</font></a> ch) (<a href="../../../../r4rs/r4rs_8.htm#IDX508" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">substring</font></a> str 0 position))
	      (<a href="../../../../r4rs/r4rs_6.htm#IDX82" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>else</b></a> (<a href="../../../../r4rs/r4rs_6.htm#IDX117" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>begin</b></a>
	              (<a href="../../../../r4rs/r4rs_8.htm#IDX490" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-set!</font></a> str position ch)
	              (<a href="file-read.html#read-into-string" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-into-string</font></a> input-port str (<a href="../../../../r4rs/r4rs_8.htm#IDX367" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">+</font></a> position 1) <a href="../../../../r4rs/r4rs_8.htm#IDX363" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">max</font></a>)))))))

<a name="state-list"></a><span class = "comment"  >;-----------------------------------------------------------------------------
; File reading between marks.</span>

<a name="state-list"></a><span> <span><a href="cross-reference-index-s.html#state-list" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from state-list to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >state-list</font></b> '()) <a name="debugging-with-marks"></a><span class = "comment"  >;for debugging purposes</span>
<a name="debugging-with-marks"></a><span> <span><a href="cross-reference-index-d.html#debugging-with-marks" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from debugging-with-marks to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >debugging-with-marks</font></b> #f)

<a name="read-text-file-between-marks"></a><span> <span><a href="cross-reference-index-r.html#read-text-file-between-marks" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from read-text-file-between-marks to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(read-text-file-between-marks file-name mark)</font></b>
  <span class = "comment"  >;;Reads the part of the file between - but excluding - two occurences of mark, and return it as a text string. 
  ;; Specifically, it read and return the string from, but excluding, the first occurence of mark
  ;; to, but excluding, the next occurence of mark.
  ;; If no occurence of mark can be located, return the empty string.
  ;; If only one occurence of mark occurs, return a suffix of the file from the mark to the end of file.
  ;; This function is implemented by means of a state machine which controls when the actual reading must take place.</span>
 (<a href="../../../../r4rs/r4rs_6.htm#SEC32" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>set!</b></a> <a href="file-read.html#current-state" title="file-read" style="{text-decoration: none;}"><font color="#000080">current-state</font></a> 'skip)
 (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> <a href="file-read.html#debugging-with-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">debugging-with-marks</font></a> (<a href="../../../../r4rs/r4rs_6.htm#SEC32" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>set!</b></a> <a href="file-read.html#state-list" title="file-read" style="{text-decoration: none;}"><font color="#000080">state-list</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX265" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">list</font></a> 'skip)))
 (<a href="../../../../r4rs/r4rs_6.htm#IDX107" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let*</b></a> ((ip (<a href="../../../../r4rs/r4rs_8.htm#IDX595" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">open-input-file</font></a> file-name))
        (res (<a href="file-read.html#read-text-file-from-input-port-with-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-text-file-from-input-port-with-marks</font></a> ip mark)))
     (<a href="../../../../r4rs/r4rs_8.htm#IDX597" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">close-input-port</font></a> ip)
     (<a href="../../../../r4rs/r4rs_6.htm#SEC32" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>set!</b></a> <a href="file-read.html#current-state" title="file-read" style="{text-decoration: none;}"><font color="#000080">current-state</font></a> 'skip)
     res))

<a name="file-chunck-with-marks"></a><span> <span><a href="cross-reference-index-f.html#file-chunck-with-marks" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from file-chunck-with-marks to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >file-chunck-with-marks</font></b> 1000)
<a name="current-state"></a><span> <span><a href="cross-reference-index-c.html#current-state" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from current-state to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >current-state</font></b> 'skip)

<a name="read-text-file-from-input-port-with-marks"></a><span> <span><a href="cross-reference-index-r.html#read-text-file-from-input-port-with-marks" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from read-text-file-from-input-port-with-marks to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(read-text-file-from-input-port-with-marks input-port mark)</font></b>
  <span class = "comment"  >;return the textual contents of file-name, as a string</span>
 (<a href="../../../../r4rs/r4rs_6.htm#IDX107" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let*</b></a> ((res (<a href="file-read.html#read-text-file-portion-with-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-text-file-portion-with-marks</font></a> input-port <a href="file-read.html#file-chunck-with-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">file-chunck-with-marks</font></a> mark)))
  (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX177" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">not</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX616" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eof-object?</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX606" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">peek-char</font></a> input-port)))
      (<a href="../../../../r4rs/r4rs_8.htm#IDX510" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-append</font></a> res (<a href="file-read.html#read-text-file-from-input-port-with-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-text-file-from-input-port-with-marks</font></a> input-port mark))
      res)))

<a name="read-text-file-portion-with-marks"></a><span> <span><a href="cross-reference-index-r.html#read-text-file-portion-with-marks" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from read-text-file-portion-with-marks to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(read-text-file-portion-with-marks input-port portion mark)</font></b>
  <span class = "comment"  >;read up to portion characters from input-port</span>
 (<a href="../../../../r4rs/r4rs_6.htm#SEC35" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let</b></a> ((str (<a href="../../../../r4rs/r4rs_8.htm#IDX483" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">make-string</font></a> portion #\space)))
  (<a href="file-read.html#read-into-string-with-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-into-string-with-marks</font></a> input-port str 0 portion mark)))

<a name="read-into-string-with-marks"></a><span> <span><a href="cross-reference-index-r.html#read-into-string-with-marks" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from read-into-string-with-marks to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(read-into-string-with-marks input-port str position max mark)</font></b>
<span class = "comment"  >;read up to max characters into str in a tail recursive fashion. Return the string.</span>
  (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX351" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">=</font></a> position <a href="../../../../r4rs/r4rs_8.htm#IDX363" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">max</font></a>)
      str
      (<a href="../../../../r4rs/r4rs_6.htm#SEC35" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let</b></a> ((ch (<a href="../../../../r4rs/r4rs_8.htm#IDX603" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">read-char</font></a> input-port)))
	(<a href="../../../../r4rs/r4rs_6.htm#SEC34" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>cond</b></a> ((<a href="../../../../r4rs/r4rs_8.htm#IDX616" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eof-object?</font></a> ch) (<a href="../../../../r4rs/r4rs_8.htm#IDX508" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">substring</font></a> str 0 position))
	      (<a href="../../../../r4rs/r4rs_6.htm#IDX82" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>else</b></a> (<a href="../../../../r4rs/r4rs_6.htm#IDX107" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let*</b></a> ((trans-result (<a href="file-read.html#transition" title="file-read" style="{text-decoration: none;}"><font color="#000080">transition</font></a> <a href="file-read.html#current-state" title="file-read" style="{text-decoration: none;}"><font color="#000080">current-state</font></a> ch mark))
			   (next-state (<a href="../../../../r4rs/r4rs_8.htm#IDX247" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">car</font></a> trans-result))
			   (output-function (<a href="../../../../r4rs/r4rs_8.htm#IDX249" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cdr</font></a> trans-result))
			   (output-string (output-function <a href="file-read.html#current-state" title="file-read" style="{text-decoration: none;}"><font color="#000080">current-state</font></a> next-state ch mark)))
                      (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> <a href="file-read.html#debugging-with-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">debugging-with-marks</font></a>
                          (<a href="../../../../r4rs/r4rs_6.htm#SEC32" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>set!</b></a> <a href="file-read.html#state-list" title="file-read" style="{text-decoration: none;}"><font color="#000080">state-list</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> next-state <a href="file-read.html#state-list" title="file-read" style="{text-decoration: none;}"><font color="#000080">state-list</font></a>)))
		      (<a href="file-read.html#put-into-string!" title="file-read" style="{text-decoration: none;}"><font color="#000080">put-into-string!</font></a> str position output-string)
                      (<a href="../../../../r4rs/r4rs_6.htm#SEC32" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>set!</b></a> <a href="file-read.html#current-state" title="file-read" style="{text-decoration: none;}"><font color="#000080">current-state</font></a> next-state)
		      (<a href="file-read.html#read-into-string-with-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-into-string-with-marks</font></a> input-port str (<a href="../../../../r4rs/r4rs_8.htm#IDX367" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">+</font></a> position (<a href="../../../../r4rs/r4rs_8.htm#IDX487" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-length</font></a> output-string)) <a href="../../../../r4rs/r4rs_8.htm#IDX363" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">max</font></a> mark)))))))

<a name="put-into-string!"></a><span> <span><a href="cross-reference-index-p.html#put-into-string!" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from put-into-string! to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(put-into-string! str position addition)</font></b>
  (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX353" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">&gt;</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX487" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-length</font></a> addition) 0)
      (<a href="../../../../r4rs/r4rs_6.htm#IDX117" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>begin</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX490" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-set!</font></a> str position (<a href="../../../../r4rs/r4rs_8.htm#IDX488" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-ref</font></a> addition 0))
             (<a href="file-read.html#put-into-string!" title="file-read" style="{text-decoration: none;}"><font color="#000080">put-into-string!</font></a> str (<a href="../../../../r4rs/r4rs_8.htm#IDX367" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">+</font></a> 1 position) (<a href="../../../../r4rs/r4rs_8.htm#IDX508" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">substring</font></a> addition 1 (<a href="../../../../r4rs/r4rs_8.htm#IDX487" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-length</font></a> addition))))))

<a name="output-skip"></a><span class = "comment"  >;-------------------------------------------------
; The state machine controlling the reading process between marks
; The marks are not included in the text returned
;
; States are either a symbol or a number:
  ; The symbol skip: Do not collect the character read.
  ; The symbol skip-rest: Reading is done. Never collect more characters.
                        ; (prevents re-reading after marked region).           
  ; The symbol collect: Do collect the character read.
  ; A positive number n: We have recognized n characters of the mark
                       ; from a skipping state towards a collecting state
  ; A negative number n: We have recognized -n characters of the mark
                       ; from collecting state towards a skipping state.
;
; Observation: In negatively numbered states, we have to output a partially
; matched mark. This is done by output-pending-mark.</span>


<a name="output-skip"></a><span> <span><a href="cross-reference-index-o.html#output-skip" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from output-skip to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(output-skip in-state out-state char mark)</font></b>
  "")

<a name="output-let-go"></a><span> <span><a href="cross-reference-index-o.html#output-let-go" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from output-let-go to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(output-let-go in-state out-state char mark)</font></b> 
  (<a href="general.html#as-string" title="general" style="{text-decoration: none;}"><font color="#000080">as-string</font></a> char))

<a name="output-pending-mark"></a><span> <span><a href="cross-reference-index-o.html#output-pending-mark" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from output-pending-mark to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(output-pending-mark in-state out-state char mark)</font></b>
  <span class = "comment"  >;output the portion of the mark already read</span>
  (<a href="../../../../r4rs/r4rs_8.htm#IDX508" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">substring</font></a> mark 0 (<a href="../../../../r4rs/r4rs_8.htm#IDX375" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">abs</font></a> in-state)))


<a name="transition"></a><span> <span><a href="cross-reference-index-t.html#transition" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from transition to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(transition in-state char mark)</font></b>
  (<a href="../../../../r4rs/r4rs_6.htm#SEC35" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let</b></a> ((mark0 (<a href="../../../../r4rs/r4rs_8.htm#IDX488" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-ref</font></a> mark 0)))  <span class = "comment"  >;first char in mark</span>
    (<a href="../../../../r4rs/r4rs_6.htm#SEC34" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>cond</b></a>  ((<a href="../../../../r4rs/r4rs_6.htm#IDX95" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>and</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX302" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">symbol?</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX204" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eq?</font></a> in-state 'skip))
              (<a href="../../../../r4rs/r4rs_6.htm#SEC34" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>cond</b></a> ((<a href="../../../../r4rs/r4rs_8.htm#IDX185" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eqv?</font></a> char mark0)                            (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> 1 <a href="file-read.html#output-skip" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-skip</font></a>))
                    (<a href="../../../../r4rs/r4rs_6.htm#IDX82" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>else</b></a>                                        (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> 'skip <a href="file-read.html#output-skip" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-skip</font></a>))))

           ((<a href="../../../../r4rs/r4rs_6.htm#IDX95" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>and</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX302" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">symbol?</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX204" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eq?</font></a> in-state 'collect))     
              (<a href="../../../../r4rs/r4rs_6.htm#SEC34" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>cond</b></a> ((<a href="../../../../r4rs/r4rs_8.htm#IDX185" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eqv?</font></a> char mark0)                            (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> -1 <a href="file-read.html#output-skip" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-skip</font></a>))
                    (<a href="../../../../r4rs/r4rs_6.htm#IDX82" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>else</b></a>                                        (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> 'collect <a href="file-read.html#output-let-go" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-let-go</font></a>))))

           ((<a href="../../../../r4rs/r4rs_6.htm#IDX95" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>and</b></a> (<a href="file-read.html#positive-number?" title="file-read" style="{text-decoration: none;}"><font color="#000080">positive-number?</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX352" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">&lt;</font></a> in-state (<a href="../../../../r4rs/r4rs_8.htm#IDX487" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-length</font></a> mark))
              (<a href="../../../../r4rs/r4rs_6.htm#SEC34" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>cond</b></a> ((<a href="../../../../r4rs/r4rs_8.htm#IDX185" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eqv?</font></a> char (<a href="../../../../r4rs/r4rs_8.htm#IDX488" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-ref</font></a> mark in-state))       
                                                                 (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX367" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">+</font></a> in-state 1) <a href="file-read.html#output-skip" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-skip</font></a>))
                    (<a href="../../../../r4rs/r4rs_6.htm#IDX82" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>else</b></a>                                        (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> 'skip <a href="file-read.html#output-skip" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-skip</font></a>)))))

           ((<a href="../../../../r4rs/r4rs_6.htm#IDX95" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>and</b></a> (<a href="file-read.html#positive-number?" title="file-read" style="{text-decoration: none;}"><font color="#000080">positive-number?</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX351" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">=</font></a> in-state (<a href="../../../../r4rs/r4rs_8.htm#IDX487" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-length</font></a> mark)))
                                                                 (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> 'collect <a href="file-read.html#output-let-go" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-let-go</font></a>))

           ((<a href="../../../../r4rs/r4rs_6.htm#IDX95" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>and</b></a> (<a href="file-read.html#negative-number?" title="file-read" style="{text-decoration: none;}"><font color="#000080">negative-number?</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX352" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">&lt;</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX375" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">abs</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX487" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-length</font></a> mark)))
              (<a href="../../../../r4rs/r4rs_6.htm#SEC34" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>cond</b></a> ((<a href="../../../../r4rs/r4rs_8.htm#IDX185" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eqv?</font></a> char (<a href="../../../../r4rs/r4rs_8.htm#IDX488" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-ref</font></a> mark (<a href="../../../../r4rs/r4rs_8.htm#IDX375" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">abs</font></a> in-state)))       
                                                                 (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX369" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">-</font></a> in-state 1) <a href="file-read.html#output-skip" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-skip</font></a>))
                    (<a href="../../../../r4rs/r4rs_6.htm#IDX82" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>else</b></a>                                        (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> 'collect <a href="file-read.html#output-pending-mark" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-pending-mark</font></a>))))

           ((<a href="../../../../r4rs/r4rs_6.htm#IDX95" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>and</b></a> (<a href="file-read.html#negative-number?" title="file-read" style="{text-decoration: none;}"><font color="#000080">negative-number?</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX351" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">=</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX375" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">abs</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX487" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-length</font></a> mark)))
                                                                 (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> 'skip-rest <a href="file-read.html#output-skip" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-skip</font></a>))

           ((<a href="../../../../r4rs/r4rs_6.htm#IDX95" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>and</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX302" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">symbol?</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX204" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eq?</font></a> in-state 'skip-rest))   (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> 'skip-rest <a href="file-read.html#output-skip" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-skip</font></a>))

       )))

<a name="positive-number?"></a><span> <span><a href="cross-reference-index-p.html#positive-number?" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from positive-number? to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(positive-number? x)</font></b>
  (<a href="../../../../r4rs/r4rs_6.htm#IDX95" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>and</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX340" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">number?</font></a> x) (<a href="../../../../r4rs/r4rs_8.htm#IDX353" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">&gt;</font></a> x 0)))


<a name="negative-number?"></a><span> <span><a href="cross-reference-index-n.html#negative-number?" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from negative-number? to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(negative-number? x)</font></b>
  (<a href="../../../../r4rs/r4rs_6.htm#IDX95" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>and</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX340" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">number?</font></a> x) (<a href="../../../../r4rs/r4rs_8.htm#IDX352" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">&lt;</font></a> x 0)))



<a name="read-text-file-including-marks"></a><span class = "comment"  >;-----------------------------------------------------------------------------
; File reading including start-mark and end-mark
; We support potential different start and end marks</span>

<a name="read-text-file-including-marks"></a><span> <span><a href="cross-reference-index-r.html#read-text-file-including-marks" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from read-text-file-including-marks to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(read-text-file-including-marks file-name start-mark end-mark)</font></b>
  <span class = "comment"  >;;Reads the part of the file between and including occurences of start-mark and end-mark, and return it as a text string.
  ;; Specifically, read and return the string from and including the first occurence of start-mark
  ;; to and including the next occurence of end-mark. 
  ;; If no occurence of the mark can be located, return the empty string.
  ;; If only the start-mark occurs, return a suffix of the file from the start-mark to the end of file.
  ;; This function is implemented by means of a state machine which controls when the actual reading must take place.</span>
 (<a href="../../../../r4rs/r4rs_6.htm#SEC32" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>set!</b></a> <a href="file-read.html#current-state" title="file-read" style="{text-decoration: none;}"><font color="#000080">current-state</font></a> 'skip)
 (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> <a href="file-read.html#debugging-with-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">debugging-with-marks</font></a> (<a href="../../../../r4rs/r4rs_6.htm#SEC32" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>set!</b></a> <a href="file-read.html#state-list" title="file-read" style="{text-decoration: none;}"><font color="#000080">state-list</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX265" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">list</font></a> 'skip)))
 (<a href="../../../../r4rs/r4rs_6.htm#IDX107" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let*</b></a> ((ip (<a href="../../../../r4rs/r4rs_8.htm#IDX595" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">open-input-file</font></a> file-name))
        (res (<a href="file-read.html#read-text-file-from-input-port-including-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-text-file-from-input-port-including-marks</font></a> ip start-mark end-mark)))
     (<a href="../../../../r4rs/r4rs_8.htm#IDX597" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">close-input-port</font></a> ip)
     (<a href="../../../../r4rs/r4rs_6.htm#SEC32" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>set!</b></a> <a href="file-read.html#current-state" title="file-read" style="{text-decoration: none;}"><font color="#000080">current-state</font></a> 'skip)
     res))

<a name="read-text-file-from-input-port-including-marks"></a><span> <span><a href="cross-reference-index-r.html#read-text-file-from-input-port-including-marks" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from read-text-file-from-input-port-including-marks to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(read-text-file-from-input-port-including-marks input-port start-mark end-mark)</font></b>
  <span class = "comment"  >;return the textual contents of file-name, as a string</span>
 (<a href="../../../../r4rs/r4rs_6.htm#IDX107" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let*</b></a> ((res (<a href="file-read.html#read-text-file-portion-including-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-text-file-portion-including-marks</font></a> input-port <a href="file-read.html#file-chunck-with-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">file-chunck-with-marks</font></a> start-mark end-mark)))
  (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX177" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">not</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX616" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eof-object?</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX606" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">peek-char</font></a> input-port)))
      (<a href="../../../../r4rs/r4rs_8.htm#IDX510" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-append</font></a> res (<a href="file-read.html#read-text-file-from-input-port-including-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-text-file-from-input-port-including-marks</font></a> input-port start-mark end-mark))
      res)))

<a name="read-text-file-portion-including-marks"></a><span> <span><a href="cross-reference-index-r.html#read-text-file-portion-including-marks" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from read-text-file-portion-including-marks to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(read-text-file-portion-including-marks input-port portion start-mark end-mark)</font></b>
  <span class = "comment"  >;read up to portion characters from input-port</span>
 (<a href="../../../../r4rs/r4rs_6.htm#SEC35" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let</b></a> ((str (<a href="../../../../r4rs/r4rs_8.htm#IDX483" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">make-string</font></a> portion #\space)))
  (<a href="file-read.html#read-into-string-including-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-into-string-including-marks</font></a> input-port str 0 portion start-mark end-mark)))

<a name="read-into-string-including-marks"></a><span> <span><a href="cross-reference-index-r.html#read-into-string-including-marks" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from read-into-string-including-marks to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(read-into-string-including-marks input-port str position max start-mark end-mark)</font></b>
<span class = "comment"  >;read up to max characters into str in a tail recursive fashion. Return the string.</span>
  (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX351" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">=</font></a> position <a href="../../../../r4rs/r4rs_8.htm#IDX363" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">max</font></a>)
      str
      (<a href="../../../../r4rs/r4rs_6.htm#SEC35" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let</b></a> ((ch (<a href="../../../../r4rs/r4rs_8.htm#IDX603" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">read-char</font></a> input-port)))
	(<a href="../../../../r4rs/r4rs_6.htm#SEC34" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>cond</b></a> ((<a href="../../../../r4rs/r4rs_8.htm#IDX616" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eof-object?</font></a> ch) (<a href="../../../../r4rs/r4rs_8.htm#IDX508" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">substring</font></a> str 0 position))
	      (<a href="../../../../r4rs/r4rs_6.htm#IDX82" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>else</b></a> (<a href="../../../../r4rs/r4rs_6.htm#IDX107" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let*</b></a> ((trans-result (<a href="file-read.html#transition1" title="file-read" style="{text-decoration: none;}"><font color="#000080">transition1</font></a> <a href="file-read.html#current-state" title="file-read" style="{text-decoration: none;}"><font color="#000080">current-state</font></a> ch start-mark end-mark))
			   (next-state (<a href="../../../../r4rs/r4rs_8.htm#IDX247" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">car</font></a> trans-result))
			   (output-function (<a href="../../../../r4rs/r4rs_8.htm#IDX249" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cdr</font></a> trans-result))
			   (output-string (output-function <a href="file-read.html#current-state" title="file-read" style="{text-decoration: none;}"><font color="#000080">current-state</font></a> next-state ch start-mark end-mark)))
                      (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> <a href="file-read.html#debugging-with-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">debugging-with-marks</font></a>
                          (<a href="../../../../r4rs/r4rs_6.htm#SEC32" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>set!</b></a> <a href="file-read.html#state-list" title="file-read" style="{text-decoration: none;}"><font color="#000080">state-list</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> next-state <a href="file-read.html#state-list" title="file-read" style="{text-decoration: none;}"><font color="#000080">state-list</font></a>)))
		      (<a href="file-read.html#put-into-string!" title="file-read" style="{text-decoration: none;}"><font color="#000080">put-into-string!</font></a> str position output-string)
                      (<a href="../../../../r4rs/r4rs_6.htm#SEC32" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>set!</b></a> <a href="file-read.html#current-state" title="file-read" style="{text-decoration: none;}"><font color="#000080">current-state</font></a> next-state)
		      (<a href="file-read.html#read-into-string-including-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-into-string-including-marks</font></a> input-port str (<a href="../../../../r4rs/r4rs_8.htm#IDX367" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">+</font></a> position (<a href="../../../../r4rs/r4rs_8.htm#IDX487" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-length</font></a> output-string))
                                                        <a href="../../../../r4rs/r4rs_8.htm#IDX363" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">max</font></a> start-mark end-mark)))))))

<a name="put-into-string!"></a><span> <span><a href="cross-reference-index-p.html#put-into-string!" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from put-into-string! to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(put-into-string! str position addition)</font></b>
  (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX353" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">&gt;</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX487" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-length</font></a> addition) 0)
      (<a href="../../../../r4rs/r4rs_6.htm#IDX117" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>begin</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX490" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-set!</font></a> str position (<a href="../../../../r4rs/r4rs_8.htm#IDX488" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-ref</font></a> addition 0))
             (<a href="file-read.html#put-into-string!" title="file-read" style="{text-decoration: none;}"><font color="#000080">put-into-string!</font></a> str (<a href="../../../../r4rs/r4rs_8.htm#IDX367" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">+</font></a> 1 position) (<a href="../../../../r4rs/r4rs_8.htm#IDX508" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">substring</font></a> addition 1 (<a href="../../../../r4rs/r4rs_8.htm#IDX487" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-length</font></a> addition))))))

<a name="output-skip1"></a><span class = "comment"  >;-------------------------------------------------
; The state machine controlling the reading process between marks
; The marks are not included in the text returned
;
; States are either a symbol or a number:
  ; The symbol skip: Do not collect the character read.
  ; The symbol skip-rest: Reading is done. Never collect more characters.
                        ; (prevents re-reading after marked region).           
  ; The symbol collect: Do collect the character read.
  ; A positive number n: We have recognized n characters of the start mark,
                       ; from a skipping state towards a collecting state
  ; A negative number n: We have recognized -n characters of the end-mark, 
                       ; from collecting state towards a skipping state.
;
; Observation: In negatively numbered states, we have to output a partially
; matched mark. This is done by output-pending-mark.</span>


<a name="output-skip1"></a><span> <span><a href="cross-reference-index-o.html#output-skip1" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from output-skip1 to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(output-skip1 in-state out-state char start-mark end-mark)</font></b>
  "")

<a name="output-let-go1"></a><span> <span><a href="cross-reference-index-o.html#output-let-go1" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from output-let-go1 to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(output-let-go1 in-state out-state char start-mark end-mark)</font></b> 
  (<a href="general.html#as-string" title="general" style="{text-decoration: none;}"><font color="#000080">as-string</font></a> char))


<a name="output-pending-start-mark"></a><span> <span><a href="cross-reference-index-o.html#output-pending-start-mark" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from output-pending-start-mark to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(output-pending-start-mark in-state out-state char start-mark end-mark)</font></b>
  <span class = "comment"  >;output the portion of the mark already read</span>
  (<a href="../../../../r4rs/r4rs_8.htm#IDX510" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-append</font></a> start-mark (<a href="general.html#as-string" title="general" style="{text-decoration: none;}"><font color="#000080">as-string</font></a> char)))

<a name="output-pending-end-mark"></a><span> <span><a href="cross-reference-index-o.html#output-pending-end-mark" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from output-pending-end-mark to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(output-pending-end-mark in-state out-state char start-mark end-mark)</font></b>
  <span class = "comment"  >;output the portion of the mark already read</span>
  (<a href="../../../../r4rs/r4rs_8.htm#IDX508" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">substring</font></a> end-mark 0 (<a href="../../../../r4rs/r4rs_8.htm#IDX375" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">abs</font></a> in-state)))


<a name="transition1"></a><span> <span><a href="cross-reference-index-t.html#transition1" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from transition1 to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(transition1 in-state char start-mark end-mark)</font></b>
  (<a href="../../../../r4rs/r4rs_6.htm#SEC35" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let</b></a> ((mark0 (<a href="../../../../r4rs/r4rs_8.htm#IDX488" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-ref</font></a> start-mark 0))  <span class = "comment"  >;first char in start-mark</span>
        (markn (<a href="../../../../r4rs/r4rs_8.htm#IDX488" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-ref</font></a> end-mark 0))    <span class = "comment"  >;first char in end-mark</span>
       )
    (<a href="../../../../r4rs/r4rs_6.htm#SEC34" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>cond</b></a>  ((<a href="../../../../r4rs/r4rs_6.htm#IDX95" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>and</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX302" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">symbol?</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX204" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eq?</font></a> in-state 'skip))
              (<a href="../../../../r4rs/r4rs_6.htm#SEC34" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>cond</b></a> ((<a href="../../../../r4rs/r4rs_8.htm#IDX185" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eqv?</font></a> char mark0)                            (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> 1 <a href="file-read.html#output-skip1" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-skip1</font></a>))
                    (<a href="../../../../r4rs/r4rs_6.htm#IDX82" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>else</b></a>                                        (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> 'skip <a href="file-read.html#output-skip1" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-skip1</font></a>))))

           ((<a href="../../../../r4rs/r4rs_6.htm#IDX95" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>and</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX302" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">symbol?</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX204" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eq?</font></a> in-state 'collect))     
              (<a href="../../../../r4rs/r4rs_6.htm#SEC34" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>cond</b></a> ((<a href="../../../../r4rs/r4rs_8.htm#IDX185" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eqv?</font></a> char markn)                            (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> -1 <a href="file-read.html#output-let-go1" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-let-go1</font></a>))
                    (<a href="../../../../r4rs/r4rs_6.htm#IDX82" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>else</b></a>                                        (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> 'collect <a href="file-read.html#output-let-go1" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-let-go1</font></a>))))

           ((<a href="../../../../r4rs/r4rs_6.htm#IDX95" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>and</b></a> (<a href="file-read.html#positive-number?" title="file-read" style="{text-decoration: none;}"><font color="#000080">positive-number?</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX352" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">&lt;</font></a> in-state (<a href="../../../../r4rs/r4rs_8.htm#IDX487" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-length</font></a> start-mark))
              (<a href="../../../../r4rs/r4rs_6.htm#SEC34" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>cond</b></a> ((<a href="../../../../r4rs/r4rs_8.htm#IDX185" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eqv?</font></a> char (<a href="../../../../r4rs/r4rs_8.htm#IDX488" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-ref</font></a> start-mark in-state))       
                                                                 (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX367" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">+</font></a> in-state 1) <a href="file-read.html#output-skip1" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-skip1</font></a>))
                    (<a href="../../../../r4rs/r4rs_6.htm#IDX82" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>else</b></a>                                        (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> 'skip <a href="file-read.html#output-skip1" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-skip1</font></a>)))))

           ((<a href="../../../../r4rs/r4rs_6.htm#IDX95" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>and</b></a> (<a href="file-read.html#positive-number?" title="file-read" style="{text-decoration: none;}"><font color="#000080">positive-number?</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX351" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">=</font></a> in-state (<a href="../../../../r4rs/r4rs_8.htm#IDX487" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-length</font></a> start-mark)))
                                                                 (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> 'collect <a href="file-read.html#output-pending-start-mark" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-pending-start-mark</font></a>))

           ((<a href="../../../../r4rs/r4rs_6.htm#IDX95" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>and</b></a> (<a href="file-read.html#negative-number?" title="file-read" style="{text-decoration: none;}"><font color="#000080">negative-number?</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX352" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">&lt;</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX375" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">abs</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX487" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-length</font></a> end-mark)))
              (<a href="../../../../r4rs/r4rs_6.htm#SEC34" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>cond</b></a> ((<a href="../../../../r4rs/r4rs_8.htm#IDX185" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eqv?</font></a> char (<a href="../../../../r4rs/r4rs_8.htm#IDX488" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-ref</font></a> end-mark (<a href="../../../../r4rs/r4rs_8.htm#IDX375" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">abs</font></a> in-state)))       
                                                                 (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX369" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">-</font></a> in-state 1) <a href="file-read.html#output-let-go1" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-let-go1</font></a>))
                    (<a href="../../../../r4rs/r4rs_6.htm#IDX82" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>else</b></a>                                        (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> 'collect <a href="file-read.html#output-let-go1" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-let-go1</font></a>))))

           ((<a href="../../../../r4rs/r4rs_6.htm#IDX95" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>and</b></a> (<a href="file-read.html#negative-number?" title="file-read" style="{text-decoration: none;}"><font color="#000080">negative-number?</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX351" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">=</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX375" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">abs</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX487" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-length</font></a> end-mark)))
                                                                 (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> 'skip-rest <a href="file-read.html#output-skip1" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-skip1</font></a>))

           ((<a href="../../../../r4rs/r4rs_6.htm#IDX95" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>and</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX302" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">symbol?</font></a> in-state) (<a href="../../../../r4rs/r4rs_8.htm#IDX204" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eq?</font></a> in-state 'skip-rest))   (<a href="../../../../r4rs/r4rs_8.htm#IDX245" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">cons</font></a> 'skip-rest <a href="file-read.html#output-skip1" title="file-read" style="{text-decoration: none;}"><font color="#000080">output-skip1</font></a>))

       )))


<span class = "comment"  >;---------------------------------------------------------------------------------------------------------------</span>
<a name="code-example"></a><span class = "comment"  >;;Convenient and specialized function returning the contents of a program file.
;; Other usages are also possible.
;; Reads an external file, either an entire file (if no optional mark parameter)
;; or a region surrounded by mark.</span>

<a name="code-example"></a><span> <span><a href="cross-reference-index-c.html#code-example" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from code-example to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(code-example file . mark)</font></b>
  (<a href="../../../../r4rs/r4rs_6.htm#SEC35" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let</b></a> ((code-text
           (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX261" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">null?</font></a> mark) 
               (<a href="file-read.html#read-text-file" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-text-file</font></a> file)
               (<a href="file-read.html#read-text-file-between-marks" title="file-read" style="{text-decoration: none;}"><font color="#000080">read-text-file-between-marks</font></a> file (<a href="../../../../r4rs/r4rs_8.htm#IDX247" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">car</font></a> mark)))))
     code-text))





<span class = "comment"  >;---------------------------------------------------------------------------------------------------------------</span>
<span class = "comment"  >;;;Writing stuff. </span>
<a name="write-text-file"></a><span class = "comment"  >;;Write the text string str to the file named file-name. 
;; After this function call, the file contains exactly the string str.
;; Opening and closing is done by this function.
;; .form (write-text-file str file-name [suppress-cr])
;; .parameter suppress-cr If true, never write a cr (character 13). Ie. never use PC end of line conventions.</span>
<a name="write-text-file"></a><span> <span><a href="cross-reference-index-w.html#write-text-file" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from write-text-file to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(write-text-file str file-name . optional-parameter-list)</font></b>
 (<a href="../../../../r4rs/r4rs_6.htm#SEC35" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let</b></a> ((suppress-cr (optional-parameter 1 optional-parameter-list #f)))
   (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> (file-exists? file-name) (delete-file file-name))
   (<a href="../../../../r4rs/r4rs_6.htm#IDX107" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let*</b></a> ((op (<a href="../../../../r4rs/r4rs_8.htm#IDX596" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">open-output-file</font></a> file-name)))
     (<a href="file-read.html#write-text-file-to-port" title="file-read" style="{text-decoration: none;}"><font color="#000080">write-text-file-to-port</font></a> str op suppress-cr)
     (<a href="../../../../r4rs/r4rs_8.htm#IDX598" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">close-output-port</font></a> op))))

<a name="write-string-to-port"></a><span class = "comment"  >;;Write the string str to port, which is assumed to be open.
;; This procedure does not close the port.
;; .form (write-string-to-port str port [suppress-cr])
;; .parameter suppress-cr If true, never write a cr (character 13). Ie. never use PC end of line conventions.
;; .internal-references "similar function" "write-port-strings"</span>
<a name="write-string-to-port"></a><span> <span><a href="cross-reference-index-w.html#write-string-to-port" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from write-string-to-port to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(write-string-to-port str port . optional-parameter-list)</font></b>
 (<a href="../../../../r4rs/r4rs_6.htm#SEC35" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let</b></a> ((suppress-cr (optional-parameter 1 optional-parameter-list #f)))
  (<a href="file-read.html#write-text-file-to-port" title="file-read" style="{text-decoration: none;}"><font color="#000080">write-text-file-to-port</font></a> str port suppress-cr)))

<a name="write-port-strings"></a><span class = "comment"  >;;Write each of the strings in the parameter strings to port.
;; The output port port is assumed to be open.
;; This procedure does not close the port.
;; .parameter port An open output port
;; .parameter strings A list of strings (a rest parameter of the function).
;; .internal-references "similar function" "write-string-to-port"
;; .misc Notice the order of the parameters compared with write-string-to-port.</span>
<a name="write-port-strings"></a><span> <span><a href="cross-reference-index-w.html#write-port-strings" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from write-port-strings to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(write-port-strings port . strings)</font></b>
  (<a href="../../../../r4rs/r4rs_8.htm#IDX544" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">for-each</font></a>
     (<a href="../../../../r4rs/r4rs_6.htm#SEC30" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>lambda</b></a> (str) (<a href="file-read.html#write-string-to-port" title="file-read" style="{text-decoration: none;}"><font color="#000080">write-string-to-port</font></a> str port))
     strings))

<a name="write-text-file-to-port"></a><span> <span><a href="cross-reference-index-w.html#write-text-file-to-port" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from write-text-file-to-port to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(write-text-file-to-port str port suppress-cr)</font></b>
  (<a href="file-read.html#write-text-file-to-port-1" title="file-read" style="{text-decoration: none;}"><font color="#000080">write-text-file-to-port-1</font></a> 0 (<a href="../../../../r4rs/r4rs_8.htm#IDX487" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-length</font></a> str) str port suppress-cr))

<a name="write-text-file-to-port-1"></a><span> <span><a href="cross-reference-index-w.html#write-text-file-to-port-1" target="control-frame"><img src="./images/small-green-up-triangle.gif" alt="In file-read: Link from write-text-file-to-port-1 to it&#39;s cross reference table entry" border="0"/></a> &nbsp;</span> </span><br/>(<a href="../../../../r4rs/r4rs_7.htm#SEC42" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>define</b></a> <b><font color = "#ff0000"  >(write-text-file-to-port-1 i max str port suppress-cr)</font></b>
  (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX352" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">&lt;</font></a> i <a href="../../../../r4rs/r4rs_8.htm#IDX363" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">max</font></a>)
    (<a href="../../../../r4rs/r4rs_6.htm#IDX117" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>begin</b></a>
      (<a href="../../../../r4rs/r4rs_6.htm#SEC35" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>let</b></a> ((ch (<a href="../../../../r4rs/r4rs_8.htm#IDX488" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">string-ref</font></a> str i)))
       (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> suppress-cr
           (<a href="../../../../r4rs/r4rs_6.htm#SEC31" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><b>if</b></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX177" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">not</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX185" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">eqv?</font></a> ch #\return)) (<a href="../../../../r4rs/r4rs_8.htm#IDX643" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">write-char</font></a> ch port))
           (<a href="../../../../r4rs/r4rs_8.htm#IDX643" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">write-char</font></a> ch port))
       (<a href="file-read.html#write-text-file-to-port-1" title="file-read" style="{text-decoration: none;}"><font color="#000080">write-text-file-to-port-1</font></a> (<a href="../../../../r4rs/r4rs_8.htm#IDX367" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">+</font></a> i 1) <a href="../../../../r4rs/r4rs_8.htm#IDX363" style="{text-decoration: none;}" target="documentation-frame" title="R4RS Scheme form"><font color="#a64700">max</font></a> str port suppress-cr)))))
  

</pre></font><div>&nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p></div></body></html>
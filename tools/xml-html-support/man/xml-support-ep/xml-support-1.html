<html><head><link href="../../../../css-stylesheets/elucidator/program.css" rel="stylesheet" title="program" type="text/css" /> <title>Source file</title></head><body bgcolor="#ffffff" text="#000000" link="#000000" vlink="#000000"><font size="2"><pre><span class="comment">; The LAML library and programs are written by Kurt Normark, Aalborg University, Denmark.
; Copyright (C) 1999  Kurt Normark, normark@s.auc.dk.
;
; This program is free software; you can redistribute it and/or modify
; it under the terms of the GNU General Public License as published by
; the Free Software Foundation; either version 2 of the License, or
; (at your option) any later version.
;
; This program is distributed in the hope that it will be useful,
; but WITHOUT ANY WARRANTY; without even the implied warranty of
; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
; GNU General Public License for more details.
;
; You should have received a copy of the GNU General Public License
; along with this program; if not, write to the Free Software
; Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span><br />

<div class="schemedoc-abstract-comment">;;;; This is a simple, non-validating XML parser for LAML together with XML pretty printing support.
;;;; As of the current version, the parser is not complete. Nevertheless, it is useful tool for parsing most
;;;; everyday XML documents to a Lisp data structure. &lt;p&gt; Given a well-formed XML document
;;;; this parser returns a Lisp tree structure that represents the parse tree of the XML document.
;;;; The parser handles start tags, end tags, and empty tags (in this parser called start-end tags).
;;;; Entities and their declarations are not handled at all.&lt;p&gt;
;;;; The top level functions are xml-parse and xml-parse-file. The xml-parser can be loaded as a library as well.&lt;p&gt;
;;;; There exists &lt;a href="../doc/xml-parser.html" target="_top"&gt;elucidative documentation&lt;/a&gt; of this parser.
;;;; See also &lt;a href="html-support.html"&gt;the HTML parsing and pretty printing support&lt;/a&gt;, which is
;;;; built on top of the XML tools, and the illustrative 
;;;; &lt;a href="../../../examples/xml-parser-and-pretty-printer/index.html"&gt;examples &lt;/a&gt; 
;;;; of the XML parser and pretty printer.&lt;p&gt;
;;;; This tool assumes that &lt;kbd&gt; laml.scm &lt;/kbd&gt; and the general library are loaded. 
;;;; The tool loads the collect-skip and the file-read libraries.&lt;p&gt;
;;;; The typographical rebreaking and re-indenting of running text is still missing.&lt;p&gt;
;;;; The LAML interactive tool procedures &lt;kbd&gt; xml-pp &lt;/kbd&gt; and &lt;kbd&gt; xml-parse &lt;/kbd&gt;
;;;; in &lt;kbd&gt; laml.scm &lt;/kbd&gt; are convenient top-level pretty printing and parse procedures respectively.&lt;p&gt;
;;;; Please notice that this is not a production quality parser and pretty printer! It is currently used for
;;;; internal purposes.&lt;p&gt;
;;;; From LAML version 20, the XML pretty printing in lib/xml-in-laml/xml-in-laml.scm replaces the XML pretty printing
;;;; in this library.
;;;; .title Reference Manual of the XML parser and pretty printer for LAML</div>

(<a class="schemedoc-name" href="../../../../man/laml.html#lib-load" title="Manual: laml">lib-load</a> "collect-skip.scm")
(<a class="schemedoc-name" href="../../../../man/laml.html#lib-load" title="Manual: laml">lib-load</a> "file-read.scm")


<div class="schemedoc-section-comment">;;; The format of the parse tree.
;;; A &lt;em&gt;parse tree&lt;/em&gt; T  produced by this tool is of the form
;;; &lt;pre&gt;    (tree N ST1 ST2 ... STn) &lt;/pre&gt;
;;; where STi, i=1..n are parse trees (recursively) and N is a node (see below). &lt;p&gt;
;;; A leaf node N may be of the form
;;; &lt;pre&gt;    (tree N) &lt;/pre&gt;
;;; or just N if N is a string (corresponding to textual contents) or an empty tag (a tag without contents).&lt;p&gt;
;;; An &lt;em&gt;inner node&lt;/em&gt; of a parse tree corresponds to a tag (an element) with contents. Such a node is represented
;;; by the following 'tag structure':
;;; &lt;pre&gt;    (tag kind tag-name . attr-info) &lt;/pre&gt;
;;; tag is a symbol (for tagging). kind is either start or start-end (both symbols).
;;; tag-name is a string. Attr-info is the attribute on property list format.&lt;p&gt;
;;; A &lt;em&gt;terminal node&lt;/em&gt; may be a start-end node, a comment node or just a contents string. End tags are not represented 
;;; in the parse tree.&lt;p&gt;
;;; Here is an example of a start-end node (empty node) with two properties:
;;; &lt;pre&gt;    (tag start-end "title" role "xxx" size "5") &lt;/pre&gt;
;;; Comments are represented as comment nodes of the form
;;; &lt;pre&gt;    (comment comment-string) &lt;/pre&gt; &lt;p&gt;
;;; Declaration nodes of the form
;;; &lt;pre&gt;    (declaration kind value) &lt;/pre&gt;
;;; are also possible. They are for instance used for document type (???) information in HTML. Finally nodes of the form
;;; &lt;pre&gt;    (xml-declaration attribute-property-list) &lt;/pre&gt;
;;; are supported.</div>
<div class="schemedoc-section-comment">;;; Constants.
;;; Constants that affect the working of the parser. </div>
<a name="xml-parser-preserve-white-space"></a><a name="xml-parser-preserve-white-space"></a><span><a href="../xml-support.html#xml-parser-preserve-white-space"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">xml-parser-preserve-white-space</span> #f)

<a name="white-space-preserving-tags"></a><a name="white-space-preserving-tags"></a><span><a href="../xml-support.html#white-space-preserving-tags"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">white-space-preserving-tags</span> '())


<a name="parse-error"></a><span class="comment">; ---------------------------------------------------------------------------------------------------
; Parse specific error and message funtions.</span><br />
<a name="parse-error"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-error . x)</span>
  (<a class="schemedoc-name" href="../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "PARSE ERROR: " (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX411" title="R5RS Scheme form">apply</a> <a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> x))))
  (<a class="applied-name" href="xml-support-1.html#parser-status" title="xml-support">parser-status</a>)
  (error "STOPPING THE PARSER"))


<a name="parse-message"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-message . x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> <a class="applied-name" href="xml-support-1.html#xml-parse-verbose" title="xml-support">xml-parse-verbose</a>
      (<a class="schemedoc-name" href="../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX411" title="R5RS Scheme form">apply</a> <a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> x))))))

<a name="recently-skipped-white-space"></a><span class="comment">; ---------------------------------------------------------------------------------------------------
; Overall functions</span><br />
<a name="recently-skipped-white-space"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">recently-skipped-white-space</span> "")

<a name="skip-white-space"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(skip-white-space)</span>
  (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#skip-while" title="Manual: collect-skip">skip-while</a> <a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#is-white-space?" title="Manual: collect-skip">is-white-space?</a>))

<a name="skip-white-space"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(skip-white-space)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">skipped-white-space</span> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#collect-until" title="Manual: collect-skip">collect-until</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#negate" title="Manual: general">negate</a> <a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#is-white-space?" title="Manual: collect-skip">is-white-space?</a>))))
    (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="xml-support-1.html#recently-skipped-white-space" title="xml-support">recently-skipped-white-space</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> <a class="applied-name" href="xml-support-1.html#recently-skipped-white-space" title="xml-support">recently-skipped-white-space</a> skipped-white-space))))

<a name="reset-white-space"></a><span class="comment">; Reset the recently skipped white space collection (to the empty string).</span><br /><a name="reset-white-space"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(reset-white-space)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="xml-support-1.html#recently-skipped-white-space" title="xml-support">recently-skipped-white-space</a> ""))

<a name="already-skipped-white-space"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(already-skipped-white-space)</span>
  <a class="applied-name" href="xml-support-1.html#recently-skipped-white-space" title="xml-support">recently-skipped-white-space</a>)
  

<a name="skip-white-space-and-comments"></a><span class="comment">; Skip white space and XML comments</span><br /><a name="skip-white-space-and-comments"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(skip-white-space-and-comments)</span>
  (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
  (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 4)
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> end-of-file?) (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&lt;!--"))
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a> 
        (<a class="applied-name" href="xml-support-1.html#parse-message" title="xml-support">parse-message</a> "Skipping comment")
        (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-string" title="Manual: collect-skip">read-a-string</a> 4)
        (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#skip-until-string" title="Manual: collect-skip">skip-until-string</a> "--&gt;" #t)
        (<a class="applied-name" href="xml-support-1.html#skip-white-space-and-comments" title="xml-support">skip-white-space-and-comments</a>))))


<span class="comment">; ---------------------------------------------------------------------------------------------------</span><br /><div class="schemedoc-section-comment">;;; Native low-level level parser functions.
;;; The top level parser functions in this section deliver specialized low level parse trees (in some ad hoc list structure).</div>
<a name="parse-xml-file"></a><a name="parse-xml-file"></a><span><a href="../xml-support.html#parse-xml-file"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-xml-file in-file-path out-file-path)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">init-in-path</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#file-name-initial-path" title="Manual: general">file-name-initial-path</a> in-file-path))
       (<span class="local-name-binding">in-file-name-prop</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#file-name-proper" title="Manual: general">file-name-proper</a> in-file-path))
       (<span class="local-name-binding">in-ext</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#file-name-extension" title="Manual: general">file-name-extension</a> in-file-path))
      )
   (<a class="applied-name" href="xml-support-1.html#reset-xml-parser" title="xml-support">reset-xml-parser</a>)
   (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">input-port</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX444" title="R5RS Scheme form">open-input-file</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> init-in-path in-file-name-prop "." (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#empty-string?" title="Manual: general">empty-string?</a> in-ext) "xml" in-ext)))))
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> ip input-port)
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">parse-tree</span> (<a class="applied-name" href="xml-support-1.html#parse-xml-ip" title="xml-support">parse-xml-ip</a>))
            (<span class="local-name-binding">target-file-name</span> out-file-path))
       (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="xml-support-1.html#resulting-parse-tree" title="xml-support">resulting-parse-tree</a> parse-tree)
       (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (file-exists? target-file-name) (delete-file target-file-name))
       (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">op</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX445" title="R5RS Scheme form">open-output-file</a> target-file-name)))
         (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX459" title="R5RS Scheme form">write</a> parse-tree op)
         (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX447" title="R5RS Scheme form">close-output-port</a> op)))

      (<a class="schemedoc-name" href="../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "DONE. The parse tree is in " out-file-path))
      (<a class="schemedoc-name" href="../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> "Use (scheme-pp &lt;file&gt;) to pretty pring the parse tree.")
      (<a class="schemedoc-name" href="../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> "The result is also in the variable resulting-parse-tree for interactive use.")
      (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX446" title="R5RS Scheme form">close-input-port</a> ip))))

<a name="parse-xml"></a><a name="parse-xml"></a><span><a href="../xml-support.html#parse-xml"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-xml file-path)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">init-path</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#file-name-initial-path" title="Manual: general">file-name-initial-path</a> file-path))
       (<span class="local-name-binding">file-name-prop</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#file-name-proper" title="Manual: general">file-name-proper</a> file-path))
       (<span class="local-name-binding">ext</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#file-name-extension" title="Manual: general">file-name-extension</a> file-path))
      )
   (<a class="applied-name" href="xml-support-1.html#reset-xml-parser" title="xml-support">reset-xml-parser</a>)
   (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">input-port</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX444" title="R5RS Scheme form">open-input-file</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> init-path file-name-prop "." (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#empty-string?" title="Manual: general">empty-string?</a> ext) "xml" ext)))))
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> ip input-port)
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">parse-tree</span> (<a class="applied-name" href="xml-support-1.html#parse-xml-ip" title="xml-support">parse-xml-ip</a>)))
        (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX446" title="R5RS Scheme form">close-input-port</a> ip)
        parse-tree))))

<a name="parse-xml-string"></a><a name="parse-xml-string"></a><span><a href="../xml-support.html#parse-xml-string"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-xml-string xml-string)</span>
   (<a class="applied-name" href="xml-support-1.html#reset-xml-parser" title="xml-support">reset-xml-parser</a>)
   (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> ip xml-string)
   (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">parse-tree</span> (<a class="applied-name" href="xml-support-1.html#parse-xml-ip" title="xml-support">parse-xml-ip</a>)))
     parse-tree))


<a name="reset-xml-parser"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(reset-xml-parser)</span>
  (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#reset-look-ahead-buffer" title="Manual: collect-skip">reset-look-ahead-buffer</a>)
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="xml-support-1.html#parse-stack" title="xml-support">parse-stack</a> '()))


<span class="comment">; ---------------------------------------------------------------------------------------------------</span><br /><div class="schemedoc-section-comment">;;; AST-level parser functions.
;;; The top level parser functions in this section deliver XML-in-LAML abstract syntax trees.
;;; These trees are much more useful than the low-level parse trees delivered by the functions in the previous section.</div>
<a name="parse-xml-file-to-ast"></a><a name="parse-xml-file-to-ast"></a><span><a href="../xml-support.html#parse-xml-file-to-ast"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-xml-file-to-ast in-file-path out-file-path xml-language)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">init-in-path</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#file-name-initial-path" title="Manual: general">file-name-initial-path</a> in-file-path))
       (<span class="local-name-binding">in-file-name-prop</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#file-name-proper" title="Manual: general">file-name-proper</a> in-file-path))
       (<span class="local-name-binding">in-ext</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#file-name-extension" title="Manual: general">file-name-extension</a> in-file-path))
      )
   (<a class="applied-name" href="xml-support-1.html#reset-xml-parser" title="xml-support">reset-xml-parser</a>)
   (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">input-port</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX444" title="R5RS Scheme form">open-input-file</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> init-in-path in-file-name-prop "." (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#empty-string?" title="Manual: general">empty-string?</a> in-ext) "xml" in-ext)))))
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> ip input-port)
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">parse-tree</span> (<a class="applied-name" href="xml-support-1.html#parse-tree-to-ast" title="xml-support">parse-tree-to-ast</a> (<a class="applied-name" href="xml-support-1.html#parse-xml-ip" title="xml-support">parse-xml-ip</a>) xml-language))
            (<span class="local-name-binding">target-file-name</span> out-file-path))
       (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="xml-support-1.html#resulting-parse-tree" title="xml-support">resulting-parse-tree</a> parse-tree)
       (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (file-exists? target-file-name) (delete-file target-file-name))
       (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">op</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX445" title="R5RS Scheme form">open-output-file</a> target-file-name)))
         (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX459" title="R5RS Scheme form">write</a> parse-tree op)
         (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX447" title="R5RS Scheme form">close-output-port</a> op)))

      (<a class="schemedoc-name" href="../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "DONE. The XML-in-LAML AST is in " out-file-path))
      (<a class="schemedoc-name" href="../../../../lib/man/general.html#display-message" title="Manual: general">display-message</a> "The result is also in the variable resulting-parse-tree for interactive use.")
      (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX446" title="R5RS Scheme form">close-input-port</a> ip))))

<a name="parse-xml-to-ast"></a><a name="parse-xml-to-ast"></a><span><a href="../xml-support.html#parse-xml-to-ast"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-xml-to-ast file-path xml-language)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">init-path</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#file-name-initial-path" title="Manual: general">file-name-initial-path</a> file-path))
       (<span class="local-name-binding">file-name-prop</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#file-name-proper" title="Manual: general">file-name-proper</a> file-path))
       (<span class="local-name-binding">ext</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#file-name-extension" title="Manual: general">file-name-extension</a> file-path))
      )
   (<a class="applied-name" href="xml-support-1.html#reset-xml-parser" title="xml-support">reset-xml-parser</a>)
   (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">input-port</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX444" title="R5RS Scheme form">open-input-file</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> init-path file-name-prop "." (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#empty-string?" title="Manual: general">empty-string?</a> ext) "xml" ext)))))
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> ip input-port)
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">parse-tree</span> (<a class="applied-name" href="xml-support-1.html#parse-tree-to-ast" title="xml-support">parse-tree-to-ast</a> (<a class="applied-name" href="xml-support-1.html#parse-xml-ip" title="xml-support">parse-xml-ip</a>) xml-language)))
        (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX446" title="R5RS Scheme form">close-input-port</a> ip)
        parse-tree))))

<a name="parse-xml-string-to-ast"></a><a name="parse-xml-string-to-ast"></a><span><a href="../xml-support.html#parse-xml-string-to-ast"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-xml-string-to-ast xml-string xml-language)</span>
   (<a class="applied-name" href="xml-support-1.html#reset-xml-parser" title="xml-support">reset-xml-parser</a>)
   (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> ip xml-string)
   (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">parse-tree</span> (<a class="applied-name" href="xml-support-1.html#parse-tree-to-ast" title="xml-support">parse-tree-to-ast</a> (<a class="applied-name" href="xml-support-1.html#parse-xml-ip" title="xml-support">parse-xml-ip</a>) xml-language)))
     parse-tree))


<a name="xml-parse-verbose"></a><span class="comment">; ---------------------------------------------------------------------------------------------------
;::parse-stack::
; Parse state: the parse stack</span><br />
<a name="xml-parse-verbose"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">xml-parse-verbose</span> #f)

<a name="parse-stack"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">parse-stack</span> '())

<a name="parse-stack-push"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-stack-push x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="xml-support-1.html#parse-stack" title="xml-support">parse-stack</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> x <a class="applied-name" href="xml-support-1.html#parse-stack" title="xml-support">parse-stack</a>)))

<a name="parse-stack-pop"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-stack-pop)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="xml-support-1.html#parse-stack-empty?" title="xml-support">parse-stack-empty?</a>))
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="xml-support-1.html#parse-stack" title="xml-support">parse-stack</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> <a class="applied-name" href="xml-support-1.html#parse-stack" title="xml-support">parse-stack</a>))
      (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "Trying to pop an empty parse stack"))))

<a name="parse-stack-top"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-stack-top)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="xml-support-1.html#parse-stack-empty?" title="xml-support">parse-stack-empty?</a>))
      (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> <a class="applied-name" href="xml-support-1.html#parse-stack" title="xml-support">parse-stack</a>)
      (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "Trying to access the top of an empty parse stack"))))

<a name="parse-stack-empty?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-stack-empty?)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> <a class="applied-name" href="xml-support-1.html#parse-stack" title="xml-support">parse-stack</a>))

<a name="parse-stack-but-top"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-stack-but-top)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="xml-support-1.html#parse-stack-empty?" title="xml-support">parse-stack-empty?</a>))
      (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> <a class="applied-name" href="xml-support-1.html#parse-stack" title="xml-support">parse-stack</a>)
      (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "Trying to access the top of an empty parse stack"))))

<a name="parse-stack-top-and-pop"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-stack-top-and-pop)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="xml-support-1.html#parse-stack-empty?" title="xml-support">parse-stack-empty?</a>))
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">res</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> <a class="applied-name" href="xml-support-1.html#parse-stack" title="xml-support">parse-stack</a>)))
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="xml-support-1.html#parse-stack" title="xml-support">parse-stack</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> <a class="applied-name" href="xml-support-1.html#parse-stack" title="xml-support">parse-stack</a>))
        res
      )
      (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "Trying to access the top of an empty parse stack"))))

<a name="parse-stack-bottom"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-stack-bottom)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="xml-support-1.html#parse-stack-empty?" title="xml-support">parse-stack-empty?</a>))
      (<a class="schemedoc-name" href="../../../../lib/man/general.html#last" title="Manual: general">last</a> <a class="applied-name" href="xml-support-1.html#parse-stack" title="xml-support">parse-stack</a>)
      (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "Trying to access the bottom of an empty parse stack"))))


<a name="make-tag-structure"></a><span class="comment">; ---------------------------------------------------------------------------------------------------
; Tag structure and comment structure functions</span><br />
<a name="make-tag-structure"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(make-tag-structure kind tag-name attribute-property-list)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> 'tag (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> kind (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> tag-name attribute-property-list))))

<a name="kind-of-tag-structure"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(kind-of-tag-structure tag-structure)</span>
  (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cadr</a> tag-structure)))

<a name="tag-of-tag-structure"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(tag-of-tag-structure tag-structure)</span>
  (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">caddr</a> tag-structure)))

<a name="attributes-of-tag-structure"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(attributes-of-tag-structure tag-structure)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cdddr</a> tag-structure))

<a name="attribute-value"></a><span class="comment">; Return the attribute value of attribute-key (a symbol) in attribute-list.
; If attribute does not exist, return #f.</span><br /><a name="attribute-value"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(attribute-value attribute-key attribute-list)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">a-list</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#propertylist-to-alist" title="Manual: general">propertylist-to-alist</a> attribute-list)))
   (<a class="schemedoc-name" href="../../../../lib/man/general.html#defaulted-get" title="Manual: general">defaulted-get</a> attribute-key a-list #f)))
  
<a name="make-comment-structure"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(make-comment-structure comment-string)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'comment comment-string))

<a name="make-processing-instruction-structure"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(make-processing-instruction-structure pi-two-element-list)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> 'processing-instruction pi-two-element-list))

<a name="make-declaration-structure"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(make-declaration-structure kind val)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'declaration kind val))

<a name="make-xml-declaration-structure"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(make-xml-declaration-structure attribute-plist)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'xml-declaration attribute-plist))

<a name="comment-of-comment-structure"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(comment-of-comment-structure node)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cadr</a> node))

<a name="kind-of-declaration-structure"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(kind-of-declaration-structure node)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cadr</a> node))

<a name="value-of-declaration-structure"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(value-of-declaration-structure node)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">caddr</a> node))

<a name="attributes-of-xml-declaration-structure"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(attributes-of-xml-declaration-structure node)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cadr</a> node))

<a name="html-tree-node?"></a><span class="comment">; -------------------------------------------------------
; Tag structure and comment structure predicates.</span><br />
<a name="html-tree-node?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(html-tree-node? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> x) 1) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x) 'html-tree)))

<a name="xml-tree-node?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(xml-tree-node? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> x) 1) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x) 'xml-tree))) 

<a name="start-node?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(start-node? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> x) 2) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x) 'tag) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cadr</a> x) 'start)))

<a name="start-end-node?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(start-end-node? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> x) 2) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x) 'tag) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cadr</a> x) 'start-end)))

<a name="comment-node?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(comment-node? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> x) 2) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x) 'comment)))

<a name="processing-instruction-node?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(processing-instruction-node? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> x) 2) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x) 'processing-instruction)))

<a name="declaration-node?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(declaration-node? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> x) 3) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x) 'declaration)))

<a name="xml-declaration-node?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(xml-declaration-node? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> x) 2) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x) 'xml-declaration)))

<span class="comment">; ---------------------------------------------------------------------------------------------------
; Parse tree functions</span><br />
<a name="resulting-parse-tree"></a><a name="resulting-parse-tree"></a><span><a href="../xml-support.html#resulting-parse-tree"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">resulting-parse-tree</span> #f)

<a name="make-parse-tree"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(make-parse-tree node subtree-list)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> 'tree (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> node subtree-list)))

<a name="root-of-parse-tree"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(root-of-parse-tree tree)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cadr</a> tree))

<a name="subtrees-of-parse-tree"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(subtrees-of-parse-tree tree)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cddr</a> tree))

<a name="subtrees-of-xml-html-parse-tree"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">subtrees-of-xml-html-parse-tree</span> <a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a>)

<a name="parse-tree?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-tree? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX319" title="R5RS Scheme form">pair?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x) 'tree)))

<a name="textual-content-node?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">textual-content-node?</span> <a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX374" title="R5RS Scheme form">string?</a>)

<a name="terminal-node?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(terminal-node? tree)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX374" title="R5RS Scheme form">string?</a> tree) 
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> tree) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> 2 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> tree)) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX374" title="R5RS Scheme form">string?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cadr</a> tree)))
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> tree) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> 2 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> tree)) (<a class="applied-name" href="xml-support-1.html#start-end-node?" title="xml-support">start-end-node?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cadr</a> tree)))
      (<a class="applied-name" href="xml-support-1.html#start-end-node?" title="xml-support">start-end-node?</a> tree)
      (<a class="applied-name" href="xml-support-1.html#comment-node?" title="xml-support">comment-node?</a> tree)
      (<a class="applied-name" href="xml-support-1.html#declaration-node?" title="xml-support">declaration-node?</a> tree)
      (<a class="applied-name" href="xml-support-1.html#xml-declaration-node?" title="xml-support">xml-declaration-node?</a> tree)))

<a name="inner-node?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(inner-node? tree)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="xml-support-1.html#terminal-node?" title="xml-support">terminal-node?</a> tree)))

<a name="node-of-tree"></a><span class="comment">; Return the node of a tree, which may be a contents string, a tag structure or a comment structure.</span><br /><a name="node-of-tree"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(node-of-tree tree)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="xml-support-1.html#terminal-node?" title="xml-support">terminal-node?</a> tree)
          (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX374" title="R5RS Scheme form">string?</a> tree) tree)
                ((<a class="applied-name" href="xml-support-1.html#start-end-node?" title="xml-support">start-end-node?</a> tree) tree)
                ((<a class="applied-name" href="xml-support-1.html#comment-node?" title="xml-support">comment-node?</a> tree) tree)
                (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="applied-name" href="xml-support-1.html#root-of-parse-tree" title="xml-support">root-of-parse-tree</a> tree))))
       ((<a class="applied-name" href="xml-support-1.html#inner-node?" title="xml-support">inner-node?</a> tree)
          (<a class="applied-name" href="xml-support-1.html#root-of-parse-tree" title="xml-support">root-of-parse-tree</a> tree))))

<a name="node-info"></a><span class="comment">; Return the node contents or tag name of the node (a symbol). An ad hoc function.
; The node may have been extracted ny node-of-tree.</span><br /><a name="node-info"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(node-info node)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="xml-support-1.html#text-contents-entry?" title="xml-support">text-contents-entry?</a> node) 
           (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX374" title="R5RS Scheme form">string?</a> node) node (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> node)))
       ((<a class="applied-name" href="xml-support-1.html#tag-entry?" title="xml-support">tag-entry?</a> node)
           (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> node)))
       ((<a class="applied-name" href="xml-support-1.html#comment-entry?" title="xml-support">comment-entry?</a> node)
           (<a class="applied-name" href="xml-support-1.html#comment-of-comment-structure" title="xml-support">comment-of-comment-structure</a> node))
       (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (error "node-info: Should not happen"))))

<a name="node-attribute-info"></a><span class="comment">; Return the attributes of a node. If there is no attributes of the node, return the empty list.</span><br /><a name="node-attribute-info"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(node-attribute-info node)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="xml-support-1.html#text-contents-entry?" title="xml-support">text-contents-entry?</a> node) 
           '())
       ((<a class="applied-name" href="xml-support-1.html#tag-entry?" title="xml-support">tag-entry?</a> node)
           (<a class="applied-name" href="xml-support-1.html#attributes-of-tag-structure" title="xml-support">attributes-of-tag-structure</a> node))
       (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (error "node-attribute-inf: Should not happen"))))
 
 

<a name="tag-entry?"></a><span class="comment">; ---------------------------------------------------------------------------------------------------
; Predicates on trees and tag structures:
; Most useful to make sense of stack entries. Can also be used to distinguish various kinds of subtrees
; of a tree from each other.</span><br />
<a name="tag-entry?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(tag-entry? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> x) 2) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x) 'tag)))

<a name="comment-entry?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(comment-entry? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> x) 2) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x) 'comment)))

<a name="declaration-entry?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(declaration-entry? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> x) 3) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x) 'declaration)))

<a name="xml-declaration-entry?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(xml-declaration-entry? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> x) 2) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x) 'xml-declaration)))

<a name="start-tag-entry?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(start-tag-entry? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="xml-support-1.html#tag-entry?" title="xml-support">tag-entry?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cadr</a> x) 'start)))

<a name="start-end-tag-entry?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(start-end-tag-entry? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="xml-support-1.html#tag-entry?" title="xml-support">tag-entry?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cadr</a> x) 'start-end)))

<a name="tree-entry?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(tree-entry? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> x) 2) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x) 'tree)))

<a name="text-contents-entry?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(text-contents-entry? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX374" title="R5RS Scheme form">string?</a> x) (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> 1 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> x)) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX374" title="R5RS Scheme form">string?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x)))))

<a name="html-root?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(html-root? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> x) 1) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x) 'html-tree)))

<a name="xml-root?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(xml-root? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX331" title="R5RS Scheme form">list?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> x) 1) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> x) 'xml-tree)))
  


<a name="parse-xml-ip"></a><span class="comment">; ---------------------------------------------------------------------------------------------------
; Substantial parse functions.</span><br />

<a name="parse-xml-ip"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-xml-ip)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> end-of-file?) (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>))
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> end-of-file? (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="applied-name" href="xml-support-1.html#parse-stack-empty?" title="xml-support">parse-stack-empty?</a>)) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> <a class="applied-name" href="xml-support-1.html#parse-stack" title="xml-support">parse-stack</a>) 1))
          (<a class="applied-name" href="xml-support-1.html#aggregate-final-parse-tree" title="xml-support">aggregate-final-parse-tree</a> 'xml-tree))
        ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> end-of-file? (<a class="applied-name" href="xml-support-1.html#parse-stack-empty?" title="xml-support">parse-stack-empty?</a>))
          (<a class="applied-name" href="xml-support-1.html#make-final-parse-tree" title="xml-support">make-final-parse-tree</a> 'xml-tree '()))
        ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> end-of-file?)
          (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">next-parse-tree</span> (<a class="applied-name" href="xml-support-1.html#parse-xml-balanced-expression" title="xml-support">parse-xml-balanced-expression</a> <a class="applied-name" href="xml-support-1.html#xml-parser-preserve-white-space" title="xml-support">xml-parser-preserve-white-space</a>)))
            (<a class="applied-name" href="xml-support-1.html#parse-stack-push" title="xml-support">parse-stack-push</a> next-parse-tree)
            (<a class="applied-name" href="xml-support-1.html#parse-xml-ip" title="xml-support">parse-xml-ip</a>)))
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (error (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "parse-xml-ip: strange parse error.")))))


<a name="skip-front-matters"></a><span class="comment">; Skip all XML document prefix stuff, including comments.
; As of this version, it cannot skip an inline DTD (causes parse error).</span><br /><a name="skip-front-matters"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(skip-front-matters)</span>
 (<a class="applied-name" href="xml-support-1.html#parse-message" title="xml-support">parse-message</a> "Skipping front matter")
 (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
 (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 2)
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&lt;?")
          (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-string" title="Manual: collect-skip">read-a-string</a> 2)
          (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#skip-until-string" title="Manual: collect-skip">skip-until-string</a> "?&gt;" #t)
          (<a class="applied-name" href="xml-support-1.html#skip-front-matters" title="xml-support">skip-front-matters</a>))
       ((<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&lt;!") <span class="comment">; <span><a name="skip-front-matters-@a"></a> @a</span></span><br />         (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">comment</span> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#collect-balanced-until" title="Manual: collect-skip">collect-balanced-until</a> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span>) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> ch #\<)) (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span>) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> ch #\>)))))
            'do-nothing)
         (<a class="applied-name" href="xml-support-1.html#skip-front-matters" title="xml-support">skip-front-matters</a>))))

<a name="parse-xml-balanced-expression"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-xml-balanced-expression preserve-white-space)</span>
  (<a class="applied-name" href="xml-support-1.html#parse-message" title="xml-support">parse-message</a> "Parsing balanced expression.")
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> end-of-file?) (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>))
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">what</span> (<a class="applied-name" href="xml-support-1.html#what-is-ahead" title="xml-support">what-is-ahead</a>))) <span class="comment">; <span><a name="parse-xml-balanced-expression-@a"></a> @a</span>- looks ahead - does not read</span><br />    (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> what 'tag) 
            (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">tag</span> (<a class="applied-name" href="xml-support-1.html#read-tag" title="xml-support">read-tag</a>)) <span class="comment">; <span><a name="parse-xml-balanced-expression-@b"></a> @b</span></span><br />                   (<span class="local-name-binding">is-tag-white-space-preserving?</span> 
                       (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> tag) <a class="applied-name" href="xml-support-1.html#white-space-preserving-tags" title="xml-support">white-space-preserving-tags</a>)
                            preserve-white-space  <span class="comment">; inherit white space preservation from parent</span><br />                       ))
                   (<span class="local-name-binding">kind</span> (<a class="applied-name" href="xml-support-1.html#kind-of-tag-structure" title="xml-support">kind-of-tag-structure</a> tag)))
              (<a class="applied-name" href="xml-support-1.html#reset-white-space" title="xml-support">reset-white-space</a>)
              (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> kind 'start) <span class="comment">; <span><a name="parse-xml-balanced-expression-@c"></a> @c</span></span><br />                       (<a class="applied-name" href="xml-support-1.html#parse-stack-push" title="xml-support">parse-stack-push</a> tag)
                       (<a class="applied-name" href="xml-support-1.html#read-and-push-subtrees-until-end-tag" title="xml-support">read-and-push-subtrees-until-end-tag</a> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> tag) is-tag-white-space-preserving?) <span class="comment">; consumes the end tag too</span><br />                       (<a class="applied-name" href="xml-support-1.html#build-tree-from-stack" title="xml-support">build-tree-from-stack</a> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> tag))  <span class="comment">; return inner node</span><br />                    )
                    ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> kind 'start-end) 
                       tag  <span class="comment">; return terminal node</span><br />                    )
                    ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> kind 'end) (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> "end tag encountered without matching start tag: " (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> tag)))
                    (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> "parse-xml-balanced-expression: unknown kind of tag"))
              )
             )
           )
           ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> what 'contents-string)
              (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">contents-string</span> (<a class="applied-name" href="xml-support-1.html#read-contents-string" title="xml-support">read-contents-string</a> preserve-white-space)))
                 (<a class="applied-name" href="xml-support-1.html#reset-white-space" title="xml-support">reset-white-space</a>)
                 contents-string))
           ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> what 'comment)
              (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">comment-string</span> (<a class="applied-name" href="xml-support-1.html#read-comment" title="xml-support">read-comment</a>)))
                 (<a class="applied-name" href="xml-support-1.html#make-comment-structure" title="xml-support">make-comment-structure</a> comment-string)))
           ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> what 'processing-instruction)
              (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">pi-structure</span> (<a class="applied-name" href="xml-support-1.html#read-processing-instruction" title="xml-support">read-processing-instruction</a>)))
                 (<a class="applied-name" href="xml-support-1.html#make-processing-instruction-structure" title="xml-support">make-processing-instruction-structure</a> pi-structure)))
           ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> what 'declaration)
              (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">declaration-structure</span> (<a class="applied-name" href="xml-support-1.html#read-declaration" title="xml-support">read-declaration</a>)))
                 (<a class="applied-name" href="xml-support-1.html#make-declaration-structure" title="xml-support">make-declaration-structure</a> 
                        (<a class="applied-name" href="xml-support-1.html#kind-of-declaration-structure" title="xml-support">kind-of-declaration-structure</a> declaration-structure)
                        (<a class="applied-name" href="xml-support-1.html#value-of-declaration-structure" title="xml-support">value-of-declaration-structure</a> declaration-structure))))
           ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX199" title="R5RS Scheme form">eq?</a> what 'xml-declaration)
               (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">attributes</span> (<a class="applied-name" href="xml-support-1.html#read-xml-declaration" title="xml-support">read-xml-declaration</a>)))
                  (<a class="applied-name" href="xml-support-1.html#make-xml-declaration-structure" title="xml-support">make-xml-declaration-structure</a> attributes)))
           (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> "parse-xml-balanced-expression: Parse problem")))))

<a name="read-comment"></a><span class="comment">; redefined next</span><br /><a name="read-comment"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(read-comment)</span>
  (<a class="applied-name" href="xml-support-1.html#parse-message" title="xml-support">parse-message</a> "Reading comment")
  (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
  (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 4)
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&lt;!--")
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a>
        (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-string" title="Manual: collect-skip">read-a-string</a> 4)
        (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">res</span> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#collect-until-string" title="Manual: collect-skip">collect-until-string</a> "--")))
          (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-string" title="Manual: collect-skip">read-a-string</a> 2)
          (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
          (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 1)
          (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&gt;")
              (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-char" title="Manual: collect-skip">read-a-char</a>)
              (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> "End of comment char &#39;&gt;&#39; expected"))
          res))
      (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> "Beginning of comment &#39;&lt;!--&#39; expected")))

<a name="read-comment"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(read-comment)</span>   <span class="comment">; april 24, 2009. Quick error fix.</span><br />  (<a class="applied-name" href="xml-support-1.html#parse-message" title="xml-support">parse-message</a> "Reading comment")
  (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
  (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 4)
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&lt;!--")
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a>
        (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-string" title="Manual: collect-skip">read-a-string</a> 4)
        (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">res</span> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#collect-until-string" title="Manual: collect-skip">collect-until-string</a> "--&gt;")))
          res))
      (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> "Beginning of comment &#39;&lt;!--&#39; expected")))

<a name="read-processing-instruction"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(read-processing-instruction)</span>
  (<a class="applied-name" href="xml-support-1.html#parse-message" title="xml-support">parse-message</a> "Reading processing instruction")
  (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
  (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 4)
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&lt;?")
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a>
        (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-string" title="Manual: collect-skip">read-a-string</a> 2)
        (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">pi-target</span> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#collect-until" title="Manual: collect-skip">collect-until</a> <a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#is-white-space?" title="Manual: collect-skip">is-white-space?</a>)))
          (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
          (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">pi-string</span> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#collect-until-string" title="Manual: collect-skip">collect-until-string</a> "?&gt;")))
            (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-string" title="Manual: collect-skip">read-a-string</a> 2)
            (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
            (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> pi-target pi-string))))
       (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> "Beginning of processing instruction &lt;? expected")))
            


<a name="read-declaration"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(read-declaration)</span> <span class="comment">; such as doctype. A primitive version.</span><br />  (<a class="applied-name" href="xml-support-1.html#parse-message" title="xml-support">parse-message</a> "Reading declaration")
  (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
  (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 2)
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&lt;!")
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a>
         (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-string" title="Manual: collect-skip">read-a-string</a> 2)
         (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
         (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">kind</span> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#collect-until" title="Manual: collect-skip">collect-until</a> <a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#is-white-space?" title="Manual: collect-skip">is-white-space?</a>)))
           (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
           (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">val</span> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#collect-until-string" title="Manual: collect-skip">collect-until-string</a> "&gt;")))
             (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-char" title="Manual: collect-skip">read-a-char</a>) <span class="comment">; &gt;</span><br />             (<a class="applied-name" href="xml-support-1.html#make-declaration-structure" title="xml-support">make-declaration-structure</a> kind val))))
      (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> "Beginning of decaration &#39;&lt;!&#39; expected")))

<a name="read-xml-declaration"></a><span class="comment">; Return a the attribute list (property list) of an xml-declaration-structure.
; This procedures reads over the entire &lt;? ... ?&gt;  structure</span><br /><a name="read-xml-declaration"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(read-xml-declaration)</span> <span class="comment">; &lt;? ... ?&gt; </span><br />  (<a class="applied-name" href="xml-support-1.html#parse-message" title="xml-support">parse-message</a> "Reading xml declaration")
  (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
  (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 5)
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&lt;?xml")
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a>
         (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-string" title="Manual: collect-skip">read-a-string</a> 5)
         (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
         (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">attributes</span> (<a class="applied-name" href="xml-support-1.html#read-tag-attributes" title="xml-support">read-tag-attributes</a>)))
           (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
           (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 2)
           (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "?&gt;")
               (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-string" title="Manual: collect-skip">read-a-string</a> 2)
               (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> "?&gt; expected"))
           attributes))
      (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> "Beginning of declaration &#39;&lt;?xml&#39; expected")))



<a name="what-is-ahead"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(what-is-ahead)</span> 
  (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 5)
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&lt;!--")  'comment)
        ((<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&lt;!") 'declaration)  <span class="comment">; right concept?</span><br />        ((<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&lt;?xml") 'xml-declaration)   <span class="comment">; right concept?</span><br />        ((<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&lt;?") 'processing-instruction)  
        ((<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&lt;") 'tag)
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> 'contents-string)))

<a name="read-contents-string"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(read-contents-string preserve-white-space)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">cont-string</span> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#collect-until" title="Manual: collect-skip">collect-until</a> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span>) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> ch #\<)))))
    (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> preserve-white-space            <span class="comment">; earlier: (white-space-preserving-context? parse-stack)</span><br />        (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> (<a class="applied-name" href="xml-support-1.html#already-skipped-white-space" title="xml-support">already-skipped-white-space</a>) cont-string)
        (<a class="applied-name" href="xml-support-1.html#remove-redundant-white-space" title="xml-support">remove-redundant-white-space</a> cont-string))))

<a name="white-space-preserving-context?"></a><span class="comment">; In a white space preserving context, such as HTML pre, strings are not rebroken.
; In XML we should probably chose always to preserve white space.</span><br /><a name="white-space-preserving-context?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(white-space-preserving-context? parse-stack)</span>
  #f)


<a name="remove-redundant-white-space"></a><span class="comment">; remove extra white space from str by returning a truncated string. Turn extra white space in spaces. A pure function.</span><br /><a name="remove-redundant-white-space"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(remove-redundant-white-space str)</span>
  (<a class="applied-name" href="xml-support-1.html#remove-redundant-white-space-1" title="xml-support">remove-redundant-white-space-1</a> str "" 0 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> str) #f))

<a name="remove-redundant-white-space-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(remove-redundant-white-space-1 str res i lgt removing)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> i lgt) res)
        ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> removing (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#is-white-space?" title="Manual: collect-skip">is-white-space?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> str i))) 
             (<a class="applied-name" href="xml-support-1.html#remove-redundant-white-space-1" title="xml-support">remove-redundant-white-space-1</a> str res (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> i 1) lgt #t))
        ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> removing (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#is-white-space?" title="Manual: collect-skip">is-white-space?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> str i)))) 
             (<a class="applied-name" href="xml-support-1.html#remove-redundant-white-space-1" title="xml-support">remove-redundant-white-space-1</a> str (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> res (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> str i)))  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> i 1) lgt #f))
        ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> removing) (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#is-white-space?" title="Manual: collect-skip">is-white-space?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> str i)))
             (<a class="applied-name" href="xml-support-1.html#remove-redundant-white-space-1" title="xml-support">remove-redundant-white-space-1</a> str (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> res (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\space))  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> i 1) lgt #t))
        ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> removing) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#is-white-space?" title="Manual: collect-skip">is-white-space?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> str i))))
             (<a class="applied-name" href="xml-support-1.html#remove-redundant-white-space-1" title="xml-support">remove-redundant-white-space-1</a> str (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> res (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> str i)))  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> i 1) lgt #f))
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (error "remove-redundant-white-space-1: should not happen"))))

<a name="read-and-push-subtrees-until-end-tag"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(read-and-push-subtrees-until-end-tag end-tag-name preserve-white-space)</span>
  (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">n</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> end-tag-name) 3)) <span class="comment">; <span><a name="read-and-push-subtrees-until-end-tag-@a"></a> @a</span></span><br />         (<span class="local-name-binding">end-tag-string</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\<) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\/) end-tag-name (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\>)))
        )
    (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> n)
    (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> end-tag-string) <span class="comment">; <span><a name="read-and-push-subtrees-until-end-tag-@b"></a> @b</span></span><br />        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a> 
          (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-string" title="Manual: collect-skip">read-a-string</a> n) <span class="comment">; finish
;          (skip-white-space)</span><br />        )
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">subtree</span> (<a class="applied-name" href="xml-support-1.html#parse-xml-balanced-expression" title="xml-support">parse-xml-balanced-expression</a> preserve-white-space))) <span class="comment">; <span><a name="read-and-push-subtrees-until-end-tag-@c"></a> @c</span></span><br />          (<a class="applied-name" href="xml-support-1.html#reset-white-space" title="xml-support">reset-white-space</a>)
          (<a class="applied-name" href="xml-support-1.html#parse-stack-push" title="xml-support">parse-stack-push</a> subtree)
          (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
          (<a class="applied-name" href="xml-support-1.html#read-and-push-subtrees-until-end-tag" title="xml-support">read-and-push-subtrees-until-end-tag</a> end-tag-name preserve-white-space) <span class="comment">; tail recursive parsing of contents</span><br />        ))))

<a name="build-tree-from-stack"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(build-tree-from-stack end-tag-name)</span>
  (<a class="applied-name" href="xml-support-1.html#build-tree-from-stack-1" title="xml-support">build-tree-from-stack-1</a> end-tag-name '()))

<a name="build-tree-from-stack-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(build-tree-from-stack-1 tag-name tree-list)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">top</span> (<a class="applied-name" href="xml-support-1.html#parse-stack-top-and-pop" title="xml-support">parse-stack-top-and-pop</a>)))
    (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="xml-support-1.html#start-tag-entry?" title="xml-support">start-tag-entry?</a> top) (<a class="applied-name" href="xml-support-1.html#matches-stack-entry" title="xml-support">matches-stack-entry</a> top tag-name))
        (<a class="applied-name" href="xml-support-1.html#make-parse-tree" title="xml-support">make-parse-tree</a> top tree-list)
        (<a class="applied-name" href="xml-support-1.html#build-tree-from-stack-1" title="xml-support">build-tree-from-stack-1</a> tag-name (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> top tree-list)))))

<a name="matches-stack-entry"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(matches-stack-entry top-tag-structure tag-name)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#downcase-string" title="Manual: general">downcase-string</a> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> top-tag-structure)) (<a class="schemedoc-name" href="../../../../lib/man/general.html#downcase-string" title="Manual: general">downcase-string</a>  tag-name)))



<a name="read-tag"></a><span class="comment">; We know that we are just in front of a tag. Return a tag structure.</span><br /><a name="read-tag"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(read-tag)</span>
  (<a class="applied-name" href="xml-support-1.html#parse-message" title="xml-support">parse-message</a> "Reading tag")
  (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
  (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 1)
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&lt;")
      (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-char" title="Manual: collect-skip">read-a-char</a>)
      (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> "&#39;&lt;&#39; expected"))
  (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 1)
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "/") <span class="comment">; end tag</span><br />      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a> <span class="comment">; <span><a name="read-tag-@a"></a> @a</span></span><br />       (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-char" title="Manual: collect-skip">read-a-char</a>)
       (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">tag-name</span> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#collect-until" title="Manual: collect-skip">collect-until</a> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span>) (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> ch #\>) (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#is-white-space?" title="Manual: collect-skip">is-white-space?</a> ch))))))
        (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 1)
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&gt;")
            (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-char" title="Manual: collect-skip">read-a-char</a>) <span class="comment">; &gt;</span><br />            (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> "An end tag must not contain anything after the tag name"))
        (<a class="applied-name" href="xml-support-1.html#parse-message" title="xml-support">parse-message</a> "  " "End: " tag-name)
        (<a class="applied-name" href="xml-support-1.html#make-tag-structure" title="xml-support">make-tag-structure</a> 'end tag-name '())))
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">tag-name</span> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#collect-until" title="Manual: collect-skip">collect-until</a> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span>) (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> ch #\>) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> ch #\/) (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#is-white-space?" title="Manual: collect-skip">is-white-space?</a> ch))))))
        (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
        (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 2) 
        <span class="comment">; <span><a name="read-tag-@b"></a> @b</span></span><br />        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#max-look-ahead-prefix" title="Manual: collect-skip">max-look-ahead-prefix</a>)) 2) (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "/&gt;"))  <span class="comment">; <span><a name="read-tag-@c"></a> @c</span>- weird</span><br />               (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-string" title="Manual: collect-skip">read-a-string</a> 2)
               (<a class="applied-name" href="xml-support-1.html#make-tag-structure" title="xml-support">make-tag-structure</a> 'start-end tag-name '()))
              ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#max-look-ahead-prefix" title="Manual: collect-skip">max-look-ahead-prefix</a>)) 1) (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&gt;"))  <span class="comment">; <span><a name="read-tag-@d"></a> @d</span></span><br />               (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-char" title="Manual: collect-skip">read-a-char</a>)
               (<a class="applied-name" href="xml-support-1.html#make-tag-structure" title="xml-support">make-tag-structure</a> 'start tag-name '()))
              (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">attribute-list</span> (<a class="applied-name" href="xml-support-1.html#read-tag-attributes" title="xml-support">read-tag-attributes</a>))) <span class="comment">; <span><a name="read-tag-@e"></a> @e</span>- white space processes at this point</span><br />                      (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 2)
                      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#max-look-ahead-prefix" title="Manual: collect-skip">max-look-ahead-prefix</a>)) 2) (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "/&gt;"))
                             (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-string" title="Manual: collect-skip">read-a-string</a> 2)
                             (<a class="applied-name" href="xml-support-1.html#parse-message" title="xml-support">parse-message</a> "  " "Start end: " tag-name ". Attributes: " (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> attribute-list))
                             (<a class="applied-name" href="xml-support-1.html#make-tag-structure" title="xml-support">make-tag-structure</a> 'start-end tag-name attribute-list))
                            ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#max-look-ahead-prefix" title="Manual: collect-skip">max-look-ahead-prefix</a>)) 1) (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&gt;"))
                             (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-char" title="Manual: collect-skip">read-a-char</a>)
                             (<a class="applied-name" href="xml-support-1.html#parse-message" title="xml-support">parse-message</a> "  " "Start: " tag-name ". Attributes: " (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> attribute-list))
                             (<a class="applied-name" href="xml-support-1.html#make-tag-structure" title="xml-support">make-tag-structure</a> 'start tag-name attribute-list))
                            (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="applied-name" href="xml-support-1.html#parse-error" title="xml-support">parse-error</a> "read-tag: end of tag expected"))))
              )))))

<a name="read-tag-attributes"></a><span class="comment">; Return attribute value pairs as a property list
; Expect that we are at the first character the first attribute name</span><br /><a name="read-tag-attributes"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(read-tag-attributes)</span>
  (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">attr-val</span> (<a class="applied-name" href="xml-support-1.html#read-attribute-value-pair" title="xml-support">read-attribute-value-pair</a>))) <span class="comment">; cons-pair or #f.</span><br />    (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
    (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> attr-val
        (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> 
         (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> attr-val) 
         (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> 
           (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> attr-val) 
           (<a class="applied-name" href="xml-support-1.html#read-tag-attributes" title="xml-support">read-tag-attributes</a>) <span class="comment">; recursive reading</span><br />         )
        )
        '())))

<span class="comment">; (define (read-attribute-value-pair)
;   (ensure-look-ahead 2)
;   (if (or (match-look-ahead? "/&gt;") (match-look-ahead? "?&gt;") (match-look-ahead? "&gt;"))
;       #f
;       (let* ((attr-name (collect-until (lambda (ch) (or (eqv? ch #\=)  (is-white-space? ch))))))
;         (skip-white-space)
;         (ensure-look-ahead 1)
;         (if (match-look-ahead? "=")
;             (begin
;               (read-a-char)
;               (skip-white-space))
;             (parse-error "= expected after attribute value"))
;         (ensure-look-ahead 1)
;         (if (match-look-ahead? """)
;             (begin
;               (read-a-char)             ; reading first "
;               (let ((value (collect-until (char-predicate #"))))
;                 (read-a-char)           ; reading second "
;                 (skip-white-space)
;                 (cons (as-symbol attr-name) value)))
;             (parse-error "Attribute value in string quotes expected")))))</span><br />
<a name="read-attribute-value-pair"></a><span class="comment">; read a single attribute value pair from the input port and return it is a cons pair.
; If no more attributes exists (we see end of tag characters) return #f.</span><br /><a name="read-attribute-value-pair"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(read-attribute-value-pair)</span>
  (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 2)
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "/&gt;") (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "?&gt;") (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&gt;"))
      #f
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">attr-name</span> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#collect-until" title="Manual: collect-skip">collect-until</a> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span>) (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> ch #\=) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> ch #\>)  (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#is-white-space?" title="Manual: collect-skip">is-white-space?</a> ch))))))
        (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
        (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 1)
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "=")
               (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-char" title="Manual: collect-skip">read-a-char</a>)
               (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
               (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 1)
               (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "\"")
                         (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-char" title="Manual: collect-skip">read-a-char</a>)      <span class="comment">; reading first "</span><br />                         (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">value</span> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#collect-until" title="Manual: collect-skip">collect-until</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#char-predicate" title="Manual: collect-skip">char-predicate</a> #\"))))
                           (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-char" title="Manual: collect-skip">read-a-char</a>)    <span class="comment">; reading second "</span><br />                           (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
                           (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> attr-name) value)))
                     ((<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#match-look-ahead?" title="Manual: collect-skip">match-look-ahead?</a> "&#39;")   
                         (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-char" title="Manual: collect-skip">read-a-char</a>)      <span class="comment">; reading first '</span><br />                         (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">value</span> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#collect-until" title="Manual: collect-skip">collect-until</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#char-predicate" title="Manual: collect-skip">char-predicate</a> #\'))))
                           (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#read-a-char" title="Manual: collect-skip">read-a-char</a>)    <span class="comment">; reading second '</span><br />                           (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
                           (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> attr-name) value)))
                     (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a>
                         (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">value</span> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#collect-until" title="Manual: collect-skip">collect-until</a> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">ch</span>) (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#is-white-space?" title="Manual: collect-skip">is-white-space?</a> ch) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> ch #\>))))))
                           (<a class="applied-name" href="xml-support-1.html#skip-white-space" title="xml-support">skip-white-space</a>)
                           (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> attr-name) value)))))
             (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a>
               (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> attr-name) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> attr-name)) <span class="comment">; boolean attribute</span><br />             )))))


<a name="aggregate-final-parse-tree"></a><span class="comment">; aggregate remaining stack entries as subtrees of a kind node. kind is a symbol, such
; as html-tree or xml-tree</span><br /><a name="aggregate-final-parse-tree"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(aggregate-final-parse-tree kind)</span>
  (<a class="applied-name" href="xml-support-1.html#make-final-parse-tree" title="xml-support">make-final-parse-tree</a> kind (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> (<a class="applied-name" href="xml-support-1.html#shallow-list-copy" title="xml-support">shallow-list-copy</a> <a class="applied-name" href="xml-support-1.html#parse-stack" title="xml-support">parse-stack</a>))))

<a name="make-final-parse-tree"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(make-final-parse-tree kind subtrees)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> kind subtrees))

<a name="shallow-list-copy"></a><span class="comment">; Assume as a pre-condition that lst is a proper list</span><br /><a name="shallow-list-copy"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(shallow-list-copy lst)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> lst) '())
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> lst) (<a class="applied-name" href="xml-support-1.html#shallow-list-copy" title="xml-support">shallow-list-copy</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> lst))))))


<span class="comment">; ---------------------------------------------------------------------------------------------------</span><br /><div class="schemedoc-section-comment">;;; Utility parser functions. 
;;; The functions in this section are all miscelaneous and utility functions of the parser.</div>
<a name="traverse-and-collect-from-parse-tree"></a><a name="traverse-and-collect-from-parse-tree"></a><span><a href="../xml-support.html#traverse-and-collect-from-parse-tree"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(traverse-and-collect-from-parse-tree tree node-interesting? result-transformer)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="applied-name" href="xml-support-1.html#html-tree-node?" title="xml-support">html-tree-node?</a> tree) (<a class="applied-name" href="xml-support-1.html#xml-tree-node?" title="xml-support">xml-tree-node?</a> tree))
          (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">subtree-results</span>
                   (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
                    (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">subtr</span>) (<a class="applied-name" href="xml-support-1.html#traverse-and-collect-from-parse-tree" title="xml-support">traverse-and-collect-from-parse-tree</a> subtr node-interesting? result-transformer))
                    (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> tree))))
             (<a class="schemedoc-name" href="../../../../lib/man/general.html#flatten" title="Manual: general">flatten</a> subtree-results)))
        ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="xml-support-1.html#terminal-node?" title="xml-support">terminal-node?</a> tree) (node-interesting? tree)) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (result-transformer tree)))
        ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="xml-support-1.html#terminal-node?" title="xml-support">terminal-node?</a> tree) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (node-interesting? tree))) '())
        ((<a class="applied-name" href="xml-support-1.html#inner-node?" title="xml-support">inner-node?</a> tree)
           (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">subtree-results</span>
                   (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> 
                    (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">subtr</span>) (<a class="applied-name" href="xml-support-1.html#traverse-and-collect-from-parse-tree" title="xml-support">traverse-and-collect-from-parse-tree</a> subtr node-interesting? result-transformer))
                    (<a class="applied-name" href="xml-support-1.html#subtrees-of-parse-tree" title="xml-support">subtrees-of-parse-tree</a> tree))))
             (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (node-interesting? tree)
                 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> 
                   (result-transformer tree)
                   (<a class="schemedoc-name" href="../../../../lib/man/general.html#flatten" title="Manual: general">flatten</a> subtree-results))
                 (<a class="schemedoc-name" href="../../../../lib/man/general.html#flatten" title="Manual: general">flatten</a> subtree-results))))))


<a name="collect-attributes-in-tree"></a><a name="collect-attributes-in-tree"></a><span><a href="../xml-support.html#collect-attributes-in-tree"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(collect-attributes-in-tree tree attr-key)</span>
 (<a class="schemedoc-name" href="../../../../lib/man/general.html#filter" title="Manual: general">filter</a> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> x #t #f))
  (<a class="applied-name" href="xml-support-1.html#traverse-and-collect-from-parse-tree" title="xml-support">traverse-and-collect-from-parse-tree</a> tree 
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">tr</span>) (<a class="applied-name" href="xml-support-1.html#tag-entry?" title="xml-support">tag-entry?</a> (<a class="applied-name" href="xml-support-1.html#node-of-tree" title="xml-support">node-of-tree</a> tr)))
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">tr</span>) (<a class="applied-name" href="xml-support-1.html#attribute-value" title="xml-support">attribute-value</a> attr-key (<a class="applied-name" href="xml-support-1.html#attributes-of-tag-structure" title="xml-support">attributes-of-tag-structure</a> (<a class="applied-name" href="xml-support-1.html#node-of-tree" title="xml-support">node-of-tree</a> tr)))))))


<a name="is-tag-of-kind?"></a><a name="is-tag-of-kind?"></a><span><a href="../xml-support.html#is-tag-of-kind?"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(is-tag-of-kind? tag-kind)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>)
    (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a>
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="xml-support-1.html#tag-entry?" title="xml-support">tag-entry?</a> x) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#downcase-string" title="Manual: general">downcase-string</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> tag-kind)) (<a class="schemedoc-name" href="../../../../lib/man/general.html#downcase-string" title="Manual: general">downcase-string</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> x)))))
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="xml-support-1.html#tree-entry?" title="xml-support">tree-entry?</a> x) (<a class="applied-name" href="xml-support-1.html#tag-entry?" title="xml-support">tag-entry?</a> (<a class="applied-name" href="xml-support-1.html#node-of-tree" title="xml-support">node-of-tree</a> x)) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#downcase-string" title="Manual: general">downcase-string</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> tag-kind)) (<a class="schemedoc-name" href="../../../../lib/man/general.html#downcase-string" title="Manual: general">downcase-string</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> (<a class="applied-name" href="xml-support-1.html#node-of-tree" title="xml-support">node-of-tree</a> x)))))))))


<a name="parser-status"></a><a name="parser-status"></a><span><a href="../xml-support.html#parser-status"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parser-status)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX461" title="R5RS Scheme form">display</a> (<a class="applied-name" href="xml-support-1.html#stack-status" title="xml-support">stack-status</a>)) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX463" title="R5RS Scheme form">newline</a>)
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX461" title="R5RS Scheme form">display</a> (<a class="applied-name" href="xml-support-1.html#input-status" title="xml-support">input-status</a>))
)

<a name="stack-status"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(stack-status)</span>
 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "THE PARSE STACK: " (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\newline) (<a class="applied-name" href="xml-support-1.html#stack-status-1" title="xml-support">stack-status-1</a> <a class="applied-name" href="xml-support-1.html#parse-stack" title="xml-support">parse-stack</a>)))


<a name="stack-status-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(stack-status-1 lst)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> lst)
    ""
    (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">top</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> lst)))
     (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a>
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="xml-support-1.html#text-contents-entry?" title="xml-support">text-contents-entry?</a> top) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="applied-name" href="xml-support-1.html#node-info" title="xml-support">node-info</a> top)))
            ((<a class="applied-name" href="xml-support-1.html#tag-entry?" title="xml-support">tag-entry?</a> top) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="applied-name" href="xml-support-1.html#node-info" title="xml-support">node-info</a> top)))
            ((<a class="applied-name" href="xml-support-1.html#tree-entry?" title="xml-support">tree-entry?</a> top) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="applied-name" href="xml-support-1.html#node-info" title="xml-support">node-info</a> (<a class="applied-name" href="xml-support-1.html#node-of-tree" title="xml-support">node-of-tree</a> top))))
            (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> "???"))
      (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\newline)
      (<a class="applied-name" href="xml-support-1.html#stack-status-1" title="xml-support">stack-status-1</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> lst))))))

<a name="input-status"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(input-status)</span>
  (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#ensure-look-ahead" title="Manual: collect-skip">ensure-look-ahead</a> 100)
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "PREFIX OF REMAINING INPUT: " (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\newline) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\") 
                 (<a class="schemedoc-name" href="../../../../lib/man/collect-skip.html#max-look-ahead-prefix" title="Manual: collect-skip">max-look-ahead-prefix</a>) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\") (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\newline)))

  

                 
<span class="comment">; ------------------------------------------------------------------------------------------------------------------------
; XML pretty printing.
; In reality this is mostly generic XML and HTML pretty printing.</span><br />
<span class="comment">; ------------------------------------------------------------------</span><br /><div class="schemedoc-section-comment">;;; Top level XML pretty printing functions.</div>
<a name="pretty-print-xml-parse-tree-file"></a><a name="pretty-print-xml-parse-tree-file"></a><span><a href="../xml-support.html#pretty-print-xml-parse-tree-file"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(pretty-print-xml-parse-tree-file in-file-path . optional-parameters)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">out-file-path</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#optional-parameter" title="Manual: general">optional-parameter</a> 1  optional-parameters in-file-path)))
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">parse-tree</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#file-read" title="Manual: general">file-read</a> in-file-path)))
   (<a class="schemedoc-name" href="../../../../lib/man/file-read.html#write-text-file" title="Manual: file-read">write-text-file</a>
    (<a class="applied-name" href="xml-support-1.html#pretty-print-xml-parse-tree" title="xml-support">pretty-print-xml-parse-tree</a> parse-tree) 
    out-file-path))))

<a name="pretty-print-xml-parse-tree"></a><a name="pretty-print-xml-parse-tree"></a><span><a href="../xml-support.html#pretty-print-xml-parse-tree"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(pretty-print-xml-parse-tree parse-tree)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="xml-support-1.html#res" title="xml-support">res</a> '())
 (<a class="applied-name" href="xml-support-1.html#pretty-print-xml-html-parse-tree-1" title="xml-support">pretty-print-xml-html-parse-tree-1</a> parse-tree 0 #f)
 (<a class="applied-name" href="xml-support-1.html#linearize-pp-result" title="xml-support">linearize-pp-result</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> <a class="applied-name" href="xml-support-1.html#res" title="xml-support">res</a>)))

<span class="comment">; ------------------------------------------------------------------</span><br /><div class="schemedoc-section-comment">;;; Variables that control the pretty printing.
;;; These variables apply for both HTML and XML.</div>
<a name="indentation-delta"></a><a name="indentation-delta"></a><span><a href="../xml-support.html#indentation-delta"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">indentation-delta</span> 3)

<a name="use-single-lining"></a><a name="use-single-lining"></a><span><a href="../xml-support.html#use-single-lining"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">use-single-lining</span> #t)

<a name="prefered-maximum-width"></a><a name="prefered-maximum-width"></a><span><a href="../xml-support.html#prefered-maximum-width"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">prefered-maximum-width</span> 90)

<a name="res"></a><span class="comment">; -------------------------------------------------------------------
; The internal result list</span><br />
<a name="res"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">res</span> '())

<a name="add-to-res"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(add-to-res x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="xml-support-1.html#res" title="xml-support">res</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> x <a class="applied-name" href="xml-support-1.html#res" title="xml-support">res</a>)))

<a name="add-list-to-res"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(add-list-to-res lst)</span>
 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX413" title="R5RS Scheme form">for-each</a>
   (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">el</span>) (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> el))
   lst))


<a name="remove-from-res"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(remove-from-res i)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> i 0)
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a>
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="xml-support-1.html#res" title="xml-support">res</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> <a class="applied-name" href="xml-support-1.html#res" title="xml-support">res</a>))
        (<a class="applied-name" href="xml-support-1.html#remove-from-res" title="xml-support">remove-from-res</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> i 1)))))

<a name="linearize-pp-result"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(linearize-pp-result lst)</span>
 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX411" title="R5RS Scheme form">apply</a> <a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> lst)))



<span class="comment">; In response to Per Madsen's request - but not a real solution.
; space after a tag belongs to the word  just after the tag.
; (define (add-white-space single-lining?)
;   (if (not single-lining?) 
;        (if (eq? laml-platform 'windows) ; pc end of line convention
;            (begin (add-to-res #\newline)) ; (add-to-res #\return)
;            (add-to-res #\newline))))</span><br />
<a name="trailing-whitespace-on-res?"></a><span class="comment">; Is the last element on res ended with white space?
; Start tag strings will always give #t</span><br /><a name="trailing-whitespace-on-res?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(trailing-whitespace-on-res?)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> <a class="applied-name" href="xml-support-1.html#res" title="xml-support">res</a>)
      #f
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">lst-el</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> <a class="applied-name" href="xml-support-1.html#res" title="xml-support">res</a>)))
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX374" title="R5RS Scheme form">string?</a> lst-el)
                 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">lgt</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> lst-el)))
                   (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> 
                      (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> #\space (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> lst-el (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> lgt 1)))
                      (<a class="applied-name" href="xml-support-1.html#start-tag-string?" title="xml-support">start-tag-string?</a> lst-el)
                   )
                  ))
              ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX351" title="R5RS Scheme form">char?</a> lst-el)
                 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> lst-el #\space) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> lst-el #\newline)))
              (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> #f)))))


<a name="start-tag-string?"></a><span class="comment">; precond: x is a string</span><br /><a name="start-tag-string?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(start-tag-string? x)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> x) 1)
       (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> x 0) #\<)
       (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> x 1) #\/))))


<a name="trailing-whitespace-pending"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">trailing-whitespace-pending</span> #f)

<a name="add-white-space"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(add-white-space single-lining?)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> #t <span class="comment">; (trailing-whitespace-on-res?)</span><br />     (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> single-lining?) 
         (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> #\newline))
     (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="xml-support-1.html#trailing-whitespace-pending" title="xml-support">trailing-whitespace-pending</a> #t)))
     

<a name="add-indentation"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(add-indentation i)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> #t <span class="comment">; (trailing-whitespace-on-res?)</span><br />      (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> (<a class="applied-name" href="xml-support-1.html#indentation" title="xml-support">indentation</a> i))))

<a name="indentation"></a><span class="comment">; -------------------------------------------------------------------</span><br />
<a name="indentation"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(indentation n)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX375" title="R5RS Scheme form">make-string</a> n #\space))

<a name="single-liner-form?"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(single-liner-form? x start-col max-width)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> <a class="applied-name" href="xml-support-1.html#use-single-lining" title="xml-support">use-single-lining</a>
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">width</span> (<a class="applied-name" href="xml-support-1.html#meassure-html-xml-form" title="xml-support">meassure-html-xml-form</a> x)))
        (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX238" title="R5RS Scheme form">&lt;=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> width start-col) max-width))
      #f))

<a name="problem-form"></a><span class="comment">; ------------------------------------------------------------------------------------------------------------
; The substantial and central pretty printing function. This function
; support both XML and HTML.</span><br />
<a name="problem-form"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">problem-form</span> #f)

<a name="pretty-print-xml-html-parse-tree-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(pretty-print-xml-html-parse-tree-1 form start-col single-lining?)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="xml-support-1.html#html-root?" title="xml-support">html-root?</a> form)
            (<a class="applied-name" href="xml-support-1.html#add-subtrees-to-res" title="xml-support">add-subtrees-to-res</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> form) start-col single-lining?))
        ((<a class="applied-name" href="xml-support-1.html#xml-root?" title="xml-support">xml-root?</a> form)
            (<a class="applied-name" href="xml-support-1.html#add-subtrees-to-res" title="xml-support">add-subtrees-to-res</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> form) start-col single-lining?))
        ((<a class="applied-name" href="xml-support-1.html#tree-entry?" title="xml-support">tree-entry?</a> form)
           (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="xml-support-1.html#single-liner-form?" title="xml-support">single-liner-form?</a> form start-col <a class="applied-name" href="xml-support-1.html#prefered-maximum-width" title="xml-support">prefered-maximum-width</a>)
               (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a>
                 (<a class="applied-name" href="xml-support-1.html#pretty-print-start-tag" title="xml-support">pretty-print-start-tag</a> (<a class="applied-name" href="xml-support-1.html#root-of-parse-tree" title="xml-support">root-of-parse-tree</a> form) start-col #t)
                 (<a class="applied-name" href="xml-support-1.html#add-white-space" title="xml-support">add-white-space</a> #t)
                 (<a class="applied-name" href="xml-support-1.html#add-subtrees-to-res" title="xml-support">add-subtrees-to-res</a> (<a class="applied-name" href="xml-support-1.html#subtrees-of-parse-tree" title="xml-support">subtrees-of-parse-tree</a> form) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> start-col <a class="applied-name" href="xml-support-1.html#indentation-delta" title="xml-support">indentation-delta</a>) #t)
                 (<a class="applied-name" href="xml-support-1.html#pretty-print-end-tag" title="xml-support">pretty-print-end-tag</a> (<a class="applied-name" href="xml-support-1.html#root-of-parse-tree" title="xml-support">root-of-parse-tree</a> form) start-col #t))
               (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a> 
                 (<a class="applied-name" href="xml-support-1.html#pretty-print-start-tag" title="xml-support">pretty-print-start-tag</a> (<a class="applied-name" href="xml-support-1.html#root-of-parse-tree" title="xml-support">root-of-parse-tree</a> form) start-col single-lining?)
                 (<a class="applied-name" href="xml-support-1.html#add-white-space" title="xml-support">add-white-space</a> single-lining?)
                 (<a class="applied-name" href="xml-support-1.html#add-subtrees-to-res" title="xml-support">add-subtrees-to-res</a> (<a class="applied-name" href="xml-support-1.html#subtrees-of-parse-tree" title="xml-support">subtrees-of-parse-tree</a> form) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> start-col <a class="applied-name" href="xml-support-1.html#indentation-delta" title="xml-support">indentation-delta</a>) single-lining?)
                 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> single-lining?) (<a class="applied-name" href="xml-support-1.html#add-indentation" title="xml-support">add-indentation</a> start-col))
                 (<a class="applied-name" href="xml-support-1.html#pretty-print-end-tag" title="xml-support">pretty-print-end-tag</a> (<a class="applied-name" href="xml-support-1.html#root-of-parse-tree" title="xml-support">root-of-parse-tree</a> form) start-col single-lining?))))
        ((<a class="applied-name" href="xml-support-1.html#text-contents-entry?" title="xml-support">text-contents-entry?</a> form) 
            (<a class="applied-name" href="xml-support-1.html#add-list-to-res" title="xml-support">add-list-to-res</a> (<a class="applied-name" href="xml-support-1.html#break-long-string" title="xml-support">break-long-string</a> (<a class="applied-name" href="xml-support-1.html#node-info" title="xml-support">node-info</a> form) start-col (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX247" title="R5RS Scheme form">max</a> 10 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> <a class="applied-name" href="xml-support-1.html#prefered-maximum-width" title="xml-support">prefered-maximum-width</a> start-col)))))
<span class="comment">;        ((text-contents-entry? form) 
;            (add-to-res (node-info form)))</span><br />        ((<a class="applied-name" href="xml-support-1.html#comment-entry?" title="xml-support">comment-entry?</a> form)
            (<a class="applied-name" href="xml-support-1.html#pretty-print-comment" title="xml-support">pretty-print-comment</a> (<a class="applied-name" href="xml-support-1.html#comment-of-comment-structure" title="xml-support">comment-of-comment-structure</a> form)))
        ((<a class="applied-name" href="xml-support-1.html#declaration-entry?" title="xml-support">declaration-entry?</a> form)
            (<a class="applied-name" href="xml-support-1.html#pretty-print-declaration" title="xml-support">pretty-print-declaration</a> (<a class="applied-name" href="xml-support-1.html#kind-of-declaration-structure" title="xml-support">kind-of-declaration-structure</a> form) (<a class="applied-name" href="xml-support-1.html#value-of-declaration-structure" title="xml-support">value-of-declaration-structure</a> form)))
        ((<a class="applied-name" href="xml-support-1.html#xml-declaration-entry?" title="xml-support">xml-declaration-entry?</a> form)
            (<a class="applied-name" href="xml-support-1.html#pretty-print-xml-declaration" title="xml-support">pretty-print-xml-declaration</a> (<a class="applied-name" href="xml-support-1.html#attributes-of-xml-declaration-structure" title="xml-support">attributes-of-xml-declaration-structure</a> form)))
        ((<a class="applied-name" href="xml-support-1.html#start-end-tag-entry?" title="xml-support">start-end-tag-entry?</a> form)
            (<a class="applied-name" href="xml-support-1.html#pretty-print-empty-tag" title="xml-support">pretty-print-empty-tag</a> form start-col single-lining?))
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX106" title="R5RS Scheme form">set!</a> <a class="applied-name" href="xml-support-1.html#problem-form" title="xml-support">problem-form</a> form) (error (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "pretty-print-xml-html-parse-tree-1: Unknown structure encountered: " (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> form)))))))


<a name="break-long-string"></a><span class="comment">; Break string into a list of substrings with interleaved indentation strings
; Handles the breaking and pretty printing of long textual pieces.</span><br /><a name="break-long-string"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(break-long-string str indentation max-length)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX374" title="R5RS Scheme form">string?</a> str) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#empty-string?" title="Manual: general">empty-string?</a> str)))
     (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">str1</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#transliterate" title="Manual: general">transliterate</a> str #\newline (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\space)))
            (<span class="local-name-binding">indentation-string</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\newline) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX375" title="R5RS Scheme form">make-string</a> indentation #\space)))
            (<span class="local-name-binding">broken-strings</span> (<a class="applied-name" href="xml-support-1.html#break-long-string-1" title="xml-support">break-long-string-1</a> str1 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> str) 0 max-length '()))
            (<span class="local-name-binding">lgt</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> broken-strings))
            )
       (<a class="schemedoc-name" href="../../../../lib/man/general.html#merge-lists-simple" title="Manual: general">merge-lists-simple</a>
        broken-strings (<a class="schemedoc-name" href="../../../../lib/man/general.html#make-list" title="Manual: general">make-list</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> lgt 1) indentation-string)))
     (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> str)))


<a name="break-long-string-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(break-long-string-1 str str-lgt i max-length res)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> i str-lgt) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> str res)))
        ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> i str-lgt) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX340" title="R5RS Scheme form">member</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> str i) <a class="schemedoc-name" href="../../../../lib/man/general.html#white-space-char-list" title="Manual: general">white-space-char-list</a>))
           (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> i max-length)
               (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">first</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> str 0 i))
                     (<span class="local-name-binding">rest</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> str (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> i 1) str-lgt)))
                  (<a class="applied-name" href="xml-support-1.html#break-long-string-1" title="xml-support">break-long-string-1</a> rest (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> rest) 1 max-length (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> first res)))
               (<a class="applied-name" href="xml-support-1.html#break-long-string-1" title="xml-support">break-long-string-1</a> str str-lgt (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> i 1) max-length res)))
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="applied-name" href="xml-support-1.html#break-long-string-1" title="xml-support">break-long-string-1</a> str str-lgt (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> i 1) max-length res))))


<a name="add-subtrees-to-res"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(add-subtrees-to-res subtree-list start-col single-lining?)</span>
  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX413" title="R5RS Scheme form">for-each</a>
    (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">tree</span>)
      (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> single-lining?) (<a class="applied-name" href="xml-support-1.html#add-indentation" title="xml-support">add-indentation</a> start-col))
      (<a class="applied-name" href="xml-support-1.html#pretty-print-xml-html-parse-tree-1" title="xml-support">pretty-print-xml-html-parse-tree-1</a> tree start-col single-lining?)
      (<a class="applied-name" href="xml-support-1.html#add-white-space" title="xml-support">add-white-space</a> single-lining?))
   subtree-list))

<a name="pretty-print-start-tag"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(pretty-print-start-tag tag-structure start-col single-lining?)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">tag-name</span> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> tag-structure))
        (<span class="local-name-binding">attributes</span> (<a class="applied-name" href="xml-support-1.html#attributes-of-tag-structure" title="xml-support">attributes-of-tag-structure</a> tag-structure)))
    (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> attributes)
        (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\<) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> tag-name) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\>)))
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a>
          (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\<) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> tag-name)))
          (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> #\space)
          (<a class="applied-name" href="xml-support-1.html#add-attributes-to-res" title="xml-support">add-attributes-to-res</a> attributes (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> start-col 2 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> tag-name)) single-lining?)
          (<a class="applied-name" href="xml-support-1.html#remove-from-res" title="xml-support">remove-from-res</a> 1) <span class="comment">; last space before greater than char</span><br />          (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> #\>)))))

<a name="add-attributes-to-res"></a><span class="comment">; attributes is a property list</span><br /><a name="add-attributes-to-res"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(add-attributes-to-res attributes start-col single-lining?)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> attributes)) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX239" title="R5RS Scheme form">&gt;=</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> attributes) 2))
         (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">key</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> attributes))
               (<span class="local-name-binding">val</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cadr</a> attributes))
               (<span class="local-name-binding">res-attributes</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cddr</a> attributes)))
           (<a class="applied-name" href="xml-support-1.html#add-single-attribute-to-res" title="xml-support">add-single-attribute-to-res</a> key val start-col single-lining?)
           (<a class="applied-name" href="xml-support-1.html#add-attributes-to-res" title="xml-support">add-attributes-to-res</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cddr</a> attributes) start-col single-lining?)))
        ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX304" title="R5RS Scheme form">not</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> attributes)) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX236" title="R5RS Scheme form">&lt;</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> attributes) 2))
           (error (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "add-attributes-to-res: malformed attribute list: " (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> attributes))))))

<a name="add-single-attribute-to-res"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(add-single-attribute-to-res key val start-col single-lining?)</span>
  (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> key) (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> "=") 
  (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#string-it" title="Manual: general">string-it</a> val)) (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> #\space))

<a name="pretty-print-empty-tag"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(pretty-print-empty-tag tag-structure start-col single-lining?)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">tag-name</span> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> tag-structure))
        (<span class="local-name-binding">attributes</span> (<a class="applied-name" href="xml-support-1.html#attributes-of-tag-structure" title="xml-support">attributes-of-tag-structure</a> tag-structure)))
    (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> attributes)
        (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\<) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> tag-name) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\/) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\>)))
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX125" title="R5RS Scheme form">begin</a>
          (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\<) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> tag-name)))
          (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> #\space)
          (<a class="applied-name" href="xml-support-1.html#add-attributes-to-res" title="xml-support">add-attributes-to-res</a> attributes (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> start-col 2 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> tag-name)) single-lining?)
          (<a class="applied-name" href="xml-support-1.html#remove-from-res" title="xml-support">remove-from-res</a> 1) <span class="comment">; last space before greater than char</span><br />          (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a>  (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\/) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\>) ))))))

<a name="pretty-print-end-tag"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(pretty-print-end-tag tag-structure start-col single-lining?)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">tag-name</span> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> tag-structure))
         (<span class="local-name-binding">end-tag</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\<) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\/) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> tag-name) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\>))))
    (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> end-tag)))

<a name="pretty-print-comment"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(pretty-print-comment comment-string)</span>
  (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> "&lt;!--") (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> #\space)
  (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> comment-string)
  (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> "--&gt;"))

<a name="pretty-print-declaration"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(pretty-print-declaration kind value)</span>
  (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> "&lt;!")
  (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> kind))
  (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> #\space)
  (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> value)
  (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> "&gt;"))

<a name="pretty-print-xml-declaration"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(pretty-print-xml-declaration attributes)</span>
  (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> "&lt;?xml")
  (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> #\space)
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">dummy</span> 0))
    (<a class="applied-name" href="xml-support-1.html#add-attributes-to-res" title="xml-support">add-attributes-to-res</a> attributes dummy #f))
  (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> #\space)
  (<a class="applied-name" href="xml-support-1.html#add-to-res" title="xml-support">add-to-res</a> "?&gt;"))





<a name="meassure-html-xml-form"></a><span class="comment">; ------------------------------------------------------------------
; Html and xml meassuring</span><br />
<a name="meassure-html-xml-form"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(meassure-html-xml-form form)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="xml-support-1.html#html-root?" title="xml-support">html-root?</a> form)
           (<a class="schemedoc-name" href="../../../../lib/man/general.html#accumulate-right" title="Manual: general">accumulate-right</a> <a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 0 
            (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="applied-name" href="xml-support-1.html#meassure-html-xml-form" title="xml-support">meassure-html-xml-form</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> form))))
        ((<a class="applied-name" href="xml-support-1.html#tree-entry?" title="xml-support">tree-entry?</a> form) 
            (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="applied-name" href="xml-support-1.html#meassure-html-xml-form" title="xml-support">meassure-html-xml-form</a> (<a class="applied-name" href="xml-support-1.html#root-of-parse-tree" title="xml-support">root-of-parse-tree</a> form)) <span class="comment">; both start only</span><br />               1
               (<a class="schemedoc-name" href="../../../../lib/man/general.html#accumulate-right" title="Manual: general">accumulate-right</a> <a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 0 
                 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="applied-name" href="xml-support-1.html#meassure-html-xml-form" title="xml-support">meassure-html-xml-form</a> (<a class="applied-name" href="xml-support-1.html#subtrees-of-parse-tree" title="xml-support">subtrees-of-parse-tree</a> form)))
               (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> (<a class="applied-name" href="xml-support-1.html#root-of-parse-tree" title="xml-support">root-of-parse-tree</a> form)))) 3))
        ((<a class="applied-name" href="xml-support-1.html#text-contents-entry?" title="xml-support">text-contents-entry?</a> form) 
            (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> (<a class="applied-name" href="xml-support-1.html#node-info" title="xml-support">node-info</a> form)))
        ((<a class="applied-name" href="xml-support-1.html#comment-entry?" title="xml-support">comment-entry?</a> form)
            (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 7 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> (<a class="applied-name" href="xml-support-1.html#comment-of-comment-structure" title="xml-support">comment-of-comment-structure</a> form))))
        ((<a class="applied-name" href="xml-support-1.html#declaration-entry?" title="xml-support">declaration-entry?</a> form)
            (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 3
               (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="applied-name" href="xml-support-1.html#kind-of-declaration-structure" title="xml-support">kind-of-declaration-structure</a> form)))
               (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> (<a class="applied-name" href="xml-support-1.html#value-of-declaration-structure" title="xml-support">value-of-declaration-structure</a> form))))
        ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="applied-name" href="xml-support-1.html#start-end-tag-entry?" title="xml-support">start-end-tag-entry?</a> form) (<a class="applied-name" href="xml-support-1.html#start-tag-entry?" title="xml-support">start-tag-entry?</a> form))
            (<a class="applied-name" href="xml-support-1.html#meassure-tag-structure" title="xml-support">meassure-tag-structure</a> form))
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (error (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> "meassure-html-xml-form: Unknown structure encountered: " (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> form))))))

<a name="meassure-tag-structure"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(meassure-tag-structure tag-structure)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">tag-name</span> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> tag-structure))
        (<span class="local-name-binding">attributes</span> (<a class="applied-name" href="xml-support-1.html#attributes-of-tag-structure" title="xml-support">attributes-of-tag-structure</a> tag-structure)))
    (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> tag-name))
        3
       (<a class="applied-name" href="xml-support-1.html#meassure-attributes" title="xml-support">meassure-attributes</a> attributes))))

<a name="meassure-attributes"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(meassure-attributes attributes)</span>
   (<a class="schemedoc-name" href="../../../../lib/man/general.html#accumulate-right" title="Manual: general">accumulate-right</a> <a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> 0   
     (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="applied-name" href="xml-support-1.html#meassure-attribute" title="xml-support">meassure-attribute</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#propertylist-to-alist" title="Manual: general">propertylist-to-alist</a> attributes))))

<a name="meassure-attribute"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(meassure-attribute attribute)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">key</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> attribute))
        (<span class="local-name-binding">val</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> attribute)))
    (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX249" title="R5RS Scheme form">+</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> key))
       1
       (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> val)))))
  
<span class="comment">; ------------------------------------------------------------------</span><br />
<div class="schemedoc-section-comment">;;; Parse tree conversions.
;;; In this section we provide a number of conversion functions that work on parse trees.</div>
<a name="parse-tree-to-laml"></a><a name="parse-tree-to-laml"></a><span><a href="../xml-support.html#parse-tree-to-laml"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-tree-to-laml tree output-file)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">prefix</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a>
                  "(load (string-append laml-dir \"laml.scm\")) " 
                  "(laml-style \"simple-html4.0-loose\")"
                  "(write-text-file "))
        (<span class="local-name-binding">html-document</span> (<a class="applied-name" href="xml-support-1.html#parse-tree-2-laml-string" title="xml-support">parse-tree-2-laml-string</a> tree))
        (<span class="local-name-binding">suffix</span> " (string-append (startup-directory) laml-source-file-name-without-extension \".html\"))")
       )
    (<a class="schemedoc-name" href="../../../../lib/man/file-read.html#write-text-file" title="Manual: file-read">write-text-file</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> prefix html-document suffix) output-file)))

<a name="parse-tree-2-laml-string"></a><span class="comment">; Given a parse tree return a string with a LAML version of the tree.</span><br /><a name="parse-tree-2-laml-string"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-tree-2-laml-string tree)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="xml-support-1.html#parse-tree?" title="xml-support">parse-tree?</a> tree)
     (<a class="applied-name" href="xml-support-1.html#parse-tree-2-laml-string-1" title="xml-support">parse-tree-2-laml-string-1</a> tree)
     (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">the-tree</span> 
            (<a class="schemedoc-name" href="../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> 
             (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="applied-name" href="xml-support-1.html#tree-entry?" title="xml-support">tree-entry?</a> x))   (<a class="applied-name" href="xml-support-1.html#subtrees-of-xml-html-parse-tree" title="xml-support">subtrees-of-xml-html-parse-tree</a> tree))))
       (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> the-tree
           (<a class="applied-name" href="xml-support-1.html#parse-tree-2-laml-string-1" title="xml-support">parse-tree-2-laml-string-1</a> the-tree)
           (<a class="schemedoc-name" href="../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "parse-tree-2-laml-string: Cannot find tree structure...")))))
 
<a name="parse-tree-2-laml-string-1"></a><span class="comment">; The function doing the real work</span><br /><a name="parse-tree-2-laml-string-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-tree-2-laml-string-1 tree)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="xml-support-1.html#inner-node?" title="xml-support">inner-node?</a> tree)
           (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="xml-support-1.html#html-tree-node?" title="xml-support">html-tree-node?</a> tree) 
                  (<a class="schemedoc-name" href="../../../../lib/man/general.html#list-to-string" title="Manual: general">list-to-string</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="applied-name" href="xml-support-1.html#parse-tree-2-laml-string-1" title="xml-support">parse-tree-2-laml-string-1</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> tree)) " "))
                 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a>
                  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">root</span> (<a class="applied-name" href="xml-support-1.html#root-of-parse-tree" title="xml-support">root-of-parse-tree</a> tree))
                        (<span class="local-name-binding">subtrees</span> (<a class="applied-name" href="xml-support-1.html#subtrees-of-parse-tree" title="xml-support">subtrees-of-parse-tree</a> tree)))
                    (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a>
                     "(" 
                     (<a class="schemedoc-name" href="../../../../lib/man/general.html#downcase-string" title="Manual: general">downcase-string</a> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> root)) " "
                     (<a class="applied-name" href="xml-support-1.html#lamlify-attributes-string" title="xml-support">lamlify-attributes-string</a> (<a class="applied-name" href="xml-support-1.html#attributes-of-tag-structure" title="xml-support">attributes-of-tag-structure</a> root))
                     (<a class="schemedoc-name" href="../../../../lib/man/general.html#list-to-string" title="Manual: general">list-to-string</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="applied-name" href="xml-support-1.html#parse-tree-2-laml-string-1" title="xml-support">parse-tree-2-laml-string-1</a> subtrees) " ")
                     ")")))))
        ((<a class="applied-name" href="xml-support-1.html#terminal-node?" title="xml-support">terminal-node?</a> tree)
         (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="xml-support-1.html#text-contents-entry?" title="xml-support">text-contents-entry?</a> tree) (<a class="schemedoc-name" href="../../../../lib/man/general.html#string-it" title="Manual: general">string-it</a> (<a class="applied-name" href="xml-support-1.html#string-protect" title="xml-support">string-protect</a> (<a class="applied-name" href="xml-support-1.html#node-info" title="xml-support">node-info</a> tree))))
               ((<a class="applied-name" href="xml-support-1.html#start-end-node?" title="xml-support">start-end-node?</a> tree) 
                (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> 
                 "("
                 (<a class="schemedoc-name" href="../../../../lib/man/general.html#downcase-string" title="Manual: general">downcase-string</a> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> tree)) " "
                 (<a class="applied-name" href="xml-support-1.html#lamlify-attributes-string" title="xml-support">lamlify-attributes-string</a>  (<a class="applied-name" href="xml-support-1.html#attributes-of-tag-structure" title="xml-support">attributes-of-tag-structure</a> tree))
                 ")"))
               (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> "")                <span class="comment">; drops comments and declarations from the output.</span><br />               )
         )
        (error "parse-tree-2-laml: Should not happen 2")))

<a name="lamlify-attributes-string"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(lamlify-attributes-string attr-list)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> attr-list) "")
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">key</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#downcase-string" title="Manual: general">downcase-string</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> attr-list))))
                    (<span class="local-name-binding">val</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cadr</a> attr-list)))
                (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> 
                   "&#39;" key " " (<a class="schemedoc-name" href="../../../../lib/man/general.html#string-it" title="Manual: general">string-it</a> val) " " (<a class="applied-name" href="xml-support-1.html#lamlify-attributes-string" title="xml-support">lamlify-attributes-string</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX325" title="R5RS Scheme form">cddr</a> attr-list)))))))

<a name="string-protect"></a><span class="comment">; Protect internal string quotes in str with backslashes.</span><br /><a name="string-protect"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(string-protect str)</span>
  (<a class="schemedoc-name" href="../../../../lib/man/general.html#replace-string" title="Manual: general">replace-string</a> str (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\") (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX392" title="R5RS Scheme form">string-append</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\\) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> #\"))))



<a name="parse-tree-to-laml-expression"></a><span class="comment">; Transform an XML or HTML parse tree to a LAML surface expressions (in terms of a Scheme list structure).
; This function is similar to parse-tree-to-laml which delivers a textual result 
; (a string) on an output file.
; Feb 2002: There are some problems with this function. Removed from public interface.</span><br /><a name="parse-tree-to-laml-expression"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-tree-to-laml-expression tree)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="xml-support-1.html#inner-node?" title="xml-support">inner-node?</a> tree)
           (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> (<a class="applied-name" href="xml-support-1.html#html-tree-node?" title="xml-support">html-tree-node?</a> tree) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX235" title="R5RS Scheme form">=</a> 1 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX333" title="R5RS Scheme form">length</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> tree)))) 
                    (<a class="applied-name" href="xml-support-1.html#parse-tree-to-laml-expression" title="xml-support">parse-tree-to-laml-expression</a> (<a class="applied-name" href="xml-support-1.html#root-of-parse-tree" title="xml-support">root-of-parse-tree</a> tree)))
                 ((<a class="applied-name" href="xml-support-1.html#html-tree-node?" title="xml-support">html-tree-node?</a> tree) 
                    (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="applied-name" href="xml-support-1.html#parse-tree-to-laml-expression" title="xml-support">parse-tree-to-laml-expression</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> tree)))
                 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a>
                  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">root</span> (<a class="applied-name" href="xml-support-1.html#root-of-parse-tree" title="xml-support">root-of-parse-tree</a> tree))
                        (<span class="local-name-binding">subtrees</span> (<a class="applied-name" href="xml-support-1.html#subtrees-of-parse-tree" title="xml-support">subtrees-of-parse-tree</a> tree)))
                     (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a>
                      (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#downcase-string" title="Manual: general">downcase-string</a> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> root)))
                      (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a>
                       (<a class="applied-name" href="xml-support-1.html#attributes-of-tag-structure" title="xml-support">attributes-of-tag-structure</a> root)
                       (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="applied-name" href="xml-support-1.html#parse-tree-to-laml-expression" title="xml-support">parse-tree-to-laml-expression</a> subtrees)))))))
        ((<a class="applied-name" href="xml-support-1.html#terminal-node?" title="xml-support">terminal-node?</a> tree)
         (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="xml-support-1.html#text-contents-entry?" title="xml-support">text-contents-entry?</a> tree)  (<a class="applied-name" href="xml-support-1.html#node-info" title="xml-support">node-info</a> tree))
               ((<a class="applied-name" href="xml-support-1.html#start-end-node?" title="xml-support">start-end-node?</a> tree) 
                 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a>
                   (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#downcase-string" title="Manual: general">downcase-string</a> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> tree)))
                   (<a class="applied-name" href="xml-support-1.html#attributes-of-tag-structure" title="xml-support">attributes-of-tag-structure</a> tree)))
               (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> "")                <span class="comment">; Problematic !!!</span><br />               ))
        (error "parse-tree-to-laml-expression: Should not happen")))



<a name="parse-tree-to-ast"></a><a name="parse-tree-to-ast"></a><span><a href="../xml-support.html#parse-tree-to-ast"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-tree-to-ast pt language)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="xml-support-1.html#parse-tree?" title="xml-support">parse-tree?</a> pt)
     (<a class="applied-name" href="xml-support-1.html#parse-tree-to-ast-1" title="xml-support">parse-tree-to-ast-1</a> pt language)
     (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">the-tree</span> 
            (<a class="schemedoc-name" href="../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> 
             (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="applied-name" href="xml-support-1.html#tree-entry?" title="xml-support">tree-entry?</a> x))   (<a class="applied-name" href="xml-support-1.html#subtrees-of-xml-html-parse-tree" title="xml-support">subtrees-of-xml-html-parse-tree</a> pt))))
       (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> the-tree
           (<a class="applied-name" href="xml-support-1.html#parse-tree-to-ast-1" title="xml-support">parse-tree-to-ast-1</a> the-tree language)
           (<a class="schemedoc-name" href="../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "parse-tree-to-ast: Cannot locate parse tree proper in the parse tree: " pt)))))

<a name="parse-tree-to-ast-1"></a><span class="comment">; The function doing the real work.</span><br /><a name="parse-tree-to-ast-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-tree-to-ast-1 pt language)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX123" title="R5RS Scheme form">letrec</a> ((<span class="local-name-binding">make-ast</span>  <span class="comment">; restricted version. Precondition: contents is a list.</span><br />           (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">element-name</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span> <span class="local-name-binding">kind</span> <span class="local-name-binding">language</span>)
             (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'ast (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-string" title="Manual: general">as-string</a> element-name) contents attributes (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> kind) (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> language) '())))
          (<span class="local-name-binding">make-xml-comment</span> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">str</span>) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'xml-comment str)))
          (<span class="local-name-binding">make-xml-processing-instruction</span> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">pi-target</span> <span class="local-name-binding">pi-string</span>) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'processing-instruction pi-target pi-string)))
         )
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="applied-name" href="xml-support-1.html#parse-tree?" title="xml-support">parse-tree?</a> pt)
          (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">node</span> (<a class="applied-name" href="xml-support-1.html#root-of-parse-tree" title="xml-support">root-of-parse-tree</a> pt))
                 (<span class="local-name-binding">subtrees</span> (<a class="applied-name" href="xml-support-1.html#subtrees-of-parse-tree" title="xml-support">subtrees-of-parse-tree</a> pt))
                 (<span class="local-name-binding">subtrees-1</span> (<a class="applied-name" href="xml-support-1.html#space-expand-subtrees" title="xml-support">space-expand-subtrees</a> subtrees))  <span class="comment">; handling white spacing</span><br />                )
            (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="xml-support-1.html#start-node?" title="xml-support">start-node?</a> node)
                (make-ast 
                  (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> node)
                  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">st</span>) (<a class="applied-name" href="xml-support-1.html#parse-tree-to-ast-1" title="xml-support">parse-tree-to-ast-1</a> st language)) subtrees-1)
                  (<a class="applied-name" href="xml-support-1.html#attributes-of-tag-structure" title="xml-support">attributes-of-tag-structure</a> node)
                  'double
                  language
                )
                (<a class="schemedoc-name" href="../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "parse-tree-to-ast-1: Parse tree is expected to have a start-node as root: " pt))))
        ((<a class="applied-name" href="xml-support-1.html#textual-content-node?" title="xml-support">textual-content-node?</a> pt) 
            (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX200" title="R5RS Scheme form">equal?</a> pt " ") #t pt))
        ((<a class="applied-name" href="xml-support-1.html#start-end-node?" title="xml-support">start-end-node?</a> pt) (make-ast (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> pt) '() (<a class="applied-name" href="xml-support-1.html#attributes-of-tag-structure" title="xml-support">attributes-of-tag-structure</a> pt) 'single language))
        ((<a class="applied-name" href="xml-support-1.html#start-node?" title="xml-support">start-node?</a> pt) 
          (<a class="schemedoc-name" href="../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "parse-tree-to-ast-1: Start-end node encountered as direct child of tree node. Should not happen: " pt))
        ((<a class="applied-name" href="xml-support-1.html#comment-node?" title="xml-support">comment-node?</a> pt)
            (make-xml-comment (<a class="schemedoc-name" href="../../../../lib/man/general.html#second" title="Manual: general">second</a> pt)))
        ((<a class="applied-name" href="xml-support-1.html#processing-instruction-node?" title="xml-support">processing-instruction-node?</a> pt)
            (make-xml-processing-instruction (<a class="schemedoc-name" href="../../../../lib/man/general.html#second" title="Manual: general">second</a> pt) (<a class="schemedoc-name" href="../../../../lib/man/general.html#third" title="Manual: general">third</a> pt)))
        ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="applied-name" href="xml-support-1.html#declaration-node?" title="xml-support">declaration-node?</a> pt) (<a class="applied-name" href="xml-support-1.html#xml-declaration-node?" title="xml-support">xml-declaration-node?</a> pt)  ""))
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "parse-tree-to-ast-1: Unknown kind of parse tree: " pt)))))

<a name="space-expand-subtrees"></a><span class="comment">; Expand an initial or trailing space in textual items of subtree-list to singleton space strings.
; Assume as a precondition, that textual items have been passed through the function remove-redundant-white-space.</span><br /><a name="space-expand-subtrees"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(space-expand-subtrees subtree-list)</span>
  (<a class="applied-name" href="xml-support-1.html#space-expand-subtrees-1" title="xml-support">space-expand-subtrees-1</a> subtree-list '()))

<a name="space-expand-subtrees-1"></a><span class="comment">; Iterative processing</span><br /><a name="space-expand-subtrees-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(space-expand-subtrees-1 subtree-list res)</span>
  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX330" title="R5RS Scheme form">null?</a> subtree-list) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX335" title="R5RS Scheme form">reverse</a> res))
        ((<a class="applied-name" href="xml-support-1.html#textual-content-node?" title="xml-support">textual-content-node?</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#first" title="Manual: general">first</a> subtree-list))
           (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">str</span> (<a class="schemedoc-name" href="../../../../lib/man/general.html#first" title="Manual: general">first</a> subtree-list))
                  (<span class="local-name-binding">str-len</span> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX378" title="R5RS Scheme form">string-length</a> str))
                  (<span class="local-name-binding">init-space?</span> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> str-len 0) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> #\space (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> str 0)) #f))
                  (<span class="local-name-binding">trailing-space?</span> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX237" title="R5RS Scheme form">&gt;</a> str-len 1) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX196" title="R5RS Scheme form">eqv?</a> #\space (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX379" title="R5RS Scheme form">string-ref</a> str (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> str-len 1))))
                                        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> #f)))
                  (<span class="local-name-binding">new-res</span> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a> ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX117" title="R5RS Scheme form">and</a> init-space? trailing-space?)
				  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> " " (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> str 1 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> str-len 1)) " ") res))
				 (init-space?
				  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> str 1 str-len) " ") res)) <span class="comment">; reversed order</span><br />				 (trailing-space?
				  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX334" title="R5RS Scheme form">append</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> " " (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX391" title="R5RS Scheme form">substring</a> str 0 (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX251" title="R5RS Scheme form">-</a> str-len 1))) res))
				 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> str res)))))
             (<a class="applied-name" href="xml-support-1.html#space-expand-subtrees-1" title="xml-support">space-expand-subtrees-1</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> subtree-list) new-res)))
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="applied-name" href="xml-support-1.html#space-expand-subtrees-1" title="xml-support">space-expand-subtrees-1</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX322" title="R5RS Scheme form">cdr</a> subtree-list) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX320" title="R5RS Scheme form">cons</a> (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX321" title="R5RS Scheme form">car</a> subtree-list) res)))))


              

<a name="parse-tree-to-element-structure"></a><a name="parse-tree-to-element-structure"></a><span><a href="../xml-support.html#parse-tree-to-element-structure"><img src="../../../../images/elucidator/small-prev.gif" title="SchemeDoc Manual entry" alt="" border="0" /></a> <br /></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-tree-to-element-structure pt)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="xml-support-1.html#parse-tree?" title="xml-support">parse-tree?</a> pt)
     (<a class="applied-name" href="xml-support-1.html#parse-tree-to-element-structure-1" title="xml-support">parse-tree-to-element-structure-1</a> pt)
     (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX121" title="R5RS Scheme form">let</a> ((<span class="local-name-binding">the-tree</span> 
            (<a class="schemedoc-name" href="../../../../lib/man/general.html#find-in-list" title="Manual: general">find-in-list</a> 
             (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">x</span>) (<a class="applied-name" href="xml-support-1.html#tree-entry?" title="xml-support">tree-entry?</a> x))   (<a class="applied-name" href="xml-support-1.html#subtrees-of-xml-html-parse-tree" title="xml-support">subtrees-of-xml-html-parse-tree</a> pt))))
       (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> the-tree
           (<a class="applied-name" href="xml-support-1.html#parse-tree-to-element-structure-1" title="xml-support">parse-tree-to-element-structure-1</a> the-tree)
           (<a class="schemedoc-name" href="../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "parse-tree-to-element-structure: Cannot locate parse tree proper in the parse tree: " pt)))))

<a name="parse-tree-to-element-structure-1"></a><span class="comment">; The function doing the real work.</span><br /><a name="parse-tree-to-element-structure-1"></a><span></span>(<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_7.html#IDX173" title="R5RS Scheme form">define</a> <span class="signature">(parse-tree-to-element-structure-1 pt)</span>
 (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX123" title="R5RS Scheme form">letrec</a> ((<span class="local-name-binding">make-element-structure</span> (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX98" title="R5RS Scheme form">lambda</a> (<span class="local-name-binding">name</span> <span class="local-name-binding">contents</span> <span class="local-name-binding">attributes</span>) (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX332" title="R5RS Scheme form">list</a> 'element name contents attributes)))) <span class="comment">; COPIED FROM LENO</span><br />  (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">cond</a>  ((<a class="applied-name" href="xml-support-1.html#parse-tree?" title="xml-support">parse-tree?</a> pt)
          (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX122" title="R5RS Scheme form">let*</a> ((<span class="local-name-binding">node</span> (<a class="applied-name" href="xml-support-1.html#root-of-parse-tree" title="xml-support">root-of-parse-tree</a> pt))
                 (<span class="local-name-binding">subtrees</span> (<a class="applied-name" href="xml-support-1.html#subtrees-of-parse-tree" title="xml-support">subtrees-of-parse-tree</a> pt)))
            (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX103" title="R5RS Scheme form">if</a> (<a class="applied-name" href="xml-support-1.html#start-node?" title="xml-support">start-node?</a> node)
                (make-element-structure
                  (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> node))
                  (<a class="scheme-procedure-name" href="../../../../r5rs/r5rs_8.html#IDX412" title="R5RS Scheme form">map</a> <a class="applied-name" href="xml-support-1.html#parse-tree-to-element-structure-1" title="xml-support">parse-tree-to-element-structure-1</a> subtrees)
                  (<a class="schemedoc-name" href="../../../../lib/man/general.html#propertylist-to-alist" title="Manual: general">propertylist-to-alist</a> (<a class="applied-name" href="xml-support-1.html#attributes-of-tag-structure" title="xml-support">attributes-of-tag-structure</a> node)))
                (<a class="schemedoc-name" href="../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "parse-tree-to-element-structure-1: Parse tree is expected to have a start-node as root: " pt))))
        ((<a class="applied-name" href="xml-support-1.html#textual-content-node?" title="xml-support">textual-content-node?</a> pt) pt)
        ((<a class="applied-name" href="xml-support-1.html#start-end-node?" title="xml-support">start-end-node?</a> pt) 
           (make-element-structure (<a class="schemedoc-name" href="../../../../lib/man/general.html#as-symbol" title="Manual: general">as-symbol</a> (<a class="applied-name" href="xml-support-1.html#tag-of-tag-structure" title="xml-support">tag-of-tag-structure</a> pt)) '() (<a class="schemedoc-name" href="../../../../lib/man/general.html#propertylist-to-alist" title="Manual: general">propertylist-to-alist</a> (<a class="applied-name" href="xml-support-1.html#attributes-of-tag-structure" title="xml-support">attributes-of-tag-structure</a> pt))))
        ((<a class="applied-name" href="xml-support-1.html#start-node?" title="xml-support">start-node?</a> pt) 
           (<a class="schemedoc-name" href="../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "parse-tree-to-element-structure-1: Start-end node encountered as direct child of tree node. Should not happen: " pt))
        ((<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX118" title="R5RS Scheme form">or</a> (<a class="applied-name" href="xml-support-1.html#declaration-node?" title="xml-support">declaration-node?</a> pt) (<a class="applied-name" href="xml-support-1.html#xml-declaration-node?" title="xml-support">xml-declaration-node?</a> pt) (<a class="applied-name" href="xml-support-1.html#comment-node?" title="xml-support">comment-node?</a> pt) ""))
        (<a class="scheme-syntax-name" href="../../../../r5rs/r5rs_6.html#IDX110" title="R5RS Scheme form">else</a> (<a class="schemedoc-name" href="../../../../lib/man/general.html#laml-error" title="Manual: general">laml-error</a> "parse-tree-to-element-structure-1: Unknown kind of parse tree: " pt)))))












</pre></font><div>&nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p> &nbsp; <p></p></div></body></html>